171bdf21d622bbec0bd2347541cdc680
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DateProperty = void 0;
const flatpickr_1 = __importDefault(require("flatpickr"));
const fr_js_1 = require("flatpickr/dist/l10n/fr.js");
const Utils_1 = require("../vault/Utils");
const Property_1 = require("./Property");
const iconMap = {
    "yesterday": "calendar-arrow-down",
    "today": "calendar-check",
    "tomorrow": "calendar-arrow-up",
    "next-week": "calendar-clock"
};
class DateProperty extends Property_1.Property {
    constructor(name, vault, quickSelectIcons, args = {}) {
        super(name, vault, args);
        this.type = "date";
        this.quickSelectIcons = quickSelectIcons;
    }
    // Crée l'affichage du champ date
    fillDisplay(vault, value, update) {
        this.vault = vault;
        const fieldContainer = document.createElement("div");
        fieldContainer.classList.add("field-container-column");
        const field = document.createElement("div");
        field.classList.add("metadata-field");
        const dateContainer = this.createFieldContainerContent(update, value);
        field.appendChild(dateContainer);
        if (this.title) {
            const header = document.createElement("div");
            header.classList.add("metadata-header");
            header.textContent = this.name;
            fieldContainer.appendChild(header);
        }
        fieldContainer.appendChild(field);
        return fieldContainer;
    }
    // Crée un champ d'input pour la date
    createFieldDate(value, update, link) {
        const input = document.createElement("input");
        input.type = "text";
        input.value = value || ""; // Formaté en "YYYY-MM-DD" pour le stockage
        input.classList.add("field-input");
        (0, flatpickr_1.default)(input, {
            dateFormat: "Y-m-d", // Stocker en "YYYY-MM-DD"
            defaultDate: value || "",
            locale: fr_js_1.French,
            onChange: async (selectedDates) => {
                const selectedDate = selectedDates[0];
                if (selectedDate) {
                    // Met à jour la valeur de l'input avec le format "YYYY-MM-DD"
                    input.value = this.formatDateForStorage(selectedDate);
                    await this.updateField(update, input, link);
                }
            },
            onClose: async () => {
                input.value = "";
                await this.updateField(update, input, link);
            }
        });
        return input;
    }
    // Crée un lien qui affiche la date (au format "26 février 2025")
    createFieldLink(value) {
        const link = document.createElement("div");
        link.textContent = value ? this.formatDateForDisplay(value) : "Aucune date sélectionnée";
        link.classList.add("date-field-link");
        link.classList.add("field-link");
        link.style.cursor = "pointer";
        link.onclick = (event) => this.modifyField(event);
        return link;
    }
    // Formate la date pour l'affichage : "26 février 2025"
    formatDateForDisplay(date) {
        const parsedDate = new Date(date);
        return parsedDate.toLocaleDateString("fr-FR", {
            day: "numeric",
            month: "long",
            year: "numeric"
        });
    }
    // Formate la date pour le stockage : "YYYY-MM-DD"
    formatDateForStorage(date) {
        // Use toISOString to avoid timezone issues, then extract date part
        return date.toISOString().split('T')[0];
    }
    // Ajoute les options "Aujourd'hui", "Demain", "Semaine prochaine"
    createQuickSelect(value, update, link, input) {
        const quickSelectContainer = document.createElement("div");
        quickSelectContainer.classList.add("quick-select-container");
        this.quickSelectIcons.forEach(option => {
            const button = document.createElement("button");
            (0, Utils_1.setIcon)(button, iconMap[option]);
            button.addEventListener("click", async () => {
                const date = this.getDateForOption(option); // Obtenir la date pour l'option choisie
                await update(this.formatDateForStorage(date));
                link.textContent = this.formatDateForDisplay(this.formatDateForStorage(date));
                link.style.display = "block";
                input.style.display = "none";
            });
            quickSelectContainer.appendChild(button);
        });
        return quickSelectContainer;
    }
    getDefaultValue() {
        return this.formatDateForStorage(this.getDateForOption(this.default));
    }
    getDateForOption(option) {
        const today = new Date();
        switch (option) {
            case "yesterday": {
                const yesterday = new Date(today);
                yesterday.setDate(today.getDate() - 1);
                return yesterday;
            }
            case "today": return new Date(today);
            case "tomorrow": {
                const tomorrow = new Date(today);
                tomorrow.setDate(today.getDate() + 1);
                return tomorrow;
            }
            case "next-week": {
                const nextWeek = new Date(today);
                nextWeek.setDate(today.getDate() + 7);
                return nextWeek;
            }
            case "2-week": {
                const twoWeeks = new Date(today);
                twoWeeks.setDate(today.getDate() + 14);
                return twoWeeks;
            }
            default: return new Date(today);
        }
    }
    // Crée un conteneur pour afficher la date et la sélection rapide
    createFieldContainerContent(update, value) {
        const fieldContainer = document.createElement("div");
        fieldContainer.classList.add("field-container");
        fieldContainer.classList.add("metadata-field");
        const currentField = value;
        const link = this.createFieldLink(currentField);
        const input = this.createFieldDate(currentField, update, link);
        // Affichage initial : Si la date existe, afficher le lien
        if (currentField && this.validate(value)) {
            link.style.display = "block";
            input.style.display = "none";
        }
        else {
            input.style.display = "block";
            link.style.display = "none";
        }
        // Créer un conteneur avec les boutons de sélection rapide
        const quickSelectContainer = this.createQuickSelect(currentField, update, link, input);
        fieldContainer.appendChild(link);
        fieldContainer.appendChild(input);
        fieldContainer.appendChild(quickSelectContainer);
        return fieldContainer;
    }
    // Met à jour la valeur de la date et bascule l'affichage entre le lien et l'input
    async updateField(update, input, link) {
        let value = this.validate(input.value);
        if (value) {
            await update(value); // Met à jour avec la date au format "YYYY-MM-DD"
            input.style.display = "none";
            link.textContent = this.formatDateForDisplay(value); // Affichage avec le mois en lettres
            link.style.display = "block";
        }
        else {
            await update(input.value);
        }
    }
}
exports.DateProperty = DateProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXERhdGVQcm9wZXJ0eS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSwwREFBa0M7QUFDbEMscURBQW1EO0FBQ25ELDBDQUF5QztBQUN6Qyx5Q0FBc0M7QUFHdEMsTUFBTSxPQUFPLEdBQTZCO0lBQ3RDLFdBQVcsRUFBRyxxQkFBcUI7SUFDbkMsT0FBTyxFQUFHLGdCQUFnQjtJQUMxQixVQUFVLEVBQUcsbUJBQW1CO0lBQ2hDLFdBQVcsRUFBRyxnQkFBZ0I7Q0FDakMsQ0FBQTtBQUVELE1BQWEsWUFBYSxTQUFRLG1CQUFRO0lBS3RDLFlBQVksSUFBWSxFQUFFLEtBQVksRUFBRSxnQkFBMEIsRUFBRSxJQUFJLEdBQUcsRUFBRTtRQUN6RSxLQUFLLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUhiLFNBQUksR0FBWSxNQUFNLENBQUM7UUFJbkMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLGdCQUFnQixDQUFBO0lBRTVDLENBQUM7SUFHRCxpQ0FBaUM7SUFDeEIsV0FBVyxDQUFDLEtBQVcsRUFBRSxLQUFXLEVBQUUsTUFBd0M7UUFDbkYsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsTUFBTSxjQUFjLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNyRCxjQUFjLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1FBRXZELE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUN0QyxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsMkJB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XFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXHNyY1xccHJvcGVydGllc1xcRGF0ZVByb3BlcnR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmbGF0cGlja3IgZnJvbSBcImZsYXRwaWNrclwiO1xyXG5pbXBvcnQgeyBGcmVuY2ggfSBmcm9tIFwiZmxhdHBpY2tyL2Rpc3QvbDEwbi9mci5qc1wiO1xyXG5pbXBvcnQgeyBzZXRJY29uIH0gZnJvbSBcIi4uL3ZhdWx0L1V0aWxzXCI7XHJcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSBcIi4vUHJvcGVydHlcIjtcclxuaW1wb3J0IHsgVmF1bHQgfSBmcm9tIFwiLi4vdmF1bHQvVmF1bHRcIjtcclxuXHJcbmNvbnN0IGljb25NYXAgOiB7W2tleTogc3RyaW5nXSA6IHN0cmluZ309IHsgXHJcbiAgICBcInllc3RlcmRheVwiIDogXCJjYWxlbmRhci1hcnJvdy1kb3duXCIsXHJcbiAgICBcInRvZGF5XCIgOiBcImNhbGVuZGFyLWNoZWNrXCIsXHJcbiAgICBcInRvbW9ycm93XCIgOiBcImNhbGVuZGFyLWFycm93LXVwXCIsXHJcbiAgICBcIm5leHQtd2Vla1wiIDogXCJjYWxlbmRhci1jbG9ja1wiXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBEYXRlUHJvcGVydHkgZXh0ZW5kcyBQcm9wZXJ0eSB7XHJcblxyXG4gICAgcHJpdmF0ZSBxdWlja1NlbGVjdEljb25zOiBzdHJpbmdbXTtcclxuICAgIHB1YmxpYyBvdmVycmlkZSB0eXBlIDogc3RyaW5nID0gXCJkYXRlXCI7XHJcblxyXG4gICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCB2YXVsdDogVmF1bHQsIHF1aWNrU2VsZWN0SWNvbnM6IHN0cmluZ1tdLCBhcmdzID0ge30pIHtcclxuICAgICAgICBzdXBlcihuYW1lLCB2YXVsdCwgYXJncyk7XHJcbiAgICAgICAgdGhpcy5xdWlja1NlbGVjdEljb25zID0gcXVpY2tTZWxlY3RJY29uc1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLyBDcsOpZSBsJ2FmZmljaGFnZSBkdSBjaGFtcCBkYXRlXHJcbiAgICBvdmVycmlkZSBmaWxsRGlzcGxheSh2YXVsdCA6IGFueSwgdmFsdWUgOiBhbnksIHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4pIHtcclxuICAgICAgICB0aGlzLnZhdWx0ID0gdmF1bHQ7XHJcbiAgICAgICAgY29uc3QgZmllbGRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGZpZWxkQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJmaWVsZC1jb250YWluZXItY29sdW1uXCIpO1xyXG5cclxuICAgICAgICBjb25zdCBmaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgZmllbGQuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLWZpZWxkXCIpO1xyXG4gICAgICAgIGNvbnN0IGRhdGVDb250YWluZXIgPSB0aGlzLmNyZWF0ZUZpZWxkQ29udGFpbmVyQ29udGVudCh1cGRhdGUsIHZhbHVlKTtcclxuICAgICAgICBmaWVsZC5hcHBlbmRDaGlsZChkYXRlQ29udGFpbmVyKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMudGl0bGUpIHtcclxuICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgaGVhZGVyLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1oZWFkZXJcIik7XHJcbiAgICAgICAgICAgIGhlYWRlci50ZXh0Q29udGVudCA9IHRoaXMubmFtZVxyXG4gICAgICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChoZWFkZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChmaWVsZCk7XHJcblxyXG4gICAgICAgIHJldHVybiBmaWVsZENvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gQ3LDqWUgdW4gY2hhbXAgZCdpbnB1dCBwb3VyIGxhIGRhdGVcclxuICAgIGNyZWF0ZUZpZWxkRGF0ZSh2YWx1ZTogc3RyaW5nLCB1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+LCBsaW5rOiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgIGlucHV0LnR5cGUgPSBcInRleHRcIjtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IHZhbHVlIHx8IFwiXCI7ICAvLyBGb3JtYXTDqSBlbiBcIllZWVktTU0tRERcIiBwb3VyIGxlIHN0b2NrYWdlXHJcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZChcImZpZWxkLWlucHV0XCIpO1xyXG4gICAgXHJcbiAgICAgICAgZmxhdHBpY2tyKGlucHV0LCB7XHJcbiAgICAgICAgICAgIGRhdGVGb3JtYXQ6IFwiWS1tLWRcIiwgIC8vIFN0b2NrZXIgZW4gXCJZWVlZLU1NLUREXCJcclxuICAgICAgICAgICAgZGVmYXVsdERhdGU6IHZhbHVlIHx8IFwiXCIsXHJcbiAgICAgICAgICAgIGxvY2FsZTogRnJlbmNoLFxyXG4gICAgICAgICAgICBvbkNoYW5nZTogYXN5bmMgKHNlbGVjdGVkRGF0ZXM6IERhdGVbXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWREYXRlID0gc2VsZWN0ZWREYXRlc1swXTtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZERhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBNZXQgw6Agam91ciBsYSB2YWxldXIgZGUgbCdpbnB1dCBhdmVjIGxlIGZvcm1hdCBcIllZWVktTU0tRERcIlxyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gdGhpcy5mb3JtYXREYXRlRm9yU3RvcmFnZShzZWxlY3RlZERhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlRmllbGQodXBkYXRlLCBpbnB1dCwgbGluaylcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb25DbG9zZSA6IGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gXCJcIlxyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVGaWVsZCh1cGRhdGUsIGlucHV0LCBsaW5rKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGlucHV0O1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDcsOpZSB1biBsaWVuIHF1aSBhZmZpY2hlIGxhIGRhdGUgKGF1IGZvcm1hdCBcIjI2IGbDqXZyaWVyIDIwMjVcIilcclxuICAgIG92ZXJyaWRlIGNyZWF0ZUZpZWxkTGluayh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgbGluay50ZXh0Q29udGVudCA9IHZhbHVlID8gdGhpcy5mb3JtYXREYXRlRm9yRGlzcGxheSh2YWx1ZSkgOiBcIkF1Y3VuZSBkYXRlIHPDqWxlY3Rpb25uw6llXCI7XHJcbiAgICAgICAgbGluay5jbGFzc0xpc3QuYWRkKFwiZGF0ZS1maWVsZC1saW5rXCIpO1xyXG4gICAgICAgIGxpbmsuY2xhc3NMaXN0LmFkZChcImZpZWxkLWxpbmtcIik7XHJcbiAgICAgICAgbGluay5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgICBsaW5rLm9uY2xpY2sgPSAoZXZlbnQpID0+IHRoaXMubW9kaWZ5RmllbGQoZXZlbnQpO1xyXG4gICAgICAgIHJldHVybiBsaW5rO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZvcm1hdGUgbGEgZGF0ZSBwb3VyIGwnYWZmaWNoYWdlIDogXCIyNiBmw6l2cmllciAyMDI1XCJcclxuICAgIGZvcm1hdERhdGVGb3JEaXNwbGF5KGRhdGU6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgcGFyc2VkRGF0ZSA9IG5ldyBEYXRlKGRhdGUpO1xyXG4gICAgICAgIHJldHVybiBwYXJzZWREYXRlLnRvTG9jYWxlRGF0ZVN0cmluZyhcImZyLUZSXCIsIHsgXHJcbiAgICAgICAgICAgIGRheTogXCJudW1lcmljXCIsIFxyXG4gICAgICAgICAgICBtb250aDogXCJsb25nXCIsIFxyXG4gICAgICAgICAgICB5ZWFyOiBcIm51bWVyaWNcIiBcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBGb3JtYXRlIGxhIGRhdGUgcG91ciBsZSBzdG9ja2FnZSA6IFwiWVlZWS1NTS1ERFwiXHJcbiAgICBmb3JtYXREYXRlRm9yU3RvcmFnZShkYXRlOiBEYXRlKTogc3RyaW5nIHtcclxuICAgICAgICAvLyBVc2UgdG9JU09TdHJpbmcgdG8gYXZvaWQgdGltZXpvbmUgaXNzdWVzLCB0aGVuIGV4dHJhY3QgZGF0ZSBwYXJ0XHJcbiAgICAgICAgcmV0dXJuIGRhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBBam91dGUgbGVzIG9wdGlvbnMgXCJBdWpvdXJkJ2h1aVwiLCBcIkRlbWFpblwiLCBcIlNlbWFpbmUgcHJvY2hhaW5lXCJcclxuICAgIGNyZWF0ZVF1aWNrU2VsZWN0KHZhbHVlOiBzdHJpbmcsIHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4sIGxpbms6IEhUTUxFbGVtZW50LCBpbnB1dDogSFRNTElucHV0RWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IHF1aWNrU2VsZWN0Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBxdWlja1NlbGVjdENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwicXVpY2stc2VsZWN0LWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5xdWlja1NlbGVjdEljb25zLmZvckVhY2gob3B0aW9uID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICAgICAgc2V0SWNvbihidXR0b24sIGljb25NYXBbb3B0aW9uXSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSB0aGlzLmdldERhdGVGb3JPcHRpb24ob3B0aW9uKTsgIC8vIE9idGVuaXIgbGEgZGF0ZSBwb3VyIGwnb3B0aW9uIGNob2lzaWVcclxuICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZSh0aGlzLmZvcm1hdERhdGVGb3JTdG9yYWdlKGRhdGUpKTtcclxuICAgICAgICAgICAgICAgIGxpbmsudGV4dENvbnRlbnQgPSB0aGlzLmZvcm1hdERhdGVGb3JEaXNwbGF5KHRoaXMuZm9ybWF0RGF0ZUZvclN0b3JhZ2UoZGF0ZSkpO1xyXG4gICAgICAgICAgICAgICAgbGluay5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgICAgICAgICAgICAgaW5wdXQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICB9KTsgXHJcbiAgICBcclxuICAgICAgICAgICAgcXVpY2tTZWxlY3RDb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHF1aWNrU2VsZWN0Q29udGFpbmVyO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGdldERlZmF1bHRWYWx1ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXREYXRlRm9yU3RvcmFnZSh0aGlzLmdldERhdGVGb3JPcHRpb24odGhpcy5kZWZhdWx0KSlcclxuICAgIH1cclxuXHJcbiAgICBnZXREYXRlRm9yT3B0aW9uKG9wdGlvbjogc3RyaW5nKTogRGF0ZSB7XHJcbiAgICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIHN3aXRjaChvcHRpb24pIHtcclxuICAgICAgICAgICAgY2FzZSBcInllc3RlcmRheVwiOiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB5ZXN0ZXJkYXkgPSBuZXcgRGF0ZSh0b2RheSk7XHJcbiAgICAgICAgICAgICAgICB5ZXN0ZXJkYXkuc2V0RGF0ZSh0b2RheS5nZXREYXRlKCkgLSAxKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB5ZXN0ZXJkYXk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBcInRvZGF5XCI6IHJldHVybiBuZXcgRGF0ZSh0b2RheSk7XHJcbiAgICAgICAgICAgIGNhc2UgXCJ0b21vcnJvd1wiOiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0b21vcnJvdyA9IG5ldyBEYXRlKHRvZGF5KTtcclxuICAgICAgICAgICAgICAgIHRvbW9ycm93LnNldERhdGUodG9kYXkuZ2V0RGF0ZSgpICsgMSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdG9tb3Jyb3c7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBcIm5leHQtd2Vla1wiOiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0V2VlayA9IG5ldyBEYXRlKHRvZGF5KTtcclxuICAgICAgICAgICAgICAgIG5leHRXZWVrLnNldERhdGUodG9kYXkuZ2V0RGF0ZSgpICsgNyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dFdlZWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBcIjItd2Vla1wiOiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0d29XZWVrcyA9IG5ldyBEYXRlKHRvZGF5KTtcclxuICAgICAgICAgICAgICAgIHR3b1dlZWtzLnNldERhdGUodG9kYXkuZ2V0RGF0ZSgpICsgMTQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHR3b1dlZWtzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IHJldHVybiBuZXcgRGF0ZSh0b2RheSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENyw6llIHVuIGNvbnRlbmV1ciBwb3VyIGFmZmljaGVyIGxhIGRhdGUgZXQgbGEgc8OpbGVjdGlvbiByYXBpZGVcclxuICAgIG92ZXJyaWRlIGNyZWF0ZUZpZWxkQ29udGFpbmVyQ29udGVudCh1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+LCB2YWx1ZTogc3RyaW5nKTogSFRNTERpdkVsZW1lbnQge1xyXG4gICAgICAgIGNvbnN0IGZpZWxkQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBmaWVsZENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiZmllbGQtY29udGFpbmVyXCIpO1xyXG4gICAgICAgIGZpZWxkQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1maWVsZFwiKTtcclxuXHJcbiAgICAgICAgY29uc3QgY3VycmVudEZpZWxkID0gdmFsdWU7XHJcbiAgICAgICAgY29uc3QgbGluayA9IHRoaXMuY3JlYXRlRmllbGRMaW5rKGN1cnJlbnRGaWVsZCk7XHJcbiAgICAgICAgY29uc3QgaW5wdXQgPSB0aGlzLmNyZWF0ZUZpZWxkRGF0ZShjdXJyZW50RmllbGQsIHVwZGF0ZSwgbGluayk7XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIC8vIEFmZmljaGFnZSBpbml0aWFsIDogU2kgbGEgZGF0ZSBleGlzdGUsIGFmZmljaGVyIGxlIGxpZW5cclxuICAgICAgICBpZiAoY3VycmVudEZpZWxkICYmIHRoaXMudmFsaWRhdGUodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIGxpbmsuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgICAgICAgICAgaW5wdXQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlucHV0LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICAgICAgICAgIGxpbmsuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ3LDqWVyIHVuIGNvbnRlbmV1ciBhdmVjIGxlcyBib3V0b25zIGRlIHPDqWxlY3Rpb24gcmFwaWRlXHJcbiAgICAgICAgY29uc3QgcXVpY2tTZWxlY3RDb250YWluZXIgPSB0aGlzLmNyZWF0ZVF1aWNrU2VsZWN0KGN1cnJlbnRGaWVsZCwgdXBkYXRlLCBsaW5rLCBpbnB1dCk7XHJcblxyXG4gICAgICAgIGZpZWxkQ29udGFpbmVyLmFwcGVuZENoaWxkKGxpbmspO1xyXG4gICAgICAgIGZpZWxkQ29udGFpbmVyLmFwcGVuZENoaWxkKGlucHV0KTtcclxuICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChxdWlja1NlbGVjdENvbnRhaW5lcik7XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIHJldHVybiBmaWVsZENvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBNZXQgw6Agam91ciBsYSB2YWxldXIgZGUgbGEgZGF0ZSBldCBiYXNjdWxlIGwnYWZmaWNoYWdlIGVudHJlIGxlIGxpZW4gZXQgbCdpbnB1dFxyXG4gICAgb3ZlcnJpZGUgYXN5bmMgdXBkYXRlRmllbGQodXBkYXRlOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPiwgaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQsIGxpbms6IEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgbGV0IHZhbHVlID0gdGhpcy52YWxpZGF0ZShpbnB1dC52YWx1ZSk7XHJcbiAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZSh2YWx1ZSk7ICAvLyBNZXQgw6Agam91ciBhdmVjIGxhIGRhdGUgYXUgZm9ybWF0IFwiWVlZWS1NTS1ERFwiXHJcbiAgICAgICAgICAgIGlucHV0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgbGluay50ZXh0Q29udGVudCA9IHRoaXMuZm9ybWF0RGF0ZUZvckRpc3BsYXkodmFsdWUpOyAgLy8gQWZmaWNoYWdlIGF2ZWMgbGUgbW9pcyBlbiBsZXR0cmVzXHJcbiAgICAgICAgICAgIGxpbmsuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBhd2FpdCB1cGRhdGUoaW5wdXQudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==