{"file":"C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\__tests__\\Config\\ConfigLoader.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\__tests__\\Config\\ConfigLoader.test.ts"],"sourcesContent":["import { ConfigLoader } from '../../src/Config/ConfigLoader';\r\nimport * as yaml from 'js-yaml';\r\n\r\n// Mock js-yaml\r\njest.mock('js-yaml');\r\n\r\ndescribe('ConfigLoader', () => {\r\n    let configLoader: ConfigLoader;\r\n    let mockApp: any;\r\n    let mockYaml: jest.Mocked<typeof yaml>;\r\n\r\n    beforeEach(() => {\r\n        jest.clearAllMocks();\r\n        \r\n        mockApp = {\r\n            vault: {\r\n                adapter: {\r\n                    fs: {\r\n                        readFileSync: jest.fn()\r\n                    }\r\n                }\r\n            },\r\n            getVaultPath: jest.fn(() => '/test/vault'),\r\n            getName: jest.fn(() => 'TestVault')\r\n        };\r\n\r\n        mockYaml = yaml as jest.Mocked<typeof yaml>;\r\n        \r\n        configLoader = new ConfigLoader('./test-config', mockApp);\r\n    });\r\n\r\n    describe('constructor', () => {\r\n        it('should create instance with config path and app', () => {\r\n            expect(configLoader).toBeInstanceOf(ConfigLoader);\r\n        });\r\n    });\r\n\r\n    describe('getConfigPath', () => {\r\n        it('should return config path', () => {\r\n            const path = configLoader.getConfigPath();\r\n            expect(path).toBe('./test-config');\r\n        });\r\n    });\r\n\r\n    describe('loadClassConfig', () => {\r\n        it('should load and parse class config from YAML', async () => {\r\n            const mockYamlContent = `\r\nclassName: TestClass\r\nclassIcon: test-icon\r\nproperties:\r\n  - name: testProp\r\n    type: text\r\n    title: Test Property\r\ndisplayContainer:\r\n  template: default\r\n`;\r\n            const mockConfig = {\r\n                className: 'TestClass',\r\n                classIcon: 'test-icon',\r\n                properties: [{\r\n                    name: 'testProp',\r\n                    type: 'text',\r\n                    title: 'Test Property'\r\n                }],\r\n                displayContainer: {\r\n                    template: 'default'\r\n                }\r\n            };\r\n\r\n            if (mockApp.vault?.adapter?.fs?.readFileSync) {\r\n                mockApp.vault.adapter.fs.readFileSync.mockReturnValue(mockYamlContent);\r\n            }\r\n            mockYaml.load.mockReturnValue(mockConfig);\r\n            \r\n            const result = await configLoader.loadClassConfig('TestClass');\r\n            \r\n            expect(result).toEqual(mockConfig);\r\n            expect(mockYaml.load).toHaveBeenCalledWith(mockYamlContent);\r\n        });\r\n\r\n        it('should return cached config if already loaded', async () => {\r\n            const mockConfig = {\r\n                className: 'TestClass',\r\n                classIcon: 'test-icon',\r\n                properties: [],\r\n                displayContainer: { template: 'default' }\r\n            };\r\n\r\n            // First load\r\n            if (mockApp.vault?.adapter?.fs?.readFileSync) {\r\n                mockApp.vault.adapter.fs.readFileSync.mockReturnValue('test: config');\r\n            }\r\n            mockYaml.load.mockReturnValue(mockConfig);\r\n            \r\n            const firstResult = await configLoader.loadClassConfig('TestClass');\r\n            \r\n            // Second load - should return cached\r\n            jest.clearAllMocks();\r\n            const secondResult = await configLoader.loadClassConfig('TestClass');\r\n            \r\n            expect(firstResult).toBe(secondResult);\r\n            expect(mockYaml.load).not.toHaveBeenCalled();\r\n        });\r\n\r\n        it('should handle file read errors', async () => {\r\n            const error = new Error('File not found');\r\n            if (mockApp.vault?.adapter?.fs?.readFileSync) {\r\n                mockApp.vault.adapter.fs.readFileSync.mockImplementation(() => {\r\n                    throw error;\r\n                });\r\n            }\r\n            \r\n            await expect(configLoader.loadClassConfig('NonExistent'))\r\n                .rejects.toThrow('File not found');\r\n        });\r\n\r\n        it('should handle YAML parse errors', async () => {\r\n            const yamlError = new Error('Invalid YAML');\r\n            if (mockApp.vault?.adapter?.fs?.readFileSync) {\r\n                mockApp.vault.adapter.fs.readFileSync.mockReturnValue('invalid: yaml: content');\r\n            }\r\n            mockYaml.load.mockImplementation(() => {\r\n                throw yamlError;\r\n            });\r\n            \r\n            await expect(configLoader.loadClassConfig('InvalidConfig'))\r\n                .rejects.toThrow('Invalid YAML');\r\n        });\r\n    });\r\n\r\n    describe('loadConfig', () => {\r\n        it('should load main configuration', async () => {\r\n            const mockConfig = {\r\n                classes: ['TestClass1', 'TestClass2'],\r\n                settings: {\r\n                    templateFolder: 'Templates'\r\n                }\r\n            };\r\n\r\n            if (mockApp.vault?.adapter?.fs?.readFileSync) {\r\n                mockApp.vault.adapter.fs.readFileSync.mockReturnValue('classes: [TestClass1, TestClass2]');\r\n            }\r\n            mockYaml.load.mockReturnValue(mockConfig);\r\n            \r\n            const result = await configLoader.loadConfig();\r\n            \r\n            expect(result).toEqual(mockConfig);\r\n            expect(mockYaml.load).toHaveBeenCalled();\r\n        });\r\n    });\r\n\r\n    describe('validateConfig', () => {\r\n        it('should validate valid config', () => {\r\n            const validConfig = {\r\n                className: 'TestClass',\r\n                classIcon: 'test-icon',\r\n                properties: [{\r\n                    name: 'testProp',\r\n                    type: 'text',\r\n                    title: 'Test Property'\r\n                }],\r\n                displayContainer: {\r\n                    template: 'default'\r\n                }\r\n            };\r\n\r\n            expect(() => configLoader.validateConfig(validConfig)).not.toThrow();\r\n        });\r\n\r\n        it('should throw error for missing required fields', () => {\r\n            const invalidConfig = {\r\n                classIcon: 'test-icon',\r\n                properties: [],\r\n                displayContainer: { template: 'default' }\r\n                // Missing className\r\n            };\r\n\r\n            expect(() => configLoader.validateConfig(invalidConfig as any))\r\n                .toThrow('Missing required field: className');\r\n        });\r\n\r\n        it('should throw error for invalid property config', () => {\r\n            const invalidConfig = {\r\n                className: 'TestClass',\r\n                classIcon: 'test-icon',\r\n                properties: [{\r\n                    name: 'testProp',\r\n                    // Missing type\r\n                    title: 'Test Property'\r\n                }],\r\n                displayContainer: { template: 'default' }\r\n            };\r\n\r\n            expect(() => configLoader.validateConfig(invalidConfig as any))\r\n                .toThrow();\r\n        });\r\n    });\r\n});"],"version":3}