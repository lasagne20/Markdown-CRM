51722fcc09179145720d559355bee286
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.LinkProperty = void 0;
const Property_1 = require("./Property");
class LinkProperty extends Property_1.Property {
    constructor(name, args = { icon: "square-arrow-out-up-right" }) {
        super(name, args);
        this.type = "link";
    }
    createIconContainer(update) {
        const iconContainer = super.createIconContainer(update);
        iconContainer.style.cursor = "pointer";
        if (!this.static) {
            iconContainer.addEventListener("click", (event) => this.modifyField(event));
        }
        return iconContainer;
    }
    validate(url) {
        // Ajoute le préfixe "http://" si l'URL ne commence pas par http:// ou https://
        let fixedUrl = url.trim();
        // Si le lien ne commence pas par http:// ou https://, ajoute "http://"
        if (!/^https?:\/\//i.test(fixedUrl)) {
            fixedUrl = "http://" + fixedUrl;
        }
        const urlRegex = /^(https?:\/\/)?([a-zA-Z0-9_-]+\.)+[a-zA-Z]{2,6}(\/[a-zA-Z0-9_-]+)*\/?$/;
        if (!urlRegex.test(fixedUrl)) {
            return "";
        }
        return fixedUrl;
    }
    getPretty(value) {
        if (!value)
            return value;
        try {
            const urlObj = new URL(value);
            // Garde le domaine, puis les premiers segments du chemin si trop long
            let pretty = urlObj.hostname;
            if (urlObj.pathname && urlObj.pathname !== "/") {
                const segments = urlObj.pathname.split("/").filter(Boolean);
                if (segments.length > 2) {
                    pretty += "/" + segments.slice(0, 2).join("/") + "/...";
                }
                else {
                    pretty += urlObj.pathname;
                }
            }
            return pretty;
        }
        catch {
            // Si ce n'est pas une URL valide, retourne la valeur d'origine sans protocole
            return value.replace(/^https?:\/\//, "");
        }
    }
    // Fonction pour créer le lien de l'field
    createFieldLink(value) {
        const link = document.createElement("a");
        link.href = this.getLink(value);
        link.textContent = this.getPretty(value) || "";
        link.classList.add("field-link");
        link.addEventListener("contextmenu", (event) => {
            event.preventDefault();
            const value = link.textContent;
            if (value) {
                navigator.clipboard.writeText(value).then(() => {
                    new Notice("Lien copié dans le presse-papiers");
                });
            }
        });
        return link;
    }
}
exports.LinkProperty = LinkProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXExpbmtQcm9wZXJ0eS50cyIsIm1hcHBpbmdzIjoiOzs7QUFDQSx5Q0FBc0M7QUFRdEMsTUFBYSxZQUFhLFNBQVEsbUJBQVE7SUFJeEMsWUFBWSxJQUFZLEVBQUUsT0FBeUIsRUFBRSxJQUFJLEVBQUUsMkJBQTJCLEVBQUU7UUFDdEYsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUhYLFNBQUksR0FBWSxNQUFNLENBQUM7SUFJaEMsQ0FBQztJQUVRLG1CQUFtQixDQUFDLE1BQXdDO1FBQ25FLE1BQU0sYUFBYSxHQUFHLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4RCxhQUFhLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUM7UUFFdkMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNqQixhQUFhLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDOUUsQ0FBQztRQUVELE9BQU8sYUFBYSxDQUFDO0lBQ3ZCLENBQUM7SUFHVSxRQUFRLENBQUMsR0FBVztRQUMzQiwrRUFBK0U7UUFDL0UsSUFBSSxRQUFRLEdBQUcsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1FBRTFCLHVFQUF1RTtRQUN2RSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1lBQ2xDLFFBQVEsR0FBRyxTQUFTLEdBQUcsUUFBUSxDQUFDO1FBQ3BDLENBQUM7UUFDRCxNQUFNLFFBQVEsR0FBRyx3RUFBd0UsQ0FBQztRQUMxRixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1lBQzNCLE9BQU8sRUFBRSxDQUFDO1FBQ2QsQ0FBQztRQUNELE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFHUSxTQUFTLENBQUMsS0FBYTtRQUM5QixJQUFJLENBQUMsS0FBSztZQUFFLE9BQU8sS0FBSyxDQUFDO1FBQ3pCLElBQUksQ0FBQztZQUNILE1BQU0sTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlCLHNFQUFzRTtZQUN0RSxJQUFJLE1BQU0sR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDO1lBQzdCLElBQUksTUFBTSxDQUFDLFFBQVEsSUFBSSxNQUFNLENBQUMsUUFBUSxLQUFLLEdBQUcsRUFBRSxDQUFDO2dCQUMvQyxNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzVELElBQUksUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDeEIsTUFBTSxJQUFJLEdBQUcsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDO2dCQUMxRCxDQUFDO3FCQUFNLENBQUM7b0JBQ04sTUFBTSxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUM7Z0JBQzVCLENBQUM7WUFDSCxDQUFDO1lBQ0QsT0FBTyxNQUFNLENBQUM7UUFDaEIsQ0FBQztRQUFDLE1BQU0sQ0FBQztZQUNQLDhFQUE4RTtZQUM5RSxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzNDLENBQUM7SUFDSCxDQUFDO0lBRUQseUNBQXlDO0lBQ2hDLGVBQWUsQ0FBQyxLQUFhO1FBQ3BDLE1BQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDL0MsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQzdDLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUN2QixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO1lBQy9CLElBQUksS0FBSyxFQUFFLENBQUM7Z0JBQ1YsU0FBUyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRTtvQkFDakQsSUFBSSxNQUFNLENBQUMsbUNBQW1DLENBQUMsQ0FBQztnQkFDOUMsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Q0FDSjtBQTFFRCxvQ0EwRUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXExpbmtQcm9wZXJ0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNeVZhdWx0IH0gZnJvbSBcIi4uL3ZhdWx0L015VmF1bHRcIjtcclxuaW1wb3J0IHsgUHJvcGVydHkgfSBmcm9tIFwiLi9Qcm9wZXJ0eVwiO1xyXG5pbXBvcnQgeyBzZXRJY29uIH0gZnJvbSBcIi4uL3ZhdWx0L1V0aWxzXCI7XHJcblxyXG4vLyBUZW1wb3JhcnkgdHlwZSBkZWNsYXJhdGlvbiBmb3IgbWlzc2luZyBpbXBvcnRcclxuZGVjbGFyZSBjb25zdCBOb3RpY2U6IGFueTtcclxuXHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIExpbmtQcm9wZXJ0eSBleHRlbmRzIFByb3BlcnR5e1xyXG5cclxuICBvdmVycmlkZSB0eXBlIDogc3RyaW5nID0gXCJsaW5rXCI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgYXJnczogeyBpY29uPzogc3RyaW5nfSA9IHsgaWNvbjogXCJzcXVhcmUtYXJyb3ctb3V0LXVwLXJpZ2h0XCIgfSkge1xyXG4gICAgc3VwZXIobmFtZSwgYXJncyk7XHJcbiAgfVxyXG5cclxuICBvdmVycmlkZSBjcmVhdGVJY29uQ29udGFpbmVyKHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4pIHtcclxuICAgIGNvbnN0IGljb25Db250YWluZXIgPSBzdXBlci5jcmVhdGVJY29uQ29udGFpbmVyKHVwZGF0ZSk7XHJcbiAgICBpY29uQ29udGFpbmVyLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xyXG5cclxuICAgIGlmICghdGhpcy5zdGF0aWMpIHtcclxuICAgICAgaWNvbkNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB0aGlzLm1vZGlmeUZpZWxkKGV2ZW50KSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGljb25Db250YWluZXI7XHJcbiAgfVxyXG5cclxuXHJcbiAgICBvdmVycmlkZSB2YWxpZGF0ZSh1cmw6IHN0cmluZykge1xyXG4gICAgICAvLyBBam91dGUgbGUgcHLDqWZpeGUgXCJodHRwOi8vXCIgc2kgbCdVUkwgbmUgY29tbWVuY2UgcGFzIHBhciBodHRwOi8vIG91IGh0dHBzOi8vXHJcbiAgICAgIGxldCBmaXhlZFVybCA9IHVybC50cmltKCk7XHJcbiAgXHJcbiAgICAgIC8vIFNpIGxlIGxpZW4gbmUgY29tbWVuY2UgcGFzIHBhciBodHRwOi8vIG91IGh0dHBzOi8vLCBham91dGUgXCJodHRwOi8vXCJcclxuICAgICAgaWYgKCEvXmh0dHBzPzpcXC9cXC8vaS50ZXN0KGZpeGVkVXJsKSkge1xyXG4gICAgICAgICAgZml4ZWRVcmwgPSBcImh0dHA6Ly9cIiArIGZpeGVkVXJsO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHVybFJlZ2V4ID0gL14oaHR0cHM/OlxcL1xcLyk/KFthLXpBLVowLTlfLV0rXFwuKStbYS16QS1aXXsyLDZ9KFxcL1thLXpBLVowLTlfLV0rKSpcXC8/JC87XHJcbiAgICAgIGlmICghdXJsUmVnZXgudGVzdChmaXhlZFVybCkpIHtcclxuICAgICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBmaXhlZFVybDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgb3ZlcnJpZGUgZ2V0UHJldHR5KHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuIHZhbHVlO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVybE9iaiA9IG5ldyBVUkwodmFsdWUpO1xyXG4gICAgICAgIC8vIEdhcmRlIGxlIGRvbWFpbmUsIHB1aXMgbGVzIHByZW1pZXJzIHNlZ21lbnRzIGR1IGNoZW1pbiBzaSB0cm9wIGxvbmdcclxuICAgICAgICBsZXQgcHJldHR5ID0gdXJsT2JqLmhvc3RuYW1lO1xyXG4gICAgICAgIGlmICh1cmxPYmoucGF0aG5hbWUgJiYgdXJsT2JqLnBhdGhuYW1lICE9PSBcIi9cIikge1xyXG4gICAgICAgICAgY29uc3Qgc2VnbWVudHMgPSB1cmxPYmoucGF0aG5hbWUuc3BsaXQoXCIvXCIpLmZpbHRlcihCb29sZWFuKTtcclxuICAgICAgICAgIGlmIChzZWdtZW50cy5sZW5ndGggPiAyKSB7XHJcbiAgICAgICAgICAgIHByZXR0eSArPSBcIi9cIiArIHNlZ21lbnRzLnNsaWNlKDAsIDIpLmpvaW4oXCIvXCIpICsgXCIvLi4uXCI7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwcmV0dHkgKz0gdXJsT2JqLnBhdGhuYW1lO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcHJldHR5O1xyXG4gICAgICB9IGNhdGNoIHtcclxuICAgICAgICAvLyBTaSBjZSBuJ2VzdCBwYXMgdW5lIFVSTCB2YWxpZGUsIHJldG91cm5lIGxhIHZhbGV1ciBkJ29yaWdpbmUgc2FucyBwcm90b2NvbGVcclxuICAgICAgICByZXR1cm4gdmFsdWUucmVwbGFjZSgvXmh0dHBzPzpcXC9cXC8vLCBcIlwiKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEZvbmN0aW9uIHBvdXIgY3LDqWVyIGxlIGxpZW4gZGUgbCdmaWVsZFxyXG4gICAgb3ZlcnJpZGUgY3JlYXRlRmllbGRMaW5rKHZhbHVlOiBzdHJpbmcpIDogYW55IHtcclxuICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG4gICAgICBsaW5rLmhyZWYgPSB0aGlzLmdldExpbmsodmFsdWUpO1xyXG4gICAgICBsaW5rLnRleHRDb250ZW50ID0gdGhpcy5nZXRQcmV0dHkodmFsdWUpIHx8IFwiXCI7XHJcbiAgICAgIGxpbmsuY2xhc3NMaXN0LmFkZChcImZpZWxkLWxpbmtcIik7XHJcbiAgICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBsaW5rLnRleHRDb250ZW50O1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQodmFsdWUpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIG5ldyBOb3RpY2UoXCJMaWVuIGNvcGnDqSBkYW5zIGxlIHByZXNzZS1wYXBpZXJzXCIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGxpbms7XHJcbiAgICB9XHJcbn0iXSwidmVyc2lvbiI6M30=