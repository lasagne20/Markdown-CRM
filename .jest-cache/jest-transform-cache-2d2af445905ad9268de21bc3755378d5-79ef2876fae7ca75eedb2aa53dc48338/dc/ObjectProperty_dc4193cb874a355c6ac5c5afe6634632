e90d635713afb9991829edac34919eca
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ObjectProperty = void 0;
const Property_1 = require("./Property");
const FileProperty_1 = require("./FileProperty");
class ObjectProperty extends Property_1.Property {
    constructor(name, vault, properties, args = {}) {
        super(name, vault, args);
        this.type = "object";
        this.flexSpan = 2;
        this.appendFirst = false;
        this.allowMove = true;
        this.display = "object"; // Can be "object", "table" or "list"
        this.appendFirst = args?.appendFirst || false;
        this.properties = properties;
        this.allowMove = args?.allowMove || true;
        // Assign any additional arguments to the instance
        Object.assign(this, args);
    }
    getClasses() {
        for (let prop of Object.values(this.properties)) {
            if (prop instanceof FileProperty_1.FileProperty || prop instanceof ObjectProperty || prop.type == "multiFile") {
                return prop.getClasses();
            }
        }
        throw new Error("No class found");
    }
    // Used by the ClasseProperty to get the parent file
    getParentValue(values) {
        if (values && values.length) {
            for (let prop of Object.values(this.properties)) {
                if (prop instanceof FileProperty_1.FileProperty || prop instanceof ObjectProperty || prop.type == "multiFile") {
                    return prop.getParentValue(values[0][prop.name]);
                }
            }
        }
        return undefined;
    }
    findValue(file, value, propertyName) {
        let values = this.read(file);
        if (values && values.length) {
            for (let i = 0; i < values.length; i++) {
                for (let prop of Object.values(this.properties)) {
                    let propValue = values[i][prop.name];
                    if (propValue && (propValue == value || (typeof propValue === "string" && propValue.includes(value)))) {
                        return values[i][propertyName];
                    }
                }
            }
        }
        return null;
    }
    getDisplayProperties(file, propertyClasseName, propertyName, isStatic = true) {
        let properties = [];
        this.vault = file.vault;
        let values = this.read(file);
        if (!(propertyName in this.properties)) {
            throw new Error("Property " + propertyName + " not found in ObjectProperty " + this.name);
        }
        let property = this.properties[propertyName];
        if (values && values.length) {
            for (let [index, row] of values.entries()) {
                property.static = isStatic;
                let display = property.fillDisplay(this.vault, row[property.name], async (value) => await this.updateObject(values, async (value) => await file.updateMetadata(this.name, value), index, property, value));
                let classe = this.vault.getFromLink(row[this.properties[propertyClasseName].name]);
                properties.push({ classe: classe, display: display });
            }
        }
        return properties;
    }
    formatParentValue(value) {
        let newObject = {};
        Object.values(this.properties).forEach(prop => {
            if (value && prop instanceof FileProperty_1.FileProperty || prop instanceof ObjectProperty || prop.type == "multiFile") {
                newObject[prop.name] = value;
                value = ""; // Only one parent
            }
            else {
                newObject[prop.name] = "";
            }
        });
        return [newObject];
    }
    getDisplay(file, args) {
        this.display = args?.display || this.display;
        return super.getDisplay(file, args);
    }
    // Méthode principale pour obtenir l'affichage
    fillDisplay(vault, values, update) {
        this.vault = vault;
        const container = document.createElement("div");
        container.classList.add("metadata-object-container-" + this.name.toLowerCase());
        // Créer l'en-tête
        this.createHeader(values, update, container);
        if (this.display == "table") {
            this.createTable(values, update, container);
        }
        else {
            // Affichage par défaut (objet)
            this.createObjects(values, update, container);
        }
        // Créer les lignes d'objet
        return container;
    }
    createTable(values, update, container) {
        // Créer un tableau pour les objets
        const tableWrapper = document.createElement("div");
        tableWrapper.style.position = "relative";
        container.appendChild(tableWrapper);
        let addButton = this.createAddButton(values, update, container);
        addButton.style.position = "absolute";
        addButton.style.top = "0";
        addButton.style.right = "0";
        tableWrapper.appendChild(addButton);
        const table = document.createElement("table");
        table.classList.add("metadata-object-table");
        tableWrapper.appendChild(table);
        // Créer l'en-tête du tableau
        const headerRow = document.createElement("tr");
        Object.values(this.properties).forEach(property => {
            const th = document.createElement("th");
            th.textContent = property.name;
            headerRow.appendChild(th);
        });
        // Ajouter une colonne pour le bouton de suppression
        const thDelete = document.createElement("th");
        headerRow.appendChild(thDelete);
        table.appendChild(headerRow);
        if (values && values.length) {
            // Créer les lignes d'objet
            values.forEach((objects, index) => {
                const row = document.createElement("tr");
                Object.values(this.properties).forEach(property => {
                    const td = document.createElement("td");
                    td.appendChild(property.fillDisplay(this.vault, objects[property.name], async (value) => await this.updateObject(values, update, index, property, value)));
                    row.appendChild(td);
                });
                // Cellule pour le bouton de suppression
                const tdDelete = document.createElement("td");
                tdDelete.classList.add("metadata-object-delete-cell");
                const deleteButton = this.createDeleteButton(values, update, index, container);
                deleteButton.classList.add("metadata-object-delete-button");
                tdDelete.appendChild(deleteButton);
                row.appendChild(tdDelete);
                table.appendChild(row);
            });
        }
    }
    // Crée l'en-tête avec les propriétés
    createHeader(values, update, container) {
        const headerRow = document.createElement("div");
        headerRow.classList.add("metadata-object-header-row");
        let title = document.createElement("div");
        title.textContent = this.title ? this.title : this.name + " : ";
        title.classList.add("metadata-header");
        headerRow.appendChild(title);
        // Ajouter le bouton d'ajout
        const addButton = this.createAddButton(values, update, container);
        headerRow.appendChild(addButton);
        container.appendChild(headerRow);
    }
    // Crée le bouton d'ajout d'un nouvel objet
    createAddButton(values, update, container) {
        const addButton = document.createElement("button");
        this.vault.app.setIcon(addButton, "circle-plus");
        addButton.classList.add("metadata-add-button");
        addButton.onclick = async () => await this.addProperty(values, update, container);
        return addButton;
    }
    // Crée les objets et les lignes à afficher
    createObjects(values, update, container) {
        if (!values) {
            return;
        }
        values.forEach((objects, index) => {
            const row = this.createObjectRow(values, update, objects, index, container);
            container.appendChild(row);
        });
        if (this.allowMove) {
            this.enableDragAndDrop(values, update, container);
        }
    }
    // Crée une ligne d'objet avec ses propriétés
    createObjectRow(values, update, objects, index, container) {
        const row = document.createElement("div");
        row.classList.add("metadata-object-row");
        if (this.allowMove) {
            row.draggable = true;
            row.dataset.index = index.toString();
            row.style.cursor = "grab";
        }
        // Ajouter le bouton de suppression
        const deleteButton = this.createDeleteButton(values, update, index, container);
        deleteButton.style.position = "absolute";
        deleteButton.style.top = "0";
        deleteButton.style.right = "0";
        row.style.position = "relative";
        row.appendChild(deleteButton);
        Object.values(this.properties).forEach(property => {
            let value = objects[property.name];
            let propertyContainer = document.createElement("div");
            propertyContainer.classList.add("metadata-object-property");
            if (property.flexSpan) {
                propertyContainer.style.gridColumn = "span " + property.flexSpan;
            }
            const title = document.createElement("div");
            title.textContent = property.name;
            title.classList.add("metadata-title");
            propertyContainer.appendChild(title);
            propertyContainer.appendChild(property.fillDisplay(this.vault, value, async (value) => await this.updateObject(values, update, index, property, value)));
            row.appendChild(propertyContainer);
        });
        return row;
    }
    // Crée un bouton de suppression pour une ligne d'objet
    createDeleteButton(values, update, index, container) {
        const deleteButton = document.createElement("button");
        this.vault.app.setIcon(deleteButton, "circle-minus");
        deleteButton.classList.add("metadata-delete-button");
        deleteButton.onclick = async () => await this.removeProperty(values, update, index, container);
        return deleteButton;
    }
    // Gère le glisser-déposer pour réordonner les objets
    enableDragAndDrop(values, update, container) {
        let draggedElement = null;
        let isEditing = false;
        // Lorsque l'utilisateur clique dans un champ d'édition (input), on active l'édition
        document.addEventListener("focus", (event) => {
            const input = event.target;
            if (input?.classList.contains('field-input')) {
                isEditing = true; // Le champ est en mode édition
            }
        }, true);
        // Lorsque l'utilisateur quitte un champ d'édition (blur), on désactive l'édition
        document.addEventListener("blur", (event) => {
            const input = event.target;
            if (input?.classList.contains('field-input')) {
                isEditing = false; // Le champ n'est plus en mode édition
            }
        }, true);
        container.addEventListener("dragstart", (event) => {
            if (isEditing) {
                event.preventDefault();
                return;
            }
            draggedElement = event.target;
            draggedElement.classList.add("dragging");
        });
        container.addEventListener("dragover", (event) => {
            event.preventDefault();
            const afterElement = this.getDragAfterElement(container, event.clientY);
            if (afterElement == null) {
                container.appendChild(draggedElement);
            }
            else {
                container.insertBefore(draggedElement, afterElement);
            }
        });
        container.addEventListener("dragend", async () => {
            if (!draggedElement)
                return;
            draggedElement.classList.remove("dragging");
            // Récupérer le nouvel ordre des éléments
            await this.updateOrder(values, update, container);
        });
    }
    // Trouver l'élément après lequel insérer (pour le Drag & Drop)
    getDragAfterElement(container, y) {
        const draggableElements = Array.from(container.querySelectorAll(".metadata-object-row:not(.dragging)"));
        const result = draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            return offset < 0 && offset > closest.offset ? { offset, element: child } : closest;
        }, { offset: Number.NEGATIVE_INFINITY, element: null });
        return result.element;
    }
    // Met à jour l'ordre des éléments après un glisser-déposer
    async updateOrder(values, update, container) {
        console.log("Update order");
        let newOrder = [];
        Array.from(container.querySelectorAll(".metadata-object-row")).forEach((row) => {
            // Assurer qu'on travaille avec un HTMLElement pour accéder à dataset
            if (row instanceof HTMLElement && row.dataset.index) {
                let index = parseInt(row.dataset.index);
                newOrder.push(values[index]);
            }
        });
        // Mettre à jour les métadonnées
        await update(newOrder);
        await this.reloadObjects(newOrder, update);
    }
    // Fonction pour supprimer un objet
    async removeProperty(values, update, index, container) {
        console.log("Remove index : ", index);
        values.splice(index, 1);
        await update(values);
        await this.reloadObjects(values, update);
    }
    // Fonction pour ajouter un objet
    async addProperty(values, update, container) {
        console.log("Add new");
        let newObject = {};
        for (let prop of Object.values(this.properties)) {
            let defaultValue = prop.getDefaultValue();
            console.log("Default value : ", defaultValue);
            if (Object.values(this.properties)[0] == prop && (prop instanceof FileProperty_1.FileProperty)) {
                prop.vault = this.vault; // Assurez-vous que vault est défini pour le premier FileProperty
                const fileProp = prop; // Cast pour accéder à handleIconClick
                defaultValue = await new Promise(async (resolve) => {
                    await fileProp.handleIconClick(async (value) => {
                        resolve(value);
                        console.log("Default value after click : ", value);
                    }, new MouseEvent("click"));
                });
            }
            console.log("Default value after click : ", defaultValue);
            if (defaultValue == "like-precedent") {
                if (values && values.length) {
                    if (this.appendFirst) {
                        defaultValue = values[0][prop.name];
                    }
                    else {
                        defaultValue = values[values.length - 1][prop.name];
                    }
                }
                else {
                    defaultValue = "";
                }
            }
            newObject[prop.name] = defaultValue;
        }
        ;
        // Valeurs par défaut
        if (!values) {
            values = [];
        }
        if (this.appendFirst) {
            values.unshift(newObject);
        }
        else {
            values.push(newObject);
        }
        await update(values);
        await this.reloadObjects(values, update);
    }
    // Mise à jour des métadonnées
    async updateObject(values, update, index, property, value) {
        console.log("Update index : ", index);
        if (values) {
            values[index][property.name] = value;
        }
        else {
            values = [{ [property.name]: value }];
        }
        console.log("Updated Values : ", values);
        await update(values);
        await this.reloadObjects(values, update);
    }
    // Recharge dynamiquement les objets
    async reloadObjects(values, update) {
        const container = document.querySelector(".metadata-object-container-" + this.name.toLowerCase());
        if (container) {
            container.innerHTML = "";
            // Recréer l'en-tête et les objets
            console.log("Values : ", values);
            this.createHeader(values, update, container);
            if (this.display == "table") {
                this.createTable(values, update, container);
            }
            else {
                // Affichage par défaut (objet)
                this.createObjects(values, update, container);
            }
        }
    }
}
exports.ObjectProperty = ObjectProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE9iamVjdFByb3BlcnR5LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLHlDQUFzQztBQUV0QyxpREFBOEM7QUFLOUMsTUFBYSxjQUFlLFNBQVEsbUJBQVE7SUFVeEMsWUFBWSxJQUFZLEVBQUUsS0FBWSxFQUFFLFVBQXVDLEVBQUUsT0FBMEUsRUFBRTtRQUN6SixLQUFLLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQVBiLFNBQUksR0FBWSxRQUFRLENBQUM7UUFDekIsYUFBUSxHQUFHLENBQUMsQ0FBQztRQUN0QixnQkFBVyxHQUFhLEtBQUssQ0FBQztRQUM5QixjQUFTLEdBQWEsSUFBSSxDQUFDO1FBQzNCLFlBQU8sR0FBWSxRQUFRLENBQUMsQ0FBQyxxQ0FBcUM7UUFJckUsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLEVBQUUsV0FBVyxJQUFJLEtBQUssQ0FBQztRQUM5QyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksRUFBRSxTQUFTLElBQUksSUFBSSxDQUFDO1FBRXpDLGtEQUFrRDtRQUNsRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQsVUFBVTtRQUNOLEtBQUssSUFBSSxJQUFJLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUMsQ0FBQztZQUM3QyxJQUFJLElBQUksWUFBWSwyQkFBWSxJQUFJLElBQUksWUFBWSxjQUFjLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxXQUFXLEVBQUMsQ0FBQztnQkFDNUYsT0FBUSxJQUFZLENBQUMsVUFBVSxFQUFFLENBQUE7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O2dCQUMvQixJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDbEQsQ0FBQztRQUNMLENBQUM7SUFFTCxDQUFDO0NBQ0Y7QUF6YUgsd0NBeWFHIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcc3JjXFxwcm9wZXJ0aWVzXFxPYmplY3RQcm9wZXJ0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgUHJvcGVydHkgfSBmcm9tIFwiLi9Qcm9wZXJ0eVwiO1xyXG5pbXBvcnQgeyBGaWxlIH0gZnJvbSBcIi4uL3ZhdWx0L0ZpbGVcIjtcclxuaW1wb3J0IHsgRmlsZVByb3BlcnR5IH0gZnJvbSBcIi4vRmlsZVByb3BlcnR5XCI7XHJcbmltcG9ydCB7IFRleHRQcm9wZXJ0eSB9IGZyb20gXCIuL1RleHRQcm9wZXJ0eVwiO1xyXG5pbXBvcnQgeyBNdWx0aUZpbGVQcm9wZXJ0eSB9IGZyb20gXCIuL011bHRpRmlsZVByb3BlcnR5XCI7XHJcbmltcG9ydCB7IFZhdWx0IH0gZnJvbSBcIi4uL3ZhdWx0L1ZhdWx0XCI7XHJcblxyXG5leHBvcnQgY2xhc3MgT2JqZWN0UHJvcGVydHkgZXh0ZW5kcyBQcm9wZXJ0eXtcclxuICAgIC8vIFVzZWQgZm9yIHByb3BlcnR5IG9iamVjdFxyXG5cclxuICAgIHB1YmxpYyBwcm9wZXJ0aWVzIDoge1trZXkgOiBzdHJpbmddIDogUHJvcGVydHl9O1xyXG4gICAgcHVibGljIG92ZXJyaWRlIHR5cGUgOiBzdHJpbmcgPSBcIm9iamVjdFwiO1xyXG4gICAgcHVibGljIG92ZXJyaWRlIGZsZXhTcGFuID0gMjtcclxuICAgIHB1YmxpYyBhcHBlbmRGaXJzdCA6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHB1YmxpYyBhbGxvd01vdmUgOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIHB1YmxpYyBkaXNwbGF5IDogc3RyaW5nID0gXCJvYmplY3RcIjsgLy8gQ2FuIGJlIFwib2JqZWN0XCIsIFwidGFibGVcIiBvciBcImxpc3RcIlxyXG5cclxuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgdmF1bHQ6IFZhdWx0LCBwcm9wZXJ0aWVzOiB7IFtrZXk6IHN0cmluZ106IFByb3BlcnR5IH0sIGFyZ3M6IHsgYWxsb3dNb3ZlPzogYm9vbGVhbiwgYXBwZW5kRmlyc3Q/OiBib29sZWFuLCBba2V5OiBzdHJpbmddOiBhbnl9ID0ge30pIHtcclxuICAgICAgICBzdXBlcihuYW1lLCB2YXVsdCwgYXJncyk7XHJcbiAgICAgICAgdGhpcy5hcHBlbmRGaXJzdCA9IGFyZ3M/LmFwcGVuZEZpcnN0IHx8IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucHJvcGVydGllcyA9IHByb3BlcnRpZXM7XHJcbiAgICAgICAgdGhpcy5hbGxvd01vdmUgPSBhcmdzPy5hbGxvd01vdmUgfHwgdHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gQXNzaWduIGFueSBhZGRpdGlvbmFsIGFyZ3VtZW50cyB0byB0aGUgaW5zdGFuY2VcclxuICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMsIGFyZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENsYXNzZXMoKTogc3RyaW5nW117XHJcbiAgICAgICAgZm9yIChsZXQgcHJvcCBvZiBPYmplY3QudmFsdWVzKHRoaXMucHJvcGVydGllcykpe1xyXG4gICAgICAgICAgICBpZiAocHJvcCBpbnN0YW5jZW9mIEZpbGVQcm9wZXJ0eSB8fCBwcm9wIGluc3RhbmNlb2YgT2JqZWN0UHJvcGVydHkgfHwgcHJvcC50eXBlID09IFwibXVsdGlGaWxlXCIpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIChwcm9wIGFzIGFueSkuZ2V0Q2xhc3NlcygpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gY2xhc3MgZm91bmRcIilcclxuICAgICAgfVxyXG5cclxuICAgIC8vIFVzZWQgYnkgdGhlIENsYXNzZVByb3BlcnR5IHRvIGdldCB0aGUgcGFyZW50IGZpbGVcclxuICAgIGdldFBhcmVudFZhbHVlKHZhbHVlcyA6IGFueSkgOiBGaWxlIHwgdW5kZWZpbmVke1xyXG4gICAgICAgIGlmICh2YWx1ZXMgJiYgdmFsdWVzLmxlbmd0aCl7XHJcbiAgICAgICAgICBmb3IgKGxldCBwcm9wIG9mIE9iamVjdC52YWx1ZXModGhpcy5wcm9wZXJ0aWVzKSl7XHJcbiAgICAgICAgICAgIGlmIChwcm9wIGluc3RhbmNlb2YgRmlsZVByb3BlcnR5IHx8IHByb3AgaW5zdGFuY2VvZiBPYmplY3RQcm9wZXJ0eSB8fCBwcm9wLnR5cGUgPT0gXCJtdWx0aUZpbGVcIil7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIChwcm9wIGFzIGFueSkuZ2V0UGFyZW50VmFsdWUodmFsdWVzWzBdW3Byb3AubmFtZV0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICBmaW5kVmFsdWUoZmlsZTogYW55LCB2YWx1ZTogc3RyaW5nLCBwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IGFueSB7XHJcbiAgICAgICAgbGV0IHZhbHVlcyA9IHRoaXMucmVhZChmaWxlKTtcclxuICAgICAgICBpZiAodmFsdWVzICYmIHZhbHVlcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgcHJvcCBvZiBPYmplY3QudmFsdWVzKHRoaXMucHJvcGVydGllcykpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBwcm9wVmFsdWUgPSB2YWx1ZXNbaV1bcHJvcC5uYW1lXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcFZhbHVlICYmIChwcm9wVmFsdWUgPT0gdmFsdWUgfHwgKHR5cGVvZiBwcm9wVmFsdWUgPT09IFwic3RyaW5nXCIgJiYgcHJvcFZhbHVlLmluY2x1ZGVzKHZhbHVlKSkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZXNbaV1bcHJvcGVydHlOYW1lXVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZ2V0RGlzcGxheVByb3BlcnRpZXMoZmlsZTogRmlsZSwgcHJvcGVydHlDbGFzc2VOYW1lIDogc3RyaW5nLCBwcm9wZXJ0eU5hbWUgOiBzdHJpbmcsIGlzU3RhdGljOiBib29sZWFuID0gdHJ1ZSk6IHtjbGFzc2UgOiBhbnkgLCBkaXNwbGF5IDogYW55fVtdIHtcclxuICAgICAgICBsZXQgcHJvcGVydGllczoge2NsYXNzZSA6IGFueSAsIGRpc3BsYXkgOiBhbnl9W10gPSBbXTtcclxuICAgICAgICB0aGlzLnZhdWx0ID0gZmlsZS52YXVsdDtcclxuICAgICAgICBsZXQgdmFsdWVzID0gdGhpcy5yZWFkKGZpbGUpO1xyXG4gICAgICAgIGlmICghKHByb3BlcnR5TmFtZSBpbiB0aGlzLnByb3BlcnRpZXMpKXtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHJvcGVydHkgXCIgKyBwcm9wZXJ0eU5hbWUgKyBcIiBub3QgZm91bmQgaW4gT2JqZWN0UHJvcGVydHkgXCIgKyB0aGlzLm5hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcHJvcGVydHkgPSB0aGlzLnByb3BlcnRpZXNbcHJvcGVydHlOYW1lXTtcclxuXHJcbiAgICAgICAgaWYgKHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoKXtcclxuICAgICAgICAgICAgZm9yIChsZXQgW2luZGV4LCByb3ddIG9mIHZhbHVlcy5lbnRyaWVzKCkpIHtcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5LnN0YXRpYyA9IGlzU3RhdGljO1xyXG4gICAgICAgICAgICAgICAgbGV0IGRpc3BsYXkgPSBwcm9wZXJ0eS5maWxsRGlzcGxheSh0aGlzLnZhdWx0LCByb3dbcHJvcGVydHkubmFtZV0sXHJcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMgKHZhbHVlIDogYW55ICkgPT4gYXdhaXQgdGhpcy51cGRhdGVPYmplY3QodmFsdWVzLCBhc3luYyAodmFsdWUpID0+IGF3YWl0IGZpbGUudXBkYXRlTWV0YWRhdGEodGhpcy5uYW1lLCB2YWx1ZSksIGluZGV4LCBwcm9wZXJ0eSwgdmFsdWUpKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgbGV0IGNsYXNzZSA9IHRoaXMudmF1bHQuZ2V0RnJvbUxpbmsocm93W3RoaXMucHJvcGVydGllc1twcm9wZXJ0eUNsYXNzZU5hbWVdLm5hbWVdKVxyXG4gICAgICAgICAgICAgICAgcHJvcGVydGllcy5wdXNoKHtjbGFzc2U6IGNsYXNzZSwgZGlzcGxheSA6IGRpc3BsYXl9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcHJvcGVydGllcztcclxuICAgIH1cclxuXHJcbiAgICBmb3JtYXRQYXJlbnRWYWx1ZSh2YWx1ZSA6IHN0cmluZyl7XHJcbiAgICAgICAgbGV0IG5ld09iamVjdDogYW55ID0ge307XHJcbiAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnRpZXMpLmZvckVhY2gocHJvcCA9PiB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiBwcm9wIGluc3RhbmNlb2YgRmlsZVByb3BlcnR5IHx8IHByb3AgaW5zdGFuY2VvZiBPYmplY3RQcm9wZXJ0eSB8fCBwcm9wLnR5cGUgPT0gXCJtdWx0aUZpbGVcIil7XHJcbiAgICAgICAgICAgICAgICBuZXdPYmplY3RbcHJvcC5uYW1lXSA9IHZhbHVlXHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IFwiXCIgLy8gT25seSBvbmUgcGFyZW50XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBuZXdPYmplY3RbcHJvcC5uYW1lXSA9IFwiXCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBbbmV3T2JqZWN0XVxyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGdldERpc3BsYXkoZmlsZTogYW55LCBhcmdzPzogeyBzdGF0aWNNb2RlPzogYm9vbGVhbjsgdGl0bGU/OiBzdHJpbmc7IGRpc3BsYXk/IDogc3RyaW5nfSk6IEhUTUxEaXZFbGVtZW50IHtcclxuICAgICAgICB0aGlzLmRpc3BsYXkgPSBhcmdzPy5kaXNwbGF5IHx8IHRoaXMuZGlzcGxheTtcclxuICAgICAgICByZXR1cm4gc3VwZXIuZ2V0RGlzcGxheShmaWxlLCBhcmdzKTtcclxuICAgIH1cclxuXHJcbiAgICAgLy8gTcOpdGhvZGUgcHJpbmNpcGFsZSBwb3VyIG9idGVuaXIgbCdhZmZpY2hhZ2VcclxuICAgICBvdmVycmlkZSBmaWxsRGlzcGxheSh2YXVsdCA6IGFueSwgdmFsdWVzOiBhbnksIHVwZGF0ZTogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4pIHtcclxuICAgICAgICB0aGlzLnZhdWx0ID0gdmF1bHRcclxuICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtb2JqZWN0LWNvbnRhaW5lci1cIit0aGlzLm5hbWUudG9Mb3dlckNhc2UoKSk7XHJcblxyXG4gICAgICAgIC8vIENyw6llciBsJ2VuLXTDqnRlXHJcbiAgICAgICAgdGhpcy5jcmVhdGVIZWFkZXIodmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmRpc3BsYXkgPT0gXCJ0YWJsZVwiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlVGFibGUodmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBBZmZpY2hhZ2UgcGFyIGTDqWZhdXQgKG9iamV0KVxyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZU9iamVjdHModmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIENyw6llciBsZXMgbGlnbmVzIGQnb2JqZXRcclxuICAgICAgICBcclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcclxuICAgICAgfVxyXG4gICAgY3JlYXRlVGFibGUodmFsdWVzOiBhbnksIHVwZGF0ZTogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICAvLyBDcsOpZXIgdW4gdGFibGVhdSBwb3VyIGxlcyBvYmpldHNcclxuICAgICAgICBjb25zdCB0YWJsZVdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIHRhYmxlV3JhcHBlci5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGFibGVXcmFwcGVyKTtcclxuXHJcbiAgICAgICAgbGV0IGFkZEJ1dHRvbiA9IHRoaXMuY3JlYXRlQWRkQnV0dG9uKHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpXHJcbiAgICAgICAgYWRkQnV0dG9uLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xyXG4gICAgICAgIGFkZEJ1dHRvbi5zdHlsZS50b3AgPSBcIjBcIjtcclxuICAgICAgICBhZGRCdXR0b24uc3R5bGUucmlnaHQgPSBcIjBcIjtcclxuICAgICAgICB0YWJsZVdyYXBwZXIuYXBwZW5kQ2hpbGQoYWRkQnV0dG9uKTtcclxuXHJcblxyXG4gICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpO1xyXG4gICAgICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1vYmplY3QtdGFibGVcIik7XHJcbiAgICAgICAgdGFibGVXcmFwcGVyLmFwcGVuZENoaWxkKHRhYmxlKTtcclxuXHJcblxyXG4gICAgICAgIC8vIENyw6llciBsJ2VuLXTDqnRlIGR1IHRhYmxlYXVcclxuICAgICAgICBjb25zdCBoZWFkZXJSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7XHJcbiAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnRpZXMpLmZvckVhY2gocHJvcGVydHkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0aCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0aFwiKTtcclxuICAgICAgICAgICAgdGgudGV4dENvbnRlbnQgPSBwcm9wZXJ0eS5uYW1lO1xyXG4gICAgICAgICAgICBoZWFkZXJSb3cuYXBwZW5kQ2hpbGQodGgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIEFqb3V0ZXIgdW5lIGNvbG9ubmUgcG91ciBsZSBib3V0b24gZGUgc3VwcHJlc3Npb25cclxuICAgICAgICBjb25zdCB0aERlbGV0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0aFwiKTtcclxuICAgICAgICBoZWFkZXJSb3cuYXBwZW5kQ2hpbGQodGhEZWxldGUpO1xyXG5cclxuICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZChoZWFkZXJSb3cpO1xyXG5cclxuICAgICAgICBpZiAodmFsdWVzICYmIHZhbHVlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgLy8gQ3LDqWVyIGxlcyBsaWduZXMgZCdvYmpldFxyXG4gICAgICAgICAgICB2YWx1ZXMuZm9yRWFjaCgob2JqZWN0czogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidHJcIik7XHJcbiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKHRoaXMucHJvcGVydGllcykuZm9yRWFjaChwcm9wZXJ0eSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGQuYXBwZW5kQ2hpbGQocHJvcGVydHkuZmlsbERpc3BsYXkodGhpcy52YXVsdCwgb2JqZWN0c1twcm9wZXJ0eS5uYW1lXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmMgKHZhbHVlIDogYW55KSA9PiBhd2FpdCB0aGlzLnVwZGF0ZU9iamVjdCh2YWx1ZXMsIHVwZGF0ZSwgaW5kZXgsIHByb3BlcnR5LCB2YWx1ZSkpKTtcclxuICAgICAgICAgICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQodGQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gQ2VsbHVsZSBwb3VyIGxlIGJvdXRvbiBkZSBzdXBwcmVzc2lvblxyXG4gICAgICAgICAgICAgICAgY29uc3QgdGREZWxldGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XHJcbiAgICAgICAgICAgICAgICB0ZERlbGV0ZS5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtb2JqZWN0LWRlbGV0ZS1jZWxsXCIpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGVsZXRlQnV0dG9uID0gdGhpcy5jcmVhdGVEZWxldGVCdXR0b24odmFsdWVzLCB1cGRhdGUsIGluZGV4LCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1vYmplY3QtZGVsZXRlLWJ1dHRvblwiKTtcclxuICAgICAgICAgICAgICAgIHRkRGVsZXRlLmFwcGVuZENoaWxkKGRlbGV0ZUJ1dHRvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKHRkRGVsZXRlKTtcclxuICAgICAgICAgICAgICAgIHRhYmxlLmFwcGVuZENoaWxkKHJvdyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICBcclxuICAgICAgLy8gQ3LDqWUgbCdlbi10w6p0ZSBhdmVjIGxlcyBwcm9wcmnDqXTDqXNcclxuICAgICAgY3JlYXRlSGVhZGVyKHZhbHVlcyA6IGFueSwgdXBkYXRlIDogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICAgIGNvbnN0IGhlYWRlclJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICBoZWFkZXJSb3cuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLW9iamVjdC1oZWFkZXItcm93XCIpO1xyXG5cclxuICAgICAgICAgIGxldCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9IHRoaXMudGl0bGUgPyB0aGlzLnRpdGxlIDogdGhpcy5uYW1lICsgXCIgOiBcIjtcclxuICAgICAgICAgIHRpdGxlLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1oZWFkZXJcIik7XHJcbiAgICAgICAgICBoZWFkZXJSb3cuYXBwZW5kQ2hpbGQodGl0bGUpO1xyXG4gIFxyXG4gICAgICAgICAgLy8gQWpvdXRlciBsZSBib3V0b24gZCdham91dFxyXG4gICAgICAgICAgY29uc3QgYWRkQnV0dG9uID0gdGhpcy5jcmVhdGVBZGRCdXR0b24odmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICBoZWFkZXJSb3cuYXBwZW5kQ2hpbGQoYWRkQnV0dG9uKTtcclxuICBcclxuICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChoZWFkZXJSb3cpO1xyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIC8vIENyw6llIGxlIGJvdXRvbiBkJ2Fqb3V0IGQndW4gbm91dmVsIG9iamV0XHJcbiAgICAgIGNyZWF0ZUFkZEJ1dHRvbih2YWx1ZXMgOiBhbnksIHVwZGF0ZSA6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KTogSFRNTEJ1dHRvbkVsZW1lbnQge1xyXG4gICAgICAgICAgY29uc3QgYWRkQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICAgIHRoaXMudmF1bHQuYXBwLnNldEljb24oYWRkQnV0dG9uLCBcImNpcmNsZS1wbHVzXCIpXHJcbiAgICAgICAgICBhZGRCdXR0b24uY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLWFkZC1idXR0b25cIik7XHJcbiAgICAgICAgICBhZGRCdXR0b24ub25jbGljayA9IGFzeW5jICgpID0+IGF3YWl0IHRoaXMuYWRkUHJvcGVydHkodmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICByZXR1cm4gYWRkQnV0dG9uO1xyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIC8vIENyw6llIGxlcyBvYmpldHMgZXQgbGVzIGxpZ25lcyDDoCBhZmZpY2hlclxyXG4gICAgICBjcmVhdGVPYmplY3RzKHZhbHVlczogYW55LCB1cGRhdGUgOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICAgIGlmICghdmFsdWVzKXtyZXR1cm59XHJcbiAgICAgICAgICB2YWx1ZXMuZm9yRWFjaCgob2JqZWN0czogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5jcmVhdGVPYmplY3RSb3codmFsdWVzLCB1cGRhdGUsIG9iamVjdHMsIGluZGV4LCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChyb3cpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBpZiAodGhpcy5hbGxvd01vdmUpe1xyXG4gICAgICAgICAgICAgIHRoaXMuZW5hYmxlRHJhZ0FuZERyb3AodmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgIFxyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIC8vIENyw6llIHVuZSBsaWduZSBkJ29iamV0IGF2ZWMgc2VzIHByb3ByacOpdMOpc1xyXG4gICAgY3JlYXRlT2JqZWN0Um93KHZhbHVlcyA6IGFueSwgdXBkYXRlIDogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIG9iamVjdHM6IGFueSwgaW5kZXg6IG51bWJlciwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCk6IEhUTUxEaXZFbGVtZW50IHtcclxuICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtb2JqZWN0LXJvd1wiKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuYWxsb3dNb3ZlKXtcclxuICAgICAgICAgICAgcm93LmRyYWdnYWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHJvdy5kYXRhc2V0LmluZGV4ID0gaW5kZXgudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgcm93LnN0eWxlLmN1cnNvciA9IFwiZ3JhYlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBBam91dGVyIGxlIGJvdXRvbiBkZSBzdXBwcmVzc2lvblxyXG4gICAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IHRoaXMuY3JlYXRlRGVsZXRlQnV0dG9uKHZhbHVlcywgdXBkYXRlLCBpbmRleCwgY29udGFpbmVyKTtcclxuICAgICAgICBkZWxldGVCdXR0b24uc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XHJcbiAgICAgICAgZGVsZXRlQnV0dG9uLnN0eWxlLnRvcCA9IFwiMFwiO1xyXG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5zdHlsZS5yaWdodCA9IFwiMFwiO1xyXG4gICAgICAgIHJvdy5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcclxuICAgICAgICByb3cuYXBwZW5kQ2hpbGQoZGVsZXRlQnV0dG9uKTtcclxuXHJcbiAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnRpZXMpLmZvckVhY2gocHJvcGVydHkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdmFsdWUgPSBvYmplY3RzW3Byb3BlcnR5Lm5hbWVdXHJcbiAgICAgICAgICAgIGxldCBwcm9wZXJ0eUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIHByb3BlcnR5Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1vYmplY3QtcHJvcGVydHlcIik7XHJcblxyXG4gICAgICAgICAgICBpZiAocHJvcGVydHkuZmxleFNwYW4pe1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlDb250YWluZXIuc3R5bGUuZ3JpZENvbHVtbiA9IFwic3BhbiBcIitwcm9wZXJ0eS5mbGV4U3BhbjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9IHByb3BlcnR5Lm5hbWU7XHJcbiAgICAgICAgICAgIHRpdGxlLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS10aXRsZVwiKTtcclxuICAgICAgICAgICAgcHJvcGVydHlDb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xyXG4gICAgICAgICAgICBwcm9wZXJ0eUNvbnRhaW5lci5hcHBlbmRDaGlsZChwcm9wZXJ0eS5maWxsRGlzcGxheSh0aGlzLnZhdWx0LCB2YWx1ZSxcclxuICAgICAgICAgICAgICAgIGFzeW5jICh2YWx1ZTogYW55KSA9PiBhd2FpdCB0aGlzLnVwZGF0ZU9iamVjdCh2YWx1ZXMsIHVwZGF0ZSwgaW5kZXgsIHByb3BlcnR5LCB2YWx1ZSkpKTtcclxuICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKHByb3BlcnR5Q29udGFpbmVyKTtcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByb3c7XHJcbiAgICAgIH1cclxuICBcclxuICAgICAgLy8gQ3LDqWUgdW4gYm91dG9uIGRlIHN1cHByZXNzaW9uIHBvdXIgdW5lIGxpZ25lIGQnb2JqZXRcclxuICAgICAgY3JlYXRlRGVsZXRlQnV0dG9uKHZhbHVlcyA6IGFueSwgdXBkYXRlIDogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGluZGV4OiBudW1iZXIsIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpOiBIVE1MQnV0dG9uRWxlbWVudCB7XHJcbiAgICAgICAgICBjb25zdCBkZWxldGVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgdGhpcy52YXVsdC5hcHAuc2V0SWNvbihkZWxldGVCdXR0b24sIFwiY2lyY2xlLW1pbnVzXCIpO1xyXG4gICAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1kZWxldGUtYnV0dG9uXCIpO1xyXG4gICAgICAgICAgZGVsZXRlQnV0dG9uLm9uY2xpY2sgPSBhc3luYyAoKSA9PiBhd2FpdCB0aGlzLnJlbW92ZVByb3BlcnR5KHZhbHVlcywgdXBkYXRlLCBpbmRleCwgY29udGFpbmVyKTtcclxuICAgICAgICAgIHJldHVybiBkZWxldGVCdXR0b247XHJcbiAgICAgIH1cclxuICBcclxuICAgICAgLy8gR8OocmUgbGUgZ2xpc3Nlci1kw6lwb3NlciBwb3VyIHLDqW9yZG9ubmVyIGxlcyBvYmpldHNcclxuICAgICAgZW5hYmxlRHJhZ0FuZERyb3AodmFsdWVzIDogYW55LCB1cGRhdGUgOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAgICAgbGV0IGRyYWdnZWRFbGVtZW50OiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xyXG5cclxuICAgICAgICAgIGxldCBpc0VkaXRpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAvLyBMb3JzcXVlIGwndXRpbGlzYXRldXIgY2xpcXVlIGRhbnMgdW4gY2hhbXAgZCfDqWRpdGlvbiAoaW5wdXQpLCBvbiBhY3RpdmUgbCfDqWRpdGlvblxyXG4gICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgICAgICAgIGlmIChpbnB1dD8uY2xhc3NMaXN0LmNvbnRhaW5zKCdmaWVsZC1pbnB1dCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlzRWRpdGluZyA9IHRydWU7ICAvLyBMZSBjaGFtcCBlc3QgZW4gbW9kZSDDqWRpdGlvblxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgIC8vIExvcnNxdWUgbCd1dGlsaXNhdGV1ciBxdWl0dGUgdW4gY2hhbXAgZCfDqWRpdGlvbiAoYmx1ciksIG9uIGTDqXNhY3RpdmUgbCfDqWRpdGlvblxyXG4gICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgaWYgKGlucHV0Py5jbGFzc0xpc3QuY29udGFpbnMoJ2ZpZWxkLWlucHV0JykpIHtcclxuICAgICAgICAgICAgICAgICAgaXNFZGl0aW5nID0gZmFsc2U7ICAvLyBMZSBjaGFtcCBuJ2VzdCBwbHVzIGVuIG1vZGUgw6lkaXRpb25cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LCB0cnVlKTtcclxuXHJcbiAgICAgICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGlzRWRpdGluZykge1xyXG4gICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRyYWdnZWRFbGVtZW50ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgICAgICBkcmFnZ2VkRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZHJhZ2dpbmdcIik7XHJcbiAgICAgICAgICB9KTtcclxuICBcclxuICAgICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ292ZXJcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICBjb25zdCBhZnRlckVsZW1lbnQgPSB0aGlzLmdldERyYWdBZnRlckVsZW1lbnQoY29udGFpbmVyLCBldmVudC5jbGllbnRZKTtcclxuICAgICAgICAgICAgICBpZiAoYWZ0ZXJFbGVtZW50ID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRyYWdnZWRFbGVtZW50ISk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUoZHJhZ2dlZEVsZW1lbnQhLCBhZnRlckVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gIFxyXG4gICAgICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnZW5kXCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICBpZiAoIWRyYWdnZWRFbGVtZW50KSByZXR1cm47XHJcbiAgICAgICAgICAgICAgZHJhZ2dlZEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImRyYWdnaW5nXCIpO1xyXG4gIFxyXG4gICAgICAgICAgICAgIC8vIFLDqWN1cMOpcmVyIGxlIG5vdXZlbCBvcmRyZSBkZXMgw6lsw6ltZW50c1xyXG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlT3JkZXIodmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBUcm91dmVyIGwnw6lsw6ltZW50IGFwcsOocyBsZXF1ZWwgaW5zw6lyZXIgKHBvdXIgbGUgRHJhZyAmIERyb3ApXHJcbiAgICAgIGdldERyYWdBZnRlckVsZW1lbnQoY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCwgeTogbnVtYmVyKTogRWxlbWVudCB8IG51bGwge1xyXG4gICAgICAgICAgY29uc3QgZHJhZ2dhYmxlRWxlbWVudHMgPSBBcnJheS5mcm9tKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKFwiLm1ldGFkYXRhLW9iamVjdC1yb3c6bm90KC5kcmFnZ2luZylcIikpO1xyXG4gIFxyXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gZHJhZ2dhYmxlRWxlbWVudHMucmVkdWNlKChjbG9zZXN0OiB7IG9mZnNldDogbnVtYmVyOyBlbGVtZW50OiBFbGVtZW50IHwgbnVsbCB9LCBjaGlsZCkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGJveCA9IGNoaWxkLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IHkgLSBib3gudG9wIC0gYm94LmhlaWdodCAvIDI7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG9mZnNldCA8IDAgJiYgb2Zmc2V0ID4gY2xvc2VzdC5vZmZzZXQgPyB7IG9mZnNldCwgZWxlbWVudDogY2hpbGQgfSA6IGNsb3Nlc3Q7XHJcbiAgICAgICAgICB9LCB7IG9mZnNldDogTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZLCBlbGVtZW50OiBudWxsIGFzIEVsZW1lbnQgfCBudWxsIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICByZXR1cm4gcmVzdWx0LmVsZW1lbnQ7XHJcbiAgICAgIH1cclxuICBcclxuICAgICAgLy8gTWV0IMOgIGpvdXIgbCdvcmRyZSBkZXMgw6lsw6ltZW50cyBhcHLDqHMgdW4gZ2xpc3Nlci1kw6lwb3NlclxyXG4gICAgICBhc3luYyB1cGRhdGVPcmRlcih2YWx1ZXMgOiBhbnksIHVwZGF0ZSA6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGUgb3JkZXJcIilcclxuICAgICAgICAgIGxldCBuZXdPcmRlcjogYW55W10gPSBbXTtcclxuICAgICAgICAgIEFycmF5LmZyb20oY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIubWV0YWRhdGEtb2JqZWN0LXJvd1wiKSkuZm9yRWFjaCgocm93KSA9PiB7XHJcbiAgICAgICAgICAgICAgLy8gQXNzdXJlciBxdSdvbiB0cmF2YWlsbGUgYXZlYyB1biBIVE1MRWxlbWVudCBwb3VyIGFjY8OpZGVyIMOgIGRhdGFzZXRcclxuICAgICAgICAgICAgICBpZiAocm93IGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgJiYgcm93LmRhdGFzZXQuaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gcGFyc2VJbnQocm93LmRhdGFzZXQuaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICBuZXdPcmRlci5wdXNoKHZhbHVlc1tpbmRleF0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgLy8gTWV0dHJlIMOgIGpvdXIgbGVzIG3DqXRhZG9ubsOpZXNcclxuICAgICAgICAgIGF3YWl0IHVwZGF0ZShuZXdPcmRlcik7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnJlbG9hZE9iamVjdHMobmV3T3JkZXIsIHVwZGF0ZSlcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBGb25jdGlvbiBwb3VyIHN1cHByaW1lciB1biBvYmpldFxyXG4gICAgICBhc3luYyByZW1vdmVQcm9wZXJ0eSh2YWx1ZXMgOiBhbnksIHVwZGF0ZSA6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBpbmRleDogbnVtYmVyLCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlbW92ZSBpbmRleCA6IFwiLCBpbmRleClcclxuICAgICAgICAgIHZhbHVlcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgYXdhaXQgdXBkYXRlKHZhbHVlcyk7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnJlbG9hZE9iamVjdHModmFsdWVzLCB1cGRhdGUpXHJcbiAgICAgIH1cclxuICBcclxuICAgICAgLy8gRm9uY3Rpb24gcG91ciBham91dGVyIHVuIG9iamV0XHJcbiAgICAgIGFzeW5jIGFkZFByb3BlcnR5KHZhbHVlcyA6IGFueSwgdXBkYXRlIDogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKFwiQWRkIG5ld1wiKVxyXG4gICAgICAgICAgbGV0IG5ld09iamVjdDogYW55ID0ge307XHJcbiAgICAgICAgICBmb3IgKGxldCBwcm9wIG9mIE9iamVjdC52YWx1ZXModGhpcy5wcm9wZXJ0aWVzKSkge1xyXG4gICAgICAgICAgICBsZXQgZGVmYXVsdFZhbHVlID0gcHJvcC5nZXREZWZhdWx0VmFsdWUoKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRlZmF1bHQgdmFsdWUgOiBcIiwgZGVmYXVsdFZhbHVlKVxyXG4gICAgICAgICAgICBpZiAoT2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnRpZXMpWzBdID09IHByb3AgJiYgKHByb3AgaW5zdGFuY2VvZiBGaWxlUHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgICAgICBwcm9wLnZhdWx0ID0gdGhpcy52YXVsdDsgLy8gQXNzdXJlei12b3VzIHF1ZSB2YXVsdCBlc3QgZMOpZmluaSBwb3VyIGxlIHByZW1pZXIgRmlsZVByb3BlcnR5XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlUHJvcCA9IHByb3AgYXMgYW55OyAvLyBDYXN0IHBvdXIgYWNjw6lkZXIgw6AgaGFuZGxlSWNvbkNsaWNrXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWUgPSBhd2FpdCBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGZpbGVQcm9wLmhhbmRsZUljb25DbGljayhhc3luYyAodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJEZWZhdWx0IHZhbHVlIGFmdGVyIGNsaWNrIDogXCIsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBuZXcgTW91c2VFdmVudChcImNsaWNrXCIpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGVmYXVsdCB2YWx1ZSBhZnRlciBjbGljayA6IFwiLCBkZWZhdWx0VmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRlZmF1bHRWYWx1ZSA9PSBcImxpa2UtcHJlY2VkZW50XCIpe1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hcHBlbmRGaXJzdCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZSA9IHZhbHVlc1swXVtwcm9wLm5hbWVdXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWUgPSB2YWx1ZXNbdmFsdWVzLmxlbmd0aC0xXVtwcm9wLm5hbWVdXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7ZGVmYXVsdFZhbHVlID0gXCJcIn1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBuZXdPYmplY3RbcHJvcC5uYW1lXSA9IGRlZmF1bHRWYWx1ZVxyXG4gICAgICAgIFxyXG4gICAgICAgIH07IFxyXG4gICAgICAgIC8vIFZhbGV1cnMgcGFyIGTDqWZhdXRcclxuICAgICAgICBpZiAoIXZhbHVlcyl7dmFsdWVzID0gW119XHJcbiAgICAgICAgaWYgKHRoaXMuYXBwZW5kRmlyc3QpIHtcclxuICAgICAgICAgICAgdmFsdWVzLnVuc2hpZnQobmV3T2JqZWN0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2YWx1ZXMucHVzaChuZXdPYmplY3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAgIGF3YWl0IHVwZGF0ZSh2YWx1ZXMpO1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5yZWxvYWRPYmplY3RzKHZhbHVlcywgdXBkYXRlKVxyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIC8vIE1pc2Ugw6Agam91ciBkZXMgbcOpdGFkb25uw6llc1xyXG4gICAgICBhc3luYyB1cGRhdGVPYmplY3QodmFsdWVzIDogYW55LCB1cGRhdGUgOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgaW5kZXg6IG51bWJlciwgcHJvcGVydHk6IFByb3BlcnR5LCB2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGUgaW5kZXggOiBcIiwgaW5kZXgpXHJcbiAgICAgICAgICBpZiAodmFsdWVzKXtcclxuICAgICAgICAgICAgdmFsdWVzW2luZGV4XVtwcm9wZXJ0eS5uYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhbHVlcyA9IFt7W3Byb3BlcnR5Lm5hbWVdIDogdmFsdWV9XVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGVkIFZhbHVlcyA6IFwiLCB2YWx1ZXMpXHJcbiAgICAgICAgICBhd2FpdCB1cGRhdGUodmFsdWVzKTtcclxuICAgICAgICAgIGF3YWl0IHRoaXMucmVsb2FkT2JqZWN0cyh2YWx1ZXMsIHVwZGF0ZSlcclxuICAgICAgfVxyXG5cclxuICAgIC8vIFJlY2hhcmdlIGR5bmFtaXF1ZW1lbnQgbGVzIG9iamV0c1xyXG4gICAgYXN5bmMgcmVsb2FkT2JqZWN0cyh2YWx1ZXMgOiBhbnksIHVwZGF0ZSA6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCkge1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubWV0YWRhdGEtb2JqZWN0LWNvbnRhaW5lci1cIit0aGlzLm5hbWUudG9Mb3dlckNhc2UoKSkgYXMgSFRNTERpdkVsZW1lbnQ7XHJcbiAgICAgICAgaWYgKGNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgICAgICAgICAgLy8gUmVjcsOpZXIgbCdlbi10w6p0ZSBldCBsZXMgb2JqZXRzXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVmFsdWVzIDogXCIsIHZhbHVlcylcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVIZWFkZXIodmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRpc3BsYXkgPT0gXCJ0YWJsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVRhYmxlKHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gQWZmaWNoYWdlIHBhciBkw6lmYXV0IChvYmpldClcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlT2JqZWN0cyh2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIH1cclxuICB9XHJcbiAgIl0sInZlcnNpb24iOjN9