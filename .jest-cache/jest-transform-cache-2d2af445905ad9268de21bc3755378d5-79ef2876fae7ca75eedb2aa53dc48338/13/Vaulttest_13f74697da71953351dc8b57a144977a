f9984c357edb89bfd20a213842d6350f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Vault_1 = require("../../src/vault/Vault");
const mocks_1 = require("../mocks");
describe('Vault', () => {
    let vault;
    let app;
    beforeEach(() => {
        // Reset all mocks
        jest.clearAllMocks();
        // Create fresh instances
        app = (0, mocks_1.mockApp)();
        vault = new Vault_1.Vault(app);
    });
    describe('constructor', () => {
        it('should create vault instance with app', () => {
            expect(vault).toBeInstanceOf(Vault_1.Vault);
            expect(vault.app).toBe(app);
        });
    });
    describe('getAllFilesInFolder', () => {
        it('should return empty array for non-existent folder', () => {
            app.vault.getAbstractFileByPath.mockReturnValue(null);
            const files = vault.getAllFilesInFolder('non-existent');
            expect(files).toEqual([]);
        });
        it('should return empty array for file instead of folder', () => {
            const mockFile = { children: undefined };
            app.vault.getAbstractFileByPath.mockReturnValue(mockFile);
            const files = vault.getAllFilesInFolder('file.md');
            expect(files).toEqual([]);
        });
        it('should return files from folder', () => {
            const mockFile1 = { path: 'folder/file1.md' };
            const mockFile2 = { path: 'folder/file2.md' };
            const mockSubfolder = {
                children: [mockFile1, mockFile2]
            };
            app.vault.getAbstractFileByPath.mockReturnValue(mockSubfolder);
            const files = vault.getAllFilesInFolder('folder');
            expect(files).toEqual([mockFile1, mockFile2]);
        });
    });
    describe('fileExists', () => {
        it('should return true if file exists', () => {
            app.vault.getAbstractFileByPath.mockReturnValue({ path: 'test.md' });
            expect(vault.fileExists('test.md')).toBe(true);
        });
        it('should return false if file does not exist', () => {
            app.vault.getAbstractFileByPath.mockReturnValue(null);
            expect(vault.fileExists('test.md')).toBe(false);
        });
    });
    describe('getFilesWithExtension', () => {
        beforeEach(() => {
            const mockFiles = [
                { path: 'file1.md', extension: 'md' },
                { path: 'file2.txt', extension: 'txt' },
                { path: 'file3.md', extension: 'md' },
                { path: 'file4.pdf', extension: 'pdf' }
            ];
            app.vault.getFiles.mockReturnValue(mockFiles);
        });
        it('should return files with specified extension', () => {
            const mdFiles = vault.getFilesWithExtension('md');
            expect(mdFiles).toHaveLength(2);
            expect(mdFiles.every(file => file.extension === 'md')).toBe(true);
        });
        it('should return empty array for non-existent extension', () => {
            const jsFiles = vault.getFilesWithExtension('js');
            expect(jsFiles).toHaveLength(0);
        });
        it('should be case sensitive', () => {
            const mdFiles = vault.getFilesWithExtension('MD');
            expect(mdFiles).toHaveLength(0);
        });
    });
    describe('getFileByPath', () => {
        it('should return file if exists', () => {
            const mockFile = { path: 'test.md' };
            app.vault.getAbstractFileByPath.mockReturnValue(mockFile);
            const result = vault.getFileByPath('test.md');
            expect(result).toBe(mockFile);
        });
        it('should return null if file does not exist', () => {
            app.vault.getAbstractFileByPath.mockReturnValue(null);
            const result = vault.getFileByPath('test.md');
            expect(result).toBeNull();
        });
    });
    describe('createFolder', () => {
        it('should create folder if it does not exist', async () => {
            app.vault.getAbstractFileByPath.mockReturnValue(null);
            app.vault.createFolder.mockResolvedValue({});
            await vault.createFolder('new-folder');
            expect(app.vault.createFolder).toHaveBeenCalledWith('new-folder');
        });
        it('should not create folder if it already exists', async () => {
            app.vault.getAbstractFileByPath.mockReturnValue({});
            await vault.createFolder('existing-folder');
            expect(app.vault.createFolder).not.toHaveBeenCalled();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXHZhdWx0XFxWYXVsdC50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsaURBQThDO0FBQzlDLG9DQUE0QztBQUU1QyxRQUFRLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtJQUNuQixJQUFJLEtBQVksQ0FBQztJQUNqQixJQUFJLEdBQVksQ0FBQztJQUVqQixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ1osa0JBQWtCO1FBQ2xCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUVyQix5QkFBeUI7UUFDekIsR0FBRyxHQUFHLElBQUEsZUFBTyxHQUFFLENBQUM7UUFDaEIsS0FBSyxHQUFHLElBQUksYUFBSyxDQUFDLEdBQVUsQ0FBQyxDQUFDO0lBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDekIsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUM3QyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsY0FBYyxDQUFDLGFBQUssQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1FBQ2pDLEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxHQUFHLEVBQUU7WUFDekQsR0FBRyxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFdEQsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLG1CQUFtQixDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBRXhELE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDOUIsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsc0RBQXNELEVBQUUsR0FBRyxFQUFFO1lBQzVELE1BQU0sUUFBUSxHQUFHLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxDQUFDO1lBQ3pDLEdBQUcsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsZUFBZSxDQUFDLFFBQWUsQ0FBQyxDQUFDO1lBRWpFLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUVuRCxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzlCLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlDQUFpQyxFQUFFLEdBQUcsRUFBRTtZQUN2QyxNQUFNLFNBQVMsR0FBRyxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxDQUFDO1lBQzlDLE1BQU0sU0FBUyxHQUFHLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixFQUFFLENBQUM7WUFDOUMsTUFBTSxhQUFhLEdBQUc7Z0JBQ2xCLFFBQVEsRUFBRSxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQVE7YUFDMUMsQ0FBQztZQUVGLEdBQUcsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsZUFBZSxDQUFDLGFBQW9CLENBQUMsQ0FBQztZQUV0RSxNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFbEQsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ2xELENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtRQUN4QixFQUFFLENBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFO1lBQ3pDLEdBQUcsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsZUFBZSxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBUyxDQUFDLENBQUM7WUFFNUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNENBQTRDLEVBQUUsR0FBRyxFQUFFO1lBQ2xELEdBQUcsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXRELE1BQU0sQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BELENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO1FBQ25DLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDWixNQUFNLFNBQVMsR0FBRztnQkFDZCxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRTtnQkFDckMsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUU7Z0JBQ3ZDLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFO2dCQUNyQyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRTthQUMxQyxDQUFDO1lBRUYsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLFNBQWdCLENBQUMsQ0FBQztRQUN6RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxHQUFHLEVBQUU7WUFDcEQsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBRWxELE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNEQUFzRCxFQUFFLEdBQUcsRUFBRTtZQUM1RCxNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFbEQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7WUFDaEMsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBRWxELE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1FBQzNCLEVBQUUsQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7WUFDcEMsTUFBTSxRQUFRLEdBQUcsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUM7WUFDckMsR0FBRyxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxlQUFlLENBQUMsUUFBZSxDQUFDLENBQUM7WUFFakUsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUU5QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEdBQUcsRUFBRTtZQUNqRCxHQUFHLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUV0RCxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRTlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7UUFDMUIsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3ZELEdBQUcsQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RELEdBQUcsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLGlCQUFpQixDQUFDLEVBQVMsQ0FBQyxDQUFDO1lBRXBELE1BQU0sS0FBSyxDQUFDLFlBQVksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUV2QyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUN0RSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywrQ0FBK0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMzRCxHQUFHLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLGVBQWUsQ0FBQyxFQUFTLENBQUMsQ0FBQztZQUUzRCxNQUFNLEtBQUssQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUU1QyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXHZhdWx0XFxWYXVsdC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZhdWx0IH0gZnJvbSAnLi4vLi4vc3JjL3ZhdWx0L1ZhdWx0JztcclxuaW1wb3J0IHsgTW9ja0FwcCwgbW9ja0FwcCB9IGZyb20gJy4uL21vY2tzJztcclxuXHJcbmRlc2NyaWJlKCdWYXVsdCcsICgpID0+IHtcclxuICAgIGxldCB2YXVsdDogVmF1bHQ7XHJcbiAgICBsZXQgYXBwOiBNb2NrQXBwO1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIC8vIFJlc2V0IGFsbCBtb2Nrc1xyXG4gICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENyZWF0ZSBmcmVzaCBpbnN0YW5jZXNcclxuICAgICAgICBhcHAgPSBtb2NrQXBwKCk7XHJcbiAgICAgICAgdmF1bHQgPSBuZXcgVmF1bHQoYXBwIGFzIGFueSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY29uc3RydWN0b3InLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgdmF1bHQgaW5zdGFuY2Ugd2l0aCBhcHAnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdCh2YXVsdCkudG9CZUluc3RhbmNlT2YoVmF1bHQpO1xyXG4gICAgICAgICAgICBleHBlY3QodmF1bHQuYXBwKS50b0JlKGFwcCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZ2V0QWxsRmlsZXNJbkZvbGRlcicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSBmb3Igbm9uLWV4aXN0ZW50IGZvbGRlcicsICgpID0+IHtcclxuICAgICAgICAgICAgYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aC5tb2NrUmV0dXJuVmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBmaWxlcyA9IHZhdWx0LmdldEFsbEZpbGVzSW5Gb2xkZXIoJ25vbi1leGlzdGVudCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGZpbGVzKS50b0VxdWFsKFtdKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZW1wdHkgYXJyYXkgZm9yIGZpbGUgaW5zdGVhZCBvZiBmb2xkZXInLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGaWxlID0geyBjaGlsZHJlbjogdW5kZWZpbmVkIH07XHJcbiAgICAgICAgICAgIGFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgubW9ja1JldHVyblZhbHVlKG1vY2tGaWxlIGFzIGFueSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBmaWxlcyA9IHZhdWx0LmdldEFsbEZpbGVzSW5Gb2xkZXIoJ2ZpbGUubWQnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChmaWxlcykudG9FcXVhbChbXSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGZpbGVzIGZyb20gZm9sZGVyJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrRmlsZTEgPSB7IHBhdGg6ICdmb2xkZXIvZmlsZTEubWQnIH07XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGaWxlMiA9IHsgcGF0aDogJ2ZvbGRlci9maWxlMi5tZCcgfTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1N1YmZvbGRlciA9IHsgXHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogW21vY2tGaWxlMSwgbW9ja0ZpbGUyXSBhcyBhbnlcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgubW9ja1JldHVyblZhbHVlKG1vY2tTdWJmb2xkZXIgYXMgYW55KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gdmF1bHQuZ2V0QWxsRmlsZXNJbkZvbGRlcignZm9sZGVyJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoZmlsZXMpLnRvRXF1YWwoW21vY2tGaWxlMSwgbW9ja0ZpbGUyXSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZmlsZUV4aXN0cycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiB0cnVlIGlmIGZpbGUgZXhpc3RzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBhcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoLm1vY2tSZXR1cm5WYWx1ZSh7IHBhdGg6ICd0ZXN0Lm1kJyB9IGFzIGFueSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QodmF1bHQuZmlsZUV4aXN0cygndGVzdC5tZCcpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBpZiBmaWxlIGRvZXMgbm90IGV4aXN0JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBhcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdCh2YXVsdC5maWxlRXhpc3RzKCd0ZXN0Lm1kJykpLnRvQmUoZmFsc2UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2dldEZpbGVzV2l0aEV4dGVuc2lvbicsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja0ZpbGVzID0gW1xyXG4gICAgICAgICAgICAgICAgeyBwYXRoOiAnZmlsZTEubWQnLCBleHRlbnNpb246ICdtZCcgfSxcclxuICAgICAgICAgICAgICAgIHsgcGF0aDogJ2ZpbGUyLnR4dCcsIGV4dGVuc2lvbjogJ3R4dCcgfSxcclxuICAgICAgICAgICAgICAgIHsgcGF0aDogJ2ZpbGUzLm1kJywgZXh0ZW5zaW9uOiAnbWQnIH0sXHJcbiAgICAgICAgICAgICAgICB7IHBhdGg6ICdmaWxlNC5wZGYnLCBleHRlbnNpb246ICdwZGYnIH1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGFwcC52YXVsdC5nZXRGaWxlcy5tb2NrUmV0dXJuVmFsdWUobW9ja0ZpbGVzIGFzIGFueSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGZpbGVzIHdpdGggc3BlY2lmaWVkIGV4dGVuc2lvbicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbWRGaWxlcyA9IHZhdWx0LmdldEZpbGVzV2l0aEV4dGVuc2lvbignbWQnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChtZEZpbGVzKS50b0hhdmVMZW5ndGgoMik7XHJcbiAgICAgICAgICAgIGV4cGVjdChtZEZpbGVzLmV2ZXJ5KGZpbGUgPT4gZmlsZS5leHRlbnNpb24gPT09ICdtZCcpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSBmb3Igbm9uLWV4aXN0ZW50IGV4dGVuc2lvbicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QganNGaWxlcyA9IHZhdWx0LmdldEZpbGVzV2l0aEV4dGVuc2lvbignanMnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChqc0ZpbGVzKS50b0hhdmVMZW5ndGgoMCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgYmUgY2FzZSBzZW5zaXRpdmUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1kRmlsZXMgPSB2YXVsdC5nZXRGaWxlc1dpdGhFeHRlbnNpb24oJ01EJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobWRGaWxlcykudG9IYXZlTGVuZ3RoKDApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2dldEZpbGVCeVBhdGgnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZmlsZSBpZiBleGlzdHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGaWxlID0geyBwYXRoOiAndGVzdC5tZCcgfTtcclxuICAgICAgICAgICAgYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aC5tb2NrUmV0dXJuVmFsdWUobW9ja0ZpbGUgYXMgYW55KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhdWx0LmdldEZpbGVCeVBhdGgoJ3Rlc3QubWQnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUobW9ja0ZpbGUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBudWxsIGlmIGZpbGUgZG9lcyBub3QgZXhpc3QnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgubW9ja1JldHVyblZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmF1bHQuZ2V0RmlsZUJ5UGF0aCgndGVzdC5tZCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjcmVhdGVGb2xkZXInLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgZm9sZGVyIGlmIGl0IGRvZXMgbm90IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgYXBwLnZhdWx0LmNyZWF0ZUZvbGRlci5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSBhcyBhbnkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYXdhaXQgdmF1bHQuY3JlYXRlRm9sZGVyKCduZXctZm9sZGVyJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ25ldy1mb2xkZXInKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBub3QgY3JlYXRlIGZvbGRlciBpZiBpdCBhbHJlYWR5IGV4aXN0cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aC5tb2NrUmV0dXJuVmFsdWUoe30gYXMgYW55KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGF3YWl0IHZhdWx0LmNyZWF0ZUZvbGRlcignZXhpc3RpbmctZm9sZGVyJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=