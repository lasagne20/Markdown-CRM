5dea21684efffd580f1b50b1d5f0dbbe
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('../../src/vault/Utils', () => ({
    setIcon: jest.fn()
}));
const ClasseProperty_1 = require("../../src/properties/ClasseProperty");
const Property_1 = require("../../src/properties/Property");
// Import the mocked function for use in tests
const { setIcon } = jest.requireMock('../../src/vault/Utils');
describe('ClasseProperty', () => {
    let classeProperty;
    beforeEach(() => {
        // Reset DOM mocks
        document.body.innerHTML = '';
        jest.clearAllMocks();
    });
    beforeEach(() => {
        classeProperty = new ClasseProperty_1.ClasseProperty('testClasse', mockVault, mockVault);
    });
    describe('constructor', () => {
        it('should create ClasseProperty with correct type', () => {
            expect(classeProperty.type).toBe('class');
        });
        it('should inherit from Property', () => {
            expect(classeProperty).toBeInstanceOf(Property_1.Property);
        });
        it('should use empty icon by default', () => {
            const defaultProperty = new ClasseProperty_1.ClasseProperty('defaultTest', mockVault, mockVault);
            expect(defaultProperty.name).toBe('defaultTest');
            expect(defaultProperty.type).toBe('class');
        });
        it('should accept custom icon', () => {
            const customProperty = new ClasseProperty_1.ClasseProperty('customName', mockVault, 'custom-icon');
            expect(customProperty.name).toBe('customName');
            expect(customProperty.icon).toBe('custom-icon');
        });
        it('should handle empty string icon', () => {
            const emptyIconProperty = new ClasseProperty_1.ClasseProperty('emptyIcon', mockVault, '');
            expect(emptyIconProperty.name).toBe('emptyIcon');
            expect(emptyIconProperty.icon).toBe('');
        });
    });
    describe('fillDisplay', () => {
        it('should create field with correct structure', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Class Value';
            const result = classeProperty.fillDisplay(value, mockUpdate);
            expect(result.tagName).toBe('DIV');
            expect(result.classList.contains('metadata-field')).toBe(true);
        });
        it('should create label with correct text content', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Class Value';
            const result = classeProperty.fillDisplay(value, mockUpdate);
            const label = result.querySelector('label');
            expect(label).toBeTruthy();
            expect(label?.textContent).toBe(value);
        });
        it('should set vault property', () => {
            const mockVault = { files: [] };
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            classeProperty.fillDisplay(value, mockUpdate);
            expect(classeProperty.vault).toBe(mockVault);
        });
        it('should handle null value', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const result = classeProperty.fillDisplay(null, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('');
        });
        it('should handle undefined value', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const result = classeProperty.fillDisplay(undefined, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('');
        });
        it('should handle empty string value', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const result = classeProperty.fillDisplay('', mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('');
        });
        it('should handle numeric value', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const numericValue = 42;
            const result = classeProperty.fillDisplay(numericValue, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('42');
        });
        it('should handle object value', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const objectValue = { name: 'test', id: 123 };
            const result = classeProperty.fillDisplay(objectValue, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('[object Object]');
        });
    });
    describe('icon handling', () => {
        it('should not create icon container when no icon', () => {
            const propertyWithoutIcon = new ClasseProperty_1.ClasseProperty('noIcon', mockVault, '');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithoutIcon.fillDisplay(value, mockUpdate);
            const iconContainer = result.querySelector('.icon-container');
            expect(iconContainer).toBeNull();
        });
        it('should create icon container when icon provided', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('withIcon', mockVault, 'test-icon');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithIcon.fillDisplay(value, mockUpdate);
            const iconContainer = result.querySelector('.icon-container');
            expect(iconContainer).toBeTruthy();
            expect(iconContainer?.classList.contains('icon-container')).toBe(true);
        });
        it('should call setIcon when icon is provided', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('withIcon', mockVault, 'custom-icon');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            propertyWithIcon.fillDisplay(value, mockUpdate);
            expect(setIcon).toHaveBeenCalledWith(expect.objectContaining({
                classList: expect.objectContaining({
                    contains: expect.any(Function)
                })
            }), 'custom-icon');
        });
        it('should not call setIcon when no icon', () => {
            setIcon.mockClear();
            const propertyWithoutIcon = new ClasseProperty_1.ClasseProperty('noIcon', mockVault, '');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            propertyWithoutIcon.fillDisplay(value, mockUpdate);
            expect(setIcon).not.toHaveBeenCalled();
        });
    });
    describe('inheritance from Property', () => {
        it('should have name property from parent', () => {
            expect(classeProperty.name).toBe('testClasse');
        });
        it('should have type property', () => {
            expect(classeProperty.type).toBe('class');
        });
        it('should have icon property from parent', () => {
            expect(classeProperty.icon).toBeDefined();
        });
        it('should have vault property that can be set', () => {
            const mockVault = { test: 'vault' };
            classeProperty.vault = mockVault;
            expect(classeProperty.vault).toBe(mockVault);
        });
    });
    describe('field structure validation', () => {
        it('should have correct DOM structure without icon', () => {
            const propertyWithoutIcon = new ClasseProperty_1.ClasseProperty('test', mockVault, '');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithoutIcon.fillDisplay(value, mockUpdate);
            expect(result.children.length).toBe(1); // Only label
            expect(result.children[0].tagName).toBe('LABEL');
        });
        it('should have correct DOM structure with icon', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('test', mockVault, 'icon');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithIcon.fillDisplay(value, mockUpdate);
            expect(result.children.length).toBe(2); // Icon container + label
            expect(result.children[0].classList.contains('icon-container')).toBe(true);
            expect(result.children[1].tagName).toBe('LABEL');
        });
        it('should maintain correct order: icon first, then label', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('test', mockVault, 'icon');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithIcon.fillDisplay(value, mockUpdate);
            const firstChild = result.children[0];
            const secondChild = result.children[1];
            expect(firstChild.classList.contains('icon-container')).toBe(true);
            expect(secondChild.tagName).toBe('LABEL');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXENsYXNzZVByb3BlcnR5LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUtILElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN0QyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUNyQixDQUFDLENBQUMsQ0FBQztBQUxKLHdFQUFxRTtBQUNyRSw0REFBeUQ7QUFNekQsOENBQThDO0FBQzlDLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFFOUQsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtJQUM1QixJQUFJLGNBQThCLENBQUM7SUFFbkMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLGtCQUFrQjtRQUNsQixRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDN0IsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3pCLENBQUMsQ0FBQyxDQUFDO0lBRUgsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLGNBQWMsR0FBRyxJQUFJLCtCQUFjLENBQUMsWUFBWSxFQUFFLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUM1RSxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQ3pCLEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxHQUFHLEVBQUU7WUFDdEQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDOUMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsOEJBQThC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U0FBUyxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzNFLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1REFBdUQsRUFBRSxHQUFHLEVBQUU7WUFDN0QsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLCtCQUFjLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUN2RSxNQUFNLFNBQVMsR0FBRyxFQUFFLENBQUM7WUFDckIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzdCLE1BQU0sS0FBSyxHQUFHLFlBQVksQ0FBQztZQUUzQixNQUFNLE1BQU0sR0FBRyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBRS9ELE1BQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEMsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUV2QyxNQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNuRSxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM5QyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXENsYXNzZVByb3BlcnR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBqZXN0LWVudmlyb25tZW50IGpzZG9tXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQ2xhc3NlUHJvcGVydHkgfSBmcm9tICcuLi8uLi9zcmMvcHJvcGVydGllcy9DbGFzc2VQcm9wZXJ0eSc7XHJcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSAnLi4vLi4vc3JjL3Byb3BlcnRpZXMvUHJvcGVydHknO1xyXG5cclxuamVzdC5tb2NrKCcuLi8uLi9zcmMvdmF1bHQvVXRpbHMnLCAoKSA9PiAoe1xyXG4gICAgc2V0SWNvbjogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbi8vIEltcG9ydCB0aGUgbW9ja2VkIGZ1bmN0aW9uIGZvciB1c2UgaW4gdGVzdHNcclxuY29uc3QgeyBzZXRJY29uIH0gPSBqZXN0LnJlcXVpcmVNb2NrKCcuLi8uLi9zcmMvdmF1bHQvVXRpbHMnKTtcclxuXHJcbmRlc2NyaWJlKCdDbGFzc2VQcm9wZXJ0eScsICgpID0+IHtcclxuICAgIGxldCBjbGFzc2VQcm9wZXJ0eTogQ2xhc3NlUHJvcGVydHk7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgLy8gUmVzZXQgRE9NIG1vY2tzXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIGNsYXNzZVByb3BlcnR5ID0gbmV3IENsYXNzZVByb3BlcnR5KCd0ZXN0Q2xhc3NlJywgbW9ja1ZhdWx0LCBtb2NrVmF1bHQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NvbnN0cnVjdG9yJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIENsYXNzZVByb3BlcnR5IHdpdGggY29ycmVjdCB0eXBlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoY2xhc3NlUHJvcGVydHkudHlwZSkudG9CZSgnY2xhc3MnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBpbmhlcml0IGZyb20gUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChjbGFzc2VQcm9wZXJ0eSkudG9CZUluc3RhbmNlT2YoUHJvcGVydHkpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHVzZSBlbXB0eSBpY29uIGJ5IGRlZmF1bHQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRQcm9wZXJ0eSA9IG5ldyBDbGFzc2VQcm9wZXJ0eSgnZGVmYXVsdFRlc3QnLCBtb2NrVmF1bHQsIG1vY2tWYXVsdCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChkZWZhdWx0UHJvcGVydHkubmFtZSkudG9CZSgnZGVmYXVsdFRlc3QnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGRlZmF1bHRQcm9wZXJ0eS50eXBlKS50b0JlKCdjbGFzcycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGFjY2VwdCBjdXN0b20gaWNvbicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY3VzdG9tUHJvcGVydHkgPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ2N1c3RvbU5hbWUnLCBtb2NrVmF1bHQsICdjdXN0b20taWNvbicpO1xyXG4gICAgICAgICAgICBleHBlY3QoY3VzdG9tUHJvcGVydHkubmFtZSkudG9CZSgnY3VzdG9tTmFtZScpO1xyXG4gICAgICAgICAgICBleHBlY3QoY3VzdG9tUHJvcGVydHkuaWNvbikudG9CZSgnY3VzdG9tLWljb24nKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgc3RyaW5nIGljb24nLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVtcHR5SWNvblByb3BlcnR5ID0gbmV3IENsYXNzZVByb3BlcnR5KCdlbXB0eUljb24nLCBtb2NrVmF1bHQsICcnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGVtcHR5SWNvblByb3BlcnR5Lm5hbWUpLnRvQmUoJ2VtcHR5SWNvbicpO1xyXG4gICAgICAgICAgICBleHBlY3QoZW1wdHlJY29uUHJvcGVydHkuaWNvbikudG9CZSgnJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZmlsbERpc3BsYXknLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgZmllbGQgd2l0aCBjb3JyZWN0IHN0cnVjdHVyZScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1ZhdWx0ID0ge307XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gJ1Rlc3QgQ2xhc3MgVmFsdWUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY2xhc3NlUHJvcGVydHkuZmlsbERpc3BsYXkodmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC50YWdOYW1lKS50b0JlKCdESVYnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jbGFzc0xpc3QuY29udGFpbnMoJ21ldGFkYXRhLWZpZWxkJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGxhYmVsIHdpdGggY29ycmVjdCB0ZXh0IGNvbnRlbnQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tWYXVsdCA9IHt9O1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICdUZXN0IENsYXNzIFZhbHVlJztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNsYXNzZVByb3BlcnR5LmZpbGxEaXNwbGF5KHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSByZXN1bHQucXVlcnlTZWxlY3RvcignbGFiZWwnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChsYWJlbCkudG9CZVRydXRoeSgpO1xyXG4gICAgICAgICAgICBleHBlY3QobGFiZWw/LnRleHRDb250ZW50KS50b0JlKHZhbHVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBzZXQgdmF1bHQgcHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tWYXVsdCA9IHsgZmlsZXM6IFtdIH07XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gJ1Rlc3QgVmFsdWUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2xhc3NlUHJvcGVydHkuZmlsbERpc3BsYXkodmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGNsYXNzZVByb3BlcnR5LnZhdWx0KS50b0JlKG1vY2tWYXVsdCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bGwgdmFsdWUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tWYXVsdCA9IHt9O1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY2xhc3NlUHJvcGVydHkuZmlsbERpc3BsYXkobnVsbCwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gcmVzdWx0LnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobGFiZWw/LnRleHRDb250ZW50KS50b0JlKCcnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgdW5kZWZpbmVkIHZhbHVlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNsYXNzZVByb3BlcnR5LmZpbGxEaXNwbGF5KHVuZGVmaW5lZCwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gcmVzdWx0LnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobGFiZWw/LnRleHRDb250ZW50KS50b0JlKCcnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgc3RyaW5nIHZhbHVlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNsYXNzZVByb3BlcnR5LmZpbGxEaXNwbGF5KCcnLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSByZXN1bHQucXVlcnlTZWxlY3RvcignbGFiZWwnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChsYWJlbD8udGV4dENvbnRlbnQpLnRvQmUoJycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBudW1lcmljIHZhbHVlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgbnVtZXJpY1ZhbHVlID0gNDI7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBjbGFzc2VQcm9wZXJ0eS5maWxsRGlzcGxheShudW1lcmljVmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IHJlc3VsdC5xdWVyeVNlbGVjdG9yKCdsYWJlbCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGxhYmVsPy50ZXh0Q29udGVudCkudG9CZSgnNDInKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgb2JqZWN0IHZhbHVlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3Qgb2JqZWN0VmFsdWUgPSB7IG5hbWU6ICd0ZXN0JywgaWQ6IDEyMyB9O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY2xhc3NlUHJvcGVydHkuZmlsbERpc3BsYXkob2JqZWN0VmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IHJlc3VsdC5xdWVyeVNlbGVjdG9yKCdsYWJlbCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGxhYmVsPy50ZXh0Q29udGVudCkudG9CZSgnW29iamVjdCBPYmplY3RdJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnaWNvbiBoYW5kbGluZycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIG5vdCBjcmVhdGUgaWNvbiBjb250YWluZXIgd2hlbiBubyBpY29uJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVdpdGhvdXRJY29uID0gbmV3IENsYXNzZVByb3BlcnR5KCdub0ljb24nLCBtb2NrVmF1bHQsICcnKTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1ZhdWx0ID0ge307XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gJ1Rlc3QgVmFsdWUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJvcGVydHlXaXRob3V0SWNvbi5maWxsRGlzcGxheSh2YWx1ZSwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGljb25Db250YWluZXIgPSByZXN1bHQucXVlcnlTZWxlY3RvcignLmljb24tY29udGFpbmVyJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoaWNvbkNvbnRhaW5lcikudG9CZU51bGwoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgaWNvbiBjb250YWluZXIgd2hlbiBpY29uIHByb3ZpZGVkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVdpdGhJY29uID0gbmV3IENsYXNzZVByb3BlcnR5KCd3aXRoSWNvbicsIG1vY2tWYXVsdCwgJ3Rlc3QtaWNvbicpO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnVGVzdCBWYWx1ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9wZXJ0eVdpdGhJY29uLmZpbGxEaXNwbGF5KHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IHJlc3VsdC5xdWVyeVNlbGVjdG9yKCcuaWNvbi1jb250YWluZXInKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChpY29uQ29udGFpbmVyKS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChpY29uQ29udGFpbmVyPy5jbGFzc0xpc3QuY29udGFpbnMoJ2ljb24tY29udGFpbmVyJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgY2FsbCBzZXRJY29uIHdoZW4gaWNvbiBpcyBwcm92aWRlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlXaXRoSWNvbiA9IG5ldyBDbGFzc2VQcm9wZXJ0eSgnd2l0aEljb24nLCBtb2NrVmF1bHQsICdjdXN0b20taWNvbicpO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnVGVzdCBWYWx1ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBwcm9wZXJ0eVdpdGhJY29uLmZpbGxEaXNwbGF5KHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChzZXRJY29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICAgICAgICBjbGFzc0xpc3Q6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgICAgICAgICBjb250YWluczogZXhwZWN0LmFueShGdW5jdGlvbilcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pLCAnY3VzdG9tLWljb24nKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBub3QgY2FsbCBzZXRJY29uIHdoZW4gbm8gaWNvbicsICgpID0+IHtcclxuICAgICAgICAgICAgc2V0SWNvbi5tb2NrQ2xlYXIoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5V2l0aG91dEljb24gPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ25vSWNvbicsIG1vY2tWYXVsdCwgJycpO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnVGVzdCBWYWx1ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBwcm9wZXJ0eVdpdGhvdXRJY29uLmZpbGxEaXNwbGF5KHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChzZXRJY29uKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2luaGVyaXRhbmNlIGZyb20gUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIG5hbWUgcHJvcGVydHkgZnJvbSBwYXJlbnQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChjbGFzc2VQcm9wZXJ0eS5uYW1lKS50b0JlKCd0ZXN0Q2xhc3NlJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGF2ZSB0eXBlIHByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoY2xhc3NlUHJvcGVydHkudHlwZSkudG9CZSgnY2xhc3MnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIGljb24gcHJvcGVydHkgZnJvbSBwYXJlbnQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChjbGFzc2VQcm9wZXJ0eS5pY29uKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgdmF1bHQgcHJvcGVydHkgdGhhdCBjYW4gYmUgc2V0JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7IHRlc3Q6ICd2YXVsdCcgfTtcclxuICAgICAgICAgICAgY2xhc3NlUHJvcGVydHkudmF1bHQgPSBtb2NrVmF1bHQ7XHJcbiAgICAgICAgICAgIGV4cGVjdChjbGFzc2VQcm9wZXJ0eS52YXVsdCkudG9CZShtb2NrVmF1bHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2ZpZWxkIHN0cnVjdHVyZSB2YWxpZGF0aW9uJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IERPTSBzdHJ1Y3R1cmUgd2l0aG91dCBpY29uJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVdpdGhvdXRJY29uID0gbmV3IENsYXNzZVByb3BlcnR5KCd0ZXN0JywgbW9ja1ZhdWx0LCAnJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tWYXVsdCA9IHt9O1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICdUZXN0IFZhbHVlJztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5V2l0aG91dEljb24uZmlsbERpc3BsYXkodmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jaGlsZHJlbi5sZW5ndGgpLnRvQmUoMSk7IC8vIE9ubHkgbGFiZWxcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jaGlsZHJlblswXS50YWdOYW1lKS50b0JlKCdMQUJFTCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBET00gc3RydWN0dXJlIHdpdGggaWNvbicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlXaXRoSWNvbiA9IG5ldyBDbGFzc2VQcm9wZXJ0eSgndGVzdCcsIG1vY2tWYXVsdCwgJ2ljb24nKTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1ZhdWx0ID0ge307XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gJ1Rlc3QgVmFsdWUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJvcGVydHlXaXRoSWNvbi5maWxsRGlzcGxheSh2YWx1ZSwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmNoaWxkcmVuLmxlbmd0aCkudG9CZSgyKTsgLy8gSWNvbiBjb250YWluZXIgKyBsYWJlbFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmNoaWxkcmVuWzBdLmNsYXNzTGlzdC5jb250YWlucygnaWNvbi1jb250YWluZXInKSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jaGlsZHJlblsxXS50YWdOYW1lKS50b0JlKCdMQUJFTCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIG1haW50YWluIGNvcnJlY3Qgb3JkZXI6IGljb24gZmlyc3QsIHRoZW4gbGFiZWwnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5V2l0aEljb24gPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ3Rlc3QnLCBtb2NrVmF1bHQsICdpY29uJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tWYXVsdCA9IHt9O1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICdUZXN0IFZhbHVlJztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5V2l0aEljb24uZmlsbERpc3BsYXkodmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgZmlyc3RDaGlsZCA9IHJlc3VsdC5jaGlsZHJlblswXTtcclxuICAgICAgICAgICAgY29uc3Qgc2Vjb25kQ2hpbGQgPSByZXN1bHQuY2hpbGRyZW5bMV07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoZmlyc3RDaGlsZC5jbGFzc0xpc3QuY29udGFpbnMoJ2ljb24tY29udGFpbmVyJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChzZWNvbmRDaGlsZC50YWdOYW1lKS50b0JlKCdMQUJFTCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=