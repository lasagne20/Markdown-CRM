7ee1b9ec7c538257f39123677430dcad
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MultiFileProperty = void 0;
const ObjectProperty_1 = require("./ObjectProperty");
const FileProperty_1 = require("./FileProperty");
const Utils_1 = require("../vault/Utils");
class MultiFileProperty extends ObjectProperty_1.ObjectProperty {
    constructor(name, classes, args = {}) {
        super(name, {}, args);
        this.type = "multiFile";
        this.flexSpan = 2;
        this.classes = classes;
        this.property = new FileProperty_1.FileProperty(name, classes, args);
    }
    getClasses() {
        return this.classes;
    }
    getParentValue(values) {
        return this.property.getParentValue(values);
    }
    formatParentValue(value) {
        return [value];
    }
    // Méthode principale pour obtenir l'affichage
    fillDisplay(vault, values, update) {
        this.vault = vault;
        const container = document.createElement("div");
        container.classList.add("metadata-multiFiles-container-" + this.name.toLowerCase());
        container.classList.add("metadata-multiFiles-container");
        // Créer les lignes d'objet
        this.createObjects(values, update, container);
        const addButton = this.createAddButton(values, update, container);
        container.appendChild(addButton);
        return container;
    }
    createObjects(values, update, container) {
        if (!values)
            return;
        values.forEach((objects, index) => {
            const row = this.createObjectRow(values, update, objects, index, container);
            container.appendChild(row);
        });
    }
    createObjectRow(values, update, value, index, container) {
        const row = document.createElement("div");
        row.classList.add("metadata-multiFiles-row-inline");
        // Ajouter le bouton de suppression
        const deleteButton = this.createDeleteButton(values, update, index, container);
        row.appendChild(deleteButton);
        let propertyContainer = document.createElement("div");
        propertyContainer.classList.add("metadata-multiFiles-property-inline");
        propertyContainer.appendChild(this.property.fillDisplay(this.vault, value, async (value) => await this.updateObject(values, update, index, this.property, value)));
        row.appendChild(propertyContainer);
        return row;
    }
    createDeleteButton(values, update, index, container) {
        const deleteButton = document.createElement("button");
        (0, Utils_1.setIcon)(deleteButton, "minus");
        deleteButton.classList.add("metadata-delete-button-inline-small");
        deleteButton.onclick = async () => await this.removeProperty(values, update, index, container);
        return deleteButton;
    }
    async addProperty(values, update, container) {
        const newFiles = this.vault.app.selectMultipleFile(this.vault, this.classes, { hint: "Choisissez des fichiers " + this.getClasses().join(" ou ") });
        if (newFiles && newFiles.length > 0) {
            if (!values) {
                values = [];
            }
            newFiles.forEach((file) => {
                values.push(file.getLink());
            });
            await update(values);
            await this.reloadObjects(values, update);
        }
    }
    createAddButton(values, update, container) {
        const addButton = document.createElement("button");
        (0, Utils_1.setIcon)(addButton, "plus");
        addButton.classList.add("metadata-add-button-inline-small");
        addButton.onclick = async () => await this.addProperty(values, update, container);
        return addButton;
    }
    enableDragAndDrop() {
        // Disable drag and drop
    }
}
exports.MultiFileProperty = MultiFileProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE11bHRpRmlsZVByb3BlcnR5LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLHFEQUFrRDtBQUNsRCxpREFBOEM7QUFDOUMsMENBQXlDO0FBSXpDLE1BQWEsaUJBQWtCLFNBQVEsK0JBQWM7SUFRakQsWUFBWSxJQUFZLEVBQUUsT0FBa0IsRUFBRSxJQUFJLEdBQUcsRUFBRTtRQUNuRCxLQUFLLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQVBWLFNBQUksR0FBWSxXQUFXLENBQUM7UUFHNUIsYUFBUSxHQUFHLENBQUMsQ0FBQztRQUt6QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksMkJBQVksQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFUSxVQUFVO1FBQ2YsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3hCLENBQUM7SUFFUSxjQUFjLENBQUMsTUFBWTtRQUNoQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQy9DLENBQUM7SUFFUSxpQkFBaUIsQ0FBQyxLQUFjO1FBQ3JDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUNsQixDQUFDO0lBRUQsOENBQThDO0lBQ3JDLFdBQVcsQ0FBQyxLQUFXLEVBQUMsTUFBVyxFQUFFLE1BQXFDO1FBQy9FLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEQsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsZ0NB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c291cmNlcyI6WyJDOlxcVXNlcnNcXGxlb2R1XFxEb2N1bWVudHNcXDEgLSBQcm9cXFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXHNyY1xccHJvcGVydGllc1xcTXVsdGlGaWxlUHJvcGVydHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCB7IE9iamVjdFByb3BlcnR5IH0gZnJvbSBcIi4vT2JqZWN0UHJvcGVydHlcIjtcclxuaW1wb3J0IHsgRmlsZVByb3BlcnR5IH0gZnJvbSBcIi4vRmlsZVByb3BlcnR5XCI7XHJcbmltcG9ydCB7IHNldEljb24gfSBmcm9tIFwiLi4vdmF1bHQvVXRpbHNcIjtcclxuaW1wb3J0IHsgRmlsZSB9IGZyb20gXCIuLi92YXVsdC9GaWxlXCI7XHJcbmltcG9ydCB7IE15VmF1bHQgfSBmcm9tIFwiLi4vdmF1bHQvTXlWYXVsdFwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIE11bHRpRmlsZVByb3BlcnR5IGV4dGVuZHMgT2JqZWN0UHJvcGVydHkge1xyXG5cclxuICAgIHB1YmxpYyBvdmVycmlkZSB0eXBlIDogc3RyaW5nID0gXCJtdWx0aUZpbGVcIjtcclxuICAgIHB1YmxpYyBjbGFzc2VzOiBzdHJpbmdbXTtcclxuICAgIHB1YmxpYyBwcm9wZXJ0eSA6IEZpbGVQcm9wZXJ0eTtcclxuICAgIHB1YmxpYyBvdmVycmlkZSBmbGV4U3BhbiA9IDI7XHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgY2xhc3NlcyA6IHN0cmluZ1tdLCBhcmdzID0ge30pe1xyXG4gICAgICAgIHN1cGVyKG5hbWUsIHt9LCBhcmdzKTtcclxuICAgICAgICB0aGlzLmNsYXNzZXMgPSBjbGFzc2VzO1xyXG4gICAgICAgIHRoaXMucHJvcGVydHkgPSBuZXcgRmlsZVByb3BlcnR5KG5hbWUsIGNsYXNzZXMsIGFyZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGdldENsYXNzZXMoKTogc3RyaW5nW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsYXNzZXM7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgZ2V0UGFyZW50VmFsdWUodmFsdWVzIDogYW55KSA6IEZpbGUgfCB1bmRlZmluZWR7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcGVydHkuZ2V0UGFyZW50VmFsdWUodmFsdWVzKVxyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGZvcm1hdFBhcmVudFZhbHVlKHZhbHVlIDogc3RyaW5nKXtcclxuICAgICAgICByZXR1cm4gW3ZhbHVlXVxyXG4gICAgfVxyXG5cclxuICAgIC8vIE3DqXRob2RlIHByaW5jaXBhbGUgcG91ciBvYnRlbmlyIGwnYWZmaWNoYWdlXHJcbiAgICBvdmVycmlkZSBmaWxsRGlzcGxheSh2YXVsdCA6IGFueSx2YWx1ZXM6IGFueSwgdXBkYXRlOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPikge1xyXG4gICAgICAgIHRoaXMudmF1bHQgPSB2YXVsdDtcclxuICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtbXVsdGlGaWxlcy1jb250YWluZXItXCIrdGhpcy5uYW1lLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtbXVsdGlGaWxlcy1jb250YWluZXJcIik7XHJcblxyXG4gICAgICAgIC8vIENyw6llciBsZXMgbGlnbmVzIGQnb2JqZXRcclxuICAgICAgICB0aGlzLmNyZWF0ZU9iamVjdHModmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgIGNvbnN0IGFkZEJ1dHRvbiA9IHRoaXMuY3JlYXRlQWRkQnV0dG9uKHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChhZGRCdXR0b24pO1xyXG5cclxuICAgICAgICByZXR1cm4gY29udGFpbmVyO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGNyZWF0ZU9iamVjdHModmFsdWVzOiBhbnksIHVwZGF0ZTogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICBpZiAoIXZhbHVlcykgcmV0dXJuO1xyXG4gICAgICAgIHZhbHVlcy5mb3JFYWNoKChvYmplY3RzOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5jcmVhdGVPYmplY3RSb3codmFsdWVzLCB1cGRhdGUsIG9iamVjdHMsIGluZGV4LCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocm93KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZSBjcmVhdGVPYmplY3RSb3codmFsdWVzOiBhbnksIHVwZGF0ZTogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIHZhbHVlOiBhbnksIGluZGV4OiBudW1iZXIsIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpOiBIVE1MRGl2RWxlbWVudCB7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICByb3cuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLW11bHRpRmlsZXMtcm93LWlubGluZVwiKTtcclxuXHJcbiAgICAgICAgLy8gQWpvdXRlciBsZSBib3V0b24gZGUgc3VwcHJlc3Npb25cclxuICAgICAgICBjb25zdCBkZWxldGVCdXR0b24gPSB0aGlzLmNyZWF0ZURlbGV0ZUJ1dHRvbih2YWx1ZXMsIHVwZGF0ZSwgaW5kZXgsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgcm93LmFwcGVuZENoaWxkKGRlbGV0ZUJ1dHRvbik7XHJcblxyXG5cclxuIFxyXG4gICAgICAgIGxldCBwcm9wZXJ0eUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgcHJvcGVydHlDb250YWluZXIuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLW11bHRpRmlsZXMtcHJvcGVydHktaW5saW5lXCIpO1xyXG4gICAgICAgIHByb3BlcnR5Q29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMucHJvcGVydHkuZmlsbERpc3BsYXkodGhpcy52YXVsdCwgdmFsdWUsIGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy51cGRhdGVPYmplY3QodmFsdWVzLCB1cGRhdGUsIGluZGV4LCB0aGlzLnByb3BlcnR5LCB2YWx1ZSkpKTtcclxuICAgICAgICByb3cuYXBwZW5kQ2hpbGQocHJvcGVydHlDb250YWluZXIpO1xyXG5cclxuICAgICAgICByZXR1cm4gcm93O1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGNyZWF0ZURlbGV0ZUJ1dHRvbih2YWx1ZXM6IGFueSwgdXBkYXRlOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgaW5kZXg6IG51bWJlciwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCk6IEhUTUxCdXR0b25FbGVtZW50IHtcclxuICAgICAgICBjb25zdCBkZWxldGVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgICAgIHNldEljb24oZGVsZXRlQnV0dG9uLCBcIm1pbnVzXCIpO1xyXG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtZGVsZXRlLWJ1dHRvbi1pbmxpbmUtc21hbGxcIik7XHJcbiAgICAgICAgZGVsZXRlQnV0dG9uLm9uY2xpY2sgPSBhc3luYyAoKSA9PiBhd2FpdCB0aGlzLnJlbW92ZVByb3BlcnR5KHZhbHVlcywgdXBkYXRlLCBpbmRleCwgY29udGFpbmVyKTtcclxuICAgICAgICByZXR1cm4gZGVsZXRlQnV0dG9uO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGFzeW5jIGFkZFByb3BlcnR5KHZhbHVlczogYW55LCB1cGRhdGU6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KSB7XHJcbiAgICAgICAgY29uc3QgbmV3RmlsZXMgPSB0aGlzLnZhdWx0LmFwcC5zZWxlY3RNdWx0aXBsZUZpbGUodGhpcy52YXVsdCwgdGhpcy5jbGFzc2VzLCB7IGhpbnQ6IFwiQ2hvaXNpc3NleiBkZXMgZmljaGllcnMgXCIgKyB0aGlzLmdldENsYXNzZXMoKS5qb2luKFwiIG91IFwiKSB9KTtcclxuICAgICAgICBpZiAobmV3RmlsZXMgJiYgbmV3RmlsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBpZiAoIXZhbHVlcykgeyB2YWx1ZXMgPSBbXTsgfVxyXG4gICAgICAgICAgICBuZXdGaWxlcy5mb3JFYWNoKChmaWxlOiBGaWxlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaChmaWxlLmdldExpbmsoKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBhd2FpdCB1cGRhdGUodmFsdWVzKTtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWxvYWRPYmplY3RzKHZhbHVlcywgdXBkYXRlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgY3JlYXRlQWRkQnV0dG9uKHZhbHVlczogYW55LCB1cGRhdGU6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KTogSFRNTEJ1dHRvbkVsZW1lbnQge1xyXG4gICAgICAgIGNvbnN0IGFkZEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgc2V0SWNvbihhZGRCdXR0b24sIFwicGx1c1wiKTtcclxuICAgICAgICBhZGRCdXR0b24uY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLWFkZC1idXR0b24taW5saW5lLXNtYWxsXCIpO1xyXG4gICAgICAgIGFkZEJ1dHRvbi5vbmNsaWNrID0gYXN5bmMgKCkgPT4gYXdhaXQgdGhpcy5hZGRQcm9wZXJ0eSh2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICByZXR1cm4gYWRkQnV0dG9uO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGVuYWJsZURyYWdBbmREcm9wKCkge1xyXG4gICAgICAgIC8vIERpc2FibGUgZHJhZyBhbmQgZHJvcFxyXG4gICAgfVxyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==