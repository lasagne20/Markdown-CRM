e5c3ee22bc1003d6dadc049b2439e08a
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DateProperty = void 0;
const flatpickr_1 = __importDefault(require("flatpickr"));
const fr_js_1 = require("flatpickr/dist/l10n/fr.js");
const Utils_1 = require("../vault/Utils");
const Property_1 = require("./Property");
const iconMap = {
    "yesterday": "calendar-arrow-down",
    "today": "calendar-check",
    "tomorrow": "calendar-arrow-up",
    "next-week": "calendar-clock"
};
class DateProperty extends Property_1.Property {
    constructor(name, quickSelectIcons, args = {}) {
        super(name, args);
        this.type = "date";
        this.quickSelectIcons = quickSelectIcons;
    }
    // Crée l'affichage du champ date
    fillDisplay(vault, value, update) {
        this.vault = vault;
        const fieldContainer = document.createElement("div");
        fieldContainer.classList.add("field-container-column");
        const field = document.createElement("div");
        field.classList.add("metadata-field");
        const dateContainer = this.createFieldContainerContent(update, value);
        field.appendChild(dateContainer);
        if (this.title) {
            const header = document.createElement("div");
            header.classList.add("metadata-header");
            header.textContent = this.name;
            fieldContainer.appendChild(header);
        }
        fieldContainer.appendChild(field);
        return fieldContainer;
    }
    // Crée un champ d'input pour la date
    createFieldDate(value, update, link) {
        const input = document.createElement("input");
        input.type = "text";
        input.value = value || ""; // Formaté en "YYYY-MM-DD" pour le stockage
        input.classList.add("field-input");
        (0, flatpickr_1.default)(input, {
            dateFormat: "Y-m-d", // Stocker en "YYYY-MM-DD"
            defaultDate: value || "",
            locale: fr_js_1.French,
            onChange: async (selectedDates) => {
                const selectedDate = selectedDates[0];
                if (selectedDate) {
                    // Met à jour la valeur de l'input avec le format "YYYY-MM-DD"
                    input.value = this.formatDateForStorage(selectedDate);
                    await this.updateField(update, input, link);
                }
            },
            onClose: async () => {
                input.value = "";
                await this.updateField(update, input, link);
            }
        });
        return input;
    }
    // Crée un lien qui affiche la date (au format "26 février 2025")
    createFieldLink(value) {
        const link = document.createElement("div");
        link.textContent = value ? this.formatDateForDisplay(value) : "Aucune date sélectionnée";
        link.classList.add("date-field-link");
        link.classList.add("field-link");
        link.style.cursor = "pointer";
        link.onclick = (event) => this.modifyField(event);
        return link;
    }
    // Formate la date pour l'affichage : "26 février 2025"
    formatDateForDisplay(date) {
        const parsedDate = new Date(date);
        return parsedDate.toLocaleDateString("fr-FR", {
            day: "numeric",
            month: "long",
            year: "numeric"
        });
    }
    // Formate la date pour le stockage : "YYYY-MM-DD"
    formatDateForStorage(date) {
        // Use toISOString to avoid timezone issues, then extract date part
        return date.toISOString().split('T')[0];
    }
    // Ajoute les options "Aujourd'hui", "Demain", "Semaine prochaine"
    createQuickSelect(value, update, link, input) {
        const quickSelectContainer = document.createElement("div");
        quickSelectContainer.classList.add("quick-select-container");
        this.quickSelectIcons.forEach(option => {
            const button = document.createElement("button");
            (0, Utils_1.setIcon)(button, iconMap[option]);
            button.addEventListener("click", async () => {
                const date = this.getDateForOption(option); // Obtenir la date pour l'option choisie
                await update(this.formatDateForStorage(date));
                link.textContent = this.formatDateForDisplay(this.formatDateForStorage(date));
                link.style.display = "block";
                input.style.display = "none";
            });
            quickSelectContainer.appendChild(button);
        });
        return quickSelectContainer;
    }
    getDefaultValue() {
        return this.formatDateForStorage(this.getDateForOption(this.default));
    }
    getDateForOption(option) {
        const today = new Date();
        switch (option) {
            case "yesterday": {
                const yesterday = new Date(today);
                yesterday.setDate(today.getDate() - 1);
                return yesterday;
            }
            case "today": return new Date(today);
            case "tomorrow": {
                const tomorrow = new Date(today);
                tomorrow.setDate(today.getDate() + 1);
                return tomorrow;
            }
            case "next-week": {
                const nextWeek = new Date(today);
                nextWeek.setDate(today.getDate() + 7);
                return nextWeek;
            }
            case "2-week": {
                const twoWeeks = new Date(today);
                twoWeeks.setDate(today.getDate() + 14);
                return twoWeeks;
            }
            default: return new Date(today);
        }
    }
    // Crée un conteneur pour afficher la date et la sélection rapide
    createFieldContainerContent(update, value) {
        const fieldContainer = document.createElement("div");
        fieldContainer.classList.add("field-container");
        fieldContainer.classList.add("metadata-field");
        const currentField = value;
        const link = this.createFieldLink(currentField);
        const input = this.createFieldDate(currentField, update, link);
        // Affichage initial : Si la date existe, afficher le lien
        if (currentField && this.validate(value)) {
            link.style.display = "block";
            input.style.display = "none";
        }
        else {
            input.style.display = "block";
            link.style.display = "none";
        }
        // Créer un conteneur avec les boutons de sélection rapide
        const quickSelectContainer = this.createQuickSelect(currentField, update, link, input);
        fieldContainer.appendChild(link);
        fieldContainer.appendChild(input);
        fieldContainer.appendChild(quickSelectContainer);
        return fieldContainer;
    }
    // Met à jour la valeur de la date et bascule l'affichage entre le lien et l'input
    async updateField(update, input, link) {
        let value = this.validate(input.value);
        if (value) {
            await update(value); // Met à jour avec la date au format "YYYY-MM-DD"
            input.style.display = "none";
            link.textContent = this.formatDateForDisplay(value); // Affichage avec le mois en lettres
            link.style.display = "block";
        }
        else {
            await update(input.value);
        }
    }
}
exports.DateProperty = DateProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXERhdGVQcm9wZXJ0eS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSwwREFBa0M7QUFDbEMscURBQW1EO0FBQ25ELDBDQUF5QztBQUN6Qyx5Q0FBc0M7QUFFdEMsTUFBTSxPQUFPLEdBQTZCO0lBQ3RDLFdBQVcsRUFBRyxxQkFBcUI7SUFDbkMsT0FBTyxFQUFHLGdCQUFnQjtJQUMxQixVQUFVLEVBQUcsbUJBQW1CO0lBQ2hDLFdBQVcsRUFBRyxnQkFBZ0I7Q0FDakMsQ0FBQTtBQUVELE1BQWEsWUFBYSxTQUFRLG1CQUFRO0lBS3RDLFlBQVksSUFBWSxFQUFFLGdCQUEwQixFQUFFLElBQUksR0FBRyxFQUFFO1FBQzNELEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFITixTQUFJLEdBQVksTUFBTSxDQUFDO1FBSW5DLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxnQkFBZ0IsQ0FBQTtJQUU1QyxDQUFDO0lBR0QsaUNBQWlDO0lBQ3hCLFdBQVcsQ0FBQyxLQUFXLEVBQUUsS0FBVyxFQUFFLE1BQXdDO1FBQ25GLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLE1BQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckQsY0FBYyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUV2RCxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzVDLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDdEMsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLDJCQUEyQixDQUFDLE1BQU0sRUFBRSxL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LENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztZQUM5QixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDaEMsQ0FBQztRQUVELDBEQUEwRDtRQUMxRCxNQUFNLG9CQUFvQixHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztRQUV2RixjQUFjLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2pDLGNBQWMsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBR2pELE9BQU8sY0FBYyxDQUFDO0lBQzFCLENBQUM7SUFFRCxrRkFBa0Y7SUFDekUsS0FBSyxDQUFDLFdBQVcsQ0FBQyxNQUF3QyxFQUFFLEtBQXVCLEVBQUUsSUFBaUI7UUFDM0csSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkMsSUFBSSxLQUFLLEVBQUUsQ0FBQztZQUNSLE1BQU0sTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUUsaURBQWlEO1lBQ3ZFLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztZQUM3QixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFFLG9DQUFvQztZQUMxRixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDakMsQ0FBQzthQUFNLENBQUM7WUFDSixNQUFNLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDOUIsQ0FBQztJQUNMLENBQUM7Q0FHSjtBQTlMRCxvQ0E4TEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXERhdGVQcm9wZXJ0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZmxhdHBpY2tyIGZyb20gXCJmbGF0cGlja3JcIjtcclxuaW1wb3J0IHsgRnJlbmNoIH0gZnJvbSBcImZsYXRwaWNrci9kaXN0L2wxMG4vZnIuanNcIjtcclxuaW1wb3J0IHsgc2V0SWNvbiB9IGZyb20gXCIuLi92YXVsdC9VdGlsc1wiO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eSB9IGZyb20gXCIuL1Byb3BlcnR5XCI7XHJcblxyXG5jb25zdCBpY29uTWFwIDoge1trZXk6IHN0cmluZ10gOiBzdHJpbmd9PSB7IFxyXG4gICAgXCJ5ZXN0ZXJkYXlcIiA6IFwiY2FsZW5kYXItYXJyb3ctZG93blwiLFxyXG4gICAgXCJ0b2RheVwiIDogXCJjYWxlbmRhci1jaGVja1wiLFxyXG4gICAgXCJ0b21vcnJvd1wiIDogXCJjYWxlbmRhci1hcnJvdy11cFwiLFxyXG4gICAgXCJuZXh0LXdlZWtcIiA6IFwiY2FsZW5kYXItY2xvY2tcIlxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRGF0ZVByb3BlcnR5IGV4dGVuZHMgUHJvcGVydHkge1xyXG5cclxuICAgIHByaXZhdGUgcXVpY2tTZWxlY3RJY29uczogc3RyaW5nW107XHJcbiAgICBwdWJsaWMgb3ZlcnJpZGUgdHlwZSA6IHN0cmluZyA9IFwiZGF0ZVwiO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgcXVpY2tTZWxlY3RJY29uczogc3RyaW5nW10sIGFyZ3MgPSB7fSkge1xyXG4gICAgICAgIHN1cGVyKG5hbWUsIGFyZ3MpO1xyXG4gICAgICAgIHRoaXMucXVpY2tTZWxlY3RJY29ucyA9IHF1aWNrU2VsZWN0SWNvbnNcclxuICAgICAgICBcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gQ3LDqWUgbCdhZmZpY2hhZ2UgZHUgY2hhbXAgZGF0ZVxyXG4gICAgb3ZlcnJpZGUgZmlsbERpc3BsYXkodmF1bHQgOiBhbnksIHZhbHVlIDogYW55LCB1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+KSB7XHJcbiAgICAgICAgdGhpcy52YXVsdCA9IHZhdWx0O1xyXG4gICAgICAgIGNvbnN0IGZpZWxkQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBmaWVsZENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiZmllbGQtY29udGFpbmVyLWNvbHVtblwiKTtcclxuXHJcbiAgICAgICAgY29uc3QgZmllbGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGZpZWxkLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1maWVsZFwiKTtcclxuICAgICAgICBjb25zdCBkYXRlQ29udGFpbmVyID0gdGhpcy5jcmVhdGVGaWVsZENvbnRhaW5lckNvbnRlbnQodXBkYXRlLCB2YWx1ZSk7XHJcbiAgICAgICAgZmllbGQuYXBwZW5kQ2hpbGQoZGF0ZUNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLnRpdGxlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhlYWRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGhlYWRlci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtaGVhZGVyXCIpO1xyXG4gICAgICAgICAgICBoZWFkZXIudGV4dENvbnRlbnQgPSB0aGlzLm5hbWVcclxuICAgICAgICAgICAgZmllbGRDb250YWluZXIuYXBwZW5kQ2hpbGQoaGVhZGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgZmllbGRDb250YWluZXIuYXBwZW5kQ2hpbGQoZmllbGQpO1xyXG5cclxuICAgICAgICByZXR1cm4gZmllbGRDb250YWluZXI7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8vIENyw6llIHVuIGNoYW1wIGQnaW5wdXQgcG91ciBsYSBkYXRlXHJcbiAgICBjcmVhdGVGaWVsZERhdGUodmFsdWU6IHN0cmluZywgdXBkYXRlOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPiwgbGluazogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgICAgICBpbnB1dC50eXBlID0gXCJ0ZXh0XCI7XHJcbiAgICAgICAgaW5wdXQudmFsdWUgPSB2YWx1ZSB8fCBcIlwiOyAgLy8gRm9ybWF0w6kgZW4gXCJZWVlZLU1NLUREXCIgcG91ciBsZSBzdG9ja2FnZVxyXG4gICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoXCJmaWVsZC1pbnB1dFwiKTtcclxuICAgIFxyXG4gICAgICAgIGZsYXRwaWNrcihpbnB1dCwge1xyXG4gICAgICAgICAgICBkYXRlRm9ybWF0OiBcIlktbS1kXCIsICAvLyBTdG9ja2VyIGVuIFwiWVlZWS1NTS1ERFwiXHJcbiAgICAgICAgICAgIGRlZmF1bHREYXRlOiB2YWx1ZSB8fCBcIlwiLFxyXG4gICAgICAgICAgICBsb2NhbGU6IEZyZW5jaCxcclxuICAgICAgICAgICAgb25DaGFuZ2U6IGFzeW5jIChzZWxlY3RlZERhdGVzOiBEYXRlW10pID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkRGF0ZSA9IHNlbGVjdGVkRGF0ZXNbMF07XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWREYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTWV0IMOgIGpvdXIgbGEgdmFsZXVyIGRlIGwnaW5wdXQgYXZlYyBsZSBmb3JtYXQgXCJZWVlZLU1NLUREXCJcclxuICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IHRoaXMuZm9ybWF0RGF0ZUZvclN0b3JhZ2Uoc2VsZWN0ZWREYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZUZpZWxkKHVwZGF0ZSwgaW5wdXQsIGxpbmspXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9uQ2xvc2UgOiBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IFwiXCJcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlRmllbGQodXBkYXRlLCBpbnB1dCwgbGluaylcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBpbnB1dDtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gQ3LDqWUgdW4gbGllbiBxdWkgYWZmaWNoZSBsYSBkYXRlIChhdSBmb3JtYXQgXCIyNiBmw6l2cmllciAyMDI1XCIpXHJcbiAgICBvdmVycmlkZSBjcmVhdGVGaWVsZExpbmsodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGxpbmsudGV4dENvbnRlbnQgPSB2YWx1ZSA/IHRoaXMuZm9ybWF0RGF0ZUZvckRpc3BsYXkodmFsdWUpIDogXCJBdWN1bmUgZGF0ZSBzw6lsZWN0aW9ubsOpZVwiO1xyXG4gICAgICAgIGxpbmsuY2xhc3NMaXN0LmFkZChcImRhdGUtZmllbGQtbGlua1wiKTtcclxuICAgICAgICBsaW5rLmNsYXNzTGlzdC5hZGQoXCJmaWVsZC1saW5rXCIpO1xyXG4gICAgICAgIGxpbmsuc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7XHJcbiAgICAgICAgbGluay5vbmNsaWNrID0gKGV2ZW50KSA9PiB0aGlzLm1vZGlmeUZpZWxkKGV2ZW50KTtcclxuICAgICAgICByZXR1cm4gbGluaztcclxuICAgIH1cclxuXHJcbiAgICAvLyBGb3JtYXRlIGxhIGRhdGUgcG91ciBsJ2FmZmljaGFnZSA6IFwiMjYgZsOpdnJpZXIgMjAyNVwiXHJcbiAgICBmb3JtYXREYXRlRm9yRGlzcGxheShkYXRlOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IHBhcnNlZERhdGUgPSBuZXcgRGF0ZShkYXRlKTtcclxuICAgICAgICByZXR1cm4gcGFyc2VkRGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoXCJmci1GUlwiLCB7IFxyXG4gICAgICAgICAgICBkYXk6IFwibnVtZXJpY1wiLCBcclxuICAgICAgICAgICAgbW9udGg6IFwibG9uZ1wiLCBcclxuICAgICAgICAgICAgeWVhcjogXCJudW1lcmljXCIgXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRm9ybWF0ZSBsYSBkYXRlIHBvdXIgbGUgc3RvY2thZ2UgOiBcIllZWVktTU0tRERcIlxyXG4gICAgZm9ybWF0RGF0ZUZvclN0b3JhZ2UoZGF0ZTogRGF0ZSk6IHN0cmluZyB7XHJcbiAgICAgICAgLy8gVXNlIHRvSVNPU3RyaW5nIHRvIGF2b2lkIHRpbWV6b25lIGlzc3VlcywgdGhlbiBleHRyYWN0IGRhdGUgcGFydFxyXG4gICAgICAgIHJldHVybiBkYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gQWpvdXRlIGxlcyBvcHRpb25zIFwiQXVqb3VyZCdodWlcIiwgXCJEZW1haW5cIiwgXCJTZW1haW5lIHByb2NoYWluZVwiXHJcbiAgICBjcmVhdGVRdWlja1NlbGVjdCh2YWx1ZTogc3RyaW5nLCB1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+LCBsaW5rOiBIVE1MRWxlbWVudCwgaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQpIHtcclxuICAgICAgICBjb25zdCBxdWlja1NlbGVjdENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgcXVpY2tTZWxlY3RDb250YWluZXIuY2xhc3NMaXN0LmFkZChcInF1aWNrLXNlbGVjdC1jb250YWluZXJcIik7XHJcblxyXG4gICAgICAgIHRoaXMucXVpY2tTZWxlY3RJY29ucy5mb3JFYWNoKG9wdGlvbiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgICAgIHNldEljb24oYnV0dG9uLCBpY29uTWFwW29wdGlvbl0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gdGhpcy5nZXREYXRlRm9yT3B0aW9uKG9wdGlvbik7ICAvLyBPYnRlbmlyIGxhIGRhdGUgcG91ciBsJ29wdGlvbiBjaG9pc2llXHJcbiAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGUodGhpcy5mb3JtYXREYXRlRm9yU3RvcmFnZShkYXRlKSk7XHJcbiAgICAgICAgICAgICAgICBsaW5rLnRleHRDb250ZW50ID0gdGhpcy5mb3JtYXREYXRlRm9yRGlzcGxheSh0aGlzLmZvcm1hdERhdGVGb3JTdG9yYWdlKGRhdGUpKTtcclxuICAgICAgICAgICAgICAgIGxpbmsuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgICAgICAgICAgICAgIGlucHV0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgfSk7IFxyXG4gICAgXHJcbiAgICAgICAgICAgIHF1aWNrU2VsZWN0Q29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBxdWlja1NlbGVjdENvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZSBnZXREZWZhdWx0VmFsdWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0RGF0ZUZvclN0b3JhZ2UodGhpcy5nZXREYXRlRm9yT3B0aW9uKHRoaXMuZGVmYXVsdCkpXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RGF0ZUZvck9wdGlvbihvcHRpb246IHN0cmluZyk6IERhdGUge1xyXG4gICAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTtcclxuICAgICAgICBzd2l0Y2gob3B0aW9uKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJ5ZXN0ZXJkYXlcIjoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeWVzdGVyZGF5ID0gbmV3IERhdGUodG9kYXkpO1xyXG4gICAgICAgICAgICAgICAgeWVzdGVyZGF5LnNldERhdGUodG9kYXkuZ2V0RGF0ZSgpIC0gMSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geWVzdGVyZGF5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgXCJ0b2RheVwiOiByZXR1cm4gbmV3IERhdGUodG9kYXkpO1xyXG4gICAgICAgICAgICBjYXNlIFwidG9tb3Jyb3dcIjoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdG9tb3Jyb3cgPSBuZXcgRGF0ZSh0b2RheSk7XHJcbiAgICAgICAgICAgICAgICB0b21vcnJvdy5zZXREYXRlKHRvZGF5LmdldERhdGUoKSArIDEpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRvbW9ycm93O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgXCJuZXh0LXdlZWtcIjoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dFdlZWsgPSBuZXcgRGF0ZSh0b2RheSk7XHJcbiAgICAgICAgICAgICAgICBuZXh0V2Vlay5zZXREYXRlKHRvZGF5LmdldERhdGUoKSArIDcpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5leHRXZWVrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgXCIyLXdlZWtcIjoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHdvV2Vla3MgPSBuZXcgRGF0ZSh0b2RheSk7XHJcbiAgICAgICAgICAgICAgICB0d29XZWVrcy5zZXREYXRlKHRvZGF5LmdldERhdGUoKSArIDE0KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0d29XZWVrcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gbmV3IERhdGUodG9kYXkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBDcsOpZSB1biBjb250ZW5ldXIgcG91ciBhZmZpY2hlciBsYSBkYXRlIGV0IGxhIHPDqWxlY3Rpb24gcmFwaWRlXHJcbiAgICBvdmVycmlkZSBjcmVhdGVGaWVsZENvbnRhaW5lckNvbnRlbnQodXBkYXRlOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPiwgdmFsdWU6IHN0cmluZyk6IEhUTUxEaXZFbGVtZW50IHtcclxuICAgICAgICBjb25zdCBmaWVsZENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgZmllbGRDb250YWluZXIuY2xhc3NMaXN0LmFkZChcImZpZWxkLWNvbnRhaW5lclwiKTtcclxuICAgICAgICBmaWVsZENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtZmllbGRcIik7XHJcblxyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRGaWVsZCA9IHZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGxpbmsgPSB0aGlzLmNyZWF0ZUZpZWxkTGluayhjdXJyZW50RmllbGQpO1xyXG4gICAgICAgIGNvbnN0IGlucHV0ID0gdGhpcy5jcmVhdGVGaWVsZERhdGUoY3VycmVudEZpZWxkLCB1cGRhdGUsIGxpbmspO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICAvLyBBZmZpY2hhZ2UgaW5pdGlhbCA6IFNpIGxhIGRhdGUgZXhpc3RlLCBhZmZpY2hlciBsZSBsaWVuXHJcbiAgICAgICAgaWYgKGN1cnJlbnRGaWVsZCAmJiB0aGlzLnZhbGlkYXRlKHZhbHVlKSkge1xyXG4gICAgICAgICAgICBsaW5rLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICAgICAgICAgIGlucHV0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpbnB1dC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgICAgICAgICBsaW5rLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENyw6llciB1biBjb250ZW5ldXIgYXZlYyBsZXMgYm91dG9ucyBkZSBzw6lsZWN0aW9uIHJhcGlkZVxyXG4gICAgICAgIGNvbnN0IHF1aWNrU2VsZWN0Q29udGFpbmVyID0gdGhpcy5jcmVhdGVRdWlja1NlbGVjdChjdXJyZW50RmllbGQsIHVwZGF0ZSwgbGluaywgaW5wdXQpO1xyXG5cclxuICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChsaW5rKTtcclxuICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChpbnB1dCk7XHJcbiAgICAgICAgZmllbGRDb250YWluZXIuYXBwZW5kQ2hpbGQocXVpY2tTZWxlY3RDb250YWluZXIpO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICByZXR1cm4gZmllbGRDb250YWluZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTWV0IMOgIGpvdXIgbGEgdmFsZXVyIGRlIGxhIGRhdGUgZXQgYmFzY3VsZSBsJ2FmZmljaGFnZSBlbnRyZSBsZSBsaWVuIGV0IGwnaW5wdXRcclxuICAgIG92ZXJyaWRlIGFzeW5jIHVwZGF0ZUZpZWxkKHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4sIGlucHV0OiBIVE1MSW5wdXRFbGVtZW50LCBsaW5rOiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMudmFsaWRhdGUoaW5wdXQudmFsdWUpO1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBhd2FpdCB1cGRhdGUodmFsdWUpOyAgLy8gTWV0IMOgIGpvdXIgYXZlYyBsYSBkYXRlIGF1IGZvcm1hdCBcIllZWVktTU0tRERcIlxyXG4gICAgICAgICAgICBpbnB1dC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgIGxpbmsudGV4dENvbnRlbnQgPSB0aGlzLmZvcm1hdERhdGVGb3JEaXNwbGF5KHZhbHVlKTsgIC8vIEFmZmljaGFnZSBhdmVjIGxlIG1vaXMgZW4gbGV0dHJlc1xyXG4gICAgICAgICAgICBsaW5rLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYXdhaXQgdXBkYXRlKGlucHV0LnZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG4iXSwidmVyc2lvbiI6M30=