8dcb5a56ea1f689123b8284825a70a7b
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock the vault utilities
jest.mock('../../src/vault/Utils', () => ({
    selectMedia: jest.fn(),
    setIcon: jest.fn()
}));
const MediaProperty_1 = require("../../src/properties/MediaProperty");
const MultiMediaProperty_1 = require("../../src/properties/MultiMediaProperty");
// Import the mocked functions
const { selectMedia, setIcon } = jest.requireMock('../../src/vault/Utils');
describe('MultiMediaProperty', () => {
    let multiMediaProperty;
    let mockVault;
    beforeEach(() => {
        // Reset DOM mocks
        document.body.innerHTML = '';
        jest.clearAllMocks();
        // Mock vault with necessary methods
        mockVault = {
            getMediaFromLink: jest.fn().mockReturnValue({ name: 'test.jpg', path: 'path/to/test.jpg' }),
            files: [],
            app: {
                setIcon: jest.fn()
            }
        };
        // Assign selectMedia mock to globalThis
        globalThis.selectMedia = selectMedia;
    });
    beforeEach(() => {
        multiMediaProperty = new MultiMediaProperty_1.MultiMediaProperty('testMedia', mockVault, {});
    });
    describe('constructor', () => {
        it('should create MultiMediaProperty with correct type', () => {
            expect(multiMediaProperty.type).toBe('multiMedia');
        });
        it('should create MediaProperty instance', () => {
            expect(multiMediaProperty.property).toBeInstanceOf(MediaProperty_1.MediaProperty);
        });
        it('should pass args to parent constructor and MediaProperty', () => {
            const customArgs = { flexSpan: 3 };
            const customProperty = new MultiMediaProperty_1.MultiMediaProperty('customName', mockVault, customArgs);
            expect(customProperty.name).toBe('customName');
            // flexSpan is hardcoded to 2 in the class, so we test the default value
            expect(customProperty.flexSpan).toBe(2);
        });
    });
    describe('fillDisplay', () => {
        it('should create container with correct classes', () => {
            const update = jest.fn();
            const result = multiMediaProperty.fillDisplay(null, update);
            expect(result.classList.contains('metadata-multiFiles-container-testmedia')).toBe(true);
            expect(result.classList.contains('metadata-multiFiles-container')).toBe(true);
        });
        it('should create add button when no values', () => {
            const update = jest.fn();
            const result = multiMediaProperty.fillDisplay(null, update);
            const addButton = result.querySelector('.metadata-add-button-inline-small');
            expect(addButton).toBeTruthy();
        });
        it('should create objects when values present', () => {
            const update = jest.fn();
            const values = ['[[file1.jpg]]', '[[file2.jpg]]'];
            const result = multiMediaProperty.fillDisplay(values, update);
            const rows = result.querySelectorAll('.metadata-multiFiles-row-inline');
            expect(rows.length).toBe(2);
        });
        it('should set vault property', () => {
            const update = jest.fn();
            multiMediaProperty.fillDisplay(null, update);
            expect(multiMediaProperty.vault).toBe(mockVault);
        });
    });
    describe('createObjects', () => {
        it('should handle empty array', () => {
            const update = jest.fn();
            const container = document.createElement('div');
            multiMediaProperty.createObjects([], update, container);
            expect(container.children.length).toBe(0);
        });
        it('should handle null values', () => {
            const update = jest.fn();
            const container = document.createElement('div');
            multiMediaProperty.createObjects(null, update, container);
            expect(container.children.length).toBe(0);
        });
        it('should create rows for each value', () => {
            const update = jest.fn();
            const container = document.createElement('div');
            const values = ['[[file1.jpg]]', '[[file2.jpg]]'];
            multiMediaProperty.vault = mockVault;
            multiMediaProperty.createObjects(values, update, container);
            expect(container.children.length).toBe(2);
        });
    });
    describe('createObjectRow', () => {
        it('should create row with correct structure', () => {
            const update = jest.fn();
            const container = document.createElement('div');
            const values = ['[[test.jpg]]'];
            const value = '[[test.jpg]]';
            const index = 0;
            multiMediaProperty.vault = mockVault;
            const row = multiMediaProperty.createObjectRow(values, update, value, index, container);
            expect(row.classList.contains('metadata-multiFiles-row-inline')).toBe(true);
            expect(row.querySelector('.metadata-delete-button-inline-small')).toBeTruthy();
        });
        it('should call property.fillDisplay with correct parameters', () => {
            const update = jest.fn();
            const container = document.createElement('div');
            const values = ['[[test.jpg]]'];
            const value = '[[test.jpg]]';
            const index = 0;
            multiMediaProperty.vault = mockVault;
            const spy = jest.spyOn(multiMediaProperty.property, 'fillDisplay');
            multiMediaProperty.createObjectRow(values, update, value, index, container);
            expect(spy).toHaveBeenCalledWith(value, expect.any(Function));
        });
    });
    describe('createDeleteButton', () => {
        it('should create button with correct classes and icon', () => {
            const values = ['[[file1.jpg]]'];
            const index = 0;
            const update = jest.fn();
            const container = document.createElement('div');
            const button = multiMediaProperty.createDeleteButton(values, update, index, container);
            expect(button.classList.contains('metadata-delete-button-inline-small')).toBe(true);
        });
        it('should have onclick handler', () => {
            const values = ['[[file1.jpg]]'];
            const index = 0;
            const update = jest.fn();
            const container = document.createElement('div');
            const button = multiMediaProperty.createDeleteButton(values, update, index, container);
            expect(button.onclick).toBeTruthy();
        });
    });
    describe('createAddButton', () => {
        it('should create button with correct classes and icon', () => {
            const values = [];
            const update = jest.fn();
            const container = document.createElement('div');
            const button = multiMediaProperty.createAddButton(values, update, container);
            expect(button.classList.contains('metadata-add-button-inline-small')).toBe(true);
        });
        it('should have onclick handler', () => {
            const values = [];
            const update = jest.fn();
            const container = document.createElement('div');
            const button = multiMediaProperty.createAddButton(values, update, container);
            expect(button.onclick).toBeTruthy();
        });
    });
    describe('addProperty', () => {
        it('should add media when selectMedia returns file', async () => {
            const mockUpdate = jest.fn();
            const container = document.createElement('div');
            const mockFile = { path: 'path/to/image.jpg', name: 'image.jpg' };
            const values = [];
            multiMediaProperty.vault = mockVault;
            selectMedia.mockResolvedValue(mockFile);
            jest.spyOn(multiMediaProperty, 'reloadObjects').mockResolvedValue(undefined);
            await multiMediaProperty.addProperty(values, mockUpdate, container);
            expect(values).toContain('[[path/to/image.jpg|image.jpg]]');
            expect(mockUpdate).toHaveBeenCalledWith(values);
        });
        it('should initialize values array if null', async () => {
            const mockUpdate = jest.fn();
            const container = document.createElement('div');
            const mockFile = { path: 'path/to/image.jpg', name: 'image.jpg' };
            let values = null;
            multiMediaProperty.vault = mockVault;
            selectMedia.mockResolvedValue(mockFile);
            jest.spyOn(multiMediaProperty, 'reloadObjects').mockResolvedValue(undefined);
            await multiMediaProperty.addProperty(values, mockUpdate, container);
            expect(mockUpdate).toHaveBeenCalled();
        });
        it('should not update when selectMedia returns null', async () => {
            const mockUpdate = jest.fn();
            const container = document.createElement('div');
            const values = [];
            multiMediaProperty.vault = mockVault;
            selectMedia.mockResolvedValue(null);
            await multiMediaProperty.addProperty(values, mockUpdate, container);
            expect(values).toHaveLength(0);
            expect(mockUpdate).not.toHaveBeenCalled();
        });
        it('should not update when selectMedia returns undefined', async () => {
            const mockUpdate = jest.fn();
            const container = document.createElement('div');
            const values = [];
            multiMediaProperty.vault = mockVault;
            selectMedia.mockResolvedValue(undefined);
            await multiMediaProperty.addProperty(values, mockUpdate, container);
            expect(values).toHaveLength(0);
            expect(mockUpdate).not.toHaveBeenCalled();
        });
    });
    describe('reloadObjects method inheritance', () => {
        it('should have reloadObjects method from parent class', () => {
            expect(typeof multiMediaProperty.reloadObjects).toBe('function');
        });
        it('should call reloadObjects when implemented by mock', async () => {
            const values = ['[[file1.jpg]]'];
            const update = jest.fn();
            jest.spyOn(multiMediaProperty, 'reloadObjects').mockResolvedValue(undefined);
            await multiMediaProperty.reloadObjects(values, update);
            expect(multiMediaProperty.reloadObjects).toHaveBeenCalledWith(values, update);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXE11bHRpTWVkaWFQcm9wZXJ0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFLSCwyQkFBMkI7QUFDM0IsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3RCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ3JCLENBQUMsQ0FBQyxDQUFDO0FBUEosc0VBQW1FO0FBQ25FLGdGQUE2RTtBQVE3RSw4QkFBOEI7QUFDOUIsTUFBTSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFFM0UsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNoQyxJQUFJLGtCQUFzQyxDQUFDO0lBQzNDLElBQUksU0FBYyxDQUFDO0lBRW5CLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixrQkFBa0I7UUFDbEIsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUVyQixvQ0FBb0M7UUFDcEMsU0FBUyxHQUFHO1lBQ1IsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLGtCQUFrQixFQUFFLENBQUM7WUFDM0YsS0FBSyxFQUFFLEVBQUU7WUFDVCxHQUFHLEVBQUU7Z0JBQ0QsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDckI7U0FDSixDQUFDO1FBRUYsd0NB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RUFBRTtZQUMxRCxNQUFNLENBQUMsT0FBTyxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDckUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0RBQW9ELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDaEUsTUFBTSxNQUFNLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUNqQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7WUFFekIsSUFBSSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxlQUFlLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUU3RSxNQUFNLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFFdkQsTUFBTSxDQUFDLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNsRixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXE11bHRpTWVkaWFQcm9wZXJ0eS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAamVzdC1lbnZpcm9ubWVudCBqc2RvbVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IE1lZGlhUHJvcGVydHkgfSBmcm9tICcuLi8uLi9zcmMvcHJvcGVydGllcy9NZWRpYVByb3BlcnR5JztcclxuaW1wb3J0IHsgTXVsdGlNZWRpYVByb3BlcnR5IH0gZnJvbSAnLi4vLi4vc3JjL3Byb3BlcnRpZXMvTXVsdGlNZWRpYVByb3BlcnR5JztcclxuXHJcbi8vIE1vY2sgdGhlIHZhdWx0IHV0aWxpdGllc1xyXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy92YXVsdC9VdGlscycsICgpID0+ICh7XHJcbiAgICBzZWxlY3RNZWRpYTogamVzdC5mbigpLFxyXG4gICAgc2V0SWNvbjogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbi8vIEltcG9ydCB0aGUgbW9ja2VkIGZ1bmN0aW9uc1xyXG5jb25zdCB7IHNlbGVjdE1lZGlhLCBzZXRJY29uIH0gPSBqZXN0LnJlcXVpcmVNb2NrKCcuLi8uLi9zcmMvdmF1bHQvVXRpbHMnKTtcclxuXHJcbmRlc2NyaWJlKCdNdWx0aU1lZGlhUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICBsZXQgbXVsdGlNZWRpYVByb3BlcnR5OiBNdWx0aU1lZGlhUHJvcGVydHk7XHJcbiAgICBsZXQgbW9ja1ZhdWx0OiBhbnk7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgLy8gUmVzZXQgRE9NIG1vY2tzXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBNb2NrIHZhdWx0IHdpdGggbmVjZXNzYXJ5IG1ldGhvZHNcclxuICAgICAgICBtb2NrVmF1bHQgPSB7XHJcbiAgICAgICAgICAgIGdldE1lZGlhRnJvbUxpbms6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBuYW1lOiAndGVzdC5qcGcnLCBwYXRoOiAncGF0aC90by90ZXN0LmpwZycgfSksXHJcbiAgICAgICAgICAgIGZpbGVzOiBbXSxcclxuICAgICAgICAgICAgYXBwOiB7XHJcbiAgICAgICAgICAgICAgICBzZXRJY29uOiBqZXN0LmZuKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIEFzc2lnbiBzZWxlY3RNZWRpYSBtb2NrIHRvIGdsb2JhbFRoaXNcclxuICAgICAgICBnbG9iYWxUaGlzLnNlbGVjdE1lZGlhID0gc2VsZWN0TWVkaWE7XHJcbiAgICB9KTtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICBtdWx0aU1lZGlhUHJvcGVydHkgPSBuZXcgTXVsdGlNZWRpYVByb3BlcnR5KCd0ZXN0TWVkaWEnLCBtb2NrVmF1bHQsIHt9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjb25zdHJ1Y3RvcicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBNdWx0aU1lZGlhUHJvcGVydHkgd2l0aCBjb3JyZWN0IHR5cGUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChtdWx0aU1lZGlhUHJvcGVydHkudHlwZSkudG9CZSgnbXVsdGlNZWRpYScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBNZWRpYVByb3BlcnR5IGluc3RhbmNlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QobXVsdGlNZWRpYVByb3BlcnR5LnByb3BlcnR5KS50b0JlSW5zdGFuY2VPZihNZWRpYVByb3BlcnR5KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBwYXNzIGFyZ3MgdG8gcGFyZW50IGNvbnN0cnVjdG9yIGFuZCBNZWRpYVByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjdXN0b21BcmdzID0geyBmbGV4U3BhbjogMyB9O1xyXG4gICAgICAgICAgICBjb25zdCBjdXN0b21Qcm9wZXJ0eSA9IG5ldyBNdWx0aU1lZGlhUHJvcGVydHkoJ2N1c3RvbU5hbWUnLCBtb2NrVmF1bHQsIGN1c3RvbUFyZ3MpO1xyXG4gICAgICAgICAgICBleHBlY3QoY3VzdG9tUHJvcGVydHkubmFtZSkudG9CZSgnY3VzdG9tTmFtZScpO1xyXG4gICAgICAgICAgICAvLyBmbGV4U3BhbiBpcyBoYXJkY29kZWQgdG8gMiBpbiB0aGUgY2xhc3MsIHNvIHdlIHRlc3QgdGhlIGRlZmF1bHQgdmFsdWVcclxuICAgICAgICAgICAgZXhwZWN0KGN1c3RvbVByb3BlcnR5LmZsZXhTcGFuKS50b0JlKDIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2ZpbGxEaXNwbGF5JywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGNvbnRhaW5lciB3aXRoIGNvcnJlY3QgY2xhc3NlcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBtdWx0aU1lZGlhUHJvcGVydHkuZmlsbERpc3BsYXkobnVsbCwgdXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtZXRhZGF0YS1tdWx0aUZpbGVzLWNvbnRhaW5lci10ZXN0bWVkaWEnKSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jbGFzc0xpc3QuY29udGFpbnMoJ21ldGFkYXRhLW11bHRpRmlsZXMtY29udGFpbmVyJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGFkZCBidXR0b24gd2hlbiBubyB2YWx1ZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gbXVsdGlNZWRpYVByb3BlcnR5LmZpbGxEaXNwbGF5KG51bGwsIHVwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBhZGRCdXR0b24gPSByZXN1bHQucXVlcnlTZWxlY3RvcignLm1ldGFkYXRhLWFkZC1idXR0b24taW5saW5lLXNtYWxsJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChhZGRCdXR0b24pLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgb2JqZWN0cyB3aGVuIHZhbHVlcyBwcmVzZW50JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IFsnW1tmaWxlMS5qcGddXScsICdbW2ZpbGUyLmpwZ11dJ107XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG11bHRpTWVkaWFQcm9wZXJ0eS5maWxsRGlzcGxheSh2YWx1ZXMsIHVwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByb3dzID0gcmVzdWx0LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tZXRhZGF0YS1tdWx0aUZpbGVzLXJvdy1pbmxpbmUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJvd3MubGVuZ3RoKS50b0JlKDIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHNldCB2YXVsdCBwcm9wZXJ0eScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbXVsdGlNZWRpYVByb3BlcnR5LmZpbGxEaXNwbGF5KG51bGwsIHVwZGF0ZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtdWx0aU1lZGlhUHJvcGVydHkudmF1bHQpLnRvQmUobW9ja1ZhdWx0KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjcmVhdGVPYmplY3RzJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGFycmF5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbXVsdGlNZWRpYVByb3BlcnR5LmNyZWF0ZU9iamVjdHMoW10sIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGgpLnRvQmUoMCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bGwgdmFsdWVzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbXVsdGlNZWRpYVByb3BlcnR5LmNyZWF0ZU9iamVjdHMobnVsbCwgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCkudG9CZSgwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgcm93cyBmb3IgZWFjaCB2YWx1ZScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gWydbW2ZpbGUxLmpwZ11dJywgJ1tbZmlsZTIuanBnXV0nXTtcclxuICAgICAgICAgICAgbXVsdGlNZWRpYVByb3BlcnR5LnZhdWx0ID0gbW9ja1ZhdWx0O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbXVsdGlNZWRpYVByb3BlcnR5LmNyZWF0ZU9iamVjdHModmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoKS50b0JlKDIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NyZWF0ZU9iamVjdFJvdycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSByb3cgd2l0aCBjb3JyZWN0IHN0cnVjdHVyZScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gWydbW3Rlc3QuanBnXV0nXTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnW1t0ZXN0LmpwZ11dJztcclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSAwO1xyXG4gICAgICAgICAgICBtdWx0aU1lZGlhUHJvcGVydHkudmF1bHQgPSBtb2NrVmF1bHQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByb3cgPSBtdWx0aU1lZGlhUHJvcGVydHkuY3JlYXRlT2JqZWN0Um93KHZhbHVlcywgdXBkYXRlLCB2YWx1ZSwgaW5kZXgsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3Qocm93LmNsYXNzTGlzdC5jb250YWlucygnbWV0YWRhdGEtbXVsdGlGaWxlcy1yb3ctaW5saW5lJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyb3cucXVlcnlTZWxlY3RvcignLm1ldGFkYXRhLWRlbGV0ZS1idXR0b24taW5saW5lLXNtYWxsJykpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjYWxsIHByb3BlcnR5LmZpbGxEaXNwbGF5IHdpdGggY29ycmVjdCBwYXJhbWV0ZXJzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBbJ1tbdGVzdC5qcGddXSddO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICdbW3Rlc3QuanBnXV0nO1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IDA7XHJcbiAgICAgICAgICAgIG11bHRpTWVkaWFQcm9wZXJ0eS52YXVsdCA9IG1vY2tWYXVsdDtcclxuICAgICAgICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihtdWx0aU1lZGlhUHJvcGVydHkucHJvcGVydHksICdmaWxsRGlzcGxheScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbXVsdGlNZWRpYVByb3BlcnR5LmNyZWF0ZU9iamVjdFJvdyh2YWx1ZXMsIHVwZGF0ZSwgdmFsdWUsIGluZGV4LCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgodmFsdWUsIGV4cGVjdC5hbnkoRnVuY3Rpb24pKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjcmVhdGVEZWxldGVCdXR0b24nLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgYnV0dG9uIHdpdGggY29ycmVjdCBjbGFzc2VzIGFuZCBpY29uJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBbJ1tbZmlsZTEuanBnXV0nXTtcclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSAwO1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gbXVsdGlNZWRpYVByb3BlcnR5LmNyZWF0ZURlbGV0ZUJ1dHRvbih2YWx1ZXMsIHVwZGF0ZSwgaW5kZXgsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnbWV0YWRhdGEtZGVsZXRlLWJ1dHRvbi1pbmxpbmUtc21hbGwnKSkudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIG9uY2xpY2sgaGFuZGxlcicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gWydbW2ZpbGUxLmpwZ11dJ107XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gMDtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9IG11bHRpTWVkaWFQcm9wZXJ0eS5jcmVhdGVEZWxldGVCdXR0b24odmFsdWVzLCB1cGRhdGUsIGluZGV4LCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGJ1dHRvbi5vbmNsaWNrKS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY3JlYXRlQWRkQnV0dG9uJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGJ1dHRvbiB3aXRoIGNvcnJlY3QgY2xhc3NlcyBhbmQgaWNvbicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gbXVsdGlNZWRpYVByb3BlcnR5LmNyZWF0ZUFkZEJ1dHRvbih2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdtZXRhZGF0YS1hZGQtYnV0dG9uLWlubGluZS1zbWFsbCcpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgb25jbGljayBoYW5kbGVyJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZXM6IGFueVtdID0gW107XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBidXR0b24gPSBtdWx0aU1lZGlhUHJvcGVydHkuY3JlYXRlQWRkQnV0dG9uKHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGJ1dHRvbi5vbmNsaWNrKS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnYWRkUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBhZGQgbWVkaWEgd2hlbiBzZWxlY3RNZWRpYSByZXR1cm5zIGZpbGUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrRmlsZSA9IHsgcGF0aDogJ3BhdGgvdG8vaW1hZ2UuanBnJywgbmFtZTogJ2ltYWdlLmpwZycgfTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xyXG4gICAgICAgICAgICBtdWx0aU1lZGlhUHJvcGVydHkudmF1bHQgPSBtb2NrVmF1bHQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAoc2VsZWN0TWVkaWEgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIGplc3Quc3B5T24obXVsdGlNZWRpYVByb3BlcnR5LCAncmVsb2FkT2JqZWN0cycpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhd2FpdCBtdWx0aU1lZGlhUHJvcGVydHkuYWRkUHJvcGVydHkodmFsdWVzLCBtb2NrVXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHZhbHVlcykudG9Db250YWluKCdbW3BhdGgvdG8vaW1hZ2UuanBnfGltYWdlLmpwZ11dJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh2YWx1ZXMpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgdmFsdWVzIGFycmF5IGlmIG51bGwnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrRmlsZSA9IHsgcGF0aDogJ3BhdGgvdG8vaW1hZ2UuanBnJywgbmFtZTogJ2ltYWdlLmpwZycgfTtcclxuICAgICAgICAgICAgbGV0IHZhbHVlczogYW55ID0gbnVsbDtcclxuICAgICAgICAgICAgbXVsdGlNZWRpYVByb3BlcnR5LnZhdWx0ID0gbW9ja1ZhdWx0O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgKHNlbGVjdE1lZGlhIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBqZXN0LnNweU9uKG11bHRpTWVkaWFQcm9wZXJ0eSwgJ3JlbG9hZE9iamVjdHMnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYXdhaXQgbXVsdGlNZWRpYVByb3BlcnR5LmFkZFByb3BlcnR5KHZhbHVlcywgbW9ja1VwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgbm90IHVwZGF0ZSB3aGVuIHNlbGVjdE1lZGlhIHJldHVybnMgbnVsbCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlczogYW55W10gPSBbXTtcclxuICAgICAgICAgICAgbXVsdGlNZWRpYVByb3BlcnR5LnZhdWx0ID0gbW9ja1ZhdWx0O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgKHNlbGVjdE1lZGlhIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhd2FpdCBtdWx0aU1lZGlhUHJvcGVydHkuYWRkUHJvcGVydHkodmFsdWVzLCBtb2NrVXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHZhbHVlcykudG9IYXZlTGVuZ3RoKDApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1VwZGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBub3QgdXBkYXRlIHdoZW4gc2VsZWN0TWVkaWEgcmV0dXJucyB1bmRlZmluZWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZXM6IGFueVtdID0gW107XHJcbiAgICAgICAgICAgIG11bHRpTWVkaWFQcm9wZXJ0eS52YXVsdCA9IG1vY2tWYXVsdDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIChzZWxlY3RNZWRpYSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhd2FpdCBtdWx0aU1lZGlhUHJvcGVydHkuYWRkUHJvcGVydHkodmFsdWVzLCBtb2NrVXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHZhbHVlcykudG9IYXZlTGVuZ3RoKDApO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1VwZGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdyZWxvYWRPYmplY3RzIG1ldGhvZCBpbmhlcml0YW5jZScsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgcmVsb2FkT2JqZWN0cyBtZXRob2QgZnJvbSBwYXJlbnQgY2xhc3MnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdCh0eXBlb2YgbXVsdGlNZWRpYVByb3BlcnR5LnJlbG9hZE9iamVjdHMpLnRvQmUoJ2Z1bmN0aW9uJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgY2FsbCByZWxvYWRPYmplY3RzIHdoZW4gaW1wbGVtZW50ZWQgYnkgbW9jaycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gWydbW2ZpbGUxLmpwZ11dJ107XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGplc3Quc3B5T24obXVsdGlNZWRpYVByb3BlcnR5LCAncmVsb2FkT2JqZWN0cycpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhd2FpdCBtdWx0aU1lZGlhUHJvcGVydHkucmVsb2FkT2JqZWN0cyh2YWx1ZXMsIHVwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobXVsdGlNZWRpYVByb3BlcnR5LnJlbG9hZE9iamVjdHMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHZhbHVlcywgdXBkYXRlKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9