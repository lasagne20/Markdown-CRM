2893dd2bd5d6e5ae9c6b825cf1bf2713
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MediaProperty = void 0;
const FileProperty_1 = require("./FileProperty");
const Utils_1 = require("../vault/Utils");
class MediaProperty extends FileProperty_1.FileProperty {
    // Used for property with a single file
    constructor(name, args = { icon: "media", create: "" }) {
        super(name, [], args);
        this.type = "media";
        this.createOption = args.create || "";
        this.display = args.display;
    }
    getDisplay(file, args = { staticMode: false, title: "", display: "name" }) {
        this.display = args.display || "name";
        if (!this.read(file) && this.createOption) {
            // If the file is not set, we return a container with a button to create a new file
            const container = document.createElement("div");
            container.classList.add("create-freecad-container");
            const button = document.createElement("button");
            button.classList.add("mod-cta");
            if (args.createOptions && args.createOptions.createFunction) {
                button.textContent = args.createOptions.title || "Cr√©er un fichier";
                button.addEventListener("click", async () => {
                    if (args.createOptions && typeof args.createOptions.createFunction === "function") {
                        let path = await args.createOptions.createFunction();
                        await file.updateMetadata(this.name, `[[${path}|${path.split("/").pop()}]]`);
                        setTimeout(() => {
                            // On attend 2 secondes pour que le fichier soit cr√©√© et d√©placer dans le bon dossier avant de l'ouvrir
                            path = file.vault.getMediaFromLink(path)?.path || path;
                            const vaultPath = file.vault.app.vault.adapter.basePath || file.vault.adapter.getBasePath?.();
                            const absoluteMediaPath = vaultPath ? require('path').join(vaultPath, path) : path;
                            this.vault.app.open(absoluteMediaPath);
                        }, 1000);
                        await file.check();
                    }
                });
                container.appendChild(button);
                return container;
            }
        }
        let value = this.read(file);
        let container = this.fillDisplay(file.vault, value, async (value) => await file.updateMetadata(this.name, value), file);
        if (args.updateOptions && args.updateOptions.updateFunction) {
            const refreshButton = document.createElement("button");
            refreshButton.classList.add("mod-cta");
            (0, Utils_1.setIcon)(refreshButton, args.updateOptions.icon || "refresh-ccw");
            refreshButton.addEventListener("click", async () => {
                if (args.updateOptions && typeof args.updateOptions.updateFunction === "function") {
                    let path = await args.updateOptions.updateFunction();
                    await file.updateMetadata(this.name, `[[${path}|${path.split("/").pop()}]]`);
                }
            });
            container.appendChild(refreshButton);
        }
        return container;
    }
    getLink(value, vault) {
        if (!value) {
            return "";
        }
        return this.vault.getMediaFromLink(value)?.name || "";
    }
    openFile(value) {
        // Get the absolute path to the file in the vault
        let mediaPath = this.vault.getMediaFromLink(value)?.path;
        const absoluteMediaPath = this.vault.getPath() ? require('path').join(this.vault.getPath(), mediaPath) : mediaPath;
        this.vault.app.open(absoluteMediaPath);
    }
    fillDisplay(vault, value, update, file = null) {
        this.vault = vault;
        if (value && value.startsWith("[[") && value.endsWith("]]")) {
            if (this.display === "embed") {
                // If it is an image : 
                let mediaPath = this.vault.getMediaFromLink(value)?.path;
                let container = document.createElement("div");
                if (mediaPath) {
                    const ext = mediaPath.toLowerCase().split('.').pop();
                    if (ext && ["png", "jpg", "jpeg", "gif"].includes(ext)) {
                        container = this.createEmbedImageContainer(mediaPath, update);
                    }
                    else if (ext && ["glb", "gltf", "fcstd"].includes(ext)) {
                        // Pour les fichiers 3D, cr√©er un message pour utiliser 3DModelProperty
                        container = document.createElement("div");
                        container.classList.add("embed-container");
                        const messageDiv = document.createElement("div");
                        messageDiv.textContent = "Fichier 3D d√©tect√©. Utilisez 3DModelProperty pour l'affichage 3D.";
                        messageDiv.style.textAlign = "center";
                        messageDiv.style.margin = "20px";
                        messageDiv.style.padding = "10px";
                        messageDiv.style.backgroundColor = "#f0f0f0";
                        messageDiv.style.border = "1px solid #ccc";
                        messageDiv.style.borderRadius = "5px";
                        container.appendChild(messageDiv);
                    }
                    container.style.position = "relative";
                    container.appendChild(this.createEmbedOpenContainer(update, value));
                    container.appendChild(this.createEmbedEditContainer(update, value));
                }
                return container;
            }
            else if (this.display === "icon") {
                const container = document.createElement("div");
                container.classList.add("metadata-field", "media-field");
                const iconDiv = document.createElement("div");
                iconDiv.classList.add("big-icon-div");
                (0, Utils_1.setIcon)(iconDiv, this.getFileIcon(value));
                const fileName = document.createElement("div");
                fileName.classList.add("media-field-file-name");
                fileName.textContent = this.vault.getMediaFromLink(value)?.name || "Fichier non trouv√©";
                container.appendChild(iconDiv);
                container.appendChild(fileName);
                container.appendChild(iconDiv);
                container.appendChild(fileName);
                // üîó Ouvrir le fichier au clic (sur tout le conteneur)
                container.style.cursor = "pointer";
                container.addEventListener("click", () => {
                    this.openFile(value);
                });
                return container;
            }
            else if (this.display === "button") {
                const container = document.createElement("div");
                container.classList.add("create-freecad-container");
                const button = document.createElement("button");
                button.classList.add("mod-cta");
                button.textContent = this.title || "Ouvrir le fichier";
                button.addEventListener("click", () => {
                    this.openFile(value);
                });
                container.appendChild(button);
                return container;
            }
        }
        return super.fillDisplay(vault, value, update);
    }
    getFileIcon(value) {
        if (value && value.startsWith("[[") && value.endsWith("]]")) {
            const mediaPath = this.vault.getMediaFromLink(value)?.path;
            if (mediaPath) {
                const ext = mediaPath.toLowerCase().split('.').pop();
                if (ext && ["png", "jpg", "jpeg", "gif"].includes(ext)) {
                    return "image";
                }
                else if (ext && ["glb", "gltf", "fcstd"].includes(ext)) {
                    return "cube3d";
                }
                else if (ext && ["pdf", "docx", "txt"].includes(ext)) {
                    return "file";
                }
                else if (ext && ["mp4", "webm", "ogg"].includes(ext)) {
                    return "video";
                }
                else if (ext && ["mp3", "wav"].includes(ext)) {
                    return "audio";
                }
                else if (ext && ["zip", "rar"].includes(ext)) {
                    return "archive";
                }
                else if (ext && ["sla"].includes(ext)) {
                    return "square-pen";
                }
                else if (ext && ["lbrn2"].includes(ext)) {
                    return "flame";
                }
            }
        }
        return this.icon || "media";
    }
    createEmbedEditContainer(update, value) {
        const container = document.createElement("div");
        container.classList.add("embed-edit-container");
        container.style.position = "absolute"; // Position the icon container absolutely
        container.style.top = "5px"; // Adjust the top position
        container.style.left = "5px"; // Adjust the right position
        container.style.cursor = "pointer"; // Change cursor to pointer
        const iconContainer = document.createElement("div");
        iconContainer.classList.add("icon-container");
        const icon = document.createElement("i");
        (0, Utils_1.setIcon)(icon, "link");
        icon.addEventListener("click", async (event) => await this.handleIconClick(update, event));
        iconContainer.appendChild(icon);
        container.appendChild(iconContainer);
        return container;
    }
    createEmbedOpenContainer(update, value) {
        const container = document.createElement("div");
        container.classList.add("embed-open-container");
        container.style.position = "absolute"; // Position the icon container absolutely
        container.style.top = "5px"; // Adjust the top position
        container.style.right = "5px"; // Adjust the right position
        container.style.cursor = "pointer"; // Change cursor to pointer
        const iconContainer = document.createElement("div");
        iconContainer.classList.add("icon-container");
        const icon = document.createElement("i");
        (0, Utils_1.setIcon)(icon, "external-link");
        icon.addEventListener("click", (event) => {
            event.preventDefault();
            if (value) {
                this.openFile(value);
            }
            else {
                this.vault.app.sendNotice("Unable to generate link for the media.");
            }
        });
        iconContainer.appendChild(icon);
        container.appendChild(iconContainer);
        return container;
    }
    createEmbedImageContainer(mediaPath, update) {
        const container = document.createElement("div");
        container.classList.add("metadata-field", "media-field", "embed-container");
        const embed = document.createElement("img");
        embed.src = this.vault.app.vault.adapter.getResourcePath(mediaPath);
        embed.alt = "Media";
        embed.classList.add("embed-media");
        const iconContainer = document.createElement("div");
        iconContainer.classList.add("icon-container");
        const icon = document.createElement("i");
        icon.classList.add("icon", this.icon);
        icon.addEventListener("click", async (event) => await this.handleIconClick(update, event));
        iconContainer.appendChild(icon);
        container.appendChild(embed);
        container.appendChild(iconContainer);
        return container;
    }
    // Fonction pour g√©rer le clic sur l'ic√¥ne
    async handleIconClick(update, event) {
        let selectedFile = await this.vault.app.selectMedia(this.vault, "Choisissez un document");
        if (selectedFile) {
            await update(`[[${selectedFile.path}|${selectedFile.name}]]`);
            const link = event.target.closest('.metadata-field')?.querySelector('.field-link');
            if (link) {
                link.textContent = selectedFile.name;
            }
        }
    }
    // Override the createFieldContainerContent function to truncate the link
    createFieldContainerContent(update, value) {
        const fieldContainer = document.createElement("div");
        fieldContainer.classList.add("field-container");
        const currentField = this.getLink(value);
        const link = document.createElement("a");
        link.href = "#";
        const truncatedField = currentField?.length > 12 ? currentField.slice(0, 12) + "..." : currentField;
        link.textContent = truncatedField || "";
        link.setAttribute("full-text", currentField || "");
        link.addEventListener("click", async (event) => await this.modifyField(event));
        link.classList.add("field-link");
        link.style.display = "block";
        fieldContainer.appendChild(link);
        return fieldContainer;
    }
    // Fonction pour g√©rer le clic sur l'ic√¥ne
    async modifyField(event) {
        const link = event.target.closest('.metadata-field')?.querySelector('.field-link');
        let currentField = link.getAttribute("full-text");
        if (!currentField) {
            return;
        }
        event.preventDefault();
        const file = this.vault.getFile(currentField);
        if (file) {
            await this.vault.app.openFile(file);
        }
        else {
            this.vault.app.sendNotice(`Le fichier ${currentField} n'existe pas`);
        }
    }
}
exports.MediaProperty = MediaProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE1lZGlhUHJvcGVydHkudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsaURBQThDO0FBQzlDLDBDQUF5QztBQUd6QyxNQUFhLGFBQWMsU0FBUSwyQkFBWTtJQU0zQyx1Q0FBdUM7SUFDdkMsWUFBWSxJQUFZLEVBQUUsT0FBNEQsRUFBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUM7UUFDL0csS0FBSyxDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFIVixTQUFJLEdBQVksT0FBTyxDQUFDO1FBSXBDLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUM7UUFDdEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQzlCLENBQUM7SUFFUSxVQUFVLENBQUMsSUFBUyxFQUFFLE9BR3pCLEVBQUMsVUFBVSxFQUFHLEtBQUssRUFBRSxLQUFLLEVBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUM7UUFDakQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxJQUFJLE1BQU0sQ0FBQztRQUN0QyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFDLENBQUM7WUFDekMsbUZBQW1GO1lBQ25GLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEQsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQztZQUVwRCxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFD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Q0FBQyxNQUFNLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMvRSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFFN0IsY0FBYyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVqQyxPQUFPLGNBQWMsQ0FBQztJQUN4QixDQUFDO0lBRUEsMENBQTBDO0lBQ2xDLEtBQUssQ0FBQyxXQUFXLENBQUMsS0FBWTtRQUNyQyxNQUFNLElBQUksR0FBSSxLQUFLLENBQUMsTUFBc0IsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsRUFBRSxhQUFhLENBQUMsYUFBYSxDQUFnQixDQUFDO1FBQ25ILElBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLENBQUE7UUFDakQsSUFBSSxDQUFDLFlBQVksRUFBQyxDQUFDO1lBQUEsT0FBTTtRQUFBLENBQUM7UUFDMUIsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBRXZCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzlDLElBQUksSUFBSSxFQUFFLENBQUM7WUFDUCxNQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4QyxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxjQUFjLFlBQVksZUFBZSxDQUFDLENBQUE7UUFDdEUsQ0FBQztJQUNILENBQUM7Q0FFSjtBQXJURCxzQ0FxVEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE1lZGlhUHJvcGVydHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRmlsZSB9IGZyb20gXCIuLi92YXVsdC9GaWxlXCI7XHJcbmltcG9ydCB7IEZpbGVQcm9wZXJ0eSB9IGZyb20gXCIuL0ZpbGVQcm9wZXJ0eVwiO1xyXG5pbXBvcnQgeyBzZXRJY29uIH0gZnJvbSBcIi4uL3ZhdWx0L1V0aWxzXCI7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIE1lZGlhUHJvcGVydHkgZXh0ZW5kcyBGaWxlUHJvcGVydHl7XHJcblxyXG4gIHB1YmxpYyBkaXNwbGF5IDogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gIHB1YmxpYyBjcmVhdGVPcHRpb24gOiBzdHJpbmc7XHJcblxyXG4gIHB1YmxpYyBvdmVycmlkZSB0eXBlIDogc3RyaW5nID0gXCJtZWRpYVwiO1xyXG4gICAgLy8gVXNlZCBmb3IgcHJvcGVydHkgd2l0aCBhIHNpbmdsZSBmaWxlXHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIGFyZ3M6IHsgaWNvbj86IHN0cmluZzsgZGlzcGxheT86IHN0cmluZzsgY3JlYXRlPzogc3RyaW5nfSA9IHtpY29uOiBcIm1lZGlhXCIsIGNyZWF0ZTogXCJcIn0pIHtcclxuICAgICAgc3VwZXIobmFtZSwgW10sIGFyZ3MpO1xyXG4gICAgICB0aGlzLmNyZWF0ZU9wdGlvbiA9IGFyZ3MuY3JlYXRlIHx8IFwiXCI7XHJcbiAgICAgIHRoaXMuZGlzcGxheSA9IGFyZ3MuZGlzcGxheTtcclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZSBnZXREaXNwbGF5KGZpbGU6IGFueSwgYXJnczoge3N0YXRpY01vZGU/IDogYm9vbGVhbiwgdGl0bGU/OiBzdHJpbmcsIGRpc3BsYXk/OiBzdHJpbmc7XHJcbiAgICAgICAgICBjcmVhdGVPcHRpb25zPyA6IHtjcmVhdGVGdW5jdGlvbj8gOiAoKSA9PiBQcm9taXNlPHN0cmluZz4sIHRpdGxlPzogc3RyaW5nfVxyXG4gICAgICAgICAgdXBkYXRlT3B0aW9ucz8gOiB7aWNvbjogc3RyaW5nLCB1cGRhdGVGdW5jdGlvbj8gOiAoKSA9PiBQcm9taXNlPHN0cmluZz59fSA9IFxyXG4gICAgICAgICAge3N0YXRpY01vZGUgOiBmYWxzZSwgdGl0bGU6XCJcIiwgZGlzcGxheTogXCJuYW1lXCJ9KTogSFRNTERpdkVsZW1lbnQge1xyXG4gICAgICAgIHRoaXMuZGlzcGxheSA9IGFyZ3MuZGlzcGxheSB8fCBcIm5hbWVcIjtcclxuICAgICAgICBpZiAoIXRoaXMucmVhZChmaWxlKSAmJiB0aGlzLmNyZWF0ZU9wdGlvbil7XHJcbiAgICAgICAgICAvLyBJZiB0aGUgZmlsZSBpcyBub3Qgc2V0LCB3ZSByZXR1cm4gYSBjb250YWluZXIgd2l0aCBhIGJ1dHRvbiB0byBjcmVhdGUgYSBuZXcgZmlsZVxyXG4gICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiY3JlYXRlLWZyZWVjYWQtY29udGFpbmVyXCIpO1xyXG5cclxuICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgICBidXR0b24uY2xhc3NMaXN0LmFkZChcIm1vZC1jdGFcIik7XHJcbiAgICAgICAgICBpZiAoYXJncy5jcmVhdGVPcHRpb25zICYmIGFyZ3MuY3JlYXRlT3B0aW9ucy5jcmVhdGVGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGFyZ3MuY3JlYXRlT3B0aW9ucy50aXRsZSB8fCBcIkNyw6llciB1biBmaWNoaWVyXCI7XHJcbiAgICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmNyZWF0ZU9wdGlvbnMgJiYgdHlwZW9mIGFyZ3MuY3JlYXRlT3B0aW9ucy5jcmVhdGVGdW5jdGlvbiA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBhdGggPSBhd2FpdCBhcmdzLmNyZWF0ZU9wdGlvbnMuY3JlYXRlRnVuY3Rpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAgYXdhaXQgZmlsZS51cGRhdGVNZXRhZGF0YSh0aGlzLm5hbWUsIGBbWyR7cGF0aH18JHtwYXRoLnNwbGl0KFwiL1wiKS5wb3AoKX1dXWApO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgLy8gT24gYXR0ZW5kIDIgc2Vjb25kZXMgcG91ciBxdWUgbGUgZmljaGllciBzb2l0IGNyw6nDqSBldCBkw6lwbGFjZXIgZGFucyBsZSBib24gZG9zc2llciBhdmFudCBkZSBsJ291dnJpclxyXG4gICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IGZpbGUudmF1bHQuZ2V0TWVkaWFGcm9tTGluayhwYXRoKT8ucGF0aCB8fCBwYXRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmF1bHRQYXRoID0gZmlsZS52YXVsdC5hcHAudmF1bHQuYWRhcHRlci5iYXNlUGF0aCB8fCBmaWxlLnZhdWx0LmFkYXB0ZXIuZ2V0QmFzZVBhdGg/LigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWJzb2x1dGVNZWRpYVBhdGggPSB2YXVsdFBhdGggPyByZXF1aXJlKCdwYXRoJykuam9pbih2YXVsdFBhdGgsIHBhdGgpIDogcGF0aDtcclxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmF1bHQuYXBwLm9wZW4oYWJzb2x1dGVNZWRpYVBhdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGZpbGUuY2hlY2soKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pOyBcclxuICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTtcclxuICAgICAgICAgICAgICByZXR1cm4gY29udGFpbmVyO1xyXG4gICAgICAgICAgfX1cclxuXHJcbiAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5yZWFkKGZpbGUpO1xyXG4gICAgICAgIGxldCBjb250YWluZXIgPSB0aGlzLmZpbGxEaXNwbGF5KGZpbGUudmF1bHQsIHZhbHVlLCBhc3luYyAodmFsdWUpID0+IGF3YWl0IGZpbGUudXBkYXRlTWV0YWRhdGEodGhpcy5uYW1lLCB2YWx1ZSksIGZpbGUpO1xyXG4gICAgICAgIGlmIChhcmdzLnVwZGF0ZU9wdGlvbnMgJiYgYXJncy51cGRhdGVPcHRpb25zLnVwZGF0ZUZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICBjb25zdCByZWZyZXNoQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICAgIHJlZnJlc2hCdXR0b24uY2xhc3NMaXN0LmFkZChcIm1vZC1jdGFcIik7XHJcbiAgICAgICAgICAgIHNldEljb24ocmVmcmVzaEJ1dHRvbiwgYXJncy51cGRhdGVPcHRpb25zLmljb24gfHwgXCJyZWZyZXNoLWNjd1wiKTtcclxuICAgICAgICAgIHJlZnJlc2hCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGFyZ3MudXBkYXRlT3B0aW9ucyAmJiB0eXBlb2YgYXJncy51cGRhdGVPcHRpb25zLnVwZGF0ZUZ1bmN0aW9uID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgICBsZXQgcGF0aCA9IGF3YWl0IGFyZ3MudXBkYXRlT3B0aW9ucy51cGRhdGVGdW5jdGlvbigpO1xyXG4gICAgICAgICAgICAgIGF3YWl0IGZpbGUudXBkYXRlTWV0YWRhdGEodGhpcy5uYW1lLCBgW1ske3BhdGh9fCR7cGF0aC5zcGxpdChcIi9cIikucG9wKCl9XV1gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocmVmcmVzaEJ1dHRvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gY29udGFpbmVyXHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgZ2V0TGluayh2YWx1ZTogc3RyaW5nLCB2YXVsdD86IGFueSk6IHN0cmluZyB7XHJcbiAgICAgIGlmICghdmFsdWUpe1xyXG4gICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB0aGlzLnZhdWx0LmdldE1lZGlhRnJvbUxpbmsodmFsdWUpPy5uYW1lIHx8IFwiXCI7XHJcbiAgICB9XHJcblxyXG4gICAgb3BlbkZpbGUodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgICAgLy8gR2V0IHRoZSBhYnNvbHV0ZSBwYXRoIHRvIHRoZSBmaWxlIGluIHRoZSB2YXVsdFxyXG4gICAgICAgICAgbGV0IG1lZGlhUGF0aCA9IHRoaXMudmF1bHQuZ2V0TWVkaWFGcm9tTGluayh2YWx1ZSk/LnBhdGg7XHJcbiAgICAgICAgICBjb25zdCBhYnNvbHV0ZU1lZGlhUGF0aCA9IHRoaXMudmF1bHQuZ2V0UGF0aCgpID8gcmVxdWlyZSgncGF0aCcpLmpvaW4odGhpcy52YXVsdC5nZXRQYXRoKCkgLCBtZWRpYVBhdGgpIDogbWVkaWFQYXRoO1xyXG4gICAgICAgICAgdGhpcy52YXVsdC5hcHAub3BlbihhYnNvbHV0ZU1lZGlhUGF0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgZmlsbERpc3BsYXkodmF1bHQ6IGFueSwgdmFsdWU6IGFueSwgdXBkYXRlOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgZmlsZTogYW55ID0gbnVsbCk6IEhUTUxEaXZFbGVtZW50IHtcclxuICAgICAgdGhpcy52YXVsdCA9IHZhdWx0O1xyXG4gICAgICBpZiAodmFsdWUgJiYgdmFsdWUuc3RhcnRzV2l0aChcIltbXCIpICYmIHZhbHVlLmVuZHNXaXRoKFwiXV1cIikpIHtcclxuICAgICAgICBpZiAodGhpcy5kaXNwbGF5ID09PSBcImVtYmVkXCIpIHtcclxuICAgICAgICAgIC8vIElmIGl0IGlzIGFuIGltYWdlIDogXHJcbiAgICAgICAgICBsZXQgbWVkaWFQYXRoID0gdGhpcy52YXVsdC5nZXRNZWRpYUZyb21MaW5rKHZhbHVlKT8ucGF0aDtcclxuICAgICAgICAgIGxldCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgaWYgKG1lZGlhUGF0aCkge1xyXG4gICAgICAgICAgICBjb25zdCBleHQgPSBtZWRpYVBhdGgudG9Mb3dlckNhc2UoKS5zcGxpdCgnLicpLnBvcCgpO1xyXG4gICAgICAgICAgICBpZiAoZXh0ICYmIFtcInBuZ1wiLCBcImpwZ1wiLCBcImpwZWdcIiwgXCJnaWZcIl0uaW5jbHVkZXMoZXh0KSkge1xyXG4gICAgICAgICAgICAgIGNvbnRhaW5lciA9IHRoaXMuY3JlYXRlRW1iZWRJbWFnZUNvbnRhaW5lcihtZWRpYVBhdGgsIHVwZGF0ZSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ICYmIFtcImdsYlwiLCBcImdsdGZcIiwgXCJmY3N0ZFwiXS5pbmNsdWRlcyhleHQpKSB7XHJcbiAgICAgICAgICAgICAgLy8gUG91ciBsZXMgZmljaGllcnMgM0QsIGNyw6llciB1biBtZXNzYWdlIHBvdXIgdXRpbGlzZXIgM0RNb2RlbFByb3BlcnR5XHJcbiAgICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChcImVtYmVkLWNvbnRhaW5lclwiKTtcclxuICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgICBtZXNzYWdlRGl2LnRleHRDb250ZW50ID0gXCJGaWNoaWVyIDNEIGTDqXRlY3TDqS4gVXRpbGlzZXogM0RNb2RlbFByb3BlcnR5IHBvdXIgbCdhZmZpY2hhZ2UgM0QuXCI7XHJcbiAgICAgICAgICAgICAgbWVzc2FnZURpdi5zdHlsZS50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xyXG4gICAgICAgICAgICAgIG1lc3NhZ2VEaXYuc3R5bGUubWFyZ2luID0gXCIyMHB4XCI7XHJcbiAgICAgICAgICAgICAgbWVzc2FnZURpdi5zdHlsZS5wYWRkaW5nID0gXCIxMHB4XCI7XHJcbiAgICAgICAgICAgICAgbWVzc2FnZURpdi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiNmMGYwZjBcIjtcclxuICAgICAgICAgICAgICBtZXNzYWdlRGl2LnN0eWxlLmJvcmRlciA9IFwiMXB4IHNvbGlkICNjY2NcIjtcclxuICAgICAgICAgICAgICBtZXNzYWdlRGl2LnN0eWxlLmJvcmRlclJhZGl1cyA9IFwiNXB4XCI7XHJcbiAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG1lc3NhZ2VEaXYpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcclxuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlRW1iZWRPcGVuQ29udGFpbmVyKHVwZGF0ZSwgdmFsdWUpKTtcclxuICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlRW1iZWRFZGl0Q29udGFpbmVyKHVwZGF0ZSwgdmFsdWUpKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiBjb250YWluZXJcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5kaXNwbGF5ID09PSBcImljb25cIikge1xyXG4gICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtZmllbGRcIiwgXCJtZWRpYS1maWVsZFwiKTtcclxuXHJcbiAgICAgICAgICBjb25zdCBpY29uRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgIGljb25EaXYuY2xhc3NMaXN0LmFkZChcImJpZy1pY29uLWRpdlwiKTtcclxuICAgICAgICAgIHNldEljb24oaWNvbkRpdiwgdGhpcy5nZXRGaWxlSWNvbih2YWx1ZSkpO1xyXG5cclxuICAgICAgICAgIGNvbnN0IGZpbGVOYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgIGZpbGVOYW1lLmNsYXNzTGlzdC5hZGQoXCJtZWRpYS1maWVsZC1maWxlLW5hbWVcIik7XHJcbiAgICAgICAgICBmaWxlTmFtZS50ZXh0Q29udGVudCA9IHRoaXMudmF1bHQuZ2V0TWVkaWFGcm9tTGluayh2YWx1ZSk/Lm5hbWUgfHwgXCJGaWNoaWVyIG5vbiB0cm91dsOpXCI7XHJcblxyXG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGljb25EaXYpO1xyXG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZpbGVOYW1lKTtcclxuXHJcblxyXG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGljb25EaXYpO1xyXG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZpbGVOYW1lKTtcclxuXHJcbiAgICAgICAgICAvLyDwn5SXIE91dnJpciBsZSBmaWNoaWVyIGF1IGNsaWMgKHN1ciB0b3V0IGxlIGNvbnRlbmV1cilcclxuICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5GaWxlKHZhbHVlKVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICByZXR1cm4gY29udGFpbmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLmRpc3BsYXkgPT09IFwiYnV0dG9uXCIpIHtcclxuICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChcImNyZWF0ZS1mcmVlY2FkLWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJtb2QtY3RhXCIpO1xyXG4gICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gdGhpcy50aXRsZSB8fCBcIk91dnJpciBsZSBmaWNoaWVyXCI7XHJcbiAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5GaWxlKHZhbHVlKVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTtcclxuICAgICAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBzdXBlci5maWxsRGlzcGxheSh2YXVsdCwgdmFsdWUsIHVwZGF0ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RmlsZUljb24odmFsdWU6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5zdGFydHNXaXRoKFwiW1tcIikgJiYgdmFsdWUuZW5kc1dpdGgoXCJdXVwiKSkge1xyXG4gICAgICAgIGNvbnN0IG1lZGlhUGF0aCA9IHRoaXMudmF1bHQuZ2V0TWVkaWFGcm9tTGluayh2YWx1ZSk/LnBhdGg7XHJcbiAgICAgICAgaWYgKG1lZGlhUGF0aCkge1xyXG4gICAgICAgICAgY29uc3QgZXh0ID0gbWVkaWFQYXRoLnRvTG93ZXJDYXNlKCkuc3BsaXQoJy4nKS5wb3AoKTtcclxuICAgICAgICAgIGlmIChleHQgJiYgW1wicG5nXCIsIFwianBnXCIsIFwianBlZ1wiLCBcImdpZlwiXS5pbmNsdWRlcyhleHQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcImltYWdlXCI7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGV4dCAmJiBbXCJnbGJcIiwgXCJnbHRmXCIsIFwiZmNzdGRcIl0uaW5jbHVkZXMoZXh0KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJjdWJlM2RcIjtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ICYmIFtcInBkZlwiLCBcImRvY3hcIiwgXCJ0eHRcIl0uaW5jbHVkZXMoZXh0KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJmaWxlXCI7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGV4dCAmJiBbXCJtcDRcIiwgXCJ3ZWJtXCIsIFwib2dnXCJdLmluY2x1ZGVzKGV4dCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFwidmlkZW9cIjtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ICYmIFtcIm1wM1wiLCBcIndhdlwiXS5pbmNsdWRlcyhleHQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcImF1ZGlvXCI7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIGlmIChleHQgJiYgW1wiemlwXCIsIFwicmFyXCJdLmluY2x1ZGVzKGV4dCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFwiYXJjaGl2ZVwiO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSBpZiAoZXh0ICYmIFtcInNsYVwiXS5pbmNsdWRlcyhleHQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcInNxdWFyZS1wZW5cIjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2UgaWYgKGV4dCAmJiBbXCJsYnJuMlwiXS5pbmNsdWRlcyhleHQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcImZsYW1lXCI7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRoaXMuaWNvbiB8fCBcIm1lZGlhXCI7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlRW1iZWRFZGl0Q29udGFpbmVyKHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4sIHZhbHVlOiBzdHJpbmcpOiBIVE1MRGl2RWxlbWVudCB7XHJcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiZW1iZWQtZWRpdC1jb250YWluZXJcIik7XHJcbiAgICAgIGNvbnRhaW5lci5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjsgLy8gUG9zaXRpb24gdGhlIGljb24gY29udGFpbmVyIGFic29sdXRlbHlcclxuICAgICAgY29udGFpbmVyLnN0eWxlLnRvcCA9IFwiNXB4XCI7IC8vIEFkanVzdCB0aGUgdG9wIHBvc2l0aW9uXHJcbiAgICAgIGNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gXCI1cHhcIjsgLy8gQWRqdXN0IHRoZSByaWdodCBwb3NpdGlvblxyXG4gICAgICBjb250YWluZXIuc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7IC8vIENoYW5nZSBjdXJzb3IgdG8gcG9pbnRlclxyXG5cclxuICAgICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIGljb25Db250YWluZXIuY2xhc3NMaXN0LmFkZChcImljb24tY29udGFpbmVyXCIpO1xyXG5cclxuICAgICAgY29uc3QgaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpXCIpO1xyXG4gICAgICBzZXRJY29uKGljb24sIFwibGlua1wiKTtcclxuXHJcbiAgICAgIGljb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChldmVudCkgPT4gYXdhaXQgdGhpcy5oYW5kbGVJY29uQ2xpY2sodXBkYXRlLCBldmVudCkpO1xyXG5cclxuICAgICAgaWNvbkNvbnRhaW5lci5hcHBlbmRDaGlsZChpY29uKTtcclxuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGljb25Db250YWluZXIpO1xyXG5cclxuICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVFbWJlZE9wZW5Db250YWluZXIodXBkYXRlOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPiwgdmFsdWU6IHN0cmluZyk6IEhUTUxEaXZFbGVtZW50IHtcclxuICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJlbWJlZC1vcGVuLWNvbnRhaW5lclwiKTtcclxuICAgICAgY29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiOyAvLyBQb3NpdGlvbiB0aGUgaWNvbiBjb250YWluZXIgYWJzb2x1dGVseVxyXG4gICAgICBjb250YWluZXIuc3R5bGUudG9wID0gXCI1cHhcIjsgLy8gQWRqdXN0IHRoZSB0b3AgcG9zaXRpb25cclxuICAgICAgY29udGFpbmVyLnN0eWxlLnJpZ2h0ID0gXCI1cHhcIjsgLy8gQWRqdXN0IHRoZSByaWdodCBwb3NpdGlvblxyXG4gICAgICBjb250YWluZXIuc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7IC8vIENoYW5nZSBjdXJzb3IgdG8gcG9pbnRlclxyXG5cclxuICAgICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIGljb25Db250YWluZXIuY2xhc3NMaXN0LmFkZChcImljb24tY29udGFpbmVyXCIpO1xyXG4gICAgICBcclxuXHJcbiAgICAgIGNvbnN0IGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaVwiKTtcclxuICAgICAgc2V0SWNvbihpY29uLCBcImV4dGVybmFsLWxpbmtcIik7XHJcblxyXG4gICAgICBpY29uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5vcGVuRmlsZSh2YWx1ZSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnZhdWx0LmFwcC5zZW5kTm90aWNlKFwiVW5hYmxlIHRvIGdlbmVyYXRlIGxpbmsgZm9yIHRoZSBtZWRpYS5cIik7XHJcbiAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpY29uQ29udGFpbmVyLmFwcGVuZENoaWxkKGljb24pO1xyXG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoaWNvbkNvbnRhaW5lcik7XHJcblxyXG4gICAgICByZXR1cm4gY29udGFpbmVyO1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgIGNyZWF0ZUVtYmVkSW1hZ2VDb250YWluZXIobWVkaWFQYXRoOiBzdHJpbmcsIHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4pOiBIVE1MRGl2RWxlbWVudCB7XHJcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtZmllbGRcIiwgXCJtZWRpYS1maWVsZFwiLCBcImVtYmVkLWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICAgIGNvbnN0IGVtYmVkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcclxuICAgICAgXHJcbiAgICAgIGVtYmVkLnNyYyA9IHRoaXMudmF1bHQuYXBwLnZhdWx0LmFkYXB0ZXIuZ2V0UmVzb3VyY2VQYXRoKG1lZGlhUGF0aCk7XHJcbiAgICAgIGVtYmVkLmFsdCA9IFwiTWVkaWFcIjtcclxuXHJcbiAgICAgIGVtYmVkLmNsYXNzTGlzdC5hZGQoXCJlbWJlZC1tZWRpYVwiKTtcclxuXHJcbiAgICAgIGNvbnN0IGljb25Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBpY29uQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJpY29uLWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICAgIGNvbnN0IGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaVwiKTtcclxuICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKFwiaWNvblwiLCB0aGlzLmljb24pO1xyXG4gICAgICBpY29uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZXZlbnQpID0+IGF3YWl0IHRoaXMuaGFuZGxlSWNvbkNsaWNrKHVwZGF0ZSwgZXZlbnQpKTtcclxuXHJcbiAgICAgIGljb25Db250YWluZXIuYXBwZW5kQ2hpbGQoaWNvbik7XHJcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChlbWJlZCk7XHJcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChpY29uQ29udGFpbmVyKTtcclxuXHJcbiAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRm9uY3Rpb24gcG91ciBnw6lyZXIgbGUgY2xpYyBzdXIgbCdpY8O0bmVcclxuICAgIG92ZXJyaWRlIGFzeW5jIGhhbmRsZUljb25DbGljayh1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+LCBldmVudDogRXZlbnQpIHtcclxuICAgICAgICBsZXQgc2VsZWN0ZWRGaWxlID0gYXdhaXQgdGhpcy52YXVsdC5hcHAuc2VsZWN0TWVkaWEodGhpcy52YXVsdCwgXCJDaG9pc2lzc2V6IHVuIGRvY3VtZW50XCIgKVxyXG4gICAgICAgIGlmIChzZWxlY3RlZEZpbGUpe1xyXG4gICAgICAgICAgYXdhaXQgdXBkYXRlKGBbWyR7c2VsZWN0ZWRGaWxlLnBhdGh9fCR7c2VsZWN0ZWRGaWxlLm5hbWV9XV1gKVxyXG4gICAgICAgICAgY29uc3QgbGluayA9IChldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQpLmNsb3Nlc3QoJy5tZXRhZGF0YS1maWVsZCcpPy5xdWVyeVNlbGVjdG9yKCcuZmllbGQtbGluaycpIGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgICAgICBpZiAobGluaykge1xyXG4gICAgICAgICAgICAgIGxpbmsudGV4dENvbnRlbnQgPSBzZWxlY3RlZEZpbGUubmFtZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBPdmVycmlkZSB0aGUgY3JlYXRlRmllbGRDb250YWluZXJDb250ZW50IGZ1bmN0aW9uIHRvIHRydW5jYXRlIHRoZSBsaW5rXHJcbiAgICBvdmVycmlkZSBjcmVhdGVGaWVsZENvbnRhaW5lckNvbnRlbnQodXBkYXRlOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPiwgdmFsdWU6IHN0cmluZykge1xyXG4gICAgICBjb25zdCBmaWVsZENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIGZpZWxkQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJmaWVsZC1jb250YWluZXJcIik7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRGaWVsZCA9IHRoaXMuZ2V0TGluayh2YWx1ZSk7XHJcbiAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuICAgICAgbGluay5ocmVmID0gXCIjXCI7XHJcbiAgICAgIGNvbnN0IHRydW5jYXRlZEZpZWxkID0gY3VycmVudEZpZWxkPy5sZW5ndGggPiAxMiA/IGN1cnJlbnRGaWVsZC5zbGljZSgwLCAxMikgKyBcIi4uLlwiIDogY3VycmVudEZpZWxkO1xyXG4gICAgICBsaW5rLnRleHRDb250ZW50ID0gdHJ1bmNhdGVkRmllbGQgfHwgXCJcIjtcclxuICAgICAgbGluay5zZXRBdHRyaWJ1dGUoXCJmdWxsLXRleHRcIiwgY3VycmVudEZpZWxkIHx8IFwiXCIpO1xyXG4gICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZXZlbnQpID0+IGF3YWl0IHRoaXMubW9kaWZ5RmllbGQoZXZlbnQpKTtcclxuICAgICAgbGluay5jbGFzc0xpc3QuYWRkKFwiZmllbGQtbGlua1wiKTtcclxuICAgICAgbGluay5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG5cclxuICAgICAgZmllbGRDb250YWluZXIuYXBwZW5kQ2hpbGQobGluayk7XHJcblxyXG4gICAgICByZXR1cm4gZmllbGRDb250YWluZXI7XHJcbiAgICB9XHJcblxyXG4gICAgIC8vIEZvbmN0aW9uIHBvdXIgZ8OpcmVyIGxlIGNsaWMgc3VyIGwnaWPDtG5lXHJcbiAgICBvdmVycmlkZSBhc3luYyBtb2RpZnlGaWVsZChldmVudDogRXZlbnQpIHtcclxuICAgICAgY29uc3QgbGluayA9IChldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQpLmNsb3Nlc3QoJy5tZXRhZGF0YS1maWVsZCcpPy5xdWVyeVNlbGVjdG9yKCcuZmllbGQtbGluaycpIGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICBsZXQgY3VycmVudEZpZWxkID0gbGluay5nZXRBdHRyaWJ1dGUoXCJmdWxsLXRleHRcIilcclxuICAgICAgaWYgKCFjdXJyZW50RmllbGQpe3JldHVybn1cclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLnZhdWx0LmdldEZpbGUoY3VycmVudEZpZWxkKTtcclxuICAgICAgaWYgKGZpbGUpIHtcclxuICAgICAgICAgIGF3YWl0IHRoaXMudmF1bHQuYXBwLm9wZW5GaWxlKGZpbGUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMudmF1bHQuYXBwLnNlbmROb3RpY2UoYExlIGZpY2hpZXIgJHtjdXJyZW50RmllbGR9IG4nZXhpc3RlIHBhc2ApXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuXHJcblxyXG4iXSwidmVyc2lvbiI6M30=