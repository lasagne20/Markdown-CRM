348513186393af877092e9d492859725
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock ConfigLoader
jest.mock('../../src/Config/ConfigLoader');
const ClassConfigManager_1 = require("../../src/Config/ClassConfigManager");
const ConfigLoader_1 = require("../../src/Config/ConfigLoader");
describe('ClassConfigManager', () => {
    let configManager;
    let mockConfigLoader;
    let mockApp;
    beforeEach(() => {
        jest.clearAllMocks();
        mockApp = {
            getVaultPath: jest.fn(() => '/test/vault'),
            getName: jest.fn(() => 'TestVault')
        };
        // Create mock config loader
        mockConfigLoader = {
            loadClassConfig: jest.fn(),
            loadConfig: jest.fn(),
            getConfigPath: jest.fn(() => './test-config')
        };
        // Mock the constructor
        ConfigLoader_1.ConfigLoader.mockImplementation(() => mockConfigLoader);
        configManager = new ClassConfigManager_1.ClassConfigManager('./test-config', mockApp);
    });
    describe('constructor', () => {
        it('should create instance with config loader', () => {
            expect(ConfigLoader_1.ConfigLoader).toHaveBeenCalledWith('./test-config', mockApp);
        });
    });
    describe('createDynamicClasse', () => {
        it('should create dynamic class from config', async () => {
            const mockConfig = {
                className: 'TestClass',
                classIcon: 'test-icon',
                properties: [],
                displayContainer: {
                    template: 'default',
                    components: []
                }
            };
            mockConfigLoader.loadClassConfig.mockResolvedValue(mockConfig);
            const DynamicClass = await configManager.createDynamicClasse('TestClass');
            expect(mockConfigLoader.loadClassConfig).toHaveBeenCalledWith('TestClass');
            expect(DynamicClass).toBeDefined();
            // Test instance creation
            const mockVault = { app: mockApp };
            const mockFile = { path: 'test.md' };
            const instance = new DynamicClass(mockVault, mockFile);
            expect(instance.name).toBe('TestClass');
            expect(instance.icon).toBe('test-icon');
        });
        it('should return cached class if already loaded', async () => {
            const mockConfig = {
                className: 'TestClass',
                classIcon: 'test-icon',
                properties: [],
                displayContainer: {
                    template: 'default',
                    components: []
                }
            };
            mockConfigLoader.loadClassConfig.mockResolvedValue(mockConfig);
            // First call
            const firstClass = await configManager.createDynamicClasse('TestClass');
            // Second call - should return cached version
            jest.clearAllMocks();
            const secondClass = await configManager.createDynamicClasse('TestClass');
            expect(firstClass).toBe(secondClass);
            expect(mockConfigLoader.loadClassConfig).not.toHaveBeenCalled();
        });
        it('should handle config loading errors', async () => {
            const error = new Error('Config not found');
            mockConfigLoader.loadClassConfig.mockRejectedValue(error);
            await expect(configManager.createDynamicClasse('NonExistentClass'))
                .rejects.toThrow('Config not found');
        });
    });
    describe('loadConfig', () => {
        it('should delegate to config loader', async () => {
            const mockConfig = { classes: ['TestClass'] };
            mockConfigLoader.loadConfig.mockResolvedValue(mockConfig);
            const result = await configManager.loadConfig();
            expect(mockConfigLoader.loadConfig).toHaveBeenCalled();
            expect(result).toBe(mockConfig);
        });
    });
    describe('getConfig', () => {
        it('should return current config', () => {
            const mockConfig = { classes: ['TestClass'] };
            configManager.config = mockConfig;
            const result = configManager.getConfig();
            expect(result).toBe(mockConfig);
        });
        it('should return undefined if no config loaded', () => {
            const result = configManager.getConfig();
            expect(result).toBeUndefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXENvbmZpZ1xcQ2xhc3NDb25maWdNYW5hZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFHQSxvQkFBb0I7QUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0FBSjNDLDRFQUF5RTtBQUN6RSxnRUFBNkQ7QUFLN0QsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNoQyxJQUFJLGFBQWlDLENBQUM7SUFDdEMsSUFBSSxnQkFBMkMsQ0FBQztJQUNoRCxJQUFJLE9BQVksQ0FBQztJQUVqQixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ1osSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLE9BQU8sR0FBRztZQUNOLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLGFBQWEsQ0FBQztZQUMxQyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUM7U0FDdEMsQ0FBQztRQUVGLDRCQUE0QjtRQUM1QixnQkFBZ0IsR0FBRztZQUNmLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzFCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3JCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLGVBQWUsQ0FBQztTQUN6QyxDQUFDO1FBRVQsdUJBQXVCO1FBQ3RCLDJCQUFzRCxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFFbkcsYUFBYSxHQUFHLElBQUksdUNBQWtCLENBQUMsZUFBZSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3JFLENBQUMsQ0FBQyxDQUFDO0lBRUgs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QyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcX190ZXN0c19fXFxDb25maWdcXENsYXNzQ29uZmlnTWFuYWdlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENsYXNzQ29uZmlnTWFuYWdlciB9IGZyb20gJy4uLy4uL3NyYy9Db25maWcvQ2xhc3NDb25maWdNYW5hZ2VyJztcclxuaW1wb3J0IHsgQ29uZmlnTG9hZGVyIH0gZnJvbSAnLi4vLi4vc3JjL0NvbmZpZy9Db25maWdMb2FkZXInO1xyXG5cclxuLy8gTW9jayBDb25maWdMb2FkZXJcclxuamVzdC5tb2NrKCcuLi8uLi9zcmMvQ29uZmlnL0NvbmZpZ0xvYWRlcicpO1xyXG5cclxuZGVzY3JpYmUoJ0NsYXNzQ29uZmlnTWFuYWdlcicsICgpID0+IHtcclxuICAgIGxldCBjb25maWdNYW5hZ2VyOiBDbGFzc0NvbmZpZ01hbmFnZXI7XHJcbiAgICBsZXQgbW9ja0NvbmZpZ0xvYWRlcjogamVzdC5Nb2NrZWQ8Q29uZmlnTG9hZGVyPjtcclxuICAgIGxldCBtb2NrQXBwOiBhbnk7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbW9ja0FwcCA9IHtcclxuICAgICAgICAgICAgZ2V0VmF1bHRQYXRoOiBqZXN0LmZuKCgpID0+ICcvdGVzdC92YXVsdCcpLFxyXG4gICAgICAgICAgICBnZXROYW1lOiBqZXN0LmZuKCgpID0+ICdUZXN0VmF1bHQnKVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSBtb2NrIGNvbmZpZyBsb2FkZXJcclxuICAgICAgICBtb2NrQ29uZmlnTG9hZGVyID0ge1xyXG4gICAgICAgICAgICBsb2FkQ2xhc3NDb25maWc6IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgbG9hZENvbmZpZzogamVzdC5mbigpLFxyXG4gICAgICAgICAgICBnZXRDb25maWdQYXRoOiBqZXN0LmZuKCgpID0+ICcuL3Rlc3QtY29uZmlnJylcclxuICAgICAgICB9IGFzIGFueTtcclxuXHJcbiAgICAgICAgLy8gTW9jayB0aGUgY29uc3RydWN0b3JcclxuICAgICAgICAoQ29uZmlnTG9hZGVyIGFzIGplc3QuTW9ja2VkQ2xhc3M8dHlwZW9mIENvbmZpZ0xvYWRlcj4pLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBtb2NrQ29uZmlnTG9hZGVyKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25maWdNYW5hZ2VyID0gbmV3IENsYXNzQ29uZmlnTWFuYWdlcignLi90ZXN0LWNvbmZpZycsIG1vY2tBcHApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NvbnN0cnVjdG9yJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGluc3RhbmNlIHdpdGggY29uZmlnIGxvYWRlcicsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KENvbmZpZ0xvYWRlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy4vdGVzdC1jb25maWcnLCBtb2NrQXBwKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjcmVhdGVEeW5hbWljQ2xhc3NlJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGR5bmFtaWMgY2xhc3MgZnJvbSBjb25maWcnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tDb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdUZXN0Q2xhc3MnLFxyXG4gICAgICAgICAgICAgICAgY2xhc3NJY29uOiAndGVzdC1pY29uJyxcclxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFtdLFxyXG4gICAgICAgICAgICAgICAgZGlzcGxheUNvbnRhaW5lcjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnZGVmYXVsdCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50czogW11cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIG1vY2tDb25maWdMb2FkZXIubG9hZENsYXNzQ29uZmlnLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb25maWcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgRHluYW1pY0NsYXNzID0gYXdhaXQgY29uZmlnTWFuYWdlci5jcmVhdGVEeW5hbWljQ2xhc3NlKCdUZXN0Q2xhc3MnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrQ29uZmlnTG9hZGVyLmxvYWRDbGFzc0NvbmZpZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1Rlc3RDbGFzcycpO1xyXG4gICAgICAgICAgICBleHBlY3QoRHluYW1pY0NsYXNzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVGVzdCBpbnN0YW5jZSBjcmVhdGlvblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7IGFwcDogbW9ja0FwcCB9IGFzIGFueTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja0ZpbGUgPSB7IHBhdGg6ICd0ZXN0Lm1kJyB9IGFzIGFueTtcclxuICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBuZXcgRHluYW1pY0NsYXNzKG1vY2tWYXVsdCwgbW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGluc3RhbmNlLm5hbWUpLnRvQmUoJ1Rlc3RDbGFzcycpO1xyXG4gICAgICAgICAgICBleHBlY3QoaW5zdGFuY2UuaWNvbikudG9CZSgndGVzdC1pY29uJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGNhY2hlZCBjbGFzcyBpZiBhbHJlYWR5IGxvYWRlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja0NvbmZpZyA9IHtcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ1Rlc3RDbGFzcycsXHJcbiAgICAgICAgICAgICAgICBjbGFzc0ljb246ICd0ZXN0LWljb24nLFxyXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczogW10sXHJcbiAgICAgICAgICAgICAgICBkaXNwbGF5Q29udGFpbmVyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdkZWZhdWx0JyxcclxuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRzOiBbXVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgbW9ja0NvbmZpZ0xvYWRlci5sb2FkQ2xhc3NDb25maWcubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbmZpZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBGaXJzdCBjYWxsXHJcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0Q2xhc3MgPSBhd2FpdCBjb25maWdNYW5hZ2VyLmNyZWF0ZUR5bmFtaWNDbGFzc2UoJ1Rlc3RDbGFzcycpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gU2Vjb25kIGNhbGwgLSBzaG91bGQgcmV0dXJuIGNhY2hlZCB2ZXJzaW9uXHJcbiAgICAgICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgICAgICAgICBjb25zdCBzZWNvbmRDbGFzcyA9IGF3YWl0IGNvbmZpZ01hbmFnZXIuY3JlYXRlRHluYW1pY0NsYXNzZSgnVGVzdENsYXNzJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoZmlyc3RDbGFzcykudG9CZShzZWNvbmRDbGFzcyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrQ29uZmlnTG9hZGVyLmxvYWRDbGFzc0NvbmZpZykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uZmlnIGxvYWRpbmcgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignQ29uZmlnIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgICAgICBtb2NrQ29uZmlnTG9hZGVyLmxvYWRDbGFzc0NvbmZpZy5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QoY29uZmlnTWFuYWdlci5jcmVhdGVEeW5hbWljQ2xhc3NlKCdOb25FeGlzdGVudENsYXNzJykpXHJcbiAgICAgICAgICAgICAgICAucmVqZWN0cy50b1Rocm93KCdDb25maWcgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnbG9hZENvbmZpZycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGRlbGVnYXRlIHRvIGNvbmZpZyBsb2FkZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tDb25maWcgPSB7IGNsYXNzZXM6IFsnVGVzdENsYXNzJ10gfTtcclxuICAgICAgICAgICAgbW9ja0NvbmZpZ0xvYWRlci5sb2FkQ29uZmlnLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb25maWcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29uZmlnTWFuYWdlci5sb2FkQ29uZmlnKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobW9ja0NvbmZpZ0xvYWRlci5sb2FkQ29uZmlnKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUobW9ja0NvbmZpZyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZ2V0Q29uZmlnJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGN1cnJlbnQgY29uZmlnJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrQ29uZmlnID0geyBjbGFzc2VzOiBbJ1Rlc3RDbGFzcyddIH07XHJcbiAgICAgICAgICAgIChjb25maWdNYW5hZ2VyIGFzIGFueSkuY29uZmlnID0gbW9ja0NvbmZpZztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbmZpZ01hbmFnZXIuZ2V0Q29uZmlnKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKG1vY2tDb25maWcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiB1bmRlZmluZWQgaWYgbm8gY29uZmlnIGxvYWRlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY29uZmlnTWFuYWdlci5nZXRDb25maWcoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVVbmRlZmluZWQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=