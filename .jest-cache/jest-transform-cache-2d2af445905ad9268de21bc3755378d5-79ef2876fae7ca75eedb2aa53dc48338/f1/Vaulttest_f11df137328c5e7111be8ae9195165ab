392cbabcdf060df8141b055594d8a4ce
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock DynamicClassFactory
jest.mock('../../src/Config/DynamicClassFactory');
const Vault_1 = require("../../src/vault/Vault");
const Classe_1 = require("../../src/vault/Classe");
const DynamicClassFactory_1 = require("../../src/Config/DynamicClassFactory");
const MockDynamicClassFactory = DynamicClassFactory_1.DynamicClassFactory;
// Test class implementation
class TestClasse extends Classe_1.Classe {
    static create(vault) {
        return new TestClasse(vault);
    }
}
// Mock implementations
const createMockApp = () => ({
    getFile: jest.fn(),
    getMetadata: jest.fn(),
    listFiles: jest.fn(),
    readFile: jest.fn(),
    writeFile: jest.fn(),
    renameFile: jest.fn(),
    createFolder: jest.fn(),
    updateMetadata: jest.fn(),
    waitForFileMetaDataUpdate: jest.fn(),
    getTemplateContent: jest.fn(),
    createDiv: jest.fn(),
    setIcon: jest.fn(),
    getAbsolutePath: jest.fn(),
    selectMedia: jest.fn(),
    open: jest.fn(),
    sendNotice: jest.fn(),
    getVaultPath: jest.fn().mockReturnValue('/vault/path'),
    getName: jest.fn().mockReturnValue('TestVault'),
    createFile: jest.fn(),
    delete: jest.fn(),
    listFolders: jest.fn(),
    isFolder: jest.fn(),
    isFile: jest.fn(),
    getFolder: jest.fn(),
    getFolderPath: jest.fn(),
    moveFile: jest.fn(),
    copyFile: jest.fn()
});
describe('Vault', () => {
    let mockApp;
    let vault;
    let settings;
    let mockDynamicFactory;
    beforeEach(() => {
        jest.clearAllMocks();
        mockApp = createMockApp();
        settings = {
            templateFolder: 'templates',
            personalName: 'Test User',
            configPath: './config'
        };
        // Setup mock dynamic factory
        mockDynamicFactory = {
            getAvailableClasses: jest.fn().mockResolvedValue(['TestClasse']),
            getClass: jest.fn().mockResolvedValue(TestClasse),
            createInstance: jest.fn()
        };
        MockDynamicClassFactory.mockImplementation(() => mockDynamicFactory);
        vault = new Vault_1.Vault(mockApp, settings);
    });
    describe('Constructor', () => {
        it('should create Vault instance with correct properties', () => {
            expect(vault).toBeInstanceOf(Vault_1.Vault);
            expect(vault.app).toBe(mockApp);
            expect(vault.settings).toBe(settings);
            expect(vault.files).toEqual({});
        });
        it('should initialize with default config path when not provided', () => {
            const settingsWithoutConfig = { ...settings };
            delete settingsWithoutConfig.configPath;
            new Vault_1.Vault(mockApp, settingsWithoutConfig);
            expect(MockDynamicClassFactory).toHaveBeenCalledWith('./config', mockApp);
        });
    });
    describe('Path and name methods', () => {
        it('should get vault path', () => {
            expect(vault.getPath()).toBe('/vault/path');
            expect(mockApp.getVaultPath).toHaveBeenCalled();
        });
        it('should get vault name', () => {
            expect(vault.getName()).toBe('TestVault');
            expect(mockApp.getName).toHaveBeenCalled();
        });
        it('should get personal name from settings', () => {
            expect(vault.getPersonalName()).toBe('Test User');
        });
    });
    describe('Dynamic class factory', () => {
        it('should initialize dynamic class factory', async () => {
            // Wait for the async initialization to complete
            await new Promise(resolve => setTimeout(resolve, 0));
            expect(MockDynamicClassFactory).toHaveBeenCalledWith('./config', mockApp);
        });
        it('should get dynamic class factory instance', () => {
            const factory = vault.getDynamicClassFactory();
            expect(factory).toBeDefined();
        });
        it('should handle dynamic class factory initialization errors', async () => {
            MockDynamicClassFactory.mockImplementation(() => {
                throw new Error('Factory initialization failed');
            });
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation();
            new Vault_1.Vault(mockApp, settings);
            // Wait for async initialization
            await new Promise(resolve => setTimeout(resolve, 0));
            expect(consoleSpy).toHaveBeenCalledWith('Failed to initialize dynamic classes:', expect.any(Error));
            consoleSpy.mockRestore();
        });
    });
    describe('Class management', () => {
        it('should get class from name', () => {
            Vault_1.Vault.classes = { TestClasse: TestClasse };
            const ClasseFromName = vault.getClasseFromName('TestClasse');
            expect(ClasseFromName).toBe(TestClasse);
        });
        it('should return undefined for non-existent class', () => {
            Vault_1.Vault.classes = {};
            const ClasseFromName = vault.getClasseFromName('NonExistent');
            expect(ClasseFromName).toBeUndefined();
        });
    });
    describe('Link reading', () => {
        it('should read wikilink file with alias', () => {
            const result = vault.readLinkFile('[[file.md|Display Name]]');
            expect(result).toBe('Display Name');
        });
        it('should read wikilink file without alias', () => {
            const result = vault.readLinkFile('[[folder/file.md]]');
            expect(result).toBe('file');
        });
        it('should read wikilink file with path when path=true', () => {
            const result = vault.readLinkFile('[[folder/file]]', true);
            expect(result).toBe('folder/file.md');
        });
        it('should read wikilink file with extension when path=true', () => {
            const result = vault.readLinkFile('[[folder/file.pdf]]', true);
            expect(result).toBe('folder/file.pdf');
        });
        it('should handle non-wikilink strings', () => {
            const result = vault.readLinkFile('regular text');
            expect(result).toBe('regular text');
        });
        it('should handle empty or null strings', () => {
            expect(vault.readLinkFile('')).toBe('');
            expect(vault.readLinkFile(null)).toBe('');
            expect(vault.readLinkFile(undefined)).toBe('');
        });
        it('should handle malformed wikilinks', () => {
            const result = vault.readLinkFile('[[incomplete');
            expect(result).toBe('[[incomplete');
        });
    });
    describe('getFromLink', () => {
        const mockFile = {
            name: 'test.md',
            path: 'folder/test.md',
            basename: 'test',
            extension: 'md'
        };
        beforeEach(() => {
            vault.createClasse = jest.fn().mockResolvedValue(new TestClasse(vault));
        });
        it('should get file by direct path match', async () => {
            mockApp.listFiles.mockResolvedValue([mockFile]);
            const result = await vault.getFromLink('[[folder/test.md]]');
            expect(result).toBeDefined();
            expect(vault.createClasse).toHaveBeenCalledWith(mockFile);
        });
        it('should get file from cache if already exists', async () => {
            const cachedClasse = new TestClasse(vault);
            vault.files['folder/test.md'] = cachedClasse;
            mockApp.listFiles.mockResolvedValue([mockFile]);
            const result = await vault.getFromLink('[[folder/test.md]]');
            expect(result).toBe(cachedClasse);
            expect(vault.createClasse).not.toHaveBeenCalled();
        });
        it('should find file by name when multiple files exist', async () => {
            const file1 = { ...mockFile, path: 'folder1/test.md' };
            const file2 = { ...mockFile, path: 'folder2/test.md' };
            mockApp.listFiles.mockResolvedValue([file1, file2]);
            const result = await vault.getFromLink('[[folder2/test.md]]');
            expect(vault.createClasse).toHaveBeenCalledWith(file2);
        });
        it('should handle file not found', async () => {
            mockApp.listFiles.mockResolvedValue([]);
            const result = await vault.getFromLink('[[nonexistent.md]]');
            expect(result).toBeNull();
        });
        it('should handle empty link', async () => {
            const result = await vault.getFromLink('');
            expect(result).toBeNull();
        });
        it('should suppress logging when log=false', async () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation();
            mockApp.listFiles.mockResolvedValue([]);
            await vault.getFromLink('[[nonexistent.md]]', false);
            expect(consoleSpy).not.toHaveBeenCalled();
            consoleSpy.mockRestore();
        });
    });
    describe('getMediaFromLink', () => {
        const mockMediaFile = {
            name: 'image.jpg',
            path: 'media/image.jpg',
            basename: 'image',
            extension: 'jpg'
        };
        it('should get media file by direct path', async () => {
            mockApp.listFiles.mockResolvedValue([mockMediaFile]);
            const result = await vault.getMediaFromLink('[[media/image.jpg]]');
            expect(result).toBe(mockMediaFile);
        });
        it('should get media file by name', async () => {
            mockApp.listFiles.mockResolvedValue([mockMediaFile]);
            const result = await vault.getMediaFromLink('[[image.jpg]]');
            expect(result).toBe(mockMediaFile);
        });
        it('should return null for non-existent media', async () => {
            mockApp.listFiles.mockResolvedValue([]);
            const result = await vault.getMediaFromLink('[[nonexistent.jpg]]');
            expect(result).toBeNull();
        });
    });
    describe('createClasse', () => {
        const mockFile = {
            name: 'test.md',
            path: 'folder/test.md',
            basename: 'test',
            extension: 'md'
        };
        beforeEach(() => {
            mockApp.getMetaDataFromPath = jest.fn();
            mockApp.waitForFileMetaDataUpdate = jest.fn().mockImplementation((filePath, key, callback) => callback());
            Vault_1.Vault.classes = { TestClasse: TestClasse };
        });
        it('should create classe with dynamic factory', async () => {
            mockApp.getMetaDataFromPath.mockReturnValue({
                frontmatter: { Classe: 'TestClasse' }
            });
            mockDynamicFactory.getClass.mockResolvedValue(TestClasse);
            const result = await vault.createClasse(mockFile);
            expect(result).toBeInstanceOf(TestClasse);
            expect(mockDynamicFactory.getClass).toHaveBeenCalledWith('TestClasse');
        });
        it('should fallback to static classes when dynamic factory fails', async () => {
            mockApp.getMetaDataFromPath.mockReturnValue({
                frontmatter: { Classe: 'TestClasse' }
            });
            mockDynamicFactory.getClass.mockRejectedValue(new Error('Dynamic class loading failed'));
            const result = await vault.createClasse(mockFile);
            expect(result).toBeInstanceOf(TestClasse);
        });
        it('should throw error when no metadata found', async () => {
            mockApp.getMetaDataFromPath.mockReturnValue(null);
            await expect(vault.createClasse(mockFile)).rejects.toThrow('Métadonnées non trouvées pour le fichier');
        });
        it('should throw error when no Classe property found', async () => {
            mockApp.getMetaDataFromPath.mockReturnValue({
                frontmatter: { otherProperty: 'value' }
            });
            await expect(vault.createClasse(mockFile)).rejects.toThrow('Propriété Classe non trouvée dans les métadonnées');
        });
        it('should throw error when class not found', async () => {
            mockApp.getMetaDataFromPath.mockReturnValue({
                frontmatter: { Classe: 'UnknownClasse' }
            });
            mockDynamicFactory.getClass.mockResolvedValue(null);
            Vault_1.Vault.classes = {};
            await expect(vault.createClasse(mockFile)).rejects.toThrow('Classe UnknownClasse non trouvée');
        });
    });
    describe('Error handling and edge cases', () => {
        it('should handle app methods that throw errors', async () => {
            mockApp.listFiles.mockRejectedValue(new Error('File system error'));
            await expect(vault.getFromLink('[[test.md]]')).rejects.toThrow('File system error');
        });
        it('should handle malformed metadata', async () => {
            const mockFile = {
                name: 'test.md',
                path: 'test.md',
                basename: 'test',
                extension: 'md'
            };
            mockApp.getMetaDataFromPath.mockReturnValue({
                frontmatter: null
            });
            await expect(vault.createClasse(mockFile)).rejects.toThrow('Propriété Classe non trouvée dans les métadonnées');
        });
        it('should handle very long file paths', async () => {
            const longPath = 'a/'.repeat(100) + 'file.md';
            const result = vault.readLinkFile(`[[${longPath}]]`, true);
            expect(result).toBe(longPath);
        });
        it('should handle special characters in file names', async () => {
            const specialName = 'file@#$%^&*()_+{}|:<>?.md';
            const result = vault.readLinkFile(`[[${specialName}]]`, true);
            expect(result).toBe(specialName);
        });
        it('should handle unicode characters', async () => {
            const unicodeName = '测试文件.md';
            const result = vault.readLinkFile(`[[${unicodeName}]]`, true);
            expect(result).toBe(unicodeName);
        });
    });
    describe('Static properties', () => {
        it('should have static classes property', () => {
            expect(Vault_1.Vault.classes).toBeDefined();
            expect(typeof Vault_1.Vault.classes).toBe('object');
        });
        it('should handle static classes being undefined', () => {
            const originalClasses = Vault_1.Vault.classes;
            Vault_1.Vault.classes = undefined;
            const result = vault.getClasseFromName('TestClasse');
            expect(result).toBeUndefined();
            Vault_1.Vault.classes = originalClasses;
        });
    });
    describe('Performance and memory', () => {
        it('should cache created classes', async () => {
            const mockFile = {
                name: 'test.md',
                path: 'test.md',
                basename: 'test',
                extension: 'md'
            };
            mockApp.listFiles.mockResolvedValue([mockFile]);
            vault.createClasse = jest.fn().mockResolvedValue(new TestClasse(vault));
            // First call should create and cache
            const result1 = await vault.getFromLink('[[test.md]]');
            // Second call should use cache
            const result2 = await vault.getFromLink('[[test.md]]');
            expect(vault.createClasse).toHaveBeenCalledTimes(1);
            expect(result1).toBe(result2);
        });
        it('should handle large numbers of files efficiently', async () => {
            const manyFiles = [];
            for (let i = 0; i < 1000; i++) {
                manyFiles.push({
                    name: `file${i}.md`,
                    path: `folder/file${i}.md`,
                    basename: `file${i}`,
                    extension: 'md'
                });
            }
            mockApp.listFiles.mockResolvedValue(manyFiles);
            vault.createClasse = jest.fn().mockResolvedValue(new TestClasse(vault));
            const result = await vault.getFromLink('[[file500.md]]');
            expect(result).toBeDefined();
            expect(vault.createClasse).toHaveBeenCalledWith(manyFiles[500]);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXHZhdWx0XFxWYXVsdC50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBS0EsMkJBQTJCO0FBQzNCLElBQUksQ0FBQyxJQUFJLENBQUMsc0NBQXNDLENBQUMsQ0FBQztBQU5sRCxpREFBd0Q7QUFDeEQsbURBQWdEO0FBRWhELDhFQUEyRTtBQUkzRSxNQUFNLHVCQUF1QixHQUFHLHlDQUFtRSxDQUFDO0FBRXBHLDRCQUE0QjtBQUM1QixNQUFNLFVBQVcsU0FBUSxlQUFNO0lBQzNCLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBWTtRQUN0QixPQUFPLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2pDLENBQUM7Q0FDSjtBQUVELHVCQUF1QjtBQUN2QixNQUFNLGFBQWEsR0FBRyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3pCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2xCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3RCLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3BCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ25CLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3BCLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3JCLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3ZCLGNBQWMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3pCLHlCQUF5QixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDcEMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUM3QixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUNwQixPQUFPLEVBQUUsSUFBSSxDQUFD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QUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM3QixNQUFNLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLG9CQUFvQixDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3BFLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGxlb2R1XFxEb2N1bWVudHNcXDEgLSBQcm9cXFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXF9fdGVzdHNfX1xcdmF1bHRcXFZhdWx0LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVmF1bHQsIFNldHRpbmdzIH0gZnJvbSAnLi4vLi4vc3JjL3ZhdWx0L1ZhdWx0JztcclxuaW1wb3J0IHsgQ2xhc3NlIH0gZnJvbSAnLi4vLi4vc3JjL3ZhdWx0L0NsYXNzZSc7XHJcbmltcG9ydCB7IElBcHAsIElGaWxlIH0gZnJvbSAnLi4vLi4vc3JjL2ludGVyZmFjZXMvSUFwcCc7XHJcbmltcG9ydCB7IER5bmFtaWNDbGFzc0ZhY3RvcnkgfSBmcm9tICcuLi8uLi9zcmMvQ29uZmlnL0R5bmFtaWNDbGFzc0ZhY3RvcnknO1xyXG5cclxuLy8gTW9jayBEeW5hbWljQ2xhc3NGYWN0b3J5XHJcbmplc3QubW9jaygnLi4vLi4vc3JjL0NvbmZpZy9EeW5hbWljQ2xhc3NGYWN0b3J5Jyk7XHJcbmNvbnN0IE1vY2tEeW5hbWljQ2xhc3NGYWN0b3J5ID0gRHluYW1pY0NsYXNzRmFjdG9yeSBhcyBqZXN0Lk1vY2tlZENsYXNzPHR5cGVvZiBEeW5hbWljQ2xhc3NGYWN0b3J5PjtcclxuXHJcbi8vIFRlc3QgY2xhc3MgaW1wbGVtZW50YXRpb25cclxuY2xhc3MgVGVzdENsYXNzZSBleHRlbmRzIENsYXNzZSB7XHJcbiAgICBzdGF0aWMgY3JlYXRlKHZhdWx0OiBWYXVsdCk6IENsYXNzZSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBUZXN0Q2xhc3NlKHZhdWx0KTtcclxuICAgIH1cclxufVxyXG5cclxuLy8gTW9jayBpbXBsZW1lbnRhdGlvbnNcclxuY29uc3QgY3JlYXRlTW9ja0FwcCA9ICgpID0+ICh7XHJcbiAgICBnZXRGaWxlOiBqZXN0LmZuKCksXHJcbiAgICBnZXRNZXRhZGF0YTogamVzdC5mbigpLFxyXG4gICAgbGlzdEZpbGVzOiBqZXN0LmZuKCksXHJcbiAgICByZWFkRmlsZTogamVzdC5mbigpLFxyXG4gICAgd3JpdGVGaWxlOiBqZXN0LmZuKCksXHJcbiAgICByZW5hbWVGaWxlOiBqZXN0LmZuKCksXHJcbiAgICBjcmVhdGVGb2xkZXI6IGplc3QuZm4oKSxcclxuICAgIHVwZGF0ZU1ldGFkYXRhOiBqZXN0LmZuKCksXHJcbiAgICB3YWl0Rm9yRmlsZU1ldGFEYXRhVXBkYXRlOiBqZXN0LmZuKCksXHJcbiAgICBnZXRUZW1wbGF0ZUNvbnRlbnQ6IGplc3QuZm4oKSxcclxuICAgIGNyZWF0ZURpdjogamVzdC5mbigpLFxyXG4gICAgc2V0SWNvbjogamVzdC5mbigpLFxyXG4gICAgZ2V0QWJzb2x1dGVQYXRoOiBqZXN0LmZuKCksXHJcbiAgICBzZWxlY3RNZWRpYTogamVzdC5mbigpLFxyXG4gICAgb3BlbjogamVzdC5mbigpLFxyXG4gICAgc2VuZE5vdGljZTogamVzdC5mbigpLFxyXG4gICAgZ2V0VmF1bHRQYXRoOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCcvdmF1bHQvcGF0aCcpLFxyXG4gICAgZ2V0TmFtZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnVGVzdFZhdWx0JyksXHJcbiAgICBjcmVhdGVGaWxlOiBqZXN0LmZuKCksXHJcbiAgICBkZWxldGU6IGplc3QuZm4oKSxcclxuICAgIGxpc3RGb2xkZXJzOiBqZXN0LmZuKCksXHJcbiAgICBpc0ZvbGRlcjogamVzdC5mbigpLFxyXG4gICAgaXNGaWxlOiBqZXN0LmZuKCksXHJcbiAgICBnZXRGb2xkZXI6IGplc3QuZm4oKSxcclxuICAgIGdldEZvbGRlclBhdGg6IGplc3QuZm4oKSxcclxuICAgIG1vdmVGaWxlOiBqZXN0LmZuKCksXHJcbiAgICBjb3B5RmlsZTogamVzdC5mbigpXHJcbn0pO1xyXG5cclxuZGVzY3JpYmUoJ1ZhdWx0JywgKCkgPT4ge1xyXG4gICAgbGV0IG1vY2tBcHA6IFJldHVyblR5cGU8dHlwZW9mIGNyZWF0ZU1vY2tBcHA+O1xyXG4gICAgbGV0IHZhdWx0OiBWYXVsdDtcclxuICAgIGxldCBzZXR0aW5nczogU2V0dGluZ3M7XHJcbiAgICBsZXQgbW9ja0R5bmFtaWNGYWN0b3J5OiBqZXN0Lk1vY2tlZDxEeW5hbWljQ2xhc3NGYWN0b3J5PjtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgICAgICBtb2NrQXBwID0gY3JlYXRlTW9ja0FwcCgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNldHRpbmdzID0ge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZUZvbGRlcjogJ3RlbXBsYXRlcycsXHJcbiAgICAgICAgICAgIHBlcnNvbmFsTmFtZTogJ1Rlc3QgVXNlcicsXHJcbiAgICAgICAgICAgIGNvbmZpZ1BhdGg6ICcuL2NvbmZpZydcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBTZXR1cCBtb2NrIGR5bmFtaWMgZmFjdG9yeVxyXG4gICAgICAgIG1vY2tEeW5hbWljRmFjdG9yeSA9IHtcclxuICAgICAgICAgICAgZ2V0QXZhaWxhYmxlQ2xhc3NlczogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFsnVGVzdENsYXNzZSddKSxcclxuICAgICAgICAgICAgZ2V0Q2xhc3M6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShUZXN0Q2xhc3NlKSxcclxuICAgICAgICAgICAgY3JlYXRlSW5zdGFuY2U6IGplc3QuZm4oKVxyXG4gICAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgICBNb2NrRHluYW1pY0NsYXNzRmFjdG9yeS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gbW9ja0R5bmFtaWNGYWN0b3J5KTtcclxuXHJcbiAgICAgICAgdmF1bHQgPSBuZXcgVmF1bHQobW9ja0FwcCBhcyBhbnksIHNldHRpbmdzKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdDb25zdHJ1Y3RvcicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBWYXVsdCBpbnN0YW5jZSB3aXRoIGNvcnJlY3QgcHJvcGVydGllcycsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KHZhdWx0KS50b0JlSW5zdGFuY2VPZihWYXVsdCk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh2YXVsdC5hcHApLnRvQmUobW9ja0FwcCk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh2YXVsdC5zZXR0aW5ncykudG9CZShzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh2YXVsdC5maWxlcykudG9FcXVhbCh7fSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaW5pdGlhbGl6ZSB3aXRoIGRlZmF1bHQgY29uZmlnIHBhdGggd2hlbiBub3QgcHJvdmlkZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzV2l0aG91dENvbmZpZyA9IHsgLi4uc2V0dGluZ3MgfTtcclxuICAgICAgICAgICAgZGVsZXRlIHNldHRpbmdzV2l0aG91dENvbmZpZy5jb25maWdQYXRoO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbmV3IFZhdWx0KG1vY2tBcHAgYXMgYW55LCBzZXR0aW5nc1dpdGhvdXRDb25maWcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KE1vY2tEeW5hbWljQ2xhc3NGYWN0b3J5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnLi9jb25maWcnLCBtb2NrQXBwKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdQYXRoIGFuZCBuYW1lIG1ldGhvZHMnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBnZXQgdmF1bHQgcGF0aCcsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KHZhdWx0LmdldFBhdGgoKSkudG9CZSgnL3ZhdWx0L3BhdGgnKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tBcHAuZ2V0VmF1bHRQYXRoKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgZ2V0IHZhdWx0IG5hbWUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdCh2YXVsdC5nZXROYW1lKCkpLnRvQmUoJ1Rlc3RWYXVsdCcpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja0FwcC5nZXROYW1lKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgZ2V0IHBlcnNvbmFsIG5hbWUgZnJvbSBzZXR0aW5ncycsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KHZhdWx0LmdldFBlcnNvbmFsTmFtZSgpKS50b0JlKCdUZXN0IFVzZXInKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdEeW5hbWljIGNsYXNzIGZhY3RvcnknLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIGR5bmFtaWMgY2xhc3MgZmFjdG9yeScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgLy8gV2FpdCBmb3IgdGhlIGFzeW5jIGluaXRpYWxpemF0aW9uIHRvIGNvbXBsZXRlXHJcbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAwKSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoTW9ja0R5bmFtaWNDbGFzc0ZhY3RvcnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcuL2NvbmZpZycsIG1vY2tBcHApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGdldCBkeW5hbWljIGNsYXNzIGZhY3RvcnkgaW5zdGFuY2UnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZhY3RvcnkgPSB2YXVsdC5nZXREeW5hbWljQ2xhc3NGYWN0b3J5KCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmYWN0b3J5KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBkeW5hbWljIGNsYXNzIGZhY3RvcnkgaW5pdGlhbGl6YXRpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBNb2NrRHluYW1pY0NsYXNzRmFjdG9yeS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWN0b3J5IGluaXRpYWxpemF0aW9uIGZhaWxlZCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbmV3IFZhdWx0KG1vY2tBcHAgYXMgYW55LCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBXYWl0IGZvciBhc3luYyBpbml0aWFsaXphdGlvblxyXG4gICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMCkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnNvbGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBkeW5hbWljIGNsYXNzZXM6JywgZXhwZWN0LmFueShFcnJvcikpO1xyXG4gICAgICAgICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnQ2xhc3MgbWFuYWdlbWVudCcsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGdldCBjbGFzcyBmcm9tIG5hbWUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIFZhdWx0LmNsYXNzZXMgPSB7IFRlc3RDbGFzc2U6IFRlc3RDbGFzc2UgfTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IENsYXNzZUZyb21OYW1lID0gdmF1bHQuZ2V0Q2xhc3NlRnJvbU5hbWUoJ1Rlc3RDbGFzc2UnKTtcclxuICAgICAgICAgICAgZXhwZWN0KENsYXNzZUZyb21OYW1lKS50b0JlKFRlc3RDbGFzc2UpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiB1bmRlZmluZWQgZm9yIG5vbi1leGlzdGVudCBjbGFzcycsICgpID0+IHtcclxuICAgICAgICAgICAgVmF1bHQuY2xhc3NlcyA9IHt9O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgQ2xhc3NlRnJvbU5hbWUgPSB2YXVsdC5nZXRDbGFzc2VGcm9tTmFtZSgnTm9uRXhpc3RlbnQnKTtcclxuICAgICAgICAgICAgZXhwZWN0KENsYXNzZUZyb21OYW1lKS50b0JlVW5kZWZpbmVkKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnTGluayByZWFkaW5nJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgcmVhZCB3aWtpbGluayBmaWxlIHdpdGggYWxpYXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhdWx0LnJlYWRMaW5rRmlsZSgnW1tmaWxlLm1kfERpc3BsYXkgTmFtZV1dJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ0Rpc3BsYXkgTmFtZScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJlYWQgd2lraWxpbmsgZmlsZSB3aXRob3V0IGFsaWFzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB2YXVsdC5yZWFkTGlua0ZpbGUoJ1tbZm9sZGVyL2ZpbGUubWRdXScpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdmaWxlJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmVhZCB3aWtpbGluayBmaWxlIHdpdGggcGF0aCB3aGVuIHBhdGg9dHJ1ZScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmF1bHQucmVhZExpbmtGaWxlKCdbW2ZvbGRlci9maWxlXV0nLCB0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnZm9sZGVyL2ZpbGUubWQnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZWFkIHdpa2lsaW5rIGZpbGUgd2l0aCBleHRlbnNpb24gd2hlbiBwYXRoPXRydWUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhdWx0LnJlYWRMaW5rRmlsZSgnW1tmb2xkZXIvZmlsZS5wZGZdXScsIHRydWUpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdmb2xkZXIvZmlsZS5wZGYnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbm9uLXdpa2lsaW5rIHN0cmluZ3MnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhdWx0LnJlYWRMaW5rRmlsZSgncmVndWxhciB0ZXh0Jyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ3JlZ3VsYXIgdGV4dCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBvciBudWxsIHN0cmluZ3MnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdCh2YXVsdC5yZWFkTGlua0ZpbGUoJycpKS50b0JlKCcnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHZhdWx0LnJlYWRMaW5rRmlsZShudWxsIGFzIGFueSkpLnRvQmUoJycpO1xyXG4gICAgICAgICAgICBleHBlY3QodmF1bHQucmVhZExpbmtGaWxlKHVuZGVmaW5lZCBhcyBhbnkpKS50b0JlKCcnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWFsZm9ybWVkIHdpa2lsaW5rcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmF1bHQucmVhZExpbmtGaWxlKCdbW2luY29tcGxldGUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnW1tpbmNvbXBsZXRlJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZ2V0RnJvbUxpbmsnLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbW9ja0ZpbGU6IElGaWxlID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAndGVzdC5tZCcsXHJcbiAgICAgICAgICAgIHBhdGg6ICdmb2xkZXIvdGVzdC5tZCcsXHJcbiAgICAgICAgICAgIGJhc2VuYW1lOiAndGVzdCcsXHJcbiAgICAgICAgICAgIGV4dGVuc2lvbjogJ21kJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICB2YXVsdC5jcmVhdGVDbGFzc2UgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobmV3IFRlc3RDbGFzc2UodmF1bHQpKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBnZXQgZmlsZSBieSBkaXJlY3QgcGF0aCBtYXRjaCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0FwcC5saXN0RmlsZXMubW9ja1Jlc29sdmVkVmFsdWUoW21vY2tGaWxlXSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YXVsdC5nZXRGcm9tTGluaygnW1tmb2xkZXIvdGVzdC5tZF1dJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgICAgICBleHBlY3QodmF1bHQuY3JlYXRlQ2xhc3NlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrRmlsZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgZ2V0IGZpbGUgZnJvbSBjYWNoZSBpZiBhbHJlYWR5IGV4aXN0cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY2FjaGVkQ2xhc3NlID0gbmV3IFRlc3RDbGFzc2UodmF1bHQpO1xyXG4gICAgICAgICAgICB2YXVsdC5maWxlc1snZm9sZGVyL3Rlc3QubWQnXSA9IGNhY2hlZENsYXNzZTtcclxuICAgICAgICAgICAgbW9ja0FwcC5saXN0RmlsZXMubW9ja1Jlc29sdmVkVmFsdWUoW21vY2tGaWxlXSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YXVsdC5nZXRGcm9tTGluaygnW1tmb2xkZXIvdGVzdC5tZF1dJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKGNhY2hlZENsYXNzZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh2YXVsdC5jcmVhdGVDbGFzc2UpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgZmluZCBmaWxlIGJ5IG5hbWUgd2hlbiBtdWx0aXBsZSBmaWxlcyBleGlzdCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZmlsZTEgPSB7IC4uLm1vY2tGaWxlLCBwYXRoOiAnZm9sZGVyMS90ZXN0Lm1kJyB9O1xyXG4gICAgICAgICAgICBjb25zdCBmaWxlMiA9IHsgLi4ubW9ja0ZpbGUsIHBhdGg6ICdmb2xkZXIyL3Rlc3QubWQnIH07XHJcbiAgICAgICAgICAgIG1vY2tBcHAubGlzdEZpbGVzLm1vY2tSZXNvbHZlZFZhbHVlKFtmaWxlMSwgZmlsZTJdKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhdWx0LmdldEZyb21MaW5rKCdbW2ZvbGRlcjIvdGVzdC5tZF1dJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QodmF1bHQuY3JlYXRlQ2xhc3NlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChmaWxlMik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGZpbGUgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBtb2NrQXBwLmxpc3RGaWxlcy5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YXVsdC5nZXRGcm9tTGluaygnW1tub25leGlzdGVudC5tZF1dJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBsaW5rJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YXVsdC5nZXRGcm9tTGluaygnJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHN1cHByZXNzIGxvZ2dpbmcgd2hlbiBsb2c9ZmFsc2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xyXG4gICAgICAgICAgICBtb2NrQXBwLmxpc3RGaWxlcy5tb2NrUmVzb2x2ZWRWYWx1ZShbXSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhd2FpdCB2YXVsdC5nZXRGcm9tTGluaygnW1tub25leGlzdGVudC5tZF1dJywgZmFsc2UpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnNvbGVTcHkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdnZXRNZWRpYUZyb21MaW5rJywgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1vY2tNZWRpYUZpbGU6IElGaWxlID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAnaW1hZ2UuanBnJyxcclxuICAgICAgICAgICAgcGF0aDogJ21lZGlhL2ltYWdlLmpwZycsXHJcbiAgICAgICAgICAgIGJhc2VuYW1lOiAnaW1hZ2UnLFxyXG4gICAgICAgICAgICBleHRlbnNpb246ICdqcGcnXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBnZXQgbWVkaWEgZmlsZSBieSBkaXJlY3QgcGF0aCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0FwcC5saXN0RmlsZXMubW9ja1Jlc29sdmVkVmFsdWUoW21vY2tNZWRpYUZpbGVdKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhdWx0LmdldE1lZGlhRnJvbUxpbmsoJ1tbbWVkaWEvaW1hZ2UuanBnXV0nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUobW9ja01lZGlhRmlsZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgZ2V0IG1lZGlhIGZpbGUgYnkgbmFtZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0FwcC5saXN0RmlsZXMubW9ja1Jlc29sdmVkVmFsdWUoW21vY2tNZWRpYUZpbGVdKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhdWx0LmdldE1lZGlhRnJvbUxpbmsoJ1tbaW1hZ2UuanBnXV0nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUobW9ja01lZGlhRmlsZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgZm9yIG5vbi1leGlzdGVudCBtZWRpYScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0FwcC5saXN0RmlsZXMubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmF1bHQuZ2V0TWVkaWFGcm9tTGluaygnW1tub25leGlzdGVudC5qcGddXScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjcmVhdGVDbGFzc2UnLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbW9ja0ZpbGU6IElGaWxlID0ge1xyXG4gICAgICAgICAgICBuYW1lOiAndGVzdC5tZCcsXHJcbiAgICAgICAgICAgIHBhdGg6ICdmb2xkZXIvdGVzdC5tZCcsXHJcbiAgICAgICAgICAgIGJhc2VuYW1lOiAndGVzdCcsXHJcbiAgICAgICAgICAgIGV4dGVuc2lvbjogJ21kJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICBtb2NrQXBwLmdldE1ldGFEYXRhRnJvbVBhdGggPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIG1vY2tBcHAud2FpdEZvckZpbGVNZXRhRGF0YVVwZGF0ZSA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oXHJcbiAgICAgICAgICAgICAgICAoZmlsZVBhdGg6IHN0cmluZywga2V5OiBzdHJpbmcsIGNhbGxiYWNrOiAoKSA9PiBQcm9taXNlPHZvaWQ+KSA9PiBjYWxsYmFjaygpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIFZhdWx0LmNsYXNzZXMgPSB7IFRlc3RDbGFzc2U6IFRlc3RDbGFzc2UgfTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgY2xhc3NlIHdpdGggZHluYW1pYyBmYWN0b3J5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBtb2NrQXBwLmdldE1ldGFEYXRhRnJvbVBhdGgubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgIGZyb250bWF0dGVyOiB7IENsYXNzZTogJ1Rlc3RDbGFzc2UnIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBtb2NrRHluYW1pY0ZhY3RvcnkuZ2V0Q2xhc3MubW9ja1Jlc29sdmVkVmFsdWUoVGVzdENsYXNzZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YXVsdC5jcmVhdGVDbGFzc2UobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZUluc3RhbmNlT2YoVGVzdENsYXNzZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrRHluYW1pY0ZhY3RvcnkuZ2V0Q2xhc3MpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdUZXN0Q2xhc3NlJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgZmFsbGJhY2sgdG8gc3RhdGljIGNsYXNzZXMgd2hlbiBkeW5hbWljIGZhY3RvcnkgZmFpbHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIG1vY2tBcHAuZ2V0TWV0YURhdGFGcm9tUGF0aC5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgZnJvbnRtYXR0ZXI6IHsgQ2xhc3NlOiAnVGVzdENsYXNzZScgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG1vY2tEeW5hbWljRmFjdG9yeS5nZXRDbGFzcy5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0R5bmFtaWMgY2xhc3MgbG9hZGluZyBmYWlsZWQnKSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YXVsdC5jcmVhdGVDbGFzc2UobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZUluc3RhbmNlT2YoVGVzdENsYXNzZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igd2hlbiBubyBtZXRhZGF0YSBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0FwcC5nZXRNZXRhRGF0YUZyb21QYXRoLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGF3YWl0IGV4cGVjdCh2YXVsdC5jcmVhdGVDbGFzc2UobW9ja0ZpbGUpKS5yZWplY3RzLnRvVGhyb3coJ03DqXRhZG9ubsOpZXMgbm9uIHRyb3V2w6llcyBwb3VyIGxlIGZpY2hpZXInKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIG5vIENsYXNzZSBwcm9wZXJ0eSBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0FwcC5nZXRNZXRhRGF0YUZyb21QYXRoLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICBmcm9udG1hdHRlcjogeyBvdGhlclByb3BlcnR5OiAndmFsdWUnIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QodmF1bHQuY3JlYXRlQ2xhc3NlKG1vY2tGaWxlKSkucmVqZWN0cy50b1Rocm93KCdQcm9wcmnDqXTDqSBDbGFzc2Ugbm9uIHRyb3V2w6llIGRhbnMgbGVzIG3DqXRhZG9ubsOpZXMnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIGNsYXNzIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0FwcC5nZXRNZXRhRGF0YUZyb21QYXRoLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICBmcm9udG1hdHRlcjogeyBDbGFzc2U6ICdVbmtub3duQ2xhc3NlJyB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9ja0R5bmFtaWNGYWN0b3J5LmdldENsYXNzLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICBWYXVsdC5jbGFzc2VzID0ge307XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QodmF1bHQuY3JlYXRlQ2xhc3NlKG1vY2tGaWxlKSkucmVqZWN0cy50b1Rocm93KCdDbGFzc2UgVW5rbm93bkNsYXNzZSBub24gdHJvdXbDqWUnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdFcnJvciBoYW5kbGluZyBhbmQgZWRnZSBjYXNlcycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBhcHAgbWV0aG9kcyB0aGF0IHRocm93IGVycm9ycycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0FwcC5saXN0RmlsZXMubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdGaWxlIHN5c3RlbSBlcnJvcicpKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGF3YWl0IGV4cGVjdCh2YXVsdC5nZXRGcm9tTGluaygnW1t0ZXN0Lm1kXV0nKSkucmVqZWN0cy50b1Rocm93KCdGaWxlIHN5c3RlbSBlcnJvcicpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgbWV0YWRhdGEnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGaWxlOiBJRmlsZSA9IHtcclxuICAgICAgICAgICAgICAgIG5hbWU6ICd0ZXN0Lm1kJyxcclxuICAgICAgICAgICAgICAgIHBhdGg6ICd0ZXN0Lm1kJyxcclxuICAgICAgICAgICAgICAgIGJhc2VuYW1lOiAndGVzdCcsXHJcbiAgICAgICAgICAgICAgICBleHRlbnNpb246ICdtZCdcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIG1vY2tBcHAuZ2V0TWV0YURhdGFGcm9tUGF0aC5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgZnJvbnRtYXR0ZXI6IG51bGxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QodmF1bHQuY3JlYXRlQ2xhc3NlKG1vY2tGaWxlKSkucmVqZWN0cy50b1Rocm93KCdQcm9wcmnDqXTDqSBDbGFzc2Ugbm9uIHRyb3V2w6llIGRhbnMgbGVzIG3DqXRhZG9ubsOpZXMnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgdmVyeSBsb25nIGZpbGUgcGF0aHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxvbmdQYXRoID0gJ2EvJy5yZXBlYXQoMTAwKSArICdmaWxlLm1kJztcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmF1bHQucmVhZExpbmtGaWxlKGBbWyR7bG9uZ1BhdGh9XV1gLCB0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShsb25nUGF0aCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHNwZWNpYWwgY2hhcmFjdGVycyBpbiBmaWxlIG5hbWVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzcGVjaWFsTmFtZSA9ICdmaWxlQCMkJV4mKigpXyt7fXw6PD4/Lm1kJztcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmF1bHQucmVhZExpbmtGaWxlKGBbWyR7c3BlY2lhbE5hbWV9XV1gLCB0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShzcGVjaWFsTmFtZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHVuaWNvZGUgY2hhcmFjdGVycycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdW5pY29kZU5hbWUgPSAn5rWL6K+V5paH5Lu2Lm1kJztcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdmF1bHQucmVhZExpbmtGaWxlKGBbWyR7dW5pY29kZU5hbWV9XV1gLCB0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh1bmljb2RlTmFtZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnU3RhdGljIHByb3BlcnRpZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIHN0YXRpYyBjbGFzc2VzIHByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoVmF1bHQuY2xhc3NlcykudG9CZURlZmluZWQoKTtcclxuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBWYXVsdC5jbGFzc2VzKS50b0JlKCdvYmplY3QnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgc3RhdGljIGNsYXNzZXMgYmVpbmcgdW5kZWZpbmVkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBvcmlnaW5hbENsYXNzZXMgPSBWYXVsdC5jbGFzc2VzO1xyXG4gICAgICAgICAgICBWYXVsdC5jbGFzc2VzID0gdW5kZWZpbmVkIGFzIGFueTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHZhdWx0LmdldENsYXNzZUZyb21OYW1lKCdUZXN0Q2xhc3NlJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVVbmRlZmluZWQoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFZhdWx0LmNsYXNzZXMgPSBvcmlnaW5hbENsYXNzZXM7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnUGVyZm9ybWFuY2UgYW5kIG1lbW9yeScsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNhY2hlIGNyZWF0ZWQgY2xhc3NlcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja0ZpbGU6IElGaWxlID0ge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogJ3Rlc3QubWQnLFxyXG4gICAgICAgICAgICAgICAgcGF0aDogJ3Rlc3QubWQnLFxyXG4gICAgICAgICAgICAgICAgYmFzZW5hbWU6ICd0ZXN0JyxcclxuICAgICAgICAgICAgICAgIGV4dGVuc2lvbjogJ21kJ1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgbW9ja0FwcC5saXN0RmlsZXMubW9ja1Jlc29sdmVkVmFsdWUoW21vY2tGaWxlXSk7XHJcbiAgICAgICAgICAgIHZhdWx0LmNyZWF0ZUNsYXNzZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShuZXcgVGVzdENsYXNzZSh2YXVsdCkpO1xyXG5cclxuICAgICAgICAgICAgLy8gRmlyc3QgY2FsbCBzaG91bGQgY3JlYXRlIGFuZCBjYWNoZVxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQxID0gYXdhaXQgdmF1bHQuZ2V0RnJvbUxpbmsoJ1tbdGVzdC5tZF1dJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTZWNvbmQgY2FsbCBzaG91bGQgdXNlIGNhY2hlXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDIgPSBhd2FpdCB2YXVsdC5nZXRGcm9tTGluaygnW1t0ZXN0Lm1kXV0nKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdCh2YXVsdC5jcmVhdGVDbGFzc2UpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdDEpLnRvQmUocmVzdWx0Mik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGxhcmdlIG51bWJlcnMgb2YgZmlsZXMgZWZmaWNpZW50bHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1hbnlGaWxlczogSUZpbGVbXSA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgbWFueUZpbGVzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGBmaWxlJHtpfS5tZGAsXHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogYGZvbGRlci9maWxlJHtpfS5tZGAsXHJcbiAgICAgICAgICAgICAgICAgICAgYmFzZW5hbWU6IGBmaWxlJHtpfWAsXHJcbiAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uOiAnbWQnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbW9ja0FwcC5saXN0RmlsZXMubW9ja1Jlc29sdmVkVmFsdWUobWFueUZpbGVzKTtcclxuICAgICAgICAgICAgdmF1bHQuY3JlYXRlQ2xhc3NlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG5ldyBUZXN0Q2xhc3NlKHZhdWx0KSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YXVsdC5nZXRGcm9tTGluaygnW1tmaWxlNTAwLm1kXV0nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh2YXVsdC5jcmVhdGVDbGFzc2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1hbnlGaWxlc1s1MDBdKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=