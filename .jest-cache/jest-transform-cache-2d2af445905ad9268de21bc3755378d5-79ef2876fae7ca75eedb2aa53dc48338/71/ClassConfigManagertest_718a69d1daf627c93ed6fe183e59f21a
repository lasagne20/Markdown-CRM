f5d9453a110268820c241f7fa83c17c4
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock ConfigLoader
jest.mock('../../src/Config/ConfigLoader');
const ClassConfigManager_1 = require("../../src/Config/ClassConfigManager");
const ConfigLoader_1 = require("../../src/Config/ConfigLoader");
describe('ClassConfigManager', () => {
    let configManager;
    let mockConfigLoader;
    let mockApp;
    beforeEach(() => {
        jest.clearAllMocks();
        mockApp = {
            getVaultPath: jest.fn(() => '/test/vault'),
            getName: jest.fn(() => 'TestVault')
        };
        // Create mock config loader with correct methods
        mockConfigLoader = {
            loadClassConfig: jest.fn(),
            getAllClassNames: jest.fn()
        };
        // Mock the constructor
        ConfigLoader_1.ConfigLoader.mockImplementation(() => mockConfigLoader);
        configManager = new ClassConfigManager_1.ClassConfigManager('./test-config', mockApp);
    });
    describe('constructor', () => {
        it('should create instance with config loader', () => {
            expect(ConfigLoader_1.ConfigLoader).toHaveBeenCalledWith('./test-config', mockApp);
        });
    });
    describe('createDynamicClasse', () => {
        it('should create dynamic class from config', async () => {
            const mockConfig = {
                className: 'TestClass',
                classIcon: 'test-icon',
                properties: {},
                displayContainer: {
                    template: 'default',
                    components: []
                }
            };
            mockConfigLoader.loadClassConfig.mockResolvedValue(mockConfig);
            const DynamicClass = await configManager.createDynamicClasse('TestClass');
            expect(mockConfigLoader.loadClassConfig).toHaveBeenCalledWith('TestClass');
            expect(DynamicClass).toBeDefined();
            // Test instance creation
            const mockVault = { app: mockApp };
            const mockFile = { path: 'test.md' };
            const instance = new DynamicClass(mockVault, mockFile);
            expect(instance.name).toBe('TestClass');
            expect(instance.icon).toBe('test-icon');
        });
        it('should return cached class if already loaded', async () => {
            const mockConfig = {
                className: 'TestClass',
                classIcon: 'test-icon',
                properties: {},
                displayContainer: {
                    template: 'default',
                    components: []
                }
            };
            mockConfigLoader.loadClassConfig.mockResolvedValue(mockConfig);
            // First call
            const firstClass = await configManager.createDynamicClasse('TestClass');
            // Second call - should return cached version
            jest.clearAllMocks();
            const secondClass = await configManager.createDynamicClasse('TestClass');
            expect(firstClass).toBe(secondClass);
            expect(mockConfigLoader.loadClassConfig).not.toHaveBeenCalled();
        });
        it('should handle config loading errors', async () => {
            const error = new Error('Config not found');
            mockConfigLoader.loadClassConfig.mockRejectedValue(error);
            await expect(configManager.createDynamicClasse('NonExistentClass'))
                .rejects.toThrow('Config not found');
        });
    });
    describe('getClassConfig', () => {
        it('should delegate to config loader', async () => {
            const mockConfig = {
                className: 'TestClass',
                classIcon: 'test-icon',
                properties: {},
                displayContainer: { template: 'default' }
            };
            mockConfigLoader.loadClassConfig.mockResolvedValue(mockConfig);
            const result = await configManager.getClassConfig('TestClass');
            expect(mockConfigLoader.loadClassConfig).toHaveBeenCalledWith('TestClass');
            expect(result).toBe(mockConfig);
        });
    });
    describe('getAvailableClasses', () => {
        it('should call getAllClassNames method', async () => {
            // Mock the getAllClassNames method on configLoader
            mockConfigLoader.getAllClassNames = jest.fn().mockResolvedValue(['TestClass']);
            const result = await configManager.getAvailableClasses();
            expect(result).toEqual(['TestClass']);
        });
    });
    describe('clearCache', () => {
        it('should clear loaded classes cache', () => {
            // Add something to cache first
            configManager.loadedClasses.set('TestClass', class {
            });
            expect(configManager.loadedClasses.size).toBe(1);
            configManager.clearCache();
            expect(configManager.loadedClasses.size).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXENvbmZpZ1xcQ2xhc3NDb25maWdNYW5hZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFHQSxvQkFBb0I7QUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0FBSjNDLDRFQUF5RTtBQUN6RSxnRUFBNkQ7QUFLN0QsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNoQyxJQUFJLGFBQWlDLENBQUM7SUFDdEMsSUFBSSxnQkFBMkMsQ0FBQztJQUNoRCxJQUFJLE9BQVksQ0FBQztJQUVqQixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ1osSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLE9BQU8sR0FBRztZQUNOLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLGFBQWEsQ0FBQztZQUMxQyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUM7U0FDdEMsQ0FBQztRQUVGLGlEQUFpRDtRQUNqRCxnQkFBZ0IsR0FBRztZQUNmLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzFCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDdkIsQ0FBQztRQUVULHVCQUF1QjtRQUN0QiwyQkFBc0QsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBRW5HLGFBQWEsR0FBRyxJQUFJLHVDQUFrQixDQUFDLGVBQWUsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNyRSxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQ3pCLEVBQUUsQ0FBQywyQ0FBMkMsRUFBRSxH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Q0FBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUU7WUFDekMsK0JBQStCO1lBQzlCLGFBQXFCLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUU7YUFBUSxDQUFDLENBQUM7WUFFaEUsTUFBTSxDQUFFLGFBQXFCLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUUxRCxhQUFhLENBQUMsVUFBVSxFQUFFLENBQUM7WUFFM0IsTUFBTSxDQUFFLGFBQXFCLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5RCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXENvbmZpZ1xcQ2xhc3NDb25maWdNYW5hZ2VyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2xhc3NDb25maWdNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vc3JjL0NvbmZpZy9DbGFzc0NvbmZpZ01hbmFnZXInO1xyXG5pbXBvcnQgeyBDb25maWdMb2FkZXIgfSBmcm9tICcuLi8uLi9zcmMvQ29uZmlnL0NvbmZpZ0xvYWRlcic7XHJcblxyXG4vLyBNb2NrIENvbmZpZ0xvYWRlclxyXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9Db25maWcvQ29uZmlnTG9hZGVyJyk7XHJcblxyXG5kZXNjcmliZSgnQ2xhc3NDb25maWdNYW5hZ2VyJywgKCkgPT4ge1xyXG4gICAgbGV0IGNvbmZpZ01hbmFnZXI6IENsYXNzQ29uZmlnTWFuYWdlcjtcclxuICAgIGxldCBtb2NrQ29uZmlnTG9hZGVyOiBqZXN0Lk1vY2tlZDxDb25maWdMb2FkZXI+O1xyXG4gICAgbGV0IG1vY2tBcHA6IGFueTtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgICAgICBcclxuICAgICAgICBtb2NrQXBwID0ge1xyXG4gICAgICAgICAgICBnZXRWYXVsdFBhdGg6IGplc3QuZm4oKCkgPT4gJy90ZXN0L3ZhdWx0JyksXHJcbiAgICAgICAgICAgIGdldE5hbWU6IGplc3QuZm4oKCkgPT4gJ1Rlc3RWYXVsdCcpXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIG1vY2sgY29uZmlnIGxvYWRlciB3aXRoIGNvcnJlY3QgbWV0aG9kc1xyXG4gICAgICAgIG1vY2tDb25maWdMb2FkZXIgPSB7XHJcbiAgICAgICAgICAgIGxvYWRDbGFzc0NvbmZpZzogamVzdC5mbigpLFxyXG4gICAgICAgICAgICBnZXRBbGxDbGFzc05hbWVzOiBqZXN0LmZuKClcclxuICAgICAgICB9IGFzIGFueTtcclxuXHJcbiAgICAgICAgLy8gTW9jayB0aGUgY29uc3RydWN0b3JcclxuICAgICAgICAoQ29uZmlnTG9hZGVyIGFzIGplc3QuTW9ja2VkQ2xhc3M8dHlwZW9mIENvbmZpZ0xvYWRlcj4pLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBtb2NrQ29uZmlnTG9hZGVyKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25maWdNYW5hZ2VyID0gbmV3IENsYXNzQ29uZmlnTWFuYWdlcignLi90ZXN0LWNvbmZpZycsIG1vY2tBcHApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NvbnN0cnVjdG9yJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGluc3RhbmNlIHdpdGggY29uZmlnIGxvYWRlcicsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KENvbmZpZ0xvYWRlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy4vdGVzdC1jb25maWcnLCBtb2NrQXBwKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjcmVhdGVEeW5hbWljQ2xhc3NlJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGR5bmFtaWMgY2xhc3MgZnJvbSBjb25maWcnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tDb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdUZXN0Q2xhc3MnLFxyXG4gICAgICAgICAgICAgICAgY2xhc3NJY29uOiAndGVzdC1pY29uJyxcclxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9LFxyXG4gICAgICAgICAgICAgICAgZGlzcGxheUNvbnRhaW5lcjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnZGVmYXVsdCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50czogW11cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIG1vY2tDb25maWdMb2FkZXIubG9hZENsYXNzQ29uZmlnLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb25maWcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgRHluYW1pY0NsYXNzID0gYXdhaXQgY29uZmlnTWFuYWdlci5jcmVhdGVEeW5hbWljQ2xhc3NlKCdUZXN0Q2xhc3MnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrQ29uZmlnTG9hZGVyLmxvYWRDbGFzc0NvbmZpZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1Rlc3RDbGFzcycpO1xyXG4gICAgICAgICAgICBleHBlY3QoRHluYW1pY0NsYXNzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVGVzdCBpbnN0YW5jZSBjcmVhdGlvblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7IGFwcDogbW9ja0FwcCB9IGFzIGFueTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja0ZpbGUgPSB7IHBhdGg6ICd0ZXN0Lm1kJyB9IGFzIGFueTtcclxuICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBuZXcgRHluYW1pY0NsYXNzKG1vY2tWYXVsdCwgbW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGluc3RhbmNlLm5hbWUpLnRvQmUoJ1Rlc3RDbGFzcycpO1xyXG4gICAgICAgICAgICBleHBlY3QoaW5zdGFuY2UuaWNvbikudG9CZSgndGVzdC1pY29uJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGNhY2hlZCBjbGFzcyBpZiBhbHJlYWR5IGxvYWRlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja0NvbmZpZyA9IHtcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ1Rlc3RDbGFzcycsXHJcbiAgICAgICAgICAgICAgICBjbGFzc0ljb246ICd0ZXN0LWljb24nLFxyXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczoge30sXHJcbiAgICAgICAgICAgICAgICBkaXNwbGF5Q29udGFpbmVyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdkZWZhdWx0JyxcclxuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRzOiBbXVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgbW9ja0NvbmZpZ0xvYWRlci5sb2FkQ2xhc3NDb25maWcubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbmZpZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBGaXJzdCBjYWxsXHJcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0Q2xhc3MgPSBhd2FpdCBjb25maWdNYW5hZ2VyLmNyZWF0ZUR5bmFtaWNDbGFzc2UoJ1Rlc3RDbGFzcycpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gU2Vjb25kIGNhbGwgLSBzaG91bGQgcmV0dXJuIGNhY2hlZCB2ZXJzaW9uXHJcbiAgICAgICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgICAgICAgICBjb25zdCBzZWNvbmRDbGFzcyA9IGF3YWl0IGNvbmZpZ01hbmFnZXIuY3JlYXRlRHluYW1pY0NsYXNzZSgnVGVzdENsYXNzJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoZmlyc3RDbGFzcykudG9CZShzZWNvbmRDbGFzcyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrQ29uZmlnTG9hZGVyLmxvYWRDbGFzc0NvbmZpZykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uZmlnIGxvYWRpbmcgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignQ29uZmlnIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgICAgICBtb2NrQ29uZmlnTG9hZGVyLmxvYWRDbGFzc0NvbmZpZy5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBhd2FpdCBleHBlY3QoY29uZmlnTWFuYWdlci5jcmVhdGVEeW5hbWljQ2xhc3NlKCdOb25FeGlzdGVudENsYXNzJykpXHJcbiAgICAgICAgICAgICAgICAucmVqZWN0cy50b1Rocm93KCdDb25maWcgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZ2V0Q2xhc3NDb25maWcnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBkZWxlZ2F0ZSB0byBjb25maWcgbG9hZGVyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrQ29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnVGVzdENsYXNzJyxcclxuICAgICAgICAgICAgICAgIGNsYXNzSWNvbjogJ3Rlc3QtaWNvbicsXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7fSxcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlDb250YWluZXI6IHsgdGVtcGxhdGU6ICdkZWZhdWx0JyB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrQ29uZmlnTG9hZGVyLmxvYWRDbGFzc0NvbmZpZy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29uZmlnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbmZpZ01hbmFnZXIuZ2V0Q2xhc3NDb25maWcoJ1Rlc3RDbGFzcycpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tDb25maWdMb2FkZXIubG9hZENsYXNzQ29uZmlnKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnVGVzdENsYXNzJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUobW9ja0NvbmZpZyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZ2V0QXZhaWxhYmxlQ2xhc3NlcycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNhbGwgZ2V0QWxsQ2xhc3NOYW1lcyBtZXRob2QnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIE1vY2sgdGhlIGdldEFsbENsYXNzTmFtZXMgbWV0aG9kIG9uIGNvbmZpZ0xvYWRlclxyXG4gICAgICAgICAgICAobW9ja0NvbmZpZ0xvYWRlciBhcyBhbnkpLmdldEFsbENsYXNzTmFtZXMgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoWydUZXN0Q2xhc3MnXSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb25maWdNYW5hZ2VyLmdldEF2YWlsYWJsZUNsYXNzZXMoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoWydUZXN0Q2xhc3MnXSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY2xlYXJDYWNoZScsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNsZWFyIGxvYWRlZCBjbGFzc2VzIGNhY2hlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAvLyBBZGQgc29tZXRoaW5nIHRvIGNhY2hlIGZpcnN0XHJcbiAgICAgICAgICAgIChjb25maWdNYW5hZ2VyIGFzIGFueSkubG9hZGVkQ2xhc3Nlcy5zZXQoJ1Rlc3RDbGFzcycsIGNsYXNzIHt9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdCgoY29uZmlnTWFuYWdlciBhcyBhbnkpLmxvYWRlZENsYXNzZXMuc2l6ZSkudG9CZSgxKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbmZpZ01hbmFnZXIuY2xlYXJDYWNoZSgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KChjb25maWdNYW5hZ2VyIGFzIGFueSkubG9hZGVkQ2xhc3Nlcy5zaXplKS50b0JlKDApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==