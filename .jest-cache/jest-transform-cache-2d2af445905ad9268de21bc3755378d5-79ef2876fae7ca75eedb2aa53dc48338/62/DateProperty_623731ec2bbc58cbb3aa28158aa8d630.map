{"file":"C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\properties\\DateProperty.ts","mappings":"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","names":[],"sources":["C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\properties\\DateProperty.ts"],"sourcesContent":["import flatpickr from \"flatpickr\";\r\nimport { French } from \"flatpickr/dist/l10n/fr.js\";\r\nimport { setIcon } from \"../vault/Utils\";\r\nimport { Property } from \"./Property\";\r\n\r\nconst iconMap : {[key: string] : string}= { \r\n    \"yesterday\" : \"calendar-arrow-down\",\r\n    \"today\" : \"calendar-check\",\r\n    \"tomorrow\" : \"calendar-arrow-up\",\r\n    \"next-week\" : \"calendar-clock\"\r\n}\r\n\r\nexport class DateProperty extends Property {\r\n\r\n    private quickSelectIcons: string[];\r\n    public override type : string = \"date\";\r\n\r\n    constructor(name: string, quickSelectIcons: string[], args = {}) {\r\n        super(name, args);\r\n        this.quickSelectIcons = quickSelectIcons\r\n        \r\n    }\r\n\r\n\r\n    // Crée l'affichage du champ date\r\n    override fillDisplay(vault : any, value : any, update: (value: string) => Promise<void>) {\r\n        this.vault = vault;\r\n        const fieldContainer = document.createElement(\"div\");\r\n        fieldContainer.classList.add(\"field-container-column\");\r\n\r\n        const field = document.createElement(\"div\");\r\n        field.classList.add(\"metadata-field\");\r\n        const dateContainer = this.createFieldContainerContent(update, value);\r\n        field.appendChild(dateContainer);\r\n\r\n        if (this.title) {\r\n            const header = document.createElement(\"div\");\r\n            header.classList.add(\"metadata-header\");\r\n            header.textContent = this.name\r\n            fieldContainer.appendChild(header);\r\n        }\r\n        \r\n        fieldContainer.appendChild(field);\r\n\r\n        return fieldContainer;\r\n    }\r\n\r\n\r\n    // Crée un champ d'input pour la date\r\n    createFieldDate(value: string, update: (value: string) => Promise<void>, link: HTMLDivElement) {\r\n        const input = document.createElement(\"input\");\r\n        input.type = \"text\";\r\n        input.value = value || \"\";  // Formaté en \"YYYY-MM-DD\" pour le stockage\r\n        input.classList.add(\"field-input\");\r\n    \r\n        flatpickr(input, {\r\n            dateFormat: \"Y-m-d\",  // Stocker en \"YYYY-MM-DD\"\r\n            defaultDate: value || \"\",\r\n            locale: French,\r\n            onChange: async (selectedDates: Date[]) => {\r\n                const selectedDate = selectedDates[0];\r\n                if (selectedDate) {\r\n                    // Met à jour la valeur de l'input avec le format \"YYYY-MM-DD\"\r\n                    input.value = this.formatDateForStorage(selectedDate);\r\n                    await this.updateField(update, input, link)\r\n                }\r\n            },\r\n            onClose : async () => {\r\n                input.value = \"\"\r\n                await this.updateField(update, input, link)\r\n            }\r\n        });\r\n        return input;\r\n    }\r\n    \r\n    // Crée un lien qui affiche la date (au format \"26 février 2025\")\r\n    override createFieldLink(value: string) {\r\n        const link = document.createElement(\"div\");\r\n        link.textContent = value ? this.formatDateForDisplay(value) : \"Aucune date sélectionnée\";\r\n        link.classList.add(\"date-field-link\");\r\n        link.classList.add(\"field-link\");\r\n        link.style.cursor = \"pointer\";\r\n        link.onclick = (event) => this.modifyField(event);\r\n        return link;\r\n    }\r\n\r\n    // Formate la date pour l'affichage : \"26 février 2025\"\r\n    formatDateForDisplay(date: string): string {\r\n        const parsedDate = new Date(date);\r\n        return parsedDate.toLocaleDateString(\"fr-FR\", { \r\n            day: \"numeric\", \r\n            month: \"long\", \r\n            year: \"numeric\" \r\n        });\r\n    }\r\n\r\n    // Formate la date pour le stockage : \"YYYY-MM-DD\"\r\n    formatDateForStorage(date: Date): string {\r\n        // Use toISOString to avoid timezone issues, then extract date part\r\n        return date.toISOString().split('T')[0];\r\n    }\r\n    \r\n    // Ajoute les options \"Aujourd'hui\", \"Demain\", \"Semaine prochaine\"\r\n    createQuickSelect(value: string, update: (value: string) => Promise<void>, link: HTMLElement, input: HTMLInputElement) {\r\n        const quickSelectContainer = document.createElement(\"div\");\r\n        quickSelectContainer.classList.add(\"quick-select-container\");\r\n\r\n        this.quickSelectIcons.forEach(option => {\r\n            const button = document.createElement(\"button\");\r\n            setIcon(button, iconMap[option]);\r\n            \r\n            button.addEventListener(\"click\", async () => {\r\n                const date = this.getDateForOption(option);  // Obtenir la date pour l'option choisie\r\n                await update(this.formatDateForStorage(date));\r\n                link.textContent = this.formatDateForDisplay(this.formatDateForStorage(date));\r\n                link.style.display = \"block\";\r\n                input.style.display = \"none\";\r\n            }); \r\n    \r\n            quickSelectContainer.appendChild(button);\r\n        });\r\n\r\n        return quickSelectContainer;\r\n    }\r\n\r\n    override getDefaultValue() {\r\n        return this.formatDateForStorage(this.getDateForOption(this.default))\r\n    }\r\n\r\n    getDateForOption(option: string): Date {\r\n        const today = new Date();\r\n        switch(option) {\r\n            case \"yesterday\": {\r\n                const yesterday = new Date(today);\r\n                yesterday.setDate(today.getDate() - 1);\r\n                return yesterday;\r\n            }\r\n            case \"today\": return new Date(today);\r\n            case \"tomorrow\": {\r\n                const tomorrow = new Date(today);\r\n                tomorrow.setDate(today.getDate() + 1);\r\n                return tomorrow;\r\n            }\r\n            case \"next-week\": {\r\n                const nextWeek = new Date(today);\r\n                nextWeek.setDate(today.getDate() + 7);\r\n                return nextWeek;\r\n            }\r\n            case \"2-week\": {\r\n                const twoWeeks = new Date(today);\r\n                twoWeeks.setDate(today.getDate() + 14);\r\n                return twoWeeks;\r\n            }\r\n            default: return new Date(today);\r\n        }\r\n    }\r\n\r\n    // Crée un conteneur pour afficher la date et la sélection rapide\r\n    override createFieldContainerContent(update: (value: string) => Promise<void>, value: string): HTMLDivElement {\r\n        const fieldContainer = document.createElement(\"div\");\r\n        fieldContainer.classList.add(\"field-container\");\r\n        fieldContainer.classList.add(\"metadata-field\");\r\n\r\n        const currentField = value;\r\n        const link = this.createFieldLink(currentField);\r\n        const input = this.createFieldDate(currentField, update, link);\r\n        \r\n\r\n        // Affichage initial : Si la date existe, afficher le lien\r\n        if (currentField && this.validate(value)) {\r\n            link.style.display = \"block\";\r\n            input.style.display = \"none\";\r\n        } else {\r\n            input.style.display = \"block\";\r\n            link.style.display = \"none\";\r\n        }\r\n\r\n        // Créer un conteneur avec les boutons de sélection rapide\r\n        const quickSelectContainer = this.createQuickSelect(currentField, update, link, input);\r\n\r\n        fieldContainer.appendChild(link);\r\n        fieldContainer.appendChild(input);\r\n        fieldContainer.appendChild(quickSelectContainer);\r\n        \r\n\r\n        return fieldContainer;\r\n    }\r\n\r\n    // Met à jour la valeur de la date et bascule l'affichage entre le lien et l'input\r\n    override async updateField(update: (value: string) => Promise<void>, input: HTMLInputElement, link: HTMLElement) {\r\n        let value = this.validate(input.value);\r\n        if (value) {\r\n            await update(value);  // Met à jour avec la date au format \"YYYY-MM-DD\"\r\n            input.style.display = \"none\";\r\n            link.textContent = this.formatDateForDisplay(value);  // Affichage avec le mois en lettres\r\n            link.style.display = \"block\";\r\n        } else {\r\n            await update(input.value);\r\n        }\r\n    }\r\n\r\n\r\n}\r\n"],"version":3}