4f49ee0ba22462721c5a90c97c5a80e8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock des dépendances
jest.mock('../../src/vault/Classe');
jest.mock('../../src/vault/Vault');
const FormulaProperty_1 = require("../../src/properties/FormulaProperty");
describe('FormulaProperty', () => {
    let formulaProperty;
    let mockFile;
    let mockVault;
    beforeEach(() => {
        // Configuration des mocks
        mockVault = {
            app: {
                vault: {
                    getName: jest.fn().mockReturnValue('TestVault')
                },
                setIcon: jest.fn((element, iconName) => {
                    element.setAttribute('data-icon', iconName);
                    element.textContent = `[${iconName}]`;
                })
            },
            readLinkFile: jest.fn()
        };
        mockFile = {
            vault: mockVault,
            getName: jest.fn(),
            getAllProperties: jest.fn(),
            getMetadataValue: jest.fn(),
            updateMetadata: jest.fn()
        };
        // Reset des mocks
        jest.clearAllMocks();
    });
    describe('Constructor', () => {
        test('should create formula property with default arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', mockVault, '1 + 1');
            expect(formulaProperty.name).toBe('testFormula');
            expect(formulaProperty.formula).toBe('1 + 1');
            expect(formulaProperty.type).toBe('formula');
            expect(formulaProperty.write).toBe(false);
            expect(formulaProperty.static).toBe(true);
        });
        test('should create formula property with custom arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', mockVault, '2 * 3', {
                icon: 'calculator',
                static: false,
                write: true
            });
            expect(formulaProperty.name).toBe('testFormula');
            expect(formulaProperty.formula).toBe('2 * 3');
            expect(formulaProperty.type).toBe('formula');
            expect(formulaProperty.write).toBe(true);
            expect(formulaProperty.static).toBe(false);
            expect(formulaProperty.icon).toBe('calculator');
        });
        test('should handle partial arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', mockVault, 'x + y', {
                icon: 'math',
                write: true
                // static will use default value from FormulaProperty constructor (true)
            });
            expect(formulaProperty.write).toBe(true);
            // La valeur sera false car LinkProperty n'override pas le default de Property
            expect(formulaProperty.static).toBe(false);
            expect(formulaProperty.icon).toBe('math');
        });
    });
    describe('validate', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', mockVault, '1 + 1');
        });
        test('should return input value unchanged', () => {
            expect(formulaProperty.validate('test')).toBe('test');
            expect(formulaProperty.validate('123')).toBe('123');
            expect(formulaProperty.validate('')).toBe('');
        });
    });
    describe('read', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('totalFormula', mockVault, 'price * quantity');
            // Mock des propriétés du fichier
            mockFile.getAllProperties.mockReturnValue({
                price: { name: 'price' },
                quantity: { name: 'quantity' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getName.mockReturnValue('TestFile');
        });
        test('should execute simple arithmetic formula', () => {
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 10;
                if (key === 'quantity')
                    return 5;
                return null;
            });
            const result = formulaProperty.read(mockFile);
            expect(result).toBe(50);
        });
        test('should handle formula with return statement', () => {
            const formulaWithReturn = new FormulaProperty_1.FormulaProperty('test', mockVault, 'return price + quantity');
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 15;
                if (key === 'quantity')
                    return 25;
                return null;
            });
            const result = formulaWithReturn.read(mockFile);
            expect(result).toBe(40);
        });
        test('should sanitize property names (remove spaces)', () => {
            mockFile.getAllProperties.mockReturnValue({
                'unit price': { name: 'unit price' },
                'item count': { name: 'item count' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'unit price')
                    return 12;
                if (key === 'item count')
                    return 3;
                return null;
            });
            const sanitizedFormula = new FormulaProperty_1.FormulaProperty('test', mockVault, 'unitprice * itemcount');
            const result = sanitizedFormula.read(mockFile);
            expect(result).toBe(36);
        });
        test('should exclude self property from formula context', () => {
            mockFile.getAllProperties.mockReturnValue({
                price: { name: 'price' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 100;
                if (key === 'totalFormula')
                    return 999; // Should be excluded
                return null;
            });
            const selfExcludingFormula = new FormulaProperty_1.FormulaProperty('totalFormula', mockVault, 'price * 2');
            const result = selfExcludingFormula.read(mockFile);
            expect(result).toBe(200);
        });
        test('should handle formula errors gracefully (ReferenceError)', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockFile.getMetadataValue.mockReturnValue(null);
            const faultyFormula = new FormulaProperty_1.FormulaProperty('test', mockVault, 'undefinedVariable * 5');
            const result = faultyFormula.read(mockFile);
            expect(result).toBeNull();
            // Test simple que console.error a été appelé avec le bon message
            expect(consoleSpy).toHaveBeenCalled();
            const errorCall = consoleSpy.mock.calls[0];
            expect(errorCall[0]).toContain('Formula error : undefinedVariable * 5');
            expect(errorCall[0]).toContain('This is all the properties available');
            consoleSpy.mockRestore();
        });
        test('should handle general formula errors', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockFile.getMetadataValue.mockReturnValue(null);
            const faultyFormula = new FormulaProperty_1.FormulaProperty('test', mockVault, 'throw new Error("test error")');
            const result = faultyFormula.read(mockFile);
            expect(result).toBeNull();
            expect(consoleSpy).toHaveBeenCalledWith(expect.stringContaining('Formula error : throw new Error("test error")'));
            consoleSpy.mockRestore();
        });
        describe('write functionality', () => {
            test('should update metadata when write is true and value changed', () => {
                const writeFormula = new FormulaProperty_1.FormulaProperty('total', mockVault, 'price + tax', {
                    icon: '',
                    write: true
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    if (key === 'total')
                        return 110; // Old value
                    return null;
                });
                const result = writeFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).toHaveBeenCalledWith('total', 120);
            });
            test('should not update metadata when write is true but value unchanged', () => {
                const writeFormula = new FormulaProperty_1.FormulaProperty('total', mockVault, 'price + tax', {
                    icon: '',
                    write: true
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    if (key === 'total')
                        return 120; // Same as calculated
                    return null;
                });
                const result = writeFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).not.toHaveBeenCalled();
            });
            test('should not update metadata when write is false', () => {
                const readOnlyFormula = new FormulaProperty_1.FormulaProperty('total', mockVault, 'price + tax', {
                    icon: '',
                    write: false
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    return null;
                });
                const result = readOnlyFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).not.toHaveBeenCalled();
            });
        });
    });
    describe('getPretty', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', mockVault, '1 + 1');
        });
        test('should return input if falsy', () => {
            expect(formulaProperty.getPretty('')).toBe('');
            expect(formulaProperty.getPretty(null)).toBe(null);
            expect(formulaProperty.getPretty(undefined)).toBe(undefined);
        });
        test('should handle non-string values', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            const numberValue = 123;
            const result = formulaProperty.getPretty(numberValue);
            expect(result).toBe(123);
            expect(consoleSpy).toHaveBeenCalledWith('Value is not a string:', 123);
            consoleSpy.mockRestore();
        });
        test('should format dates in French locale', () => {
            const dateString = '2023-12-25';
            const result = formulaProperty.getPretty(dateString);
            expect(result).toBe('25 décembre 2023');
        });
        test('should format integers with French locale formatting', () => {
            const integerString = '1234';
            const result = formulaProperty.getPretty(integerString);
            // Vérifions d'abord le résultat réel
            console.log('Actual result:', JSON.stringify(result));
            // Le format peut varier selon l'environnement, testons que c'est bien formaté
            expect(result).toMatch(/1[,\s]234[.,]00/);
        });
        test('should not format decimal numbers as integers', () => {
            const decimalString = '123.45';
            const result = formulaProperty.getPretty(decimalString);
            expect(result).toBe('123.45');
        });
        test('should clean URLs by removing protocols', () => {
            expect(formulaProperty.getPretty('https://example.com')).toBe('example.com');
            expect(formulaProperty.getPretty('http://test.org')).toBe('test.org');
        });
        test('should clean Obsidian links by removing brackets', () => {
            expect(formulaProperty.getPretty('[[Note Title]]')).toBe('Note Title');
        });
        test('should handle complex strings with multiple cleanups', () => {
            const complexString = 'https://[[example.com]]';
            const result = formulaProperty.getPretty(complexString);
            expect(result).toBe('example.com');
        });
        test('should return regular strings unchanged', () => {
            const regularString = 'Just a normal string';
            const result = formulaProperty.getPretty(regularString);
            expect(result).toBe('Just a normal string');
        });
    });
    describe('getLink', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', mockVault, '1 + 1');
            formulaProperty.vault = mockVault;
        });
        test('should return input if falsy', () => {
            expect(formulaProperty.getLink('')).toBe('');
            expect(formulaProperty.getLink(null)).toBe(null);
            expect(formulaProperty.getLink(undefined)).toBe(undefined);
        });
        test('should create mailto links for emails', () => {
            expect(formulaProperty.getLink('test@example.com')).toBe('mailto:test@example.com');
            expect(formulaProperty.getLink('user.name+tag@domain.co.uk')).toBe('mailto:user.name+tag@domain.co.uk');
        });
        test('should handle Obsidian links', () => {
            mockVault.readLinkFile.mockReturnValue([null, 'path/to/file.md']);
            const result = formulaProperty.getLink('[[My Note]]');
            expect(result).toBe('obsidian://open?vault=TestVault&file=path%2Fto%2Ffile.md');
            expect(mockVault.readLinkFile).toHaveBeenCalledWith('My Note', true);
        });
        test('should handle Obsidian link errors gracefully', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockVault.readLinkFile.mockImplementation(() => {
                throw new Error('File not found');
            });
            const result = formulaProperty.getLink('[[Invalid Note]]');
            expect(result).toBe('[[Invalid Note]]');
            expect(consoleSpy).toHaveBeenCalledWith('Error parsing link for [[Invalid Note]]:', expect.any(Error));
            consoleSpy.mockRestore();
        });
        test('should handle URLs with protocols', () => {
            expect(formulaProperty.getLink('https://example.com')).toBe('https://example.com');
            expect(formulaProperty.getLink('http://test.org/path')).toBe('http://test.org/path');
        });
        test('should add protocol to URLs without them', () => {
            expect(formulaProperty.getLink('example.com')).toBe('http://example.com');
            expect(formulaProperty.getLink('test.org/path')).toBe('http://test.org/path');
        });
        test('should return regular strings unchanged', () => {
            const regularString = 'Just a normal string';
            const result = formulaProperty.getLink(regularString);
            expect(result).toBe('Just a normal string');
        });
        test('should handle invalid URL formats', () => {
            const invalidUrl = 'not-a-url';
            const result = formulaProperty.getLink(invalidUrl);
            expect(result).toBe('not-a-url');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXEZvcm11bGFQcm9wZXJ0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBSUEsdUJBQXVCO0FBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFKbkMsMEVBQXVFO0FBTXZFLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDN0IsSUFBSSxlQUFnQyxDQUFDO0lBQ3JDLElBQUksUUFBNkIsQ0FBQztJQUNsQyxJQUFJLFNBQTZCLENBQUM7SUFFbEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLDBCQUEwQjtRQUMxQixTQUFTLEdBQUc7WUFDUixHQUFHLEVBQUU7Z0JBQ0QsS0FBSyxFQUFFO29CQUNILE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQztpQkFDbEQ7Z0JBQ0QsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFvQixFQUFFLFFBQWdCLEVBQUUsRUFBRTtvQkFDeEQsT0FBTyxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBQzVDLE9BQU8sQ0FBQyxXQUFXLEdBQUcsSUFBSSxRQUFRLEdBQUcsQ0FBQztnQkFDMUMsQ0FBQyxDQUFDO2FBQ0w7WUFDRCxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNuQixDQUFDO1FBRVQsUUFBUSxHQUFHO1lBQ1AsS0FBSyxFQUFFLFNBQVM7WUFDaEIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDbEIsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUMzQixn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c0JBQXNCLENBQUMsQ0FBQztRQUNsRixDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7WUFDakQsTUFBTSxhQUFhLEdBQUcsc0JBQXNCLENBQUM7WUFDN0MsTUFBTSxNQUFNLEdBQUcsZUFBZSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUV0RCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFO1lBQzNDLE1BQU0sVUFBVSxHQUFHLFdBQVcsQ0FBQztZQUMvQixNQUFNLE1BQU0sR0FBRyxlQUFlLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRW5ELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcX190ZXN0c19fXFxQcm9wZXJ0aWVzXFxGb3JtdWxhUHJvcGVydHkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDbGFzc2UgfSBmcm9tICcuLi8uLi9zcmMvdmF1bHQvQ2xhc3NlJztcclxuaW1wb3J0IHsgVmF1bHQgfSBmcm9tICcuLi8uLi9zcmMvdmF1bHQvVmF1bHQnO1xyXG5pbXBvcnQgeyBGb3JtdWxhUHJvcGVydHkgfSBmcm9tICcuLi8uLi9zcmMvcHJvcGVydGllcy9Gb3JtdWxhUHJvcGVydHknO1xyXG5cclxuLy8gTW9jayBkZXMgZMOpcGVuZGFuY2VzXHJcbmplc3QubW9jaygnLi4vLi4vc3JjL3ZhdWx0L0NsYXNzZScpO1xyXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy92YXVsdC9WYXVsdCcpO1xyXG5cclxuZGVzY3JpYmUoJ0Zvcm11bGFQcm9wZXJ0eScsICgpID0+IHtcclxuICAgIGxldCBmb3JtdWxhUHJvcGVydHk6IEZvcm11bGFQcm9wZXJ0eTtcclxuICAgIGxldCBtb2NrRmlsZTogamVzdC5Nb2NrZWQ8Q2xhc3NlPjtcclxuICAgIGxldCBtb2NrVmF1bHQ6IGplc3QuTW9ja2VkPFZhdWx0PjtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAvLyBDb25maWd1cmF0aW9uIGRlcyBtb2Nrc1xyXG4gICAgICAgIG1vY2tWYXVsdCA9IHtcclxuICAgICAgICAgICAgYXBwOiB7XHJcbiAgICAgICAgICAgICAgICB2YXVsdDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldE5hbWU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ1Rlc3RWYXVsdCcpXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2V0SWNvbjogamVzdC5mbigoZWxlbWVudDogSFRNTEVsZW1lbnQsIGljb25OYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1pY29uJywgaWNvbk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSBgWyR7aWNvbk5hbWV9XWA7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZWFkTGlua0ZpbGU6IGplc3QuZm4oKVxyXG4gICAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgICBtb2NrRmlsZSA9IHtcclxuICAgICAgICAgICAgdmF1bHQ6IG1vY2tWYXVsdCxcclxuICAgICAgICAgICAgZ2V0TmFtZTogamVzdC5mbigpLFxyXG4gICAgICAgICAgICBnZXRBbGxQcm9wZXJ0aWVzOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICAgIGdldE1ldGFkYXRhVmFsdWU6IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgdXBkYXRlTWV0YWRhdGE6IGplc3QuZm4oKVxyXG4gICAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgICAvLyBSZXNldCBkZXMgbW9ja3NcclxuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdDb25zdHJ1Y3RvcicsICgpID0+IHtcclxuICAgICAgICB0ZXN0KCdzaG91bGQgY3JlYXRlIGZvcm11bGEgcHJvcGVydHkgd2l0aCBkZWZhdWx0IGFyZ3VtZW50cycsICgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdEZvcm11bGEnLCBtb2NrVmF1bHQsICcxICsgMScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5uYW1lKS50b0JlKCd0ZXN0Rm9ybXVsYScpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmZvcm11bGEpLnRvQmUoJzEgKyAxJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkudHlwZSkudG9CZSgnZm9ybXVsYScpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LndyaXRlKS50b0JlKGZhbHNlKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5zdGF0aWMpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBjcmVhdGUgZm9ybXVsYSBwcm9wZXJ0eSB3aXRoIGN1c3RvbSBhcmd1bWVudHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGZvcm11bGFQcm9wZXJ0eSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3Rlc3RGb3JtdWxhJywgbW9ja1ZhdWx0LCAnMiAqIDMnLCB7XHJcbiAgICAgICAgICAgICAgICBpY29uOiAnY2FsY3VsYXRvcicsXHJcbiAgICAgICAgICAgICAgICBzdGF0aWM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgd3JpdGU6IHRydWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5Lm5hbWUpLnRvQmUoJ3Rlc3RGb3JtdWxhJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZm9ybXVsYSkudG9CZSgnMiAqIDMnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS50eXBlKS50b0JlKCdmb3JtdWxhJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkud3JpdGUpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuc3RhdGljKS50b0JlKGZhbHNlKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5pY29uKS50b0JlKCdjYWxjdWxhdG9yJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgcGFydGlhbCBhcmd1bWVudHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGZvcm11bGFQcm9wZXJ0eSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3Rlc3RGb3JtdWxhJywgbW9ja1ZhdWx0LCAneCArIHknLCB7XHJcbiAgICAgICAgICAgICAgICBpY29uOiAnbWF0aCcsXHJcbiAgICAgICAgICAgICAgICB3cml0ZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgLy8gc3RhdGljIHdpbGwgdXNlIGRlZmF1bHQgdmFsdWUgZnJvbSBGb3JtdWxhUHJvcGVydHkgY29uc3RydWN0b3IgKHRydWUpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS53cml0ZSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgLy8gTGEgdmFsZXVyIHNlcmEgZmFsc2UgY2FyIExpbmtQcm9wZXJ0eSBuJ292ZXJyaWRlIHBhcyBsZSBkZWZhdWx0IGRlIFByb3BlcnR5XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuc3RhdGljKS50b0JlKGZhbHNlKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5pY29uKS50b0JlKCdtYXRoJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgndmFsaWRhdGUnLCAoKSA9PiB7XHJcbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGZvcm11bGFQcm9wZXJ0eSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3Rlc3QnLCBtb2NrVmF1bHQsICcxICsgMScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIGlucHV0IHZhbHVlIHVuY2hhbmdlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS52YWxpZGF0ZSgndGVzdCcpKS50b0JlKCd0ZXN0Jyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkudmFsaWRhdGUoJzEyMycpKS50b0JlKCcxMjMnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS52YWxpZGF0ZSgnJykpLnRvQmUoJycpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ3JlYWQnLCAoKSA9PiB7XHJcbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGZvcm11bGFQcm9wZXJ0eSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3RvdGFsRm9ybXVsYScsIG1vY2tWYXVsdCwgJ3ByaWNlICogcXVhbnRpdHknKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIE1vY2sgZGVzIHByb3ByacOpdMOpcyBkdSBmaWNoaWVyXHJcbiAgICAgICAgICAgIG1vY2tGaWxlLmdldEFsbFByb3BlcnRpZXMubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgIHByaWNlOiB7IG5hbWU6ICdwcmljZScgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICBxdWFudGl0eTogeyBuYW1lOiAncXVhbnRpdHknIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgdG90YWxGb3JtdWxhOiB7IG5hbWU6ICd0b3RhbEZvcm11bGEnIH0gYXMgYW55XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TmFtZS5tb2NrUmV0dXJuVmFsdWUoJ1Rlc3RGaWxlJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBleGVjdXRlIHNpbXBsZSBhcml0aG1ldGljIGZvcm11bGEnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIG1vY2tGaWxlLmdldE1ldGFkYXRhVmFsdWVcclxuICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3ByaWNlJykgcmV0dXJuIDEwO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdxdWFudGl0eScpIHJldHVybiA1O1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoNTApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGZvcm11bGEgd2l0aCByZXR1cm4gc3RhdGVtZW50JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmb3JtdWxhV2l0aFJldHVybiA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3Rlc3QnLCBtb2NrVmF1bHQsICdyZXR1cm4gcHJpY2UgKyBxdWFudGl0eScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAncHJpY2UnKSByZXR1cm4gMTU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3F1YW50aXR5JykgcmV0dXJuIDI1O1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhV2l0aFJldHVybi5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSg0MCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBzYW5pdGl6ZSBwcm9wZXJ0eSBuYW1lcyAocmVtb3ZlIHNwYWNlcyknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIG1vY2tGaWxlLmdldEFsbFByb3BlcnRpZXMubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgICd1bml0IHByaWNlJzogeyBuYW1lOiAndW5pdCBwcmljZScgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICAnaXRlbSBjb3VudCc6IHsgbmFtZTogJ2l0ZW0gY291bnQnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgdG90YWxGb3JtdWxhOiB7IG5hbWU6ICd0b3RhbEZvcm11bGEnIH0gYXMgYW55XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAndW5pdCBwcmljZScpIHJldHVybiAxMjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnaXRlbSBjb3VudCcpIHJldHVybiAzO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzYW5pdGl6ZWRGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsIG1vY2tWYXVsdCwgJ3VuaXRwcmljZSAqIGl0ZW1jb3VudCcpO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBzYW5pdGl6ZWRGb3JtdWxhLnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKDM2KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGV4Y2x1ZGUgc2VsZiBwcm9wZXJ0eSBmcm9tIGZvcm11bGEgY29udGV4dCcsICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0QWxsUHJvcGVydGllcy5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcHJpY2U6IHsgbmFtZTogJ3ByaWNlJyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgIHRvdGFsRm9ybXVsYTogeyBuYW1lOiAndG90YWxGb3JtdWxhJyB9IGFzIGFueVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG1vY2tGaWxlLmdldE1ldGFkYXRhVmFsdWVcclxuICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3ByaWNlJykgcmV0dXJuIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAndG90YWxGb3JtdWxhJykgcmV0dXJuIDk5OTsgLy8gU2hvdWxkIGJlIGV4Y2x1ZGVkXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHNlbGZFeGNsdWRpbmdGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndG90YWxGb3JtdWxhJywgbW9ja1ZhdWx0LCAncHJpY2UgKiAyJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHNlbGZFeGNsdWRpbmdGb3JtdWxhLnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKDIwMCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgZm9ybXVsYSBlcnJvcnMgZ3JhY2VmdWxseSAoUmVmZXJlbmNlRXJyb3IpJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZS5tb2NrUmV0dXJuVmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBmYXVsdHlGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsIG1vY2tWYXVsdCwgJ3VuZGVmaW5lZFZhcmlhYmxlICogNScpO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmYXVsdHlGb3JtdWxhLnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcclxuICAgICAgICAgICAgLy8gVGVzdCBzaW1wbGUgcXVlIGNvbnNvbGUuZXJyb3IgYSDDqXTDqSBhcHBlbMOpIGF2ZWMgbGUgYm9uIG1lc3NhZ2VcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnNvbGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3JDYWxsID0gY29uc29sZVNweS5tb2NrLmNhbGxzWzBdO1xyXG4gICAgICAgICAgICBleHBlY3QoZXJyb3JDYWxsWzBdKS50b0NvbnRhaW4oJ0Zvcm11bGEgZXJyb3IgOiB1bmRlZmluZWRWYXJpYWJsZSAqIDUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGVycm9yQ2FsbFswXSkudG9Db250YWluKCdUaGlzIGlzIGFsbCB0aGUgcHJvcGVydGllcyBhdmFpbGFibGUnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBnZW5lcmFsIGZvcm11bGEgZXJyb3JzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZS5tb2NrUmV0dXJuVmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBmYXVsdHlGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsIG1vY2tWYXVsdCwgJ3Rocm93IG5ldyBFcnJvcihcInRlc3QgZXJyb3JcIiknKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZmF1bHR5Rm9ybXVsYS5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb25zb2xlU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAgICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdGb3JtdWxhIGVycm9yIDogdGhyb3cgbmV3IEVycm9yKFwidGVzdCBlcnJvclwiKScpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGRlc2NyaWJlKCd3cml0ZSBmdW5jdGlvbmFsaXR5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICB0ZXN0KCdzaG91bGQgdXBkYXRlIG1ldGFkYXRhIHdoZW4gd3JpdGUgaXMgdHJ1ZSBhbmQgdmFsdWUgY2hhbmdlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdyaXRlRm9ybXVsYSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3RvdGFsJywgbW9ja1ZhdWx0LCAncHJpY2UgKyB0YXgnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGU6IHRydWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE1vY2sgZ2V0QWxsUHJvcGVydGllcyBwb3VyIGNldHRlIGluc3RhbmNlXHJcbiAgICAgICAgICAgICAgICBtb2NrRmlsZS5nZXRBbGxQcm9wZXJ0aWVzLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpY2U6IHsgbmFtZTogJ3ByaWNlJyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgICAgICB0YXg6IHsgbmFtZTogJ3RheCcgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IHsgbmFtZTogJ3RvdGFsJyB9IGFzIGFueVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdwcmljZScpIHJldHVybiAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd0YXgnKSByZXR1cm4gMjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd0b3RhbCcpIHJldHVybiAxMTA7IC8vIE9sZCB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB3cml0ZUZvcm11bGEucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMTIwKTtcclxuICAgICAgICAgICAgICAgIGV4cGVjdChtb2NrRmlsZS51cGRhdGVNZXRhZGF0YSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3RvdGFsJywgMTIwKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0ZXN0KCdzaG91bGQgbm90IHVwZGF0ZSBtZXRhZGF0YSB3aGVuIHdyaXRlIGlzIHRydWUgYnV0IHZhbHVlIHVuY2hhbmdlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdyaXRlRm9ybXVsYSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3RvdGFsJywgbW9ja1ZhdWx0LCAncHJpY2UgKyB0YXgnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGU6IHRydWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE1vY2sgZ2V0QWxsUHJvcGVydGllcyBwb3VyIGNldHRlIGluc3RhbmNlXHJcbiAgICAgICAgICAgICAgICBtb2NrRmlsZS5nZXRBbGxQcm9wZXJ0aWVzLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpY2U6IHsgbmFtZTogJ3ByaWNlJyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgICAgICB0YXg6IHsgbmFtZTogJ3RheCcgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IHsgbmFtZTogJ3RvdGFsJyB9IGFzIGFueVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdwcmljZScpIHJldHVybiAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd0YXgnKSByZXR1cm4gMjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd0b3RhbCcpIHJldHVybiAxMjA7IC8vIFNhbWUgYXMgY2FsY3VsYXRlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB3cml0ZUZvcm11bGEucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMTIwKTtcclxuICAgICAgICAgICAgICAgIGV4cGVjdChtb2NrRmlsZS51cGRhdGVNZXRhZGF0YSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0ZXN0KCdzaG91bGQgbm90IHVwZGF0ZSBtZXRhZGF0YSB3aGVuIHdyaXRlIGlzIGZhbHNlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVhZE9ubHlGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndG90YWwnLCBtb2NrVmF1bHQsICdwcmljZSArIHRheCcsIHtcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZTogZmFsc2VcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE1vY2sgZ2V0QWxsUHJvcGVydGllcyBwb3VyIGNldHRlIGluc3RhbmNlXHJcbiAgICAgICAgICAgICAgICBtb2NrRmlsZS5nZXRBbGxQcm9wZXJ0aWVzLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpY2U6IHsgbmFtZTogJ3ByaWNlJyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgICAgICB0YXg6IHsgbmFtZTogJ3RheCcgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IHsgbmFtZTogJ3RvdGFsJyB9IGFzIGFueVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdwcmljZScpIHJldHVybiAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd0YXgnKSByZXR1cm4gMjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlYWRPbmx5Rm9ybXVsYS5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgxMjApO1xyXG4gICAgICAgICAgICAgICAgZXhwZWN0KG1vY2tGaWxlLnVwZGF0ZU1ldGFkYXRhKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdnZXRQcmV0dHknLCAoKSA9PiB7XHJcbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGZvcm11bGFQcm9wZXJ0eSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3Rlc3QnLCBtb2NrVmF1bHQsICcxICsgMScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIGlucHV0IGlmIGZhbHN5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eSgnJykpLnRvQmUoJycpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eShudWxsIGFzIGFueSkpLnRvQmUobnVsbCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KHVuZGVmaW5lZCBhcyBhbnkpKS50b0JlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgbm9uLXN0cmluZyB2YWx1ZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBudW1iZXJWYWx1ZSA9IDEyMyBhcyBhbnk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkobnVtYmVyVmFsdWUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgxMjMpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1ZhbHVlIGlzIG5vdCBhIHN0cmluZzonLCAxMjMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgZm9ybWF0IGRhdGVzIGluIEZyZW5jaCBsb2NhbGUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGVTdHJpbmcgPSAnMjAyMy0xMi0yNSc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoZGF0ZVN0cmluZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCcyNSBkw6ljZW1icmUgMjAyMycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgZm9ybWF0IGludGVnZXJzIHdpdGggRnJlbmNoIGxvY2FsZSBmb3JtYXR0aW5nJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbnRlZ2VyU3RyaW5nID0gJzEyMzQnO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KGludGVnZXJTdHJpbmcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVsOpcmlmaW9ucyBkJ2Fib3JkIGxlIHLDqXN1bHRhdCByw6llbFxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQWN0dWFsIHJlc3VsdDonLCBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTtcclxuICAgICAgICAgICAgLy8gTGUgZm9ybWF0IHBldXQgdmFyaWVyIHNlbG9uIGwnZW52aXJvbm5lbWVudCwgdGVzdG9ucyBxdWUgYydlc3QgYmllbiBmb3JtYXTDqVxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b01hdGNoKC8xWyxcXHNdMjM0Wy4sXTAwLyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBub3QgZm9ybWF0IGRlY2ltYWwgbnVtYmVycyBhcyBpbnRlZ2VycycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGVjaW1hbFN0cmluZyA9ICcxMjMuNDUnO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KGRlY2ltYWxTdHJpbmcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnMTIzLjQ1Jyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBjbGVhbiBVUkxzIGJ5IHJlbW92aW5nIHByb3RvY29scycsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoJ2h0dHBzOi8vZXhhbXBsZS5jb20nKSkudG9CZSgnZXhhbXBsZS5jb20nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoJ2h0dHA6Ly90ZXN0Lm9yZycpKS50b0JlKCd0ZXN0Lm9yZycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgY2xlYW4gT2JzaWRpYW4gbGlua3MgYnkgcmVtb3ZpbmcgYnJhY2tldHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KCdbW05vdGUgVGl0bGVdXScpKS50b0JlKCdOb3RlIFRpdGxlJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgY29tcGxleCBzdHJpbmdzIHdpdGggbXVsdGlwbGUgY2xlYW51cHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXhTdHJpbmcgPSAnaHR0cHM6Ly9bW2V4YW1wbGUuY29tXV0nO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KGNvbXBsZXhTdHJpbmcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnZXhhbXBsZS5jb20nKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIHJldHVybiByZWd1bGFyIHN0cmluZ3MgdW5jaGFuZ2VkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZWd1bGFyU3RyaW5nID0gJ0p1c3QgYSBub3JtYWwgc3RyaW5nJztcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eShyZWd1bGFyU3RyaW5nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ0p1c3QgYSBub3JtYWwgc3RyaW5nJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZ2V0TGluaycsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsIG1vY2tWYXVsdCwgJzEgKyAxJyk7XHJcbiAgICAgICAgICAgIGZvcm11bGFQcm9wZXJ0eS52YXVsdCA9IG1vY2tWYXVsdDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIHJldHVybiBpbnB1dCBpZiBmYWxzeScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKCcnKSkudG9CZSgnJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluayhudWxsIGFzIGFueSkpLnRvQmUobnVsbCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluayh1bmRlZmluZWQgYXMgYW55KSkudG9CZSh1bmRlZmluZWQpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgY3JlYXRlIG1haWx0byBsaW5rcyBmb3IgZW1haWxzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ3Rlc3RAZXhhbXBsZS5jb20nKSkudG9CZSgnbWFpbHRvOnRlc3RAZXhhbXBsZS5jb20nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKCd1c2VyLm5hbWUrdGFnQGRvbWFpbi5jby51aycpKS50b0JlKCdtYWlsdG86dXNlci5uYW1lK3RhZ0Bkb21haW4uY28udWsnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBPYnNpZGlhbiBsaW5rcycsICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja1ZhdWx0LnJlYWRMaW5rRmlsZS5tb2NrUmV0dXJuVmFsdWUoW251bGwsICdwYXRoL3RvL2ZpbGUubWQnXSBhcyBhbnkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ1tbTXkgTm90ZV1dJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdvYnNpZGlhbjovL29wZW4/dmF1bHQ9VGVzdFZhdWx0JmZpbGU9cGF0aCUyRnRvJTJGZmlsZS5tZCcpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1ZhdWx0LnJlYWRMaW5rRmlsZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ015IE5vdGUnLCB0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBPYnNpZGlhbiBsaW5rIGVycm9ycyBncmFjZWZ1bGx5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xyXG4gICAgICAgICAgICBtb2NrVmF1bHQucmVhZExpbmtGaWxlLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ1tbSW52YWxpZCBOb3RlXV0nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ1tbSW52YWxpZCBOb3RlXV0nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnNvbGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICAgICAgICAgJ0Vycm9yIHBhcnNpbmcgbGluayBmb3IgW1tJbnZhbGlkIE5vdGVdXTonLFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LmFueShFcnJvcilcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBVUkxzIHdpdGggcHJvdG9jb2xzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ2h0dHBzOi8vZXhhbXBsZS5jb20nKSkudG9CZSgnaHR0cHM6Ly9leGFtcGxlLmNvbScpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ2h0dHA6Ly90ZXN0Lm9yZy9wYXRoJykpLnRvQmUoJ2h0dHA6Ly90ZXN0Lm9yZy9wYXRoJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBhZGQgcHJvdG9jb2wgdG8gVVJMcyB3aXRob3V0IHRoZW0nLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluaygnZXhhbXBsZS5jb20nKSkudG9CZSgnaHR0cDovL2V4YW1wbGUuY29tJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluaygndGVzdC5vcmcvcGF0aCcpKS50b0JlKCdodHRwOi8vdGVzdC5vcmcvcGF0aCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIHJlZ3VsYXIgc3RyaW5ncyB1bmNoYW5nZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlZ3VsYXJTdHJpbmcgPSAnSnVzdCBhIG5vcm1hbCBzdHJpbmcnO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0TGluayhyZWd1bGFyU3RyaW5nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ0p1c3QgYSBub3JtYWwgc3RyaW5nJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgaW52YWxpZCBVUkwgZm9ybWF0cycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaW52YWxpZFVybCA9ICdub3QtYS11cmwnO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0TGluayhpbnZhbGlkVXJsKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ25vdC1hLXVybCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=