7fa21a61c3b26998d11b24def77f488c
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock setIcon function to work synchronously in tests
jest.mock('../../src/vault/Utils', () => ({
    setIcon: jest.fn((element, iconName) => {
        element.setAttribute('data-icon', iconName);
    }),
    sendNotice: jest.fn()
}));
const NameProperty_1 = require("../../src/properties/NameProperty");
describe('NameProperty', () => {
    let nameProperty;
    let mockVault;
    beforeEach(() => {
        // Setup mock vault
        mockVault = {
            app: {
                vault: { getFiles: jest.fn(() => []) },
                setIcon: jest.fn((element, iconName) => {
                    element.setAttribute('data-icon', iconName);
                    element.textContent = `[${iconName}]`;
                })
            }
        };
        nameProperty = new NameProperty_1.NameProperty(mockVault);
    });
    describe('constructor', () => {
        it('should create NameProperty with correct type and name', () => {
            expect(nameProperty.name).toBe('name');
            expect(nameProperty.type).toBe('name');
            expect(nameProperty.static).toBe(true);
        });
        it('should inherit from Property', () => {
            expect(nameProperty).toBeInstanceOf(nameProperty.constructor);
            expect(nameProperty.hasOwnProperty('name')).toBe(true);
            expect(nameProperty.hasOwnProperty('type')).toBe(true);
            expect(nameProperty.hasOwnProperty('static')).toBe(true);
        });
    });
    describe('read', () => {
        it('should call getLink on file object', () => {
            const mockFile = {
                getLink: jest.fn().mockReturnValue('Test Link')
            };
            const result = nameProperty.read(mockFile);
            expect(mockFile.getLink).toHaveBeenCalledTimes(1);
            expect(result).toBe('Test Link');
        });
        it('should throw error when file has no getLink method', () => {
            const mockFile = {};
            expect(() => nameProperty.read(mockFile)).toThrow();
        });
        it('should throw error with null file', () => {
            expect(() => nameProperty.read(null)).toThrow();
        });
        it('should throw error with undefined file', () => {
            expect(() => nameProperty.read(undefined)).toThrow();
        });
        it('should return result from getLink even if empty', () => {
            const mockFile = {
                getLink: jest.fn().mockReturnValue('')
            };
            const result = nameProperty.read(mockFile);
            expect(result).toBe('');
        });
        it('should return null if getLink returns null', () => {
            const mockFile = {
                getLink: jest.fn().mockReturnValue(null)
            };
            const result = nameProperty.read(mockFile);
            expect(result).toBeNull();
        });
    });
    describe('inherited methods', () => {
        it('should have validate method from parent class', () => {
            expect(typeof nameProperty.validate).toBe('function');
            expect(nameProperty.validate('test')).toBe('test');
        });
        it('should have getLink method from parent class', () => {
            expect(typeof nameProperty.getLink).toBe('function');
            expect(nameProperty.getLink('test')).toBe('test');
        });
        it('should have getPretty method from parent class', () => {
            expect(typeof nameProperty.getPretty).toBe('function');
            expect(nameProperty.getPretty('test')).toBe('test');
        });
        it('should have fillDisplay method from parent class', () => {
            expect(typeof nameProperty.fillDisplay).toBe('function');
        });
    });
    describe('static behavior', () => {
        it('should create static fields when using fillDisplay', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const display = nameProperty.fillDisplay('Test Name', mockUpdate);
            // Vérifier que l'élément créé contient les bonnes classes
            expect(display.tagName).toBe('DIV');
            expect(display.classList.contains('metadata-field')).toBe(true);
        });
        it('should not allow field modification when static', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const display = nameProperty.fillDisplay('Test Name', mockUpdate);
            const link = display.querySelector('.field-link');
            if (link) {
                expect(link.style.cursor).toBe('default');
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXE5hbWVQcm9wZXJ0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFJSCx1REFBdUQ7QUFDdkQsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBb0IsRUFBRSxRQUFnQixFQUFFLEVBQUU7UUFDeEQsT0FBTyxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDaEQsQ0FBQyxDQUFDO0lBQ0YsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDeEIsQ0FBQyxDQUFDLENBQUM7QUFSSixvRUFBaUU7QUFVakUsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7SUFDMUIsSUFBSSxZQUEwQixDQUFDO0lBQy9CLElBQUksU0FBYyxDQUFDO0lBRW5CLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixtQkFBbUI7UUFDbkIsU0FBUyxHQUFHO1lBQ1IsR0FBRyxFQUFFO2dCQUNELEtBQUssRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFO2dCQUN0QyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE9BQW9CLEVBQUUsUUFBZ0IsRUFBRSxFQUFFO29CQUN4RCxPQUFPLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztvQkFDNUMsT0FBTyxDQUFDLFdBQVcsR0FBRyxJQUFJLFFBQVEsR0FBRyxDQUFDO2dCQUMxQyxDQUFDLENBQUM7YUFDTDtTQUNHLENBQUM7UUFFVCxZQUFZ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TSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzlDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXE5hbWVQcm9wZXJ0eS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAamVzdC1lbnZpcm9ubWVudCBqc2RvbVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IE5hbWVQcm9wZXJ0eSB9IGZyb20gJy4uLy4uL3NyYy9wcm9wZXJ0aWVzL05hbWVQcm9wZXJ0eSc7XHJcblxyXG4vLyBNb2NrIHNldEljb24gZnVuY3Rpb24gdG8gd29yayBzeW5jaHJvbm91c2x5IGluIHRlc3RzXHJcbmplc3QubW9jaygnLi4vLi4vc3JjL3ZhdWx0L1V0aWxzJywgKCkgPT4gKHtcclxuICAgIHNldEljb246IGplc3QuZm4oKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBpY29uTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWNvbicsIGljb25OYW1lKTtcclxuICAgIH0pLFxyXG4gICAgc2VuZE5vdGljZTogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbmRlc2NyaWJlKCdOYW1lUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICBsZXQgbmFtZVByb3BlcnR5OiBOYW1lUHJvcGVydHk7XHJcbiAgICBsZXQgbW9ja1ZhdWx0OiBhbnk7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgLy8gU2V0dXAgbW9jayB2YXVsdFxyXG4gICAgICAgIG1vY2tWYXVsdCA9IHtcclxuICAgICAgICAgICAgYXBwOiB7IFxyXG4gICAgICAgICAgICAgICAgdmF1bHQ6IHsgZ2V0RmlsZXM6IGplc3QuZm4oKCkgPT4gW10pIH0sXHJcbiAgICAgICAgICAgICAgICBzZXRJY29uOiBqZXN0LmZuKChlbGVtZW50OiBIVE1MRWxlbWVudCwgaWNvbk5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWljb24nLCBpY29uTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9IGBbJHtpY29uTmFtZX1dYDtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGFzIGFueTtcclxuICAgICAgICBcclxuICAgICAgICBuYW1lUHJvcGVydHkgPSBuZXcgTmFtZVByb3BlcnR5KG1vY2tWYXVsdCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY29uc3RydWN0b3InLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgTmFtZVByb3BlcnR5IHdpdGggY29ycmVjdCB0eXBlIGFuZCBuYW1lJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QobmFtZVByb3BlcnR5Lm5hbWUpLnRvQmUoJ25hbWUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KG5hbWVQcm9wZXJ0eS50eXBlKS50b0JlKCduYW1lJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChuYW1lUHJvcGVydHkuc3RhdGljKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGluaGVyaXQgZnJvbSBQcm9wZXJ0eScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KG5hbWVQcm9wZXJ0eSkudG9CZUluc3RhbmNlT2YobmFtZVByb3BlcnR5LmNvbnN0cnVjdG9yKTtcclxuICAgICAgICAgICAgZXhwZWN0KG5hbWVQcm9wZXJ0eS5oYXNPd25Qcm9wZXJ0eSgnbmFtZScpKS50b0JlKHRydWUpO1xyXG4gICAgICAgICAgICBleHBlY3QobmFtZVByb3BlcnR5Lmhhc093blByb3BlcnR5KCd0eXBlJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChuYW1lUHJvcGVydHkuaGFzT3duUHJvcGVydHkoJ3N0YXRpYycpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ3JlYWQnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjYWxsIGdldExpbmsgb24gZmlsZSBvYmplY3QnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGaWxlID0ge1xyXG4gICAgICAgICAgICAgICAgZ2V0TGluazogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnVGVzdCBMaW5rJylcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG5hbWVQcm9wZXJ0eS5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrRmlsZS5nZXRMaW5rKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ1Rlc3QgTGluaycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIHdoZW4gZmlsZSBoYXMgbm8gZ2V0TGluayBtZXRob2QnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGaWxlID0ge307XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoKCkgPT4gbmFtZVByb3BlcnR5LnJlYWQobW9ja0ZpbGUpKS50b1Rocm93KCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igd2l0aCBudWxsIGZpbGUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdCgoKSA9PiBuYW1lUHJvcGVydHkucmVhZChudWxsKSkudG9UaHJvdygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIHdpdGggdW5kZWZpbmVkIGZpbGUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdCgoKSA9PiBuYW1lUHJvcGVydHkucmVhZCh1bmRlZmluZWQpKS50b1Rocm93KCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHJlc3VsdCBmcm9tIGdldExpbmsgZXZlbiBpZiBlbXB0eScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja0ZpbGUgPSB7XHJcbiAgICAgICAgICAgICAgICBnZXRMaW5rOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCcnKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gbmFtZVByb3BlcnR5LnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgaWYgZ2V0TGluayByZXR1cm5zIG51bGwnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGaWxlID0ge1xyXG4gICAgICAgICAgICAgICAgZ2V0TGluazogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShudWxsKVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gbmFtZVByb3BlcnR5LnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdpbmhlcml0ZWQgbWV0aG9kcycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgdmFsaWRhdGUgbWV0aG9kIGZyb20gcGFyZW50IGNsYXNzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIG5hbWVQcm9wZXJ0eS52YWxpZGF0ZSkudG9CZSgnZnVuY3Rpb24nKTtcclxuICAgICAgICAgICAgZXhwZWN0KG5hbWVQcm9wZXJ0eS52YWxpZGF0ZSgndGVzdCcpKS50b0JlKCd0ZXN0Jyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGF2ZSBnZXRMaW5rIG1ldGhvZCBmcm9tIHBhcmVudCBjbGFzcycsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBuYW1lUHJvcGVydHkuZ2V0TGluaykudG9CZSgnZnVuY3Rpb24nKTtcclxuICAgICAgICAgICAgZXhwZWN0KG5hbWVQcm9wZXJ0eS5nZXRMaW5rKCd0ZXN0JykpLnRvQmUoJ3Rlc3QnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIGdldFByZXR0eSBtZXRob2QgZnJvbSBwYXJlbnQgY2xhc3MnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdCh0eXBlb2YgbmFtZVByb3BlcnR5LmdldFByZXR0eSkudG9CZSgnZnVuY3Rpb24nKTtcclxuICAgICAgICAgICAgZXhwZWN0KG5hbWVQcm9wZXJ0eS5nZXRQcmV0dHkoJ3Rlc3QnKSkudG9CZSgndGVzdCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgZmlsbERpc3BsYXkgbWV0aG9kIGZyb20gcGFyZW50IGNsYXNzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIG5hbWVQcm9wZXJ0eS5maWxsRGlzcGxheSkudG9CZSgnZnVuY3Rpb24nKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdzdGF0aWMgYmVoYXZpb3InLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgc3RhdGljIGZpZWxkcyB3aGVuIHVzaW5nIGZpbGxEaXNwbGF5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGRpc3BsYXkgPSBuYW1lUHJvcGVydHkuZmlsbERpc3BsYXkoJ1Rlc3QgTmFtZScsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVsOpcmlmaWVyIHF1ZSBsJ8OpbMOpbWVudCBjcsOpw6kgY29udGllbnQgbGVzIGJvbm5lcyBjbGFzc2VzXHJcbiAgICAgICAgICAgIGV4cGVjdChkaXNwbGF5LnRhZ05hbWUpLnRvQmUoJ0RJVicpO1xyXG4gICAgICAgICAgICBleHBlY3QoZGlzcGxheS5jbGFzc0xpc3QuY29udGFpbnMoJ21ldGFkYXRhLWZpZWxkJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgbm90IGFsbG93IGZpZWxkIG1vZGlmaWNhdGlvbiB3aGVuIHN0YXRpYycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1ZhdWx0ID0ge307XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBkaXNwbGF5ID0gbmFtZVByb3BlcnR5LmZpbGxEaXNwbGF5KCdUZXN0IE5hbWUnLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgbGluayA9IGRpc3BsYXkucXVlcnlTZWxlY3RvcignLmZpZWxkLWxpbmsnKSBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChsaW5rKSB7XHJcbiAgICAgICAgICAgICAgICBleHBlY3QobGluay5zdHlsZS5jdXJzb3IpLnRvQmUoJ2RlZmF1bHQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=