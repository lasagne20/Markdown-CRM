05ab9508df39a525fe590d8329a7c111
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock complex dependencies
jest.mock('../../src/vault/Utils', () => ({
    setIcon: jest.fn()
}));
const _3DModelProperty_1 = require("../../src/properties/3DModelProperty");
const MediaProperty_1 = require("../../src/properties/MediaProperty");
// Mock external dependencies
global.Notice = jest.fn();
global.selectMedia = jest.fn();
global.shell = {
    openPath: jest.fn()
};
// Mock THREE.js dependencies
global.THREE = {
    WebGLRenderer: jest.fn().mockImplementation(() => ({
        setSize: jest.fn(),
        domElement: document.createElement('canvas'),
        render: jest.fn()
    })),
    Scene: jest.fn().mockImplementation(() => ({
        add: jest.fn()
    })),
    PerspectiveCamera: jest.fn().mockImplementation(() => ({
        position: { set: jest.fn() },
        up: { set: jest.fn() },
        lookAt: jest.fn()
    })),
    DirectionalLight: jest.fn().mockImplementation(() => ({
        position: { set: jest.fn() },
        target: { position: { set: jest.fn() } }
    })),
    AmbientLight: jest.fn(),
    Box3: jest.fn().mockImplementation(() => ({
        setFromObject: jest.fn().mockReturnThis(),
        getCenter: jest.fn(),
        getSize: jest.fn()
    })),
    Vector3: jest.fn().mockImplementation(() => ({
        sub: jest.fn()
    }))
};
global.GLTFLoader = jest.fn().mockImplementation(() => ({
    load: jest.fn()
}));
global.OrbitControls = jest.fn().mockImplementation(() => ({
    enableDamping: true,
    dampingFactor: 0.05,
    enableZoom: true,
    enablePan: true,
    enableRotate: true,
    minPolarAngle: 0,
    maxPolarAngle: Math.PI,
    target: { set: jest.fn() },
    update: jest.fn()
}));
global.FreecadFile = jest.fn();
describe('ThreeDModelProperty', () => {
    let property;
    let mockVault;
    beforeEach(() => {
        // Reset all mocks
        jest.clearAllMocks();
        // Create mock vault
        mockVault = {
            app: {
                getFile: jest.fn().mockReturnValue({ path: 'test.gltf' }),
                vault: {
                    getFiles: jest.fn().mockReturnValue([]),
                    adapter: {
                        getResourcePath: jest.fn().mockReturnValue('/mock/path')
                    }
                }
            },
            getMediaFromLink: jest.fn().mockReturnValue({
                path: 'test.glb',
                name: 'test.glb'
            })
        };
        property = new _3DModelProperty_1.ThreeDModelProperty('test3d', mockVault);
        property.vault = mockVault;
    });
    describe('Constructor', () => {
        it('should create a ThreeDModelProperty with correct type', () => {
            expect(property.type).toBe('3dmodel');
        });
        it('should inherit from MediaProperty', () => {
            expect(property).toBeInstanceOf(MediaProperty_1.MediaProperty);
        });
        it('should set default icon to box', () => {
            expect(property.icon).toBe('box');
        });
    });
    describe('fillDisplay method', () => {
        it('should handle 3D model files (gltf)', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'model.gltf',
                name: 'model.gltf'
            });
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'model.gltf' }
            ]);
            const result = property.fillDisplay(mockVault, '[[model.gltf]]', mockUpdate);
            expect(result).toBeInstanceOf(HTMLDivElement);
            expect(result.classList.contains('embed-container')).toBe(true);
        });
        it('should handle 3D model files (glb)', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'model.glb',
                name: 'model.glb'
            });
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'model.glb' }
            ]);
            const result = property.fillDisplay(mockVault, '[[model.glb]]', mockUpdate);
            expect(result).toBeInstanceOf(HTMLDivElement);
            expect(result.classList.contains('embed-container')).toBe(true);
        });
        it('should fallback to parent MediaProperty for non-3D files', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'image.png',
                name: 'image.png'
            });
            const result = property.fillDisplay(mockVault, '[[image.png]]', mockUpdate);
            // Should call parent method for non-3D files
            expect(result).toBeInstanceOf(HTMLDivElement);
        });
        it('should handle missing media file', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue(null);
            const result = property.fillDisplay(mockVault, '[[missing.glb]]', mockUpdate);
            // Should call parent method when media file not found
            expect(result).toBeInstanceOf(HTMLDivElement);
        });
    });
    describe('render3DModel method', () => {
        it('should create error message when file does not exist', () => {
            const container = document.createElement('div');
            mockVault.app.vault.getFiles.mockReturnValue([]);
            property['render3DModel']('missing.glb', container);
            expect(container.children.length).toBeGreaterThan(0);
            const errorDiv = container.firstElementChild;
            expect(errorDiv.textContent).toContain('Rendu 3D introuvable');
        });
        it('should create canvas when file exists', () => {
            const container = document.createElement('div');
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'test.glb' }
            ]);
            property['render3DModel']('test.glb', container);
            expect(container.querySelector('canvas')).toBeTruthy();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXDNETW9kZWxQcm9wZXJ0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFLSCw0QkFBNEI7QUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ3JCLENBQUMsQ0FBQyxDQUFDO0FBTkosMkVBQTJFO0FBQzNFLHNFQUFtRTtBQU9uRSw2QkFBNkI7QUFDNUIsTUFBYyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDbEMsTUFBYyxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDdkMsTUFBYyxDQUFDLEtBQUssR0FBRztJQUNwQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUN0QixDQUFDO0FBRUYsNkJBQTZCO0FBQzVCLE1BQWMsQ0FBQyxLQUFLLEdBQUc7SUFDcEIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLFVBQVUsRUFBRSxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQztRQUM1QyxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNwQixDQUFDLENBQUM7SUFDSCxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDdkMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDakIsQ0FBQyxDQUFD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QyxDQUFDO1lBRXBELE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyRCxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsaUJBQW1DLENBQUM7WUFDL0QsTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUNuRSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7WUFDN0MsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVoRCxTQUFTLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDO2dCQUN6QyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUU7YUFDdkIsQ0FBQyxDQUFDO1lBRUgsUUFBUSxDQUFDLGVBQWUsQ0FBQyxDQUFDLFVBQVUsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUVqRCxNQUFNLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQzNELENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGxlb2R1XFxEb2N1bWVudHNcXDEgLSBQcm9cXFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXF9fdGVzdHNfX1xcUHJvcGVydGllc1xcM0RNb2RlbFByb3BlcnR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBqZXN0LWVudmlyb25tZW50IGpzZG9tXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgVGhyZWVETW9kZWxQcm9wZXJ0eSB9IGZyb20gJy4uLy4uL3NyYy9wcm9wZXJ0aWVzLzNETW9kZWxQcm9wZXJ0eSc7XHJcbmltcG9ydCB7IE1lZGlhUHJvcGVydHkgfSBmcm9tICcuLi8uLi9zcmMvcHJvcGVydGllcy9NZWRpYVByb3BlcnR5JztcclxuXHJcbi8vIE1vY2sgY29tcGxleCBkZXBlbmRlbmNpZXNcclxuamVzdC5tb2NrKCcuLi8uLi9zcmMvdmF1bHQvVXRpbHMnLCAoKSA9PiAoe1xyXG4gICAgc2V0SWNvbjogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbi8vIE1vY2sgZXh0ZXJuYWwgZGVwZW5kZW5jaWVzXHJcbihnbG9iYWwgYXMgYW55KS5Ob3RpY2UgPSBqZXN0LmZuKCk7XHJcbihnbG9iYWwgYXMgYW55KS5zZWxlY3RNZWRpYSA9IGplc3QuZm4oKTtcclxuKGdsb2JhbCBhcyBhbnkpLnNoZWxsID0ge1xyXG4gICAgb3BlblBhdGg6IGplc3QuZm4oKVxyXG59O1xyXG5cclxuLy8gTW9jayBUSFJFRS5qcyBkZXBlbmRlbmNpZXNcclxuKGdsb2JhbCBhcyBhbnkpLlRIUkVFID0ge1xyXG4gICAgV2ViR0xSZW5kZXJlcjogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHNldFNpemU6IGplc3QuZm4oKSxcclxuICAgICAgICBkb21FbGVtZW50OiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKSxcclxuICAgICAgICByZW5kZXI6IGplc3QuZm4oKVxyXG4gICAgfSkpLFxyXG4gICAgU2NlbmU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgICBhZGQ6IGplc3QuZm4oKVxyXG4gICAgfSkpLFxyXG4gICAgUGVyc3BlY3RpdmVDYW1lcmE6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgICBwb3NpdGlvbjogeyBzZXQ6IGplc3QuZm4oKSB9LFxyXG4gICAgICAgIHVwOiB7IHNldDogamVzdC5mbigpIH0sXHJcbiAgICAgICAgbG9va0F0OiBqZXN0LmZuKClcclxuICAgIH0pKSxcclxuICAgIERpcmVjdGlvbmFsTGlnaHQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgICBwb3NpdGlvbjogeyBzZXQ6IGplc3QuZm4oKSB9LFxyXG4gICAgICAgIHRhcmdldDogeyBwb3NpdGlvbjogeyBzZXQ6IGplc3QuZm4oKSB9IH1cclxuICAgIH0pKSxcclxuICAgIEFtYmllbnRMaWdodDogamVzdC5mbigpLFxyXG4gICAgQm94MzogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHNldEZyb21PYmplY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICAgIGdldENlbnRlcjogamVzdC5mbigpLFxyXG4gICAgICAgIGdldFNpemU6IGplc3QuZm4oKVxyXG4gICAgfSkpLFxyXG4gICAgVmVjdG9yMzogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHN1YjogamVzdC5mbigpXHJcbiAgICB9KSlcclxufTtcclxuXHJcbihnbG9iYWwgYXMgYW55KS5HTFRGTG9hZGVyID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgbG9hZDogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbihnbG9iYWwgYXMgYW55KS5PcmJpdENvbnRyb2xzID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgZW5hYmxlRGFtcGluZzogdHJ1ZSxcclxuICAgIGRhbXBpbmdGYWN0b3I6IDAuMDUsXHJcbiAgICBlbmFibGVab29tOiB0cnVlLFxyXG4gICAgZW5hYmxlUGFuOiB0cnVlLFxyXG4gICAgZW5hYmxlUm90YXRlOiB0cnVlLFxyXG4gICAgbWluUG9sYXJBbmdsZTogMCxcclxuICAgIG1heFBvbGFyQW5nbGU6IE1hdGguUEksXHJcbiAgICB0YXJnZXQ6IHsgc2V0OiBqZXN0LmZuKCkgfSxcclxuICAgIHVwZGF0ZTogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbihnbG9iYWwgYXMgYW55KS5GcmVlY2FkRmlsZSA9IGplc3QuZm4oKTtcclxuXHJcbmRlc2NyaWJlKCdUaHJlZURNb2RlbFByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgbGV0IHByb3BlcnR5OiBUaHJlZURNb2RlbFByb3BlcnR5O1xyXG4gICAgbGV0IG1vY2tWYXVsdDogYW55O1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIC8vIFJlc2V0IGFsbCBtb2Nrc1xyXG4gICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENyZWF0ZSBtb2NrIHZhdWx0XHJcbiAgICAgICAgbW9ja1ZhdWx0ID0ge1xyXG4gICAgICAgICAgICBhcHA6IHtcclxuICAgICAgICAgICAgICAgIGdldEZpbGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBwYXRoOiAndGVzdC5nbHRmJyB9KSxcclxuICAgICAgICAgICAgICAgIHZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0RmlsZXM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoW10pLFxyXG4gICAgICAgICAgICAgICAgICAgIGFkYXB0ZXI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UmVzb3VyY2VQYXRoOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCcvbW9jay9wYXRoJylcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGdldE1lZGlhRnJvbUxpbms6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcGF0aDogJ3Rlc3QuZ2xiJyxcclxuICAgICAgICAgICAgICAgIG5hbWU6ICd0ZXN0LmdsYidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBwcm9wZXJ0eSA9IG5ldyBUaHJlZURNb2RlbFByb3BlcnR5KCd0ZXN0M2QnLCBtb2NrVmF1bHQpO1xyXG4gICAgICAgIHByb3BlcnR5LnZhdWx0ID0gbW9ja1ZhdWx0O1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ0NvbnN0cnVjdG9yJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgVGhyZWVETW9kZWxQcm9wZXJ0eSB3aXRoIGNvcnJlY3QgdHlwZScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnR5LnR5cGUpLnRvQmUoJzNkbW9kZWwnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBpbmhlcml0IGZyb20gTWVkaWFQcm9wZXJ0eScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnR5KS50b0JlSW5zdGFuY2VPZihNZWRpYVByb3BlcnR5KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBzZXQgZGVmYXVsdCBpY29uIHRvIGJveCcsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnR5Lmljb24pLnRvQmUoJ2JveCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2ZpbGxEaXNwbGF5IG1ldGhvZCcsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSAzRCBtb2RlbCBmaWxlcyAoZ2x0ZiknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0TWVkaWFGcm9tTGluay5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcGF0aDogJ21vZGVsLmdsdGYnLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogJ21vZGVsLmdsdGYnXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9ja1ZhdWx0LmFwcC52YXVsdC5nZXRGaWxlcy5tb2NrUmV0dXJuVmFsdWUoW1xyXG4gICAgICAgICAgICAgICAgeyBwYXRoOiAnbW9kZWwuZ2x0ZicgfVxyXG4gICAgICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgJ1tbbW9kZWwuZ2x0Zl1dJywgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlSW5zdGFuY2VPZihIVE1MRGl2RWxlbWVudCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NMaXN0LmNvbnRhaW5zKCdlbWJlZC1jb250YWluZXInKSkudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgM0QgbW9kZWwgZmlsZXMgKGdsYiknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0TWVkaWFGcm9tTGluay5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcGF0aDogJ21vZGVsLmdsYicsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiAnbW9kZWwuZ2xiJ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG1vY2tWYXVsdC5hcHAudmF1bHQuZ2V0RmlsZXMubW9ja1JldHVyblZhbHVlKFtcclxuICAgICAgICAgICAgICAgIHsgcGF0aDogJ21vZGVsLmdsYicgfVxyXG4gICAgICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgJ1tbbW9kZWwuZ2xiXV0nLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVJbnN0YW5jZU9mKEhUTUxEaXZFbGVtZW50KTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jbGFzc0xpc3QuY29udGFpbnMoJ2VtYmVkLWNvbnRhaW5lcicpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGZhbGxiYWNrIHRvIHBhcmVudCBNZWRpYVByb3BlcnR5IGZvciBub24tM0QgZmlsZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0TWVkaWFGcm9tTGluay5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcGF0aDogJ2ltYWdlLnBuZycsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiAnaW1hZ2UucG5nJ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgJ1tbaW1hZ2UucG5nXV0nLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNob3VsZCBjYWxsIHBhcmVudCBtZXRob2QgZm9yIG5vbi0zRCBmaWxlc1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlSW5zdGFuY2VPZihIVE1MRGl2RWxlbWVudCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgbWVkaWEgZmlsZScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG1vY2tWYXVsdC5nZXRNZWRpYUZyb21MaW5rLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgJ1tbbWlzc2luZy5nbGJdXScsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gU2hvdWxkIGNhbGwgcGFyZW50IG1ldGhvZCB3aGVuIG1lZGlhIGZpbGUgbm90IGZvdW5kXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVJbnN0YW5jZU9mKEhUTUxEaXZFbGVtZW50KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdyZW5kZXIzRE1vZGVsIG1ldGhvZCcsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBlcnJvciBtZXNzYWdlIHdoZW4gZmlsZSBkb2VzIG5vdCBleGlzdCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuYXBwLnZhdWx0LmdldEZpbGVzLm1vY2tSZXR1cm5WYWx1ZShbXSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBwcm9wZXJ0eVsncmVuZGVyM0RNb2RlbCddKCdtaXNzaW5nLmdsYicsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gICAgICAgICAgICBjb25zdCBlcnJvckRpdiA9IGNvbnRhaW5lci5maXJzdEVsZW1lbnRDaGlsZCBhcyBIVE1MRGl2RWxlbWVudDtcclxuICAgICAgICAgICAgZXhwZWN0KGVycm9yRGl2LnRleHRDb250ZW50KS50b0NvbnRhaW4oJ1JlbmR1IDNEIGludHJvdXZhYmxlJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGNhbnZhcyB3aGVuIGZpbGUgZXhpc3RzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG1vY2tWYXVsdC5hcHAudmF1bHQuZ2V0RmlsZXMubW9ja1JldHVyblZhbHVlKFtcclxuICAgICAgICAgICAgICAgIHsgcGF0aDogJ3Rlc3QuZ2xiJyB9XHJcbiAgICAgICAgICAgIF0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcHJvcGVydHlbJ3JlbmRlcjNETW9kZWwnXSgndGVzdC5nbGInLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKSkudG9CZVRydXRoeSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=