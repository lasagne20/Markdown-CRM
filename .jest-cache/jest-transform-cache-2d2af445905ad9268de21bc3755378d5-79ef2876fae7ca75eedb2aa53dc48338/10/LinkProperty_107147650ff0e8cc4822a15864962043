7a349e02d0a8765edf531da3c5f4dede
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.LinkProperty = void 0;
const Property_1 = require("./Property");
class LinkProperty extends Property_1.Property {
    constructor(name, args = { icon: "square-arrow-out-up-right" }) {
        super(name, args);
        this.type = "link";
    }
    createIconContainer(update) {
        const iconContainer = super.createIconContainer(update);
        iconContainer.style.cursor = "pointer";
        if (!this.static) {
            iconContainer.onclick = (event) => this.modifyField(event);
        }
        return iconContainer;
    }
    validate(url) {
        // Ajoute le préfixe "http://" si l'URL ne commence pas par http:// ou https://
        let fixedUrl = url.trim();
        // Si le lien ne commence pas par http:// ou https://, ajoute "http://"
        if (!/^https?:\/\//i.test(fixedUrl)) {
            fixedUrl = "http://" + fixedUrl;
        }
        const urlRegex = /^(https?:\/\/)?([a-zA-Z0-9_-]+\.)+[a-zA-Z]{2,6}(\/[a-zA-Z0-9_-]+)*\/?$/;
        if (!urlRegex.test(fixedUrl)) {
            return "";
        }
        return fixedUrl;
    }
    getPretty(value) {
        if (!value)
            return value;
        try {
            const urlObj = new URL(value);
            // Garde le domaine, puis les premiers segments du chemin si trop long
            let pretty = urlObj.hostname;
            if (urlObj.pathname && urlObj.pathname !== "/") {
                const segments = urlObj.pathname.split("/").filter(Boolean);
                if (segments.length > 2) {
                    pretty += "/" + segments.slice(0, 2).join("/") + "/...";
                }
                else {
                    pretty += urlObj.pathname;
                }
            }
            return pretty;
        }
        catch {
            // Si ce n'est pas une URL valide, retourne la valeur d'origine sans protocole
            return value.replace(/^https?:\/\//, "");
        }
    }
    // Fonction pour créer le lien de l'field
    createFieldLink(value) {
        const link = document.createElement("a");
        link.href = this.getLink(value);
        link.textContent = this.getPretty(value) || "";
        link.classList.add("field-link");
        link.oncontextmenu = (event) => {
            event.preventDefault();
            const value = link.textContent;
            if (value) {
                navigator.clipboard.writeText(value).then(() => {
                    new Notice("Lien copié dans le presse-papiers");
                });
            }
        };
        return link;
    }
}
exports.LinkProperty = LinkProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXExpbmtQcm9wZXJ0eS50cyIsIm1hcHBpbmdzIjoiOzs7QUFDQSx5Q0FBc0M7QUFRdEMsTUFBYSxZQUFhLFNBQVEsbUJBQVE7SUFJeEMsWUFBWSxJQUFZLEVBQUUsT0FBeUIsRUFBRSxJQUFJLEVBQUUsMkJBQTJCLEVBQUU7UUFDdEYsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUhYLFNBQUksR0FBWSxNQUFNLENBQUM7SUFJaEMsQ0FBQztJQUVRLG1CQUFtQixDQUFDLE1BQXdDO1FBQ25FLE1BQU0sYUFBYSxHQUFHLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4RCxhQUFhLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUM7UUFFdkMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNqQixhQUFhLENBQUMsT0FBTyxHQUFHLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdELENBQUM7UUFFRCxPQUFPLGFBQWEsQ0FBQztJQUN2QixDQUFDO0lBR1UsUUFBUSxDQUFDLEdBQVc7UUFDM0IsK0VBQStFO1FBQy9FLElBQUksUUFBUSxHQUFHLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUUxQix1RUFBdUU7UUFDdkUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztZQUNsQyxRQUFRLEdBQUcsU0FBUyxHQUFHLFFBQVEsQ0FBQztRQUNwQyxDQUFDO1FBQ0QsTUFBTSxRQUFRLEdBQUcsd0VBQXdFLENBQUM7UUFDMUYsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztZQUMzQixPQUFPLEVBQUUsQ0FBQztRQUNkLENBQUM7UUFDRCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBR1EsU0FBUyxDQUFDLEtBQWE7UUFDOUIsSUFBSSxDQUFDLEtBQUs7WUFBRSxPQUFPLEtBQUssQ0FBQztRQUN6QixJQUFJLENBQUM7WUFDSCxNQUFNLE1BQU0sR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM5QixzRUFBc0U7WUFDdEUsSUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQztZQUM3QixJQUFJLE1BQU0sQ0FBQyxRQUFRLElBQUksTUFBTSxDQUFDLFFBQVEsS0FBSyxHQUFHLEVBQUUsQ0FBQztnQkFDL0MsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUM1RCxJQUFJLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQ3hCLE1BQU0sSUFBSSxHQUFHLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQztnQkFDMUQsQ0FBQztxQkFBTSxDQUFDO29CQUNOLE1BQU0sSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDO2dCQUM1QixDQUFDO1lBQ0gsQ0FBQztZQUNELE9BQU8sTUFBTSxDQUFDO1FBQ2hCLENBQUM7UUFBQyxNQUFNLENBQUM7WUFDUCw4RUFBOEU7WUFDOUUsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMzQyxDQUFDO0lBQ0gsQ0FBQztJQUVELHlDQUF5QztJQUNoQyxlQUFlLENBQUMsS0FBYTtRQUNwQyxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQy9DLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUM3QixLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDdkIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztZQUMvQixJQUFJLEtBQUssRUFBRSxDQUFDO2dCQUNWLFNBQVMsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUU7b0JBQ2pELElBQUksTUFBTSxDQUFDLG1DQUFtQyxDQUFDLENBQUM7Z0JBQzlDLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztRQUNILENBQUMsQ0FBQztRQUNGLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztDQUNKO0FBMUVELG9DQTBFQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGxlb2R1XFxEb2N1bWVudHNcXDEgLSBQcm9cXFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXHNyY1xccHJvcGVydGllc1xcTGlua1Byb3BlcnR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE15VmF1bHQgfSBmcm9tIFwiLi4vdmF1bHQvTXlWYXVsdFwiO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eSB9IGZyb20gXCIuL1Byb3BlcnR5XCI7XHJcbmltcG9ydCB7IHNldEljb24gfSBmcm9tIFwiLi4vdmF1bHQvVXRpbHNcIjtcclxuXHJcbi8vIFRlbXBvcmFyeSB0eXBlIGRlY2xhcmF0aW9uIGZvciBtaXNzaW5nIGltcG9ydFxyXG5kZWNsYXJlIGNvbnN0IE5vdGljZTogYW55O1xyXG5cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgTGlua1Byb3BlcnR5IGV4dGVuZHMgUHJvcGVydHl7XHJcblxyXG4gIG92ZXJyaWRlIHR5cGUgOiBzdHJpbmcgPSBcImxpbmtcIjtcclxuXHJcbiAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCBhcmdzOiB7IGljb24/OiBzdHJpbmd9ID0geyBpY29uOiBcInNxdWFyZS1hcnJvdy1vdXQtdXAtcmlnaHRcIiB9KSB7XHJcbiAgICBzdXBlcihuYW1lLCBhcmdzKTtcclxuICB9XHJcblxyXG4gIG92ZXJyaWRlIGNyZWF0ZUljb25Db250YWluZXIodXBkYXRlOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPikge1xyXG4gICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IHN1cGVyLmNyZWF0ZUljb25Db250YWluZXIodXBkYXRlKTtcclxuICAgIGljb25Db250YWluZXIuc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7XHJcblxyXG4gICAgaWYgKCF0aGlzLnN0YXRpYykge1xyXG4gICAgICBpY29uQ29udGFpbmVyLm9uY2xpY2sgPSAoZXZlbnQpID0+IHRoaXMubW9kaWZ5RmllbGQoZXZlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBpY29uQ29udGFpbmVyO1xyXG4gIH1cclxuXHJcblxyXG4gICAgb3ZlcnJpZGUgdmFsaWRhdGUodXJsOiBzdHJpbmcpIHtcclxuICAgICAgLy8gQWpvdXRlIGxlIHByw6lmaXhlIFwiaHR0cDovL1wiIHNpIGwnVVJMIG5lIGNvbW1lbmNlIHBhcyBwYXIgaHR0cDovLyBvdSBodHRwczovL1xyXG4gICAgICBsZXQgZml4ZWRVcmwgPSB1cmwudHJpbSgpO1xyXG4gIFxyXG4gICAgICAvLyBTaSBsZSBsaWVuIG5lIGNvbW1lbmNlIHBhcyBwYXIgaHR0cDovLyBvdSBodHRwczovLywgYWpvdXRlIFwiaHR0cDovL1wiXHJcbiAgICAgIGlmICghL15odHRwcz86XFwvXFwvL2kudGVzdChmaXhlZFVybCkpIHtcclxuICAgICAgICAgIGZpeGVkVXJsID0gXCJodHRwOi8vXCIgKyBmaXhlZFVybDtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCB1cmxSZWdleCA9IC9eKGh0dHBzPzpcXC9cXC8pPyhbYS16QS1aMC05Xy1dK1xcLikrW2EtekEtWl17Miw2fShcXC9bYS16QS1aMC05Xy1dKykqXFwvPyQvO1xyXG4gICAgICBpZiAoIXVybFJlZ2V4LnRlc3QoZml4ZWRVcmwpKSB7XHJcbiAgICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZml4ZWRVcmw7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIG92ZXJyaWRlIGdldFByZXR0eSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgIGlmICghdmFsdWUpIHJldHVybiB2YWx1ZTtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1cmxPYmogPSBuZXcgVVJMKHZhbHVlKTtcclxuICAgICAgICAvLyBHYXJkZSBsZSBkb21haW5lLCBwdWlzIGxlcyBwcmVtaWVycyBzZWdtZW50cyBkdSBjaGVtaW4gc2kgdHJvcCBsb25nXHJcbiAgICAgICAgbGV0IHByZXR0eSA9IHVybE9iai5ob3N0bmFtZTtcclxuICAgICAgICBpZiAodXJsT2JqLnBhdGhuYW1lICYmIHVybE9iai5wYXRobmFtZSAhPT0gXCIvXCIpIHtcclxuICAgICAgICAgIGNvbnN0IHNlZ21lbnRzID0gdXJsT2JqLnBhdGhuYW1lLnNwbGl0KFwiL1wiKS5maWx0ZXIoQm9vbGVhbik7XHJcbiAgICAgICAgICBpZiAoc2VnbWVudHMubGVuZ3RoID4gMikge1xyXG4gICAgICAgICAgICBwcmV0dHkgKz0gXCIvXCIgKyBzZWdtZW50cy5zbGljZSgwLCAyKS5qb2luKFwiL1wiKSArIFwiLy4uLlwiO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcHJldHR5ICs9IHVybE9iai5wYXRobmFtZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHByZXR0eTtcclxuICAgICAgfSBjYXRjaCB7XHJcbiAgICAgICAgLy8gU2kgY2Ugbidlc3QgcGFzIHVuZSBVUkwgdmFsaWRlLCByZXRvdXJuZSBsYSB2YWxldXIgZCdvcmlnaW5lIHNhbnMgcHJvdG9jb2xlXHJcbiAgICAgICAgcmV0dXJuIHZhbHVlLnJlcGxhY2UoL15odHRwcz86XFwvXFwvLywgXCJcIik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBGb25jdGlvbiBwb3VyIGNyw6llciBsZSBsaWVuIGRlIGwnZmllbGRcclxuICAgIG92ZXJyaWRlIGNyZWF0ZUZpZWxkTGluayh2YWx1ZTogc3RyaW5nKSA6IGFueSB7XHJcbiAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuICAgICAgbGluay5ocmVmID0gdGhpcy5nZXRMaW5rKHZhbHVlKTtcclxuICAgICAgbGluay50ZXh0Q29udGVudCA9IHRoaXMuZ2V0UHJldHR5KHZhbHVlKSB8fCBcIlwiO1xyXG4gICAgICBsaW5rLmNsYXNzTGlzdC5hZGQoXCJmaWVsZC1saW5rXCIpO1xyXG4gICAgICBsaW5rLm9uY29udGV4dG1lbnUgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gbGluay50ZXh0Q29udGVudDtcclxuICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KHZhbHVlKS50aGVuKCgpID0+IHtcclxuICAgICAgICBuZXcgTm90aWNlKFwiTGllbiBjb3Bpw6kgZGFucyBsZSBwcmVzc2UtcGFwaWVyc1wiKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgcmV0dXJuIGxpbms7XHJcbiAgICB9XHJcbn0iXSwidmVyc2lvbiI6M30=