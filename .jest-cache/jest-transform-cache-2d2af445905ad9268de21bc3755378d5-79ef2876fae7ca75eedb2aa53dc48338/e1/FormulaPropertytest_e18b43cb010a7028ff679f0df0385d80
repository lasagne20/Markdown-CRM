aa4d5a25747ab082063a9fc0668135db
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock des dépendances
jest.mock('../../src/vault/Classe');
jest.mock('../../src/vault/Vault');
const FormulaProperty_1 = require("../../src/properties/FormulaProperty");
describe('FormulaProperty', () => {
    let formulaProperty;
    let mockFile;
    let mockVault;
    beforeEach(() => {
        // Configuration des mocks
        mockVault = {
            getName: jest.fn().mockReturnValue('TestVault'),
            app: {
                vault: {
                    getName: jest.fn().mockReturnValue('TestVault')
                },
                setIcon: jest.fn((element, iconName) => {
                    element.setAttribute('data-icon', iconName);
                    element.textContent = `[${iconName}]`;
                })
            },
            readLinkFile: jest.fn()
        };
        mockFile = {
            vault: mockVault,
            getName: jest.fn(),
            getAllProperties: jest.fn(),
            getMetadataValue: jest.fn(),
            updateMetadata: jest.fn()
        };
        // Reset des mocks
        jest.clearAllMocks();
    });
    describe('Constructor', () => {
        test('should create formula property with default arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', mockVault, '1 + 1');
            expect(formulaProperty.name).toBe('testFormula');
            expect(formulaProperty.formula).toBe('1 + 1');
            expect(formulaProperty.type).toBe('formula');
            expect(formulaProperty.write).toBe(false);
            expect(formulaProperty.static).toBe(true);
        });
        test('should create formula property with custom arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', mockVault, '2 * 3', {
                icon: 'calculator',
                static: false,
                write: true
            });
            expect(formulaProperty.name).toBe('testFormula');
            expect(formulaProperty.formula).toBe('2 * 3');
            expect(formulaProperty.type).toBe('formula');
            expect(formulaProperty.write).toBe(true);
            expect(formulaProperty.static).toBe(false);
            expect(formulaProperty.icon).toBe('calculator');
        });
        test('should handle partial arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', mockVault, 'x + y', {
                icon: 'math',
                write: true
                // static will use default value from FormulaProperty constructor (true)
            });
            expect(formulaProperty.write).toBe(true);
            // La valeur sera false car LinkProperty n'override pas le default de Property
            expect(formulaProperty.static).toBe(false);
            expect(formulaProperty.icon).toBe('math');
        });
    });
    describe('validate', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', mockVault, '1 + 1');
        });
        test('should return input value unchanged', () => {
            expect(formulaProperty.validate('test')).toBe('test');
            expect(formulaProperty.validate('123')).toBe('123');
            expect(formulaProperty.validate('')).toBe('');
        });
    });
    describe('read', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('totalFormula', mockVault, 'price * quantity');
            // Mock des propriétés du fichier
            mockFile.getAllProperties.mockReturnValue({
                price: { name: 'price' },
                quantity: { name: 'quantity' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getName.mockReturnValue('TestFile');
        });
        test('should execute simple arithmetic formula', () => {
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 10;
                if (key === 'quantity')
                    return 5;
                return null;
            });
            const result = formulaProperty.read(mockFile);
            expect(result).toBe(50);
        });
        test('should handle formula with return statement', () => {
            const formulaWithReturn = new FormulaProperty_1.FormulaProperty('test', mockVault, 'return price + quantity');
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 15;
                if (key === 'quantity')
                    return 25;
                return null;
            });
            const result = formulaWithReturn.read(mockFile);
            expect(result).toBe(40);
        });
        test('should sanitize property names (remove spaces)', () => {
            mockFile.getAllProperties.mockReturnValue({
                'unit price': { name: 'unit price' },
                'item count': { name: 'item count' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'unit price')
                    return 12;
                if (key === 'item count')
                    return 3;
                return null;
            });
            const sanitizedFormula = new FormulaProperty_1.FormulaProperty('test', mockVault, 'unitprice * itemcount');
            const result = sanitizedFormula.read(mockFile);
            expect(result).toBe(36);
        });
        test('should exclude self property from formula context', () => {
            mockFile.getAllProperties.mockReturnValue({
                price: { name: 'price' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 100;
                if (key === 'totalFormula')
                    return 999; // Should be excluded
                return null;
            });
            const selfExcludingFormula = new FormulaProperty_1.FormulaProperty('totalFormula', mockVault, 'price * 2');
            const result = selfExcludingFormula.read(mockFile);
            expect(result).toBe(200);
        });
        test('should handle formula errors gracefully (ReferenceError)', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockFile.getMetadataValue.mockReturnValue(null);
            const faultyFormula = new FormulaProperty_1.FormulaProperty('test', mockVault, 'undefinedVariable * 5');
            const result = faultyFormula.read(mockFile);
            expect(result).toBeNull();
            // Test simple que console.error a été appelé avec le bon message
            expect(consoleSpy).toHaveBeenCalled();
            const errorCall = consoleSpy.mock.calls[0];
            expect(errorCall[0]).toContain('Formula error : undefinedVariable * 5');
            expect(errorCall[0]).toContain('This is all the properties available');
            consoleSpy.mockRestore();
        });
        test('should handle general formula errors', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockFile.getMetadataValue.mockReturnValue(null);
            const faultyFormula = new FormulaProperty_1.FormulaProperty('test', mockVault, 'throw new Error("test error")');
            const result = faultyFormula.read(mockFile);
            expect(result).toBeNull();
            expect(consoleSpy).toHaveBeenCalledWith(expect.stringContaining('Formula error : throw new Error("test error")'));
            consoleSpy.mockRestore();
        });
        describe('write functionality', () => {
            test('should update metadata when write is true and value changed', () => {
                const writeFormula = new FormulaProperty_1.FormulaProperty('total', mockVault, 'price + tax', {
                    icon: '',
                    write: true
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    if (key === 'total')
                        return 110; // Old value
                    return null;
                });
                const result = writeFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).toHaveBeenCalledWith('total', 120);
            });
            test('should not update metadata when write is true but value unchanged', () => {
                const writeFormula = new FormulaProperty_1.FormulaProperty('total', mockVault, 'price + tax', {
                    icon: '',
                    write: true
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    if (key === 'total')
                        return 120; // Same as calculated
                    return null;
                });
                const result = writeFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).not.toHaveBeenCalled();
            });
            test('should not update metadata when write is false', () => {
                const readOnlyFormula = new FormulaProperty_1.FormulaProperty('total', mockVault, 'price + tax', {
                    icon: '',
                    write: false
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    return null;
                });
                const result = readOnlyFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).not.toHaveBeenCalled();
            });
        });
    });
    describe('getPretty', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', mockVault, '1 + 1');
        });
        test('should return input if falsy', () => {
            expect(formulaProperty.getPretty('')).toBe('');
            expect(formulaProperty.getPretty(null)).toBe(null);
            expect(formulaProperty.getPretty(undefined)).toBe(undefined);
        });
        test('should handle non-string values', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            const numberValue = 123;
            const result = formulaProperty.getPretty(numberValue);
            expect(result).toBe(123);
            expect(consoleSpy).toHaveBeenCalledWith('Value is not a string:', 123);
            consoleSpy.mockRestore();
        });
        test('should format dates in French locale', () => {
            const dateString = '2023-12-25';
            const result = formulaProperty.getPretty(dateString);
            expect(result).toBe('25 décembre 2023');
        });
        test('should format integers with French locale formatting', () => {
            const integerString = '1234';
            const result = formulaProperty.getPretty(integerString);
            // Vérifions d'abord le résultat réel
            console.log('Actual result:', JSON.stringify(result));
            // Le format peut varier selon l'environnement, testons que c'est bien formaté
            expect(result).toMatch(/1[,\s]234[.,]00/);
        });
        test('should not format decimal numbers as integers', () => {
            const decimalString = '123.45';
            const result = formulaProperty.getPretty(decimalString);
            expect(result).toBe('123.45');
        });
        test('should clean URLs by removing protocols', () => {
            expect(formulaProperty.getPretty('https://example.com')).toBe('example.com');
            expect(formulaProperty.getPretty('http://test.org')).toBe('test.org');
        });
        test('should clean Obsidian links by removing brackets', () => {
            expect(formulaProperty.getPretty('[[Note Title]]')).toBe('Note Title');
        });
        test('should handle complex strings with multiple cleanups', () => {
            const complexString = 'https://[[example.com]]';
            const result = formulaProperty.getPretty(complexString);
            expect(result).toBe('example.com');
        });
        test('should return regular strings unchanged', () => {
            const regularString = 'Just a normal string';
            const result = formulaProperty.getPretty(regularString);
            expect(result).toBe('Just a normal string');
        });
    });
    describe('getLink', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', mockVault, '1 + 1');
            formulaProperty.vault = mockVault;
        });
        test('should return input if falsy', () => {
            expect(formulaProperty.getLink('')).toBe('');
            expect(formulaProperty.getLink(null)).toBe(null);
            expect(formulaProperty.getLink(undefined)).toBe(undefined);
        });
        test('should create mailto links for emails', () => {
            expect(formulaProperty.getLink('test@example.com')).toBe('mailto:test@example.com');
            expect(formulaProperty.getLink('user.name+tag@domain.co.uk')).toBe('mailto:user.name+tag@domain.co.uk');
        });
        test('should handle Obsidian links', () => {
            mockVault.readLinkFile.mockReturnValue([null, 'path/to/file.md']);
            const result = formulaProperty.getLink('[[My Note]]');
            expect(result).toBe('obsidian://open?vault=TestVault&file=path%2Fto%2Ffile.md');
            expect(mockVault.readLinkFile).toHaveBeenCalledWith('My Note', true);
        });
        test('should handle Obsidian link errors gracefully', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockVault.readLinkFile.mockImplementation(() => {
                throw new Error('File not found');
            });
            const result = formulaProperty.getLink('[[Invalid Note]]');
            expect(result).toBe('[[Invalid Note]]');
            expect(consoleSpy).toHaveBeenCalledWith('Error parsing link for [[Invalid Note]]:', expect.any(Error));
            consoleSpy.mockRestore();
        });
        test('should handle URLs with protocols', () => {
            expect(formulaProperty.getLink('https://example.com')).toBe('https://example.com');
            expect(formulaProperty.getLink('http://test.org/path')).toBe('http://test.org/path');
        });
        test('should add protocol to URLs without them', () => {
            expect(formulaProperty.getLink('example.com')).toBe('http://example.com');
            expect(formulaProperty.getLink('test.org/path')).toBe('http://test.org/path');
        });
        test('should return regular strings unchanged', () => {
            const regularString = 'Just a normal string';
            const result = formulaProperty.getLink(regularString);
            expect(result).toBe('Just a normal string');
        });
        test('should handle invalid URL formats', () => {
            const invalidUrl = 'not-a-url';
            const result = formulaProperty.getLink(invalidUrl);
            expect(result).toBe('not-a-url');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXEZvcm11bGFQcm9wZXJ0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBSUEsdUJBQXVCO0FBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFKbkMsMEVBQXVFO0FBTXZFLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDN0IsSUFBSSxlQUFnQyxDQUFDO0lBQ3JDLElBQUksUUFBNkIsQ0FBQztJQUNsQyxJQUFJLFNBQTZCLENBQUM7SUFFbEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLDBCQUEwQjtRQUMxQixTQUFTLEdBQUc7WUFDUixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUM7WUFDL0MsR0FBRyxFQUFFO2dCQUNELEtBQUssRUFBRTtvQkFDSCxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUM7aUJBQ2xEO2dCQUNELE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBb0IsRUFBRSxRQUFnQixFQUFFLEVBQUU7b0JBQ3hELE9BQU8sQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDO29CQUM1QyxPQUFPLENBQUMsV0FBVyxHQUFHLElBQUksUUFBUSxHQUFHLENBQUM7Z0JBQzFDLENBQUMsQ0FBQzthQUNMO1lBQ0QsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDbkIsQ0FBQztRQUVULFFBQVEsR0FBRztZQUNQLEtBQUssRUFBRSxTQUFTO1lBQ2hCLE9BQU8sRUFBRSxJQUFJ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LE1BQU0sQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDbEYsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELE1BQU0sYUFBYSxHQUFHLHNCQUFzQixDQUFDO1lBQzdDLE1BQU0sTUFBTSxHQUFHLGVBQWUsQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7WUFFdEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtZQUMzQyxNQUFNLFVBQVUsR0FBRyxXQUFXLENBQUM7WUFDL0IsTUFBTSxNQUFNLEdBQUcsZUFBZSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUVuRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGxlb2R1XFxEb2N1bWVudHNcXDEgLSBQcm9cXFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXF9fdGVzdHNfX1xcUHJvcGVydGllc1xcRm9ybXVsYVByb3BlcnR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2xhc3NlIH0gZnJvbSAnLi4vLi4vc3JjL3ZhdWx0L0NsYXNzZSc7XHJcbmltcG9ydCB7IFZhdWx0IH0gZnJvbSAnLi4vLi4vc3JjL3ZhdWx0L1ZhdWx0JztcclxuaW1wb3J0IHsgRm9ybXVsYVByb3BlcnR5IH0gZnJvbSAnLi4vLi4vc3JjL3Byb3BlcnRpZXMvRm9ybXVsYVByb3BlcnR5JztcclxuXHJcbi8vIE1vY2sgZGVzIGTDqXBlbmRhbmNlc1xyXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy92YXVsdC9DbGFzc2UnKTtcclxuamVzdC5tb2NrKCcuLi8uLi9zcmMvdmF1bHQvVmF1bHQnKTtcclxuXHJcbmRlc2NyaWJlKCdGb3JtdWxhUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICBsZXQgZm9ybXVsYVByb3BlcnR5OiBGb3JtdWxhUHJvcGVydHk7XHJcbiAgICBsZXQgbW9ja0ZpbGU6IGplc3QuTW9ja2VkPENsYXNzZT47XHJcbiAgICBsZXQgbW9ja1ZhdWx0OiBqZXN0Lk1vY2tlZDxWYXVsdD47XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgLy8gQ29uZmlndXJhdGlvbiBkZXMgbW9ja3NcclxuICAgICAgICBtb2NrVmF1bHQgPSB7XHJcbiAgICAgICAgICAgIGdldE5hbWU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ1Rlc3RWYXVsdCcpLFxyXG4gICAgICAgICAgICBhcHA6IHtcclxuICAgICAgICAgICAgICAgIHZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0TmFtZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnVGVzdFZhdWx0JylcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzZXRJY29uOiBqZXN0LmZuKChlbGVtZW50OiBIVE1MRWxlbWVudCwgaWNvbk5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWljb24nLCBpY29uTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9IGBbJHtpY29uTmFtZX1dYDtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHJlYWRMaW5rRmlsZTogamVzdC5mbigpXHJcbiAgICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICAgIG1vY2tGaWxlID0ge1xyXG4gICAgICAgICAgICB2YXVsdDogbW9ja1ZhdWx0LFxyXG4gICAgICAgICAgICBnZXROYW1lOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICAgIGdldEFsbFByb3BlcnRpZXM6IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgZ2V0TWV0YWRhdGFWYWx1ZTogamVzdC5mbigpLFxyXG4gICAgICAgICAgICB1cGRhdGVNZXRhZGF0YTogamVzdC5mbigpXHJcbiAgICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICAgIC8vIFJlc2V0IGRlcyBtb2Nrc1xyXG4gICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ0NvbnN0cnVjdG9yJywgKCkgPT4ge1xyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBjcmVhdGUgZm9ybXVsYSBwcm9wZXJ0eSB3aXRoIGRlZmF1bHQgYXJndW1lbnRzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBmb3JtdWxhUHJvcGVydHkgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0ZXN0Rm9ybXVsYScsIG1vY2tWYXVsdCwgJzEgKyAxJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5Lm5hbWUpLnRvQmUoJ3Rlc3RGb3JtdWxhJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZm9ybXVsYSkudG9CZSgnMSArIDEnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS50eXBlKS50b0JlKCdmb3JtdWxhJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkud3JpdGUpLnRvQmUoZmFsc2UpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LnN0YXRpYykudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGNyZWF0ZSBmb3JtdWxhIHByb3BlcnR5IHdpdGggY3VzdG9tIGFyZ3VtZW50cycsICgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdEZvcm11bGEnLCBtb2NrVmF1bHQsICcyICogMycsIHtcclxuICAgICAgICAgICAgICAgIGljb246ICdjYWxjdWxhdG9yJyxcclxuICAgICAgICAgICAgICAgIHN0YXRpYzogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICB3cml0ZTogdHJ1ZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkubmFtZSkudG9CZSgndGVzdEZvcm11bGEnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5mb3JtdWxhKS50b0JlKCcyICogMycpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LnR5cGUpLnRvQmUoJ2Zvcm11bGEnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS53cml0ZSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5zdGF0aWMpLnRvQmUoZmFsc2UpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5Lmljb24pLnRvQmUoJ2NhbGN1bGF0b3InKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBwYXJ0aWFsIGFyZ3VtZW50cycsICgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdEZvcm11bGEnLCBtb2NrVmF1bHQsICd4ICsgeScsIHtcclxuICAgICAgICAgICAgICAgIGljb246ICdtYXRoJyxcclxuICAgICAgICAgICAgICAgIHdyaXRlOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAvLyBzdGF0aWMgd2lsbCB1c2UgZGVmYXVsdCB2YWx1ZSBmcm9tIEZvcm11bGFQcm9wZXJ0eSBjb25zdHJ1Y3RvciAodHJ1ZSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LndyaXRlKS50b0JlKHRydWUpO1xyXG4gICAgICAgICAgICAvLyBMYSB2YWxldXIgc2VyYSBmYWxzZSBjYXIgTGlua1Byb3BlcnR5IG4nb3ZlcnJpZGUgcGFzIGxlIGRlZmF1bHQgZGUgUHJvcGVydHlcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5zdGF0aWMpLnRvQmUoZmFsc2UpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5Lmljb24pLnRvQmUoJ21hdGgnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCd2YWxpZGF0ZScsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsIG1vY2tWYXVsdCwgJzEgKyAxJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gaW5wdXQgdmFsdWUgdW5jaGFuZ2VkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LnZhbGlkYXRlKCd0ZXN0JykpLnRvQmUoJ3Rlc3QnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS52YWxpZGF0ZSgnMTIzJykpLnRvQmUoJzEyMycpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LnZhbGlkYXRlKCcnKSkudG9CZSgnJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgncmVhZCcsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndG90YWxGb3JtdWxhJywgbW9ja1ZhdWx0LCAncHJpY2UgKiBxdWFudGl0eScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gTW9jayBkZXMgcHJvcHJpw6l0w6lzIGR1IGZpY2hpZXJcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0QWxsUHJvcGVydGllcy5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcHJpY2U6IHsgbmFtZTogJ3ByaWNlJyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgIHF1YW50aXR5OiB7IG5hbWU6ICdxdWFudGl0eScgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICB0b3RhbEZvcm11bGE6IHsgbmFtZTogJ3RvdGFsRm9ybXVsYScgfSBhcyBhbnlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrRmlsZS5nZXROYW1lLm1vY2tSZXR1cm5WYWx1ZSgnVGVzdEZpbGUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGV4ZWN1dGUgc2ltcGxlIGFyaXRobWV0aWMgZm9ybXVsYScsICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAncHJpY2UnKSByZXR1cm4gMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3F1YW50aXR5JykgcmV0dXJuIDU7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSg1MCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgZm9ybXVsYSB3aXRoIHJldHVybiBzdGF0ZW1lbnQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZvcm11bGFXaXRoUmV0dXJuID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsIG1vY2tWYXVsdCwgJ3JldHVybiBwcmljZSArIHF1YW50aXR5Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrRmlsZS5nZXRNZXRhZGF0YVZhbHVlXHJcbiAgICAgICAgICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uKChrZXk6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdwcmljZScpIHJldHVybiAxNTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAncXVhbnRpdHknKSByZXR1cm4gMjU7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFXaXRoUmV0dXJuLnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKDQwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIHNhbml0aXplIHByb3BlcnR5IG5hbWVzIChyZW1vdmUgc3BhY2VzKScsICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0QWxsUHJvcGVydGllcy5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgJ3VuaXQgcHJpY2UnOiB7IG5hbWU6ICd1bml0IHByaWNlJyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgICdpdGVtIGNvdW50JzogeyBuYW1lOiAnaXRlbSBjb3VudCcgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICB0b3RhbEZvcm11bGE6IHsgbmFtZTogJ3RvdGFsRm9ybXVsYScgfSBhcyBhbnlcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBtb2NrRmlsZS5nZXRNZXRhZGF0YVZhbHVlXHJcbiAgICAgICAgICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uKChrZXk6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd1bml0IHByaWNlJykgcmV0dXJuIDEyO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdpdGVtIGNvdW50JykgcmV0dXJuIDM7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHNhbml0aXplZEZvcm11bGEgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0ZXN0JywgbW9ja1ZhdWx0LCAndW5pdHByaWNlICogaXRlbWNvdW50Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHNhbml0aXplZEZvcm11bGEucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMzYpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgZXhjbHVkZSBzZWxmIHByb3BlcnR5IGZyb20gZm9ybXVsYSBjb250ZXh0JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBtb2NrRmlsZS5nZXRBbGxQcm9wZXJ0aWVzLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICBwcmljZTogeyBuYW1lOiAncHJpY2UnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgdG90YWxGb3JtdWxhOiB7IG5hbWU6ICd0b3RhbEZvcm11bGEnIH0gYXMgYW55XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAncHJpY2UnKSByZXR1cm4gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd0b3RhbEZvcm11bGEnKSByZXR1cm4gOTk5OyAvLyBTaG91bGQgYmUgZXhjbHVkZWRcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc2VsZkV4Y2x1ZGluZ0Zvcm11bGEgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0b3RhbEZvcm11bGEnLCBtb2NrVmF1bHQsICdwcmljZSAqIDInKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gc2VsZkV4Y2x1ZGluZ0Zvcm11bGEucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMjAwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBmb3JtdWxhIGVycm9ycyBncmFjZWZ1bGx5IChSZWZlcmVuY2VFcnJvciknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrRmlsZS5nZXRNZXRhZGF0YVZhbHVlLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGZhdWx0eUZvcm11bGEgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0ZXN0JywgbW9ja1ZhdWx0LCAndW5kZWZpbmVkVmFyaWFibGUgKiA1Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZhdWx0eUZvcm11bGEucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xyXG4gICAgICAgICAgICAvLyBUZXN0IHNpbXBsZSBxdWUgY29uc29sZS5lcnJvciBhIMOpdMOpIGFwcGVsw6kgYXZlYyBsZSBib24gbWVzc2FnZVxyXG4gICAgICAgICAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgICAgICBjb25zdCBlcnJvckNhbGwgPSBjb25zb2xlU3B5Lm1vY2suY2FsbHNbMF07XHJcbiAgICAgICAgICAgIGV4cGVjdChlcnJvckNhbGxbMF0pLnRvQ29udGFpbignRm9ybXVsYSBlcnJvciA6IHVuZGVmaW5lZFZhcmlhYmxlICogNScpO1xyXG4gICAgICAgICAgICBleHBlY3QoZXJyb3JDYWxsWzBdKS50b0NvbnRhaW4oJ1RoaXMgaXMgYWxsIHRoZSBwcm9wZXJ0aWVzIGF2YWlsYWJsZScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGdlbmVyYWwgZm9ybXVsYSBlcnJvcnMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrRmlsZS5nZXRNZXRhZGF0YVZhbHVlLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGZhdWx0eUZvcm11bGEgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0ZXN0JywgbW9ja1ZhdWx0LCAndGhyb3cgbmV3IEVycm9yKFwidGVzdCBlcnJvclwiKScpO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmYXVsdHlGb3JtdWxhLnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnNvbGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ0Zvcm11bGEgZXJyb3IgOiB0aHJvdyBuZXcgRXJyb3IoXCJ0ZXN0IGVycm9yXCIpJylcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZGVzY3JpYmUoJ3dyaXRlIGZ1bmN0aW9uYWxpdHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRlc3QoJ3Nob3VsZCB1cGRhdGUgbWV0YWRhdGEgd2hlbiB3cml0ZSBpcyB0cnVlIGFuZCB2YWx1ZSBjaGFuZ2VkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgd3JpdGVGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndG90YWwnLCBtb2NrVmF1bHQsICdwcmljZSArIHRheCcsIHtcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTW9jayBnZXRBbGxQcm9wZXJ0aWVzIHBvdXIgY2V0dGUgaW5zdGFuY2VcclxuICAgICAgICAgICAgICAgIG1vY2tGaWxlLmdldEFsbFByb3BlcnRpZXMubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgICAgICBwcmljZTogeyBuYW1lOiAncHJpY2UnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgICAgIHRheDogeyBuYW1lOiAndGF4JyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogeyBuYW1lOiAndG90YWwnIH0gYXMgYW55XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBtb2NrRmlsZS5nZXRNZXRhZGF0YVZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3ByaWNlJykgcmV0dXJuIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3RheCcpIHJldHVybiAyMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3RvdGFsJykgcmV0dXJuIDExMDsgLy8gT2xkIHZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHdyaXRlRm9ybXVsYS5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgxMjApO1xyXG4gICAgICAgICAgICAgICAgZXhwZWN0KG1vY2tGaWxlLnVwZGF0ZU1ldGFkYXRhKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndG90YWwnLCAxMjApO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRlc3QoJ3Nob3VsZCBub3QgdXBkYXRlIG1ldGFkYXRhIHdoZW4gd3JpdGUgaXMgdHJ1ZSBidXQgdmFsdWUgdW5jaGFuZ2VkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgd3JpdGVGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndG90YWwnLCBtb2NrVmF1bHQsICdwcmljZSArIHRheCcsIHtcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTW9jayBnZXRBbGxQcm9wZXJ0aWVzIHBvdXIgY2V0dGUgaW5zdGFuY2VcclxuICAgICAgICAgICAgICAgIG1vY2tGaWxlLmdldEFsbFByb3BlcnRpZXMubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgICAgICBwcmljZTogeyBuYW1lOiAncHJpY2UnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgICAgIHRheDogeyBuYW1lOiAndGF4JyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogeyBuYW1lOiAndG90YWwnIH0gYXMgYW55XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBtb2NrRmlsZS5nZXRNZXRhZGF0YVZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3ByaWNlJykgcmV0dXJuIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3RheCcpIHJldHVybiAyMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3RvdGFsJykgcmV0dXJuIDEyMDsgLy8gU2FtZSBhcyBjYWxjdWxhdGVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHdyaXRlRm9ybXVsYS5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgxMjApO1xyXG4gICAgICAgICAgICAgICAgZXhwZWN0KG1vY2tGaWxlLnVwZGF0ZU1ldGFkYXRhKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRlc3QoJ3Nob3VsZCBub3QgdXBkYXRlIG1ldGFkYXRhIHdoZW4gd3JpdGUgaXMgZmFsc2UnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZWFkT25seUZvcm11bGEgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0b3RhbCcsIG1vY2tWYXVsdCwgJ3ByaWNlICsgdGF4Jywge1xyXG4gICAgICAgICAgICAgICAgICAgIGljb246ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTW9jayBnZXRBbGxQcm9wZXJ0aWVzIHBvdXIgY2V0dGUgaW5zdGFuY2VcclxuICAgICAgICAgICAgICAgIG1vY2tGaWxlLmdldEFsbFByb3BlcnRpZXMubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgICAgICBwcmljZTogeyBuYW1lOiAncHJpY2UnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgICAgIHRheDogeyBuYW1lOiAndGF4JyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogeyBuYW1lOiAndG90YWwnIH0gYXMgYW55XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBtb2NrRmlsZS5nZXRNZXRhZGF0YVZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3ByaWNlJykgcmV0dXJuIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3RheCcpIHJldHVybiAyMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcmVhZE9ubHlGb3JtdWxhLnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKDEyMCk7XHJcbiAgICAgICAgICAgICAgICBleHBlY3QobW9ja0ZpbGUudXBkYXRlTWV0YWRhdGEpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2dldFByZXR0eScsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsIG1vY2tWYXVsdCwgJzEgKyAxJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gaW5wdXQgaWYgZmFsc3knLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KCcnKSkudG9CZSgnJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KG51bGwgYXMgYW55KSkudG9CZShudWxsKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkodW5kZWZpbmVkIGFzIGFueSkpLnRvQmUodW5kZWZpbmVkKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBub24tc3RyaW5nIHZhbHVlcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IG51bWJlclZhbHVlID0gMTIzIGFzIGFueTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eShudW1iZXJWYWx1ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKDEyMyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb25zb2xlU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnVmFsdWUgaXMgbm90IGEgc3RyaW5nOicsIDEyMyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBmb3JtYXQgZGF0ZXMgaW4gRnJlbmNoIGxvY2FsZScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0ZVN0cmluZyA9ICcyMDIzLTEyLTI1JztcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eShkYXRlU3RyaW5nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJzI1IGTDqWNlbWJyZSAyMDIzJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBmb3JtYXQgaW50ZWdlcnMgd2l0aCBGcmVuY2ggbG9jYWxlIGZvcm1hdHRpbmcnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGludGVnZXJTdHJpbmcgPSAnMTIzNCc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoaW50ZWdlclN0cmluZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBWw6lyaWZpb25zIGQnYWJvcmQgbGUgcsOpc3VsdGF0IHLDqWVsXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBY3R1YWwgcmVzdWx0OicsIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpO1xyXG4gICAgICAgICAgICAvLyBMZSBmb3JtYXQgcGV1dCB2YXJpZXIgc2Vsb24gbCdlbnZpcm9ubmVtZW50LCB0ZXN0b25zIHF1ZSBjJ2VzdCBiaWVuIGZvcm1hdMOpXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvTWF0Y2goLzFbLFxcc10yMzRbLixdMDAvKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIG5vdCBmb3JtYXQgZGVjaW1hbCBudW1iZXJzIGFzIGludGVnZXJzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkZWNpbWFsU3RyaW5nID0gJzEyMy40NSc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoZGVjaW1hbFN0cmluZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCcxMjMuNDUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGNsZWFuIFVSTHMgYnkgcmVtb3ZpbmcgcHJvdG9jb2xzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eSgnaHR0cHM6Ly9leGFtcGxlLmNvbScpKS50b0JlKCdleGFtcGxlLmNvbScpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eSgnaHR0cDovL3Rlc3Qub3JnJykpLnRvQmUoJ3Rlc3Qub3JnJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBjbGVhbiBPYnNpZGlhbiBsaW5rcyBieSByZW1vdmluZyBicmFja2V0cycsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoJ1tbTm90ZSBUaXRsZV1dJykpLnRvQmUoJ05vdGUgVGl0bGUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV4IHN0cmluZ3Mgd2l0aCBtdWx0aXBsZSBjbGVhbnVwcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29tcGxleFN0cmluZyA9ICdodHRwczovL1tbZXhhbXBsZS5jb21dXSc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoY29tcGxleFN0cmluZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdleGFtcGxlLmNvbScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIHJlZ3VsYXIgc3RyaW5ncyB1bmNoYW5nZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlZ3VsYXJTdHJpbmcgPSAnSnVzdCBhIG5vcm1hbCBzdHJpbmcnO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KHJlZ3VsYXJTdHJpbmcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnSnVzdCBhIG5vcm1hbCBzdHJpbmcnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdnZXRMaW5rJywgKCkgPT4ge1xyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICBmb3JtdWxhUHJvcGVydHkgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0ZXN0JywgbW9ja1ZhdWx0LCAnMSArIDEnKTtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5LnZhdWx0ID0gbW9ja1ZhdWx0O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIGlucHV0IGlmIGZhbHN5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJycpKS50b0JlKCcnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKG51bGwgYXMgYW55KSkudG9CZShudWxsKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKHVuZGVmaW5lZCBhcyBhbnkpKS50b0JlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBjcmVhdGUgbWFpbHRvIGxpbmtzIGZvciBlbWFpbHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluaygndGVzdEBleGFtcGxlLmNvbScpKS50b0JlKCdtYWlsdG86dGVzdEBleGFtcGxlLmNvbScpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ3VzZXIubmFtZSt0YWdAZG9tYWluLmNvLnVrJykpLnRvQmUoJ21haWx0bzp1c2VyLm5hbWUrdGFnQGRvbWFpbi5jby51aycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIE9ic2lkaWFuIGxpbmtzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBtb2NrVmF1bHQucmVhZExpbmtGaWxlLm1vY2tSZXR1cm5WYWx1ZShbbnVsbCwgJ3BhdGgvdG8vZmlsZS5tZCddIGFzIGFueSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0TGluaygnW1tNeSBOb3RlXV0nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ29ic2lkaWFuOi8vb3Blbj92YXVsdD1UZXN0VmF1bHQmZmlsZT1wYXRoJTJGdG8lMkZmaWxlLm1kJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrVmF1bHQucmVhZExpbmtGaWxlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnTXkgTm90ZScsIHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIE9ic2lkaWFuIGxpbmsgZXJyb3JzIGdyYWNlZnVsbHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XHJcbiAgICAgICAgICAgIG1vY2tWYXVsdC5yZWFkTGlua0ZpbGUubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmlsZSBub3QgZm91bmQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0TGluaygnW1tJbnZhbGlkIE5vdGVdXScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnW1tJbnZhbGlkIE5vdGVdXScpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgICAgICAgICAnRXJyb3IgcGFyc2luZyBsaW5rIGZvciBbW0ludmFsaWQgTm90ZV1dOicsXHJcbiAgICAgICAgICAgICAgICBleHBlY3QuYW55KEVycm9yKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIFVSTHMgd2l0aCBwcm90b2NvbHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluaygnaHR0cHM6Ly9leGFtcGxlLmNvbScpKS50b0JlKCdodHRwczovL2V4YW1wbGUuY29tJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluaygnaHR0cDovL3Rlc3Qub3JnL3BhdGgnKSkudG9CZSgnaHR0cDovL3Rlc3Qub3JnL3BhdGgnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGFkZCBwcm90b2NvbCB0byBVUkxzIHdpdGhvdXQgdGhlbScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKCdleGFtcGxlLmNvbScpKS50b0JlKCdodHRwOi8vZXhhbXBsZS5jb20nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKCd0ZXN0Lm9yZy9wYXRoJykpLnRvQmUoJ2h0dHA6Ly90ZXN0Lm9yZy9wYXRoJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gcmVndWxhciBzdHJpbmdzIHVuY2hhbmdlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVndWxhclN0cmluZyA9ICdKdXN0IGEgbm9ybWFsIHN0cmluZyc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKHJlZ3VsYXJTdHJpbmcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnSnVzdCBhIG5vcm1hbCBzdHJpbmcnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIFVSTCBmb3JtYXRzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbnZhbGlkVXJsID0gJ25vdC1hLXVybCc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKGludmFsaWRVcmwpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnbm90LWEtdXJsJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==