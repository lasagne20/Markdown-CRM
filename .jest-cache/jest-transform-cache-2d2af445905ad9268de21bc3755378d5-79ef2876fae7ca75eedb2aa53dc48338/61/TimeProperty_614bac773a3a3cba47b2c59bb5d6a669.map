{"file":"C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\properties\\TimeProperty .ts","mappings":"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","names":[],"sources":["C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\properties\\TimeProperty .ts"],"sourcesContent":["import flatpickr from \"flatpickr\";\r\nimport { French } from \"flatpickr/dist/l10n/fr.js\";\r\nimport { Property } from \"./Property\";\r\n\r\nexport class TimeProperty extends Property {\r\n    override type: string = \"time\";\r\n    private format: string;\r\n\r\n    constructor(name: string, args : {format?: string, icon? : string}= {format : \"HH:mm\"}) {\r\n        super(name, args);\r\n        this.format = args.format || \"HH:mm\";\r\n\r\n    }\r\n\r\n    // Affiche le champ temps\r\n    override fillDisplay(vault : any, value: any, update: (value: any) => Promise<void>) {\r\n        const container = document.createElement(\"div\");\r\n        container.classList.add(\"field-container\");\r\n\r\n        const link = this.createFieldLink(value);\r\n        const input = this.createFieldTime(value, update, link);\r\n\r\n        // Affichage initial\r\n        if (value && this.validate(value)) {\r\n            link.style.display = \"block\";\r\n            input.style.display = \"none\";\r\n        } else {\r\n            input.style.display = \"block\";\r\n            link.style.display = \"none\";\r\n        }\r\n\r\n        container.appendChild(link);\r\n        container.appendChild(input);\r\n\r\n        return container;\r\n    }\r\n\r\n    // Crée un input pour l'heure (hh:mm) avec flatpickr\r\n    createFieldTime(value: string, update: (value: string) => Promise<void>, link: HTMLElement) {\r\n        const input = document.createElement(\"input\");\r\n        input.type = \"text\";\r\n        input.value = value || \"\";\r\n        input.classList.add(\"field-input\");\r\n\r\n        flatpickr(input, {\r\n            enableTime: true,\r\n            noCalendar: true,\r\n            dateFormat: \"H:i\",\r\n            time_24hr: true,\r\n            defaultDate: value || \"\",\r\n            locale: French,\r\n            onChange: async (selectedDates: Date[]) => {\r\n                const selected = selectedDates[0];\r\n                if (selected) {\r\n                    input.value = this.formatTimeForStorage(selected);\r\n                    await this.updateField(update, input, link);\r\n                }\r\n            },\r\n            onClose: async () => {\r\n                if (!this.validate(input.value)) input.value = \"\";\r\n                await this.updateField(update, input, link);\r\n            }\r\n        });\r\n\r\n        return input;\r\n    }\r\n\r\n    // Affiche l'heure ou un texte par défaut\r\n    override createFieldLink(value: string) {\r\n        const link = document.createElement(\"div\");\r\n        link.textContent = value ? this.formatTimeForDisplay(value) : \"Aucune heure sélectionnée\";\r\n        link.classList.add(\"time-field-link\", \"field-link\");\r\n        link.style.cursor = \"pointer\";\r\n        link.addEventListener(\"click\", (event) => this.modifyField(event));\r\n        return link;\r\n    }\r\n\r\n    // Formate l'heure pour l'affichage : \"14:30\"\r\n    formatTimeForDisplay(time: string): string {\r\n        if (this.format === \"HH:mm\") {\r\n            return time || \"Aucune heure sélectionnée\";\r\n        }\r\n        if (!time) return \"\";\r\n        const parts = time.split(\":\").map(Number);\r\n        if (parts.length < 2) return time;\r\n        const [h, m, s] = [parts[0], parts[1], parts[2] || 0];\r\n        const result = [];\r\n        if (h) result.push(`${h}h`);\r\n        if (m) result.push(`${m} min`);\r\n        if (s) result.push(`${s}s`);\r\n        return result.length ? result.join(\" \") : \"0 min\";\r\n    }\r\n\r\n    // Formate l'heure pour le stockage : \"HH:mm\"\r\n    formatTimeForStorage(date: Date): string {\r\n        return date.toLocaleTimeString(\"fr-FR\", { hour: \"2-digit\", minute: \"2-digit\", hour12: false });\r\n    }\r\n\r\n    // Validation simple du format \"HH:mm\"\r\n    override validate(value: string): string {\r\n        if( /^\\d{2}:\\d{2}$/.test(value)){\r\n            return value;\r\n        }\r\n        return \"\";\r\n    }\r\n\r\n    // Bascule entre input et affichage\r\n    override async updateField(update: (value: string) => Promise<void>, input: HTMLInputElement, link: HTMLElement) {\r\n        let value = this.validate(input.value) ? input.value : \"\";\r\n        await update(value);\r\n        if (value) {\r\n            input.style.display = \"none\";\r\n            link.textContent = this.formatTimeForDisplay(value);\r\n            link.style.display = \"block\";\r\n        } else {\r\n            link.textContent = \"Aucune heure sélectionnée\";\r\n        }\r\n    }\r\n\r\n    // Pour afficher l'input à la place du lien\r\n    override modifyField(event: Event) {\r\n        const link = event.currentTarget as HTMLElement;\r\n        const container = link.parentElement;\r\n        if (!container) return;\r\n        const input = container.querySelector(\"input\");\r\n        if (input) {\r\n            link.style.display = \"none\";\r\n            input.style.display = \"block\";\r\n            input.focus();\r\n        }\r\n    }\r\n}\r\n"],"version":3}