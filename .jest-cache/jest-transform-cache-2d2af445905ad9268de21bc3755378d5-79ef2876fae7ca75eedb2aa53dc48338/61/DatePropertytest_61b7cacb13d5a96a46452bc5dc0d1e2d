eb91a0cfb07b2d7837ee1ee6c6913706
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock Obsidian modules
jest.mock('obsidian', () => ({}), { virtual: true });
// Mock flatpickr completely
jest.mock('flatpickr', () => {
    const mockInstance = {
        destroy: jest.fn(),
        setDate: jest.fn(),
        clear: jest.fn()
    };
    const mockFlatpickr = jest.fn((element, options) => {
        element.flatpickrOptions = options;
        element.flatpickrInstance = mockInstance;
        return mockInstance;
    });
    return mockFlatpickr;
});
// Mock French locale
jest.mock('flatpickr/dist/l10n/fr.js', () => ({
    French: { locale: 'fr' }
}));
// Mock all dependencies  
jest.mock('../vault/File', () => ({}));
jest.mock('../vault/MyVault', () => ({}));
jest.mock('../classes/Classe', () => ({}));
jest.mock('../vault/Utils', () => ({
    setIcon: jest.fn((element, iconName) => {
        element.setAttribute('data-icon', iconName);
        element.textContent = `[${iconName}]`;
    })
}));
// Mock Property base class
jest.mock('./Property', () => {
    return {
        Property: class MockProperty {
            constructor(name, type, ...args) {
                this.title = '';
                this.static = false;
                this.icon = '';
                this.read = jest.fn(() => '');
                this.validate = jest.fn((value) => value);
                this.getPretty = jest.fn(() => '');
                this.getDisplay = jest.fn(() => document.createElement('div'));
                this.fillDisplay = jest.fn(() => {
                    const div = document.createElement('div');
                    div.classList.add('field-container-column');
                    const field = document.createElement('div');
                    field.classList.add('metadata-field');
                    div.appendChild(field);
                    return div;
                });
                this.name = name;
                this.type = type;
                if (args.length > 0 && typeof args[0] === 'object') {
                    Object.assign(this, args[0]);
                }
            }
        }
    };
});
const DateProperty_1 = require("./DateProperty");
describe('DateProperty', () => {
    let dateProperty;
    let mockVault;
    let mockFile;
    beforeEach(() => {
        jest.clearAllMocks();
        document.body.innerHTML = '';
        mockVault = {
            app: { vault: { getFiles: jest.fn(() => []) } }
        };
        mockFile = {
            getMetadata: jest.fn(() => ({ eventDate: '2024-03-15' })),
            getMetadataValue: jest.fn((key) => key === 'eventDate' ? '2024-03-15' : undefined),
            updateMetadata: jest.fn(),
            vault: mockVault
        };
        dateProperty = new DateProperty_1.DateProperty('eventDate', ['today', 'tomorrow', 'next-week']);
        jest.useFakeTimers();
        jest.setSystemTime(new Date('2024-03-15T10:00:00Z'));
    });
    afterEach(() => {
        jest.useRealTimers();
    });
    describe('constructor', () => {
        it('should create DateProperty with correct properties', () => {
            const quickIcons = ['today', 'tomorrow'];
            const prop = new DateProperty_1.DateProperty('testDate', quickIcons);
            expect(prop.name).toBe('testDate');
            expect(prop.type).toBe('date');
            expect(prop.quickSelectIcons).toEqual(quickIcons);
        });
    });
    describe('formatDateForStorage', () => {
        it('should format date in YYYY-MM-DD format', () => {
            const testDate = new Date('2024-03-15T10:30:00Z');
            const result = dateProperty.formatDateForStorage(testDate);
            expect(result).toBe('2024-03-15');
        });
    });
    describe('formatDateForDisplay', () => {
        it('should format valid date strings', () => {
            const result = dateProperty.formatDateForDisplay('2024-03-15');
            expect(result).toBeTruthy();
            expect(typeof result).toBe('string');
        });
        it('should handle invalid dates', () => {
            const result = dateProperty.formatDateForDisplay('invalid-date');
            expect(result).toBe('Date invalide');
        });
    });
    describe('getDateForOption', () => {
        it('should return correct dates for standard options', () => {
            const today = dateProperty.getDateForOption('today');
            expect(today.getDate()).toBe(15);
            const tomorrow = dateProperty.getDateForOption('tomorrow');
            expect(tomorrow.getDate()).toBe(16);
        });
    });
    describe('createFieldLink', () => {
        it('should create a clickable link element', () => {
            const link = dateProperty.createFieldLink('2024-03-15');
            expect(link.tagName).toBe('DIV');
            expect(link.classList.contains('field-link')).toBe(true);
            expect(link.style.cursor).toBe('pointer');
        });
        it('should show placeholder for empty values', () => {
            const link = dateProperty.createFieldLink('');
            expect(link.textContent).toBe('Aucune date sélectionnée');
        });
    });
    describe('createFieldDate', () => {
        it('should create input with flatpickr initialization', () => {
            const updateFn = jest.fn();
            const link = document.createElement('div');
            const input = dateProperty.createFieldDate('2024-03-15', updateFn, link);
            expect(input.tagName).toBe('INPUT');
            expect(input.value).toBe('2024-03-15');
            expect(input.flatpickrInstance).toBeDefined();
        });
    });
    describe('createQuickSelect', () => {
        it('should create buttons for quick select options', () => {
            const updateFn = jest.fn();
            const link = document.createElement('div');
            const input = document.createElement('input');
            const container = dateProperty.createQuickSelect('', updateFn, link, input);
            expect(container.tagName).toBe('DIV');
            expect(container.classList.contains('quick-select-container')).toBe(true);
            const buttons = container.querySelectorAll('button');
            expect(buttons.length).toBe(3);
        });
    });
    describe('updateField', () => {
        it('should update field with valid input', async () => {
            const updateFn = jest.fn().mockResolvedValue(undefined);
            const input = document.createElement('input');
            const link = document.createElement('div');
            input.value = '2024-03-20';
            dateProperty.validate = jest.fn(() => '2024-03-20');
            await dateProperty.updateField(updateFn, input, link);
            expect(updateFn).toHaveBeenCalledWith('2024-03-20');
        });
    });
    describe('fillDisplay', () => {
        it('should create display structure', () => {
            const updateFn = jest.fn();
            const result = dateProperty.fillDisplay(mockVault, '2024-03-15', updateFn);
            expect(result).toBeTruthy();
            expect(result.classList.contains('field-container-column')).toBe(true);
        });
    });
    describe('edge cases', () => {
        it('should handle null values gracefully', () => {
            expect(() => {
                dateProperty.createFieldLink(null);
                dateProperty.formatDateForDisplay('');
            }).not.toThrow();
        });
        it('should handle empty quick select icons', () => {
            const prop = new DateProperty_1.DateProperty('test', []);
            const updateFn = jest.fn();
            const link = document.createElement('div');
            const input = document.createElement('input');
            const container = prop.createQuickSelect('', updateFn, link, input);
            const buttons = container.querySelectorAll('button');
            expect(buttons.length).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXERhdGVQcm9wZXJ0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFJSCx3QkFBd0I7QUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBRXJELDRCQUE0QjtBQUM1QixJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7SUFDeEIsTUFBTSxZQUFZLEdBQUc7UUFDakIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbEIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDbkIsQ0FBQztJQUVGLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLEVBQUU7UUFDOUMsT0FBZSxDQUFDLGdCQUFnQixHQUFHLE9BQU8sQ0FBQztRQUMzQyxPQUFlLENBQUMsaUJBQWlCLEdBQUcsWUFBWSxDQUFDO1FBQ2xELE9BQU8sWUFBWSxDQUFDO0lBQ3hCLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxhQUFhLENBQUM7QUFDekIsQ0FBQyxDQUFDLENBQUM7QUFFSCxxQkFBcUI7QUFDckIsSUFBSSxDQUFDLElBQUksQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzFDLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Q0FDM0IsQ0FBQyxDQUFDLENBQUM7QUFFSiwwQkFBMEI7QUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxl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QyxPQUFPLENBQXFCLENBQUM7WUFFbEUsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3BFLE1BQU0sT0FBTyxHQUFHLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVyRCxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXERhdGVQcm9wZXJ0eS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAamVzdC1lbnZpcm9ubWVudCBqc2RvbVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IERhdGVQcm9wZXJ0eSB9IGZyb20gJy4vRGF0ZVByb3BlcnR5JztcclxuXHJcbi8vIE1vY2sgT2JzaWRpYW4gbW9kdWxlc1xyXG5qZXN0Lm1vY2soJ29ic2lkaWFuJywgKCkgPT4gKHt9KSwgeyB2aXJ0dWFsOiB0cnVlIH0pO1xyXG5cclxuLy8gTW9jayBmbGF0cGlja3IgY29tcGxldGVseVxyXG5qZXN0Lm1vY2soJ2ZsYXRwaWNrcicsICgpID0+IHtcclxuICAgIGNvbnN0IG1vY2tJbnN0YW5jZSA9IHtcclxuICAgICAgICBkZXN0cm95OiBqZXN0LmZuKCksXHJcbiAgICAgICAgc2V0RGF0ZTogamVzdC5mbigpLFxyXG4gICAgICAgIGNsZWFyOiBqZXN0LmZuKClcclxuICAgIH07XHJcbiAgICBcclxuICAgIGNvbnN0IG1vY2tGbGF0cGlja3IgPSBqZXN0LmZuKChlbGVtZW50LCBvcHRpb25zKSA9PiB7XHJcbiAgICAgICAgKGVsZW1lbnQgYXMgYW55KS5mbGF0cGlja3JPcHRpb25zID0gb3B0aW9ucztcclxuICAgICAgICAoZWxlbWVudCBhcyBhbnkpLmZsYXRwaWNrckluc3RhbmNlID0gbW9ja0luc3RhbmNlO1xyXG4gICAgICAgIHJldHVybiBtb2NrSW5zdGFuY2U7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgcmV0dXJuIG1vY2tGbGF0cGlja3I7XHJcbn0pO1xyXG5cclxuLy8gTW9jayBGcmVuY2ggbG9jYWxlXHJcbmplc3QubW9jaygnZmxhdHBpY2tyL2Rpc3QvbDEwbi9mci5qcycsICgpID0+ICh7XHJcbiAgICBGcmVuY2g6IHsgbG9jYWxlOiAnZnInIH1cclxufSkpO1xyXG5cclxuLy8gTW9jayBhbGwgZGVwZW5kZW5jaWVzICBcclxuamVzdC5tb2NrKCcuLi92YXVsdC9GaWxlJywgKCkgPT4gKHt9KSk7XHJcbmplc3QubW9jaygnLi4vdmF1bHQvTXlWYXVsdCcsICgpID0+ICh7fSkpO1xyXG5qZXN0Lm1vY2soJy4uL2NsYXNzZXMvQ2xhc3NlJywgKCkgPT4gKHt9KSk7XHJcbmplc3QubW9jaygnLi4vdmF1bHQvVXRpbHMnLCAoKSA9PiAoe1xyXG4gICAgc2V0SWNvbjogamVzdC5mbigoZWxlbWVudDogSFRNTEVsZW1lbnQsIGljb25OYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1pY29uJywgaWNvbk5hbWUpO1xyXG4gICAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSBgWyR7aWNvbk5hbWV9XWA7XHJcbiAgICB9KVxyXG59KSk7XHJcblxyXG4vLyBNb2NrIFByb3BlcnR5IGJhc2UgY2xhc3NcclxuamVzdC5tb2NrKCcuL1Byb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBQcm9wZXJ0eTogY2xhc3MgTW9ja1Byb3BlcnR5IHtcclxuICAgICAgICAgICAgbmFtZTogc3RyaW5nO1xyXG4gICAgICAgICAgICB0eXBlOiBzdHJpbmc7XHJcbiAgICAgICAgICAgIHRpdGxlOiBzdHJpbmcgPSAnJztcclxuICAgICAgICAgICAgc3RhdGljOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGljb246IHN0cmluZyA9ICcnO1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBhbnk7XHJcbiAgICAgICAgICAgIHZhdWx0OiBhbnk7XHJcblxyXG4gICAgICAgICAgICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIHR5cGU6IHN0cmluZywgLi4uYXJnczogYW55W10pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAwICYmIHR5cGVvZiBhcmdzWzBdID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgYXJnc1swXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJlYWQgPSBqZXN0LmZuKCgpID0+ICcnKTtcclxuICAgICAgICAgICAgdmFsaWRhdGUgPSBqZXN0LmZuKCh2YWx1ZTogc3RyaW5nKSA9PiB2YWx1ZSk7XHJcbiAgICAgICAgICAgIGdldFByZXR0eSA9IGplc3QuZm4oKCkgPT4gJycpO1xyXG4gICAgICAgICAgICBnZXREaXNwbGF5ID0gamVzdC5mbigoKSA9PiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSk7XHJcbiAgICAgICAgICAgIGZpbGxEaXNwbGF5ID0gamVzdC5mbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIGRpdi5jbGFzc0xpc3QuYWRkKCdmaWVsZC1jb250YWluZXItY29sdW1uJyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgZmllbGQuY2xhc3NMaXN0LmFkZCgnbWV0YWRhdGEtZmllbGQnKTtcclxuICAgICAgICAgICAgICAgIGRpdi5hcHBlbmRDaGlsZChmaWVsZCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGl2O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59KTtcclxuXHJcbmRlc2NyaWJlKCdEYXRlUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICBsZXQgZGF0ZVByb3BlcnR5OiBEYXRlUHJvcGVydHk7XHJcbiAgICBsZXQgbW9ja1ZhdWx0OiBhbnk7XHJcbiAgICBsZXQgbW9ja0ZpbGU6IGFueTtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9ICcnO1xyXG4gICAgICAgIFxyXG4gICAgICAgIG1vY2tWYXVsdCA9IHtcclxuICAgICAgICAgICAgYXBwOiB7IHZhdWx0OiB7IGdldEZpbGVzOiBqZXN0LmZuKCgpID0+IFtdKSB9IH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBtb2NrRmlsZSA9IHtcclxuICAgICAgICAgICAgZ2V0TWV0YWRhdGE6IGplc3QuZm4oKCkgPT4gKHsgZXZlbnREYXRlOiAnMjAyNC0wMy0xNScgfSkpLFxyXG4gICAgICAgICAgICBnZXRNZXRhZGF0YVZhbHVlOiBqZXN0LmZuKChrZXk6IHN0cmluZykgPT4ga2V5ID09PSAnZXZlbnREYXRlJyA/ICcyMDI0LTAzLTE1JyA6IHVuZGVmaW5lZCksXHJcbiAgICAgICAgICAgIHVwZGF0ZU1ldGFkYXRhOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICAgIHZhdWx0OiBtb2NrVmF1bHRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBkYXRlUHJvcGVydHkgPSBuZXcgRGF0ZVByb3BlcnR5KCdldmVudERhdGUnLCBbJ3RvZGF5JywgJ3RvbW9ycm93JywgJ25leHQtd2VlayddKTtcclxuICAgICAgICBcclxuICAgICAgICBqZXN0LnVzZUZha2VUaW1lcnMoKTtcclxuICAgICAgICBqZXN0LnNldFN5c3RlbVRpbWUobmV3IERhdGUoJzIwMjQtMDMtMTVUMTA6MDA6MDBaJykpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgICAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjb25zdHJ1Y3RvcicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBEYXRlUHJvcGVydHkgd2l0aCBjb3JyZWN0IHByb3BlcnRpZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHF1aWNrSWNvbnMgPSBbJ3RvZGF5JywgJ3RvbW9ycm93J107XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3AgPSBuZXcgRGF0ZVByb3BlcnR5KCd0ZXN0RGF0ZScsIHF1aWNrSWNvbnMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHByb3AubmFtZSkudG9CZSgndGVzdERhdGUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHByb3AudHlwZSkudG9CZSgnZGF0ZScpO1xyXG4gICAgICAgICAgICBleHBlY3QoKHByb3AgYXMgYW55KS5xdWlja1NlbGVjdEljb25zKS50b0VxdWFsKHF1aWNrSWNvbnMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2Zvcm1hdERhdGVGb3JTdG9yYWdlJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgZm9ybWF0IGRhdGUgaW4gWVlZWS1NTS1ERCBmb3JtYXQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlc3REYXRlID0gbmV3IERhdGUoJzIwMjQtMDMtMTVUMTA6MzA6MDBaJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGRhdGVQcm9wZXJ0eS5mb3JtYXREYXRlRm9yU3RvcmFnZSh0ZXN0RGF0ZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJzIwMjQtMDMtMTUnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdmb3JtYXREYXRlRm9yRGlzcGxheScsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGZvcm1hdCB2YWxpZCBkYXRlIHN0cmluZ3MnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGRhdGVQcm9wZXJ0eS5mb3JtYXREYXRlRm9yRGlzcGxheSgnMjAyNC0wMy0xNScpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0KS50b0JlKCdzdHJpbmcnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW52YWxpZCBkYXRlcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGF0ZVByb3BlcnR5LmZvcm1hdERhdGVGb3JEaXNwbGF5KCdpbnZhbGlkLWRhdGUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnRGF0ZSBpbnZhbGlkZScpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2dldERhdGVGb3JPcHRpb24nLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gY29ycmVjdCBkYXRlcyBmb3Igc3RhbmRhcmQgb3B0aW9ucycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdG9kYXkgPSBkYXRlUHJvcGVydHkuZ2V0RGF0ZUZvck9wdGlvbigndG9kYXknKTtcclxuICAgICAgICAgICAgZXhwZWN0KHRvZGF5LmdldERhdGUoKSkudG9CZSgxNSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCB0b21vcnJvdyA9IGRhdGVQcm9wZXJ0eS5nZXREYXRlRm9yT3B0aW9uKCd0b21vcnJvdycpO1xyXG4gICAgICAgICAgICBleHBlY3QodG9tb3Jyb3cuZ2V0RGF0ZSgpKS50b0JlKDE2KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjcmVhdGVGaWVsZExpbmsnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgYSBjbGlja2FibGUgbGluayBlbGVtZW50JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gZGF0ZVByb3BlcnR5LmNyZWF0ZUZpZWxkTGluaygnMjAyNC0wMy0xNScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGxpbmsudGFnTmFtZSkudG9CZSgnRElWJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChsaW5rLmNsYXNzTGlzdC5jb250YWlucygnZmllbGQtbGluaycpKS50b0JlKHRydWUpO1xyXG4gICAgICAgICAgICBleHBlY3QobGluay5zdHlsZS5jdXJzb3IpLnRvQmUoJ3BvaW50ZXInKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBzaG93IHBsYWNlaG9sZGVyIGZvciBlbXB0eSB2YWx1ZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkYXRlUHJvcGVydHkuY3JlYXRlRmllbGRMaW5rKCcnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGxpbmsudGV4dENvbnRlbnQpLnRvQmUoJ0F1Y3VuZSBkYXRlIHPDqWxlY3Rpb25uw6llJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY3JlYXRlRmllbGREYXRlJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGlucHV0IHdpdGggZmxhdHBpY2tyIGluaXRpYWxpemF0aW9uJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVGbiA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBkYXRlUHJvcGVydHkuY3JlYXRlRmllbGREYXRlKCcyMDI0LTAzLTE1JywgdXBkYXRlRm4sIGxpbmspO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGlucHV0LnRhZ05hbWUpLnRvQmUoJ0lOUFVUJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChpbnB1dC52YWx1ZSkudG9CZSgnMjAyNC0wMy0xNScpO1xyXG4gICAgICAgICAgICBleHBlY3QoKGlucHV0IGFzIGFueSkuZmxhdHBpY2tySW5zdGFuY2UpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY3JlYXRlUXVpY2tTZWxlY3QnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgYnV0dG9ucyBmb3IgcXVpY2sgc2VsZWN0IG9wdGlvbnMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZUZuID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZGF0ZVByb3BlcnR5LmNyZWF0ZVF1aWNrU2VsZWN0KCcnLCB1cGRhdGVGbiwgbGluaywgaW5wdXQpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci50YWdOYW1lKS50b0JlKCdESVYnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ3F1aWNrLXNlbGVjdC1jb250YWluZXInKSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChidXR0b25zLmxlbmd0aCkudG9CZSgzKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCd1cGRhdGVGaWVsZCcsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIHVwZGF0ZSBmaWVsZCB3aXRoIHZhbGlkIGlucHV0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVGbiA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaW5wdXQudmFsdWUgPSAnMjAyNC0wMy0yMCc7XHJcbiAgICAgICAgICAgIGRhdGVQcm9wZXJ0eS52YWxpZGF0ZSA9IGplc3QuZm4oKCkgPT4gJzIwMjQtMDMtMjAnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGF3YWl0IGRhdGVQcm9wZXJ0eS51cGRhdGVGaWVsZCh1cGRhdGVGbiwgaW5wdXQsIGxpbmspO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHVwZGF0ZUZuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnMjAyNC0wMy0yMCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2ZpbGxEaXNwbGF5JywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGRpc3BsYXkgc3RydWN0dXJlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVGbiA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGF0ZVByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgJzIwMjQtMDMtMTUnLCB1cGRhdGVGbik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NMaXN0LmNvbnRhaW5zKCdmaWVsZC1jb250YWluZXItY29sdW1uJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZWRnZSBjYXNlcycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBudWxsIHZhbHVlcyBncmFjZWZ1bGx5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZGF0ZVByb3BlcnR5LmNyZWF0ZUZpZWxkTGluayhudWxsIGFzIGFueSk7XHJcbiAgICAgICAgICAgICAgICBkYXRlUHJvcGVydHkuZm9ybWF0RGF0ZUZvckRpc3BsYXkoJycpO1xyXG4gICAgICAgICAgICB9KS5ub3QudG9UaHJvdygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBxdWljayBzZWxlY3QgaWNvbnMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3AgPSBuZXcgRGF0ZVByb3BlcnR5KCd0ZXN0JywgW10pO1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVGbiA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHByb3AuY3JlYXRlUXVpY2tTZWxlY3QoJycsIHVwZGF0ZUZuLCBsaW5rLCBpbnB1dCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoYnV0dG9ucy5sZW5ndGgpLnRvQmUoMCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9