e24cfe27cf7216992fd20d8e235b9304
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock ClassConfigManager
jest.mock('../../src/Config/ClassConfigManager');
const DynamicClassFactory_1 = require("../../src/Config/DynamicClassFactory");
const ClassConfigManager_1 = require("../../src/Config/ClassConfigManager");
const Classe_1 = require("../../src/vault/Classe");
describe('DynamicClassFactory', () => {
    let factory;
    let mockConfigManager;
    let mockApp;
    beforeEach(() => {
        jest.clearAllMocks();
        mockApp = {
            getVaultPath: jest.fn(() => '/test/vault'),
            getName: jest.fn(() => 'TestVault')
        };
        // Create mock config manager
        mockConfigManager = {
            createDynamicClasse: jest.fn(),
            loadConfig: jest.fn(),
            getConfig: jest.fn()
        };
        // Mock the constructor
        ClassConfigManager_1.ClassConfigManager.mockImplementation(() => mockConfigManager);
        factory = new DynamicClassFactory_1.DynamicClassFactory('./test-config', mockApp);
    });
    describe('constructor', () => {
        it('should create instance with config manager', () => {
            expect(ClassConfigManager_1.ClassConfigManager).toHaveBeenCalledWith('./test-config', mockApp);
        });
    });
    describe('getClass', () => {
        it('should return cached class if already registered', async () => {
            const MockClass = class extends Classe_1.Classe {
            };
            // First call - should call createDynamicClasse
            mockConfigManager.createDynamicClasse.mockResolvedValue(MockClass);
            const firstResult = await factory.getClass('TestClass');
            expect(firstResult).toBe(MockClass);
            expect(mockConfigManager.createDynamicClasse).toHaveBeenCalledWith('TestClass');
            // Second call - should return cached version
            jest.clearAllMocks();
            const secondResult = await factory.getClass('TestClass');
            expect(secondResult).toBe(MockClass);
            expect(mockConfigManager.createDynamicClasse).not.toHaveBeenCalled();
        });
        it('should create new class if not cached', async () => {
            const MockClass = class extends Classe_1.Classe {
            };
            mockConfigManager.createDynamicClasse.mockResolvedValue(MockClass);
            const result = await factory.getClass('NewClass');
            expect(result).toBe(MockClass);
            expect(mockConfigManager.createDynamicClasse).toHaveBeenCalledWith('NewClass');
        });
    });
    describe('createInstance', () => {
        it('should create instance of dynamic class', async () => {
            const mockVault = { app: mockApp };
            const mockFile = { path: 'test.md' };
            const MockClass = jest.fn();
            MockClass.mockImplementation(function (vault, file) {
                this.vault = vault;
                this.file = file;
            });
            mockConfigManager.createDynamicClasse.mockResolvedValue(MockClass);
            const instance = await factory.createInstance('TestClass', mockApp, mockVault, mockFile);
            expect(MockClass).toHaveBeenCalledWith(mockVault, mockFile);
            expect(instance).toBeInstanceOf(MockClass);
        });
    });
    describe('getAvailableClasses', () => {
        it('should return list of available classes', async () => {
            const mockClasses = ['Class1', 'Class2', 'Class3'];
            mockConfigManager.getConfig = jest.fn().mockReturnValue({
                classes: mockClasses
            });
            const result = await factory.getAvailableClasses();
            expect(result).toEqual(mockClasses);
        });
        it('should return empty array if no config', async () => {
            mockConfigManager.getConfig = jest.fn().mockReturnValue(null);
            const result = await factory.getAvailableClasses();
            expect(result).toEqual([]);
        });
        it('should return empty array if no classes in config', async () => {
            mockConfigManager.getConfig = jest.fn().mockReturnValue({});
            const result = await factory.getAvailableClasses();
            expect(result).toEqual([]);
        });
    });
    describe('clearCache', () => {
        it('should clear the class registry', async () => {
            const MockClass = class extends Classe_1.Classe {
            };
            mockConfigManager.createDynamicClasse.mockResolvedValue(MockClass);
            // Add class to registry
            await factory.getClass('TestClass');
            // Clear cache
            factory.clearCache();
            // Should call createDynamicClasse again after clearing
            jest.clearAllMocks();
            await factory.getClass('TestClass');
            expect(mockConfigManager.createDynamicClasse).toHaveBeenCalledWith('TestClass');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXENvbmZpZ1xcRHluYW1pY0NsYXNzRmFjdG9yeS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBSUEsMEJBQTBCO0FBQzFCLElBQUksQ0FBQyxJQUFJLENBQUMscUNBQXFDLENBQUMsQ0FBQztBQUxqRCw4RUFBMkU7QUFDM0UsNEVBQXlFO0FBQ3pFLG1EQUFnRDtBQUtoRCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ2pDLElBQUksT0FBNEIsQ0FBQztJQUNqQyxJQUFJLGlCQUFrRCxDQUFDO0lBQ3ZELElBQUksT0FBWSxDQUFDO0lBRWpCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFckIsT0FBTyxHQUFHO1lBQ04sWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDO1lBQzFDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQztTQUN0QyxDQUFDO1FBRUYsNkJBQTZCO1FBQzdCLGlCQUFpQixHQUFHO1lBQ2hCLG1CQUFtQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDOUIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDckIsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDaEIsQ0FBQztRQUVULHVCQUF1QjtRQUN0Qix1Q0FBa0UsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRWhILE9BQU8sR0FBRyxJQUFJLHlDQUFtQixDQUFDLGVBQWUsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNoRSxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FB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QUMsRUFBRSxDQUFDLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO1FBQ3hCLEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3QyxNQUFNLFNBQVMsR0FBRyxLQUFNLFNBQVEsZUFBTTthQUFVLENBQUM7WUFDakQsaUJBQWlCLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFbkUsd0JBQXdCO1lBQ3hCLE1BQU0sT0FBTyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUVwQyxjQUFjO1lBQ2QsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBRXJCLHVEQUF1RDtZQUN2RCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDckIsTUFBTSxPQUFPLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3BGLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGxlb2R1XFxEb2N1bWVudHNcXDEgLSBQcm9cXFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXF9fdGVzdHNfX1xcQ29uZmlnXFxEeW5hbWljQ2xhc3NGYWN0b3J5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRHluYW1pY0NsYXNzRmFjdG9yeSB9IGZyb20gJy4uLy4uL3NyYy9Db25maWcvRHluYW1pY0NsYXNzRmFjdG9yeSc7XHJcbmltcG9ydCB7IENsYXNzQ29uZmlnTWFuYWdlciB9IGZyb20gJy4uLy4uL3NyYy9Db25maWcvQ2xhc3NDb25maWdNYW5hZ2VyJztcclxuaW1wb3J0IHsgQ2xhc3NlIH0gZnJvbSAnLi4vLi4vc3JjL3ZhdWx0L0NsYXNzZSc7XHJcblxyXG4vLyBNb2NrIENsYXNzQ29uZmlnTWFuYWdlclxyXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9Db25maWcvQ2xhc3NDb25maWdNYW5hZ2VyJyk7XHJcblxyXG5kZXNjcmliZSgnRHluYW1pY0NsYXNzRmFjdG9yeScsICgpID0+IHtcclxuICAgIGxldCBmYWN0b3J5OiBEeW5hbWljQ2xhc3NGYWN0b3J5O1xyXG4gICAgbGV0IG1vY2tDb25maWdNYW5hZ2VyOiBqZXN0Lk1vY2tlZDxDbGFzc0NvbmZpZ01hbmFnZXI+O1xyXG4gICAgbGV0IG1vY2tBcHA6IGFueTtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgICAgICBcclxuICAgICAgICBtb2NrQXBwID0ge1xyXG4gICAgICAgICAgICBnZXRWYXVsdFBhdGg6IGplc3QuZm4oKCkgPT4gJy90ZXN0L3ZhdWx0JyksXHJcbiAgICAgICAgICAgIGdldE5hbWU6IGplc3QuZm4oKCkgPT4gJ1Rlc3RWYXVsdCcpXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIG1vY2sgY29uZmlnIG1hbmFnZXJcclxuICAgICAgICBtb2NrQ29uZmlnTWFuYWdlciA9IHtcclxuICAgICAgICAgICAgY3JlYXRlRHluYW1pY0NsYXNzZTogamVzdC5mbigpLFxyXG4gICAgICAgICAgICBsb2FkQ29uZmlnOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICAgIGdldENvbmZpZzogamVzdC5mbigpXHJcbiAgICAgICAgfSBhcyBhbnk7XHJcblxyXG4gICAgICAgIC8vIE1vY2sgdGhlIGNvbnN0cnVjdG9yXHJcbiAgICAgICAgKENsYXNzQ29uZmlnTWFuYWdlciBhcyBqZXN0Lk1vY2tlZENsYXNzPHR5cGVvZiBDbGFzc0NvbmZpZ01hbmFnZXI+KS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gbW9ja0NvbmZpZ01hbmFnZXIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZhY3RvcnkgPSBuZXcgRHluYW1pY0NsYXNzRmFjdG9yeSgnLi90ZXN0LWNvbmZpZycsIG1vY2tBcHApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NvbnN0cnVjdG9yJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGluc3RhbmNlIHdpdGggY29uZmlnIG1hbmFnZXInLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChDbGFzc0NvbmZpZ01hbmFnZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcuL3Rlc3QtY29uZmlnJywgbW9ja0FwcCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZ2V0Q2xhc3MnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gY2FjaGVkIGNsYXNzIGlmIGFscmVhZHkgcmVnaXN0ZXJlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgTW9ja0NsYXNzID0gY2xhc3MgZXh0ZW5kcyBDbGFzc2Uge30gYXMgYW55O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gRmlyc3QgY2FsbCAtIHNob3VsZCBjYWxsIGNyZWF0ZUR5bmFtaWNDbGFzc2VcclxuICAgICAgICAgICAgbW9ja0NvbmZpZ01hbmFnZXIuY3JlYXRlRHluYW1pY0NsYXNzZS5tb2NrUmVzb2x2ZWRWYWx1ZShNb2NrQ2xhc3MpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgZmlyc3RSZXN1bHQgPSBhd2FpdCBmYWN0b3J5LmdldENsYXNzKCdUZXN0Q2xhc3MnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZpcnN0UmVzdWx0KS50b0JlKE1vY2tDbGFzcyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrQ29uZmlnTWFuYWdlci5jcmVhdGVEeW5hbWljQ2xhc3NlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnVGVzdENsYXNzJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTZWNvbmQgY2FsbCAtIHNob3VsZCByZXR1cm4gY2FjaGVkIHZlcnNpb25cclxuICAgICAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlY29uZFJlc3VsdCA9IGF3YWl0IGZhY3RvcnkuZ2V0Q2xhc3MoJ1Rlc3RDbGFzcycpO1xyXG4gICAgICAgICAgICBleHBlY3Qoc2Vjb25kUmVzdWx0KS50b0JlKE1vY2tDbGFzcyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChtb2NrQ29uZmlnTWFuYWdlci5jcmVhdGVEeW5hbWljQ2xhc3NlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBuZXcgY2xhc3MgaWYgbm90IGNhY2hlZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgTW9ja0NsYXNzID0gY2xhc3MgZXh0ZW5kcyBDbGFzc2Uge30gYXMgYW55O1xyXG4gICAgICAgICAgICBtb2NrQ29uZmlnTWFuYWdlci5jcmVhdGVEeW5hbWljQ2xhc3NlLm1vY2tSZXNvbHZlZFZhbHVlKE1vY2tDbGFzcyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBmYWN0b3J5LmdldENsYXNzKCdOZXdDbGFzcycpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShNb2NrQ2xhc3MpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja0NvbmZpZ01hbmFnZXIuY3JlYXRlRHluYW1pY0NsYXNzZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ05ld0NsYXNzJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY3JlYXRlSW5zdGFuY2UnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgaW5zdGFuY2Ugb2YgZHluYW1pYyBjbGFzcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1ZhdWx0ID0geyBhcHA6IG1vY2tBcHAgfSBhcyBhbnk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tGaWxlID0geyBwYXRoOiAndGVzdC5tZCcgfSBhcyBhbnk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBNb2NrQ2xhc3MgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIE1vY2tDbGFzcy5tb2NrSW1wbGVtZW50YXRpb24oZnVuY3Rpb24odGhpczogYW55LCB2YXVsdDogYW55LCBmaWxlOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmF1bHQgPSB2YXVsdDtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmlsZSA9IGZpbGU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja0NvbmZpZ01hbmFnZXIuY3JlYXRlRHluYW1pY0NsYXNzZS5tb2NrUmVzb2x2ZWRWYWx1ZShNb2NrQ2xhc3MgYXMgYW55KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gYXdhaXQgZmFjdG9yeS5jcmVhdGVJbnN0YW5jZSgnVGVzdENsYXNzJywgbW9ja0FwcCwgbW9ja1ZhdWx0LCBtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoTW9ja0NsYXNzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrVmF1bHQsIG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgZXhwZWN0KGluc3RhbmNlKS50b0JlSW5zdGFuY2VPZihNb2NrQ2xhc3MpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2dldEF2YWlsYWJsZUNsYXNzZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gbGlzdCBvZiBhdmFpbGFibGUgY2xhc3NlcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja0NsYXNzZXMgPSBbJ0NsYXNzMScsICdDbGFzczInLCAnQ2xhc3MzJ107XHJcbiAgICAgICAgICAgIG1vY2tDb25maWdNYW5hZ2VyLmdldENvbmZpZyA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgY2xhc3NlczogbW9ja0NsYXNzZXNcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBmYWN0b3J5LmdldEF2YWlsYWJsZUNsYXNzZXMoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NsYXNzZXMpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSBpZiBubyBjb25maWcnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIG1vY2tDb25maWdNYW5hZ2VyLmdldENvbmZpZyA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBmYWN0b3J5LmdldEF2YWlsYWJsZUNsYXNzZXMoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW10pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSBpZiBubyBjbGFzc2VzIGluIGNvbmZpZycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0NvbmZpZ01hbmFnZXIuZ2V0Q29uZmlnID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7fSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBmYWN0b3J5LmdldEF2YWlsYWJsZUNsYXNzZXMoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW10pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NsZWFyQ2FjaGUnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjbGVhciB0aGUgY2xhc3MgcmVnaXN0cnknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IE1vY2tDbGFzcyA9IGNsYXNzIGV4dGVuZHMgQ2xhc3NlIHt9IGFzIGFueTtcclxuICAgICAgICAgICAgbW9ja0NvbmZpZ01hbmFnZXIuY3JlYXRlRHluYW1pY0NsYXNzZS5tb2NrUmVzb2x2ZWRWYWx1ZShNb2NrQ2xhc3MpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQWRkIGNsYXNzIHRvIHJlZ2lzdHJ5XHJcbiAgICAgICAgICAgIGF3YWl0IGZhY3RvcnkuZ2V0Q2xhc3MoJ1Rlc3RDbGFzcycpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQ2xlYXIgY2FjaGVcclxuICAgICAgICAgICAgZmFjdG9yeS5jbGVhckNhY2hlKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTaG91bGQgY2FsbCBjcmVhdGVEeW5hbWljQ2xhc3NlIGFnYWluIGFmdGVyIGNsZWFyaW5nXHJcbiAgICAgICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgICAgICAgICBhd2FpdCBmYWN0b3J5LmdldENsYXNzKCdUZXN0Q2xhc3MnKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tDb25maWdNYW5hZ2VyLmNyZWF0ZUR5bmFtaWNDbGFzc2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdUZXN0Q2xhc3MnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=