55c5adabe7ecfbdd4de284ede8b67ed3
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock flatpickr completely
jest.mock('flatpickr', () => {
    const mockInstance = {
        destroy: jest.fn(),
        setDate: jest.fn(),
        clear: jest.fn()
    };
    const mockFlatpickr = jest.fn((element, options) => {
        element.flatpickrOptions = options;
        element.flatpickrInstance = mockInstance;
        return mockInstance;
    });
    return mockFlatpickr;
});
// Mock French locale
jest.mock('flatpickr/dist/l10n/fr.js', () => ({
    French: { locale: 'fr' }
}));
// Mock all dependencies
jest.mock('../../src/vault/Classe', () => ({}));
jest.mock('../../src/vault/File', () => ({}));
jest.mock('../../src/vault/Vault', () => ({}));
jest.mock('../../src/vault/Utils', () => ({
    setIcon: jest.fn((element, iconName) => {
        element.setAttribute('data-icon', iconName);
        element.textContent = `[${iconName}]`;
    })
}));
// Mock Property base class
jest.mock('../../src/properties/Property', () => {
    return {
        Property: class MockProperty {
            constructor(name, vault, ...args) {
                this.title = '';
                this.static = false;
                this.icon = '';
                this.read = jest.fn(() => '');
                this.validate = jest.fn((value) => value);
                this.getPretty = jest.fn(() => '');
                this.getDisplay = jest.fn(() => document.createElement('div'));
                this.fillDisplay = jest.fn(() => {
                    const div = document.createElement('div');
                    div.classList.add('field-container-column');
                    const field = document.createElement('div');
                    field.classList.add('metadata-field');
                    div.appendChild(field);
                    return div;
                });
                this.name = name;
                this.vault = vault;
                this.type = 'property';
                if (args.length > 0 && typeof args[args.length - 1] === 'object') {
                    Object.assign(this, args[args.length - 1]);
                }
            }
        }
    };
});
const DateProperty_1 = require("../../src/properties/DateProperty");
describe('DateProperty', () => {
    let dateProperty;
    let mockVault;
    let mockFile;
    beforeEach(() => {
        jest.clearAllMocks();
        document.body.innerHTML = '';
        mockVault = {
            app: {
                vault: { getFiles: jest.fn(() => []) },
                setIcon: jest.fn((element, iconName) => {
                    element.setAttribute('data-icon', iconName);
                    element.textContent = `[${iconName}]`;
                })
            }
        };
        mockFile = {
            getMetadata: jest.fn(() => ({ eventDate: '2024-03-15' })),
            getMetadataValue: jest.fn((key) => key === 'eventDate' ? '2024-03-15' : undefined),
            updateMetadata: jest.fn(),
            vault: mockVault
        };
        dateProperty = new DateProperty_1.DateProperty('eventDate', mockVault, ['today', 'tomorrow', 'next-week']);
        jest.useFakeTimers();
        jest.setSystemTime(new Date('2024-03-15T10:00:00Z'));
    });
    afterEach(() => {
        jest.useRealTimers();
    });
    describe('constructor', () => {
        it('should create DateProperty with correct properties', () => {
            const quickIcons = ['today', 'tomorrow'];
            const prop = new DateProperty_1.DateProperty('testDate', mockVault, quickIcons);
            expect(prop.name).toBe('testDate');
            expect(prop.type).toBe('date');
            expect(prop.quickSelectIcons).toEqual(quickIcons);
        });
    });
    describe('formatDateForStorage', () => {
        it('should format date in YYYY-MM-DD format', () => {
            const testDate = new Date('2024-03-15T10:30:00Z');
            const result = dateProperty.formatDateForStorage(testDate);
            expect(result).toBe('2024-03-15');
        });
    });
    describe('formatDateForDisplay', () => {
        it('should format valid date strings', () => {
            const result = dateProperty.formatDateForDisplay('2024-03-15');
            expect(result).toBeTruthy();
            expect(typeof result).toBe('string');
        });
        it('should handle invalid dates', () => {
            const result = dateProperty.formatDateForDisplay('invalid-date');
            expect(result).toBe('Invalid Date');
        });
    });
    describe('getDateForOption', () => {
        it('should return correct dates for standard options', () => {
            const today = dateProperty.getDateForOption('today');
            expect(today.getDate()).toBe(15);
            const tomorrow = dateProperty.getDateForOption('tomorrow');
            expect(tomorrow.getDate()).toBe(16);
        });
    });
    describe('createFieldLink', () => {
        it('should create a clickable link element', () => {
            const link = dateProperty.createFieldLink('2024-03-15');
            expect(link.tagName).toBe('DIV');
            expect(link.classList.contains('field-link')).toBe(true);
            expect(link.style.cursor).toBe('pointer');
        });
        it('should show placeholder for empty values', () => {
            const link = dateProperty.createFieldLink('');
            expect(link.textContent).toBe('Aucune date sélectionnée');
        });
    });
    describe('createFieldDate', () => {
        it('should create input with flatpickr initialization', () => {
            const updateFn = jest.fn();
            const link = document.createElement('div');
            const input = dateProperty.createFieldDate('2024-03-15', updateFn, link);
            expect(input.tagName).toBe('INPUT');
            expect(input.value).toBe('2024-03-15');
            expect(input.classList.contains('field-input')).toBe(true);
        });
    });
    describe('createQuickSelect', () => {
        it('should create buttons for quick select options', () => {
            const updateFn = jest.fn();
            const link = document.createElement('div');
            const input = document.createElement('input');
            // Debug: Vérifier que vault et app sont bien définis
            console.log('dateProperty.vault:', dateProperty.vault);
            console.log('dateProperty.vault.app:', dateProperty.vault?.app);
            const container = dateProperty.createQuickSelect('', updateFn, link, input);
            expect(container.tagName).toBe('DIV');
            expect(container.classList.contains('quick-select-container')).toBe(true);
            const buttons = container.querySelectorAll('button');
            expect(buttons.length).toBe(3);
        });
    });
    describe('updateField', () => {
        it('should update field with valid input', async () => {
            const updateFn = jest.fn().mockResolvedValue(undefined);
            const input = document.createElement('input');
            const link = document.createElement('div');
            input.value = '2024-03-20';
            dateProperty.validate = jest.fn(() => '2024-03-20');
            await dateProperty.updateField(updateFn, input, link);
            expect(updateFn).toHaveBeenCalledWith('2024-03-20');
        });
    });
    describe('fillDisplay', () => {
        it('should create display structure', () => {
            const updateFn = jest.fn();
            const result = dateProperty.fillDisplay('2024-03-15', updateFn);
            expect(result).toBeTruthy();
            expect(result.classList.contains('field-container-column')).toBe(true);
        });
    });
    describe('edge cases', () => {
        it('should handle null values gracefully', () => {
            expect(() => {
                dateProperty.createFieldLink(null);
                dateProperty.formatDateForDisplay('');
            }).not.toThrow();
        });
        it('should handle empty quick select icons', () => {
            const prop = new DateProperty_1.DateProperty('test', mockVault, []);
            const updateFn = jest.fn();
            const link = document.createElement('div');
            const input = document.createElement('input');
            const container = prop.createQuickSelect('', updateFn, link, input);
            const buttons = container.querySelectorAll('button');
            expect(buttons.length).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXERhdGVQcm9wZXJ0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFJSCw0QkFBNEI7QUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFO0lBQ3hCLE1BQU0sWUFBWSxHQUFHO1FBQ2pCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ25CLENBQUM7SUFFRixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxFQUFFO1FBQzlDLE9BQWUsQ0FBQyxnQkFBZ0IsR0FBRyxPQUFPLENBQUM7UUFDM0MsT0FBZSxDQUFDLGlCQUFpQixHQUFHLFlBQVksQ0FBQztRQUNsRCxPQUFPLFlBQVksQ0FBQztJQUN4QixDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sYUFBYSxDQUFDO0FBQ3pCLENBQUMsQ0FBQyxDQUFDO0FBRUgscUJBQXFCO0FBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMxQyxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO0NBQzNCLENBQUMsQ0FBQyxDQUFDO0FBRUosd0JBQXdCO0FBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ2hELElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzlDLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQy9DLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN0QyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE9BQW9CLEVBQUUsUUFBZ0IsRUFBRSxFQUFFO1FBQ3hELE9BQU8sQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzVDLE9BQU8sQ0FBQyxXQUFXLEdBQUcsSUFBSSxRQUFRLEdBQUcsQ0FBQztJQUMxQyxDQUFDLENBQUM7Q0FDTCxDQUFDLENBQUMsQ0FBQztBQUVKLDJCQUEyQjtBQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDLCtCQUErQixFQUFFLEdBQUcsRUFBRTtJQUM1QyxPQUFPO1FBQ0gsUUFBUSxFQUFFLE1BQU0sWUFBWTtZQVN4QixZQUFZLElBQVksRUFBRSxLQUFVLEVBQUUsR0FBRyxJQUFXO2dCQU5wRCxVQUFLLEdBQVcsRUFBRSxDQUFDO2dCQUNuQixXQUFNLEdBQVksS0FBSyxDQUFDO2dCQUN4QixTQUFJLEdBQVcsRUFBRSxDQUFDO2dCQWNsQixTQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDekIsYUFBUSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFhLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUM3QyxjQUFTLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDOUIsZUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUMxRCxnQkFBVyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFO29CQUN2QixNQUFNLEdBQUcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUMxQyxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO29CQUM1QyxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUM1QyxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO29CQUN0QyxHQUFHLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUN2QixPQUFPLEdBQUcsQ0FBQztnQkFDZixDQUFDLENBQUMsQ0FBQztnQkFwQkMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7Z0JBQ2pCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO2dCQUNuQixJQUFJLENBQUMsSUFBSSxHQUFHLFVBQVUsQ0FBQztnQkFFdkIsSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxLQUFLLFFBQVEsRUFBRSxDQUFDO29CQUMvRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMvQyxDQUFDO1lBQ0wsQ0FBQztTQWNKO0tBQ0osQ0FBQztBQUNOLENBQUMsQ0FBQyxDQUFDO0FBdkVILG9FQUFpRTtBQXlFakUsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7SUFDMUIsSUFBSSxZQUEwQixDQUFDO0lBQy9CLElBQUksU0FBYyxDQUFDO0lBQ25CLElBQUksUUFBYSxDQUFDO0lBRWxCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDckIsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBRTdCLFNBQVMsR0FBRztZQUNSLEdBQUcsRUFBRTtnQkFDRCxLQUFLLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTtnQkFDdEMsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFvQixFQUFFLFFBQWdCLEVBQUUsRUFBRTtvQkFDeEQsT0FBTyxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBQzVDLE9BQU8sQ0FBQyxXQUFXLEdBQUcsSUFBSSxRQUFRLEdBQUcsQ0FBQztnQkFDMUMsQ0FBQyxDQUFDO2FBQ0w7U0FDSixDQUFDO1FBRUYsUUFBUSxHQUFHO1lBQ1AsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDO1lBQ3pELGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFXLEVBQUUsRUFBRSxDQUFDLEdBQUcsS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1lBQzFGLGNBQWMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3pCLEtBQUssRUFBRSxTQUFTO1NBQ25CLENBQUM7UUFFRixZQUFZLEdBQUcsSUFBSSwyQkFBWSxDQUFDLFdBQVcsRUFBRSxTQUFTLEVBQUUsQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7UUFFNUYsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDO0lBQ3pELENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNYLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN6QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQ3pCLEVBQUUsQ0FBQyxvREFBb0QsRUFBRSxHQUFHLEVBQUU7WUFDMUQsTUFBTSxVQUFVLEdBQUcsQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUM7WUFDekMsTUFBTSxJQUFJLEdBQUcsSUFBSSwyQkFBWSxDQUFDLFVBQVUsRUFBRSxTQUFTLEVBQUUsVUFBVSxDQUFDLENBQUM7WUFFakUsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDbkMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDL0IsTUFBTSxDQUFFLElBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtRQUNsQyxFQUFFLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1lBQy9DLE1BQU0sUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7WUFDbEQsTUFBTSxNQUFNLEdBQUcsWUFBWSxDQUFDLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzNELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdEMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7UUFDbEMsRUFBRSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtZQUN4QyxNQUFNLE1BQU0sR0FBRyxZQUFZLENBQUMsb0JBQW9CLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDL0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQzVCLE1BQU0sQ0FBQyxPQUFPLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUU7WUFDbkMsTUFBTSxNQUFNLEdBQUcsWUFBWSxDQUFDLG9CQUFvQixDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQ2pFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsRUFBRSxDQUFDLGtEQUFrRCxFQUFFLEdBQUcsRUFBRTtZQUN4RCxNQUFNLEtBQUssR0FBRyxZQUFZLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDckQsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUVqQyxNQUFNLFFBQVEsR0FBRyxZQUFZLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDM0QsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUM3QixFQUFFLENBQUMsd0NBQXdDLEVBQUUsR0FBRyxFQUFFO1lBQzlDLE1BQU0sSUFBSSxHQUFHLFlBQVksQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFeEQsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3pELE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM5QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7WUFDaEQsTUFBTSxJQUFJLEdBQUcsWUFBWSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM5QyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1FBQzlELENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO1FBQzdCLEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxHQUFHLEVBQUU7WUFDekQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzNCLE1BQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFM0MsTUFBTSxLQUFLLEdBQUcsWUFBWSxDQUFDLGVBQWUsQ0FBQyxZQUFZLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRXpFLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3ZDLE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUMvQixFQUFFLENBQUMsZ0RBQWdELEVBQUUsR0FBRyxFQUFFO1lBQ3RELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMzQixNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzNDLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFxQixDQUFDO1lBRWxFLHFEQUFxRDtZQUNyRCxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixFQUFFLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN2RCxPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QixFQUFFLFlBQVksQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFFaEUsTUFBTSxTQUFTLEdBQUcsWUFBWSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBRTVFLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRTFFLE1BQU0sT0FBTyxHQUFHLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNyRCxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDekIsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2xELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN4RCxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBcUIsQ0FBQztZQUNsRSxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRTNDLEtBQUssQ0FBQyxLQUFLLEdBQUcsWUFBWSxDQUFDO1lBQzNCLFlBQVksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUVwRCxNQUFNLFlBQVksQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztZQUV0RCxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsb0JBQW9CLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FBQ3pCLEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxHQUFHLEVBQUU7WUFDdkMsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzNCLE1BQU0sTUFBTSxHQUFHLFlBQVksQ0FBQyxXQUFXLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRWhFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUM1QixNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUU7UUFDeEIsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEdBQUcsRUFBRTtZQUM1QyxNQUFNLENBQUMsR0FBRyxFQUFFO2dCQUNSLFlBQVksQ0FBQyxlQUFlLENBQUMsSUFBVyxDQUFDLENBQUM7Z0JBQzFDLFlBQVksQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMxQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0NBQXdDLEVBQUUsR0FBRyxFQUFFO1lBQzlDLE1BQU0sSUFBSSxHQUFHLElBQUksMkJBQVksQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ3JELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMzQixNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzNDLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFxQixDQUFDO1lBRWxFLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNwRSxNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFckQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcX190ZXN0c19fXFxQcm9wZXJ0aWVzXFxEYXRlUHJvcGVydHkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGplc3QtZW52aXJvbm1lbnQganNkb21cclxuICovXHJcblxyXG5pbXBvcnQgeyBEYXRlUHJvcGVydHkgfSBmcm9tICcuLi8uLi9zcmMvcHJvcGVydGllcy9EYXRlUHJvcGVydHknO1xyXG5cclxuLy8gTW9jayBmbGF0cGlja3IgY29tcGxldGVseVxyXG5qZXN0Lm1vY2soJ2ZsYXRwaWNrcicsICgpID0+IHtcclxuICAgIGNvbnN0IG1vY2tJbnN0YW5jZSA9IHtcclxuICAgICAgICBkZXN0cm95OiBqZXN0LmZuKCksXHJcbiAgICAgICAgc2V0RGF0ZTogamVzdC5mbigpLFxyXG4gICAgICAgIGNsZWFyOiBqZXN0LmZuKClcclxuICAgIH07XHJcbiAgICBcclxuICAgIGNvbnN0IG1vY2tGbGF0cGlja3IgPSBqZXN0LmZuKChlbGVtZW50LCBvcHRpb25zKSA9PiB7XHJcbiAgICAgICAgKGVsZW1lbnQgYXMgYW55KS5mbGF0cGlja3JPcHRpb25zID0gb3B0aW9ucztcclxuICAgICAgICAoZWxlbWVudCBhcyBhbnkpLmZsYXRwaWNrckluc3RhbmNlID0gbW9ja0luc3RhbmNlO1xyXG4gICAgICAgIHJldHVybiBtb2NrSW5zdGFuY2U7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgcmV0dXJuIG1vY2tGbGF0cGlja3I7XHJcbn0pO1xyXG5cclxuLy8gTW9jayBGcmVuY2ggbG9jYWxlXHJcbmplc3QubW9jaygnZmxhdHBpY2tyL2Rpc3QvbDEwbi9mci5qcycsICgpID0+ICh7XHJcbiAgICBGcmVuY2g6IHsgbG9jYWxlOiAnZnInIH1cclxufSkpO1xyXG5cclxuLy8gTW9jayBhbGwgZGVwZW5kZW5jaWVzXHJcbmplc3QubW9jaygnLi4vLi4vc3JjL3ZhdWx0L0NsYXNzZScsICgpID0+ICh7fSkpO1xyXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy92YXVsdC9GaWxlJywgKCkgPT4gKHt9KSk7XHJcbmplc3QubW9jaygnLi4vLi4vc3JjL3ZhdWx0L1ZhdWx0JywgKCkgPT4gKHt9KSk7XHJcbmplc3QubW9jaygnLi4vLi4vc3JjL3ZhdWx0L1V0aWxzJywgKCkgPT4gKHtcclxuICAgIHNldEljb246IGplc3QuZm4oKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBpY29uTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWNvbicsIGljb25OYW1lKTtcclxuICAgICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gYFske2ljb25OYW1lfV1gO1xyXG4gICAgfSlcclxufSkpO1xyXG5cclxuLy8gTW9jayBQcm9wZXJ0eSBiYXNlIGNsYXNzXHJcbmplc3QubW9jaygnLi4vLi4vc3JjL3Byb3BlcnRpZXMvUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIFByb3BlcnR5OiBjbGFzcyBNb2NrUHJvcGVydHkge1xyXG4gICAgICAgICAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICAgICAgICAgIHR5cGU6IHN0cmluZztcclxuICAgICAgICAgICAgdGl0bGU6IHN0cmluZyA9ICcnO1xyXG4gICAgICAgICAgICBzdGF0aWM6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgaWNvbjogc3RyaW5nID0gJyc7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGFueTtcclxuICAgICAgICAgICAgdmF1bHQ6IGFueTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgdmF1bHQ6IGFueSwgLi4uYXJnczogYW55W10pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZhdWx0ID0gdmF1bHQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSAncHJvcGVydHknO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAwICYmIHR5cGVvZiBhcmdzW2FyZ3MubGVuZ3RoIC0gMV0gPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBhcmdzW2FyZ3MubGVuZ3RoIC0gMV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZWFkID0gamVzdC5mbigoKSA9PiAnJyk7XHJcbiAgICAgICAgICAgIHZhbGlkYXRlID0gamVzdC5mbigodmFsdWU6IHN0cmluZykgPT4gdmFsdWUpO1xyXG4gICAgICAgICAgICBnZXRQcmV0dHkgPSBqZXN0LmZuKCgpID0+ICcnKTtcclxuICAgICAgICAgICAgZ2V0RGlzcGxheSA9IGplc3QuZm4oKCkgPT4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xyXG4gICAgICAgICAgICBmaWxsRGlzcGxheSA9IGplc3QuZm4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICBkaXYuY2xhc3NMaXN0LmFkZCgnZmllbGQtY29udGFpbmVyLWNvbHVtbicpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIGZpZWxkLmNsYXNzTGlzdC5hZGQoJ21ldGFkYXRhLWZpZWxkJyk7XHJcbiAgICAgICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoZmllbGQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRpdjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSk7XHJcblxyXG5kZXNjcmliZSgnRGF0ZVByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgbGV0IGRhdGVQcm9wZXJ0eTogRGF0ZVByb3BlcnR5O1xyXG4gICAgbGV0IG1vY2tWYXVsdDogYW55O1xyXG4gICAgbGV0IG1vY2tGaWxlOiBhbnk7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICBcclxuICAgICAgICBtb2NrVmF1bHQgPSB7XHJcbiAgICAgICAgICAgIGFwcDogeyBcclxuICAgICAgICAgICAgICAgIHZhdWx0OiB7IGdldEZpbGVzOiBqZXN0LmZuKCgpID0+IFtdKSB9LFxyXG4gICAgICAgICAgICAgICAgc2V0SWNvbjogamVzdC5mbigoZWxlbWVudDogSFRNTEVsZW1lbnQsIGljb25OYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1pY29uJywgaWNvbk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSBgWyR7aWNvbk5hbWV9XWA7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbW9ja0ZpbGUgPSB7XHJcbiAgICAgICAgICAgIGdldE1ldGFkYXRhOiBqZXN0LmZuKCgpID0+ICh7IGV2ZW50RGF0ZTogJzIwMjQtMDMtMTUnIH0pKSxcclxuICAgICAgICAgICAgZ2V0TWV0YWRhdGFWYWx1ZTogamVzdC5mbigoa2V5OiBzdHJpbmcpID0+IGtleSA9PT0gJ2V2ZW50RGF0ZScgPyAnMjAyNC0wMy0xNScgOiB1bmRlZmluZWQpLFxyXG4gICAgICAgICAgICB1cGRhdGVNZXRhZGF0YTogamVzdC5mbigpLFxyXG4gICAgICAgICAgICB2YXVsdDogbW9ja1ZhdWx0XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZGF0ZVByb3BlcnR5ID0gbmV3IERhdGVQcm9wZXJ0eSgnZXZlbnREYXRlJywgbW9ja1ZhdWx0LCBbJ3RvZGF5JywgJ3RvbW9ycm93JywgJ25leHQtd2VlayddKTtcclxuICAgICAgICBcclxuICAgICAgICBqZXN0LnVzZUZha2VUaW1lcnMoKTtcclxuICAgICAgICBqZXN0LnNldFN5c3RlbVRpbWUobmV3IERhdGUoJzIwMjQtMDMtMTVUMTA6MDA6MDBaJykpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgICAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjb25zdHJ1Y3RvcicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBEYXRlUHJvcGVydHkgd2l0aCBjb3JyZWN0IHByb3BlcnRpZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHF1aWNrSWNvbnMgPSBbJ3RvZGF5JywgJ3RvbW9ycm93J107XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3AgPSBuZXcgRGF0ZVByb3BlcnR5KCd0ZXN0RGF0ZScsIG1vY2tWYXVsdCwgcXVpY2tJY29ucyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocHJvcC5uYW1lKS50b0JlKCd0ZXN0RGF0ZScpO1xyXG4gICAgICAgICAgICBleHBlY3QocHJvcC50eXBlKS50b0JlKCdkYXRlJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdCgocHJvcCBhcyBhbnkpLnF1aWNrU2VsZWN0SWNvbnMpLnRvRXF1YWwocXVpY2tJY29ucyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZm9ybWF0RGF0ZUZvclN0b3JhZ2UnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBmb3JtYXQgZGF0ZSBpbiBZWVlZLU1NLUREIGZvcm1hdCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdGVzdERhdGUgPSBuZXcgRGF0ZSgnMjAyNC0wMy0xNVQxMDozMDowMFonKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGF0ZVByb3BlcnR5LmZvcm1hdERhdGVGb3JTdG9yYWdlKHRlc3REYXRlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnMjAyNC0wMy0xNScpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2Zvcm1hdERhdGVGb3JEaXNwbGF5JywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgZm9ybWF0IHZhbGlkIGRhdGUgc3RyaW5ncycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGF0ZVByb3BlcnR5LmZvcm1hdERhdGVGb3JEaXNwbGF5KCcyMDI0LTAzLTE1Jyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQpLnRvQmUoJ3N0cmluZycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIGRhdGVzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBkYXRlUHJvcGVydHkuZm9ybWF0RGF0ZUZvckRpc3BsYXkoJ2ludmFsaWQtZGF0ZScpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdJbnZhbGlkIERhdGUnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdnZXREYXRlRm9yT3B0aW9uJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgZGF0ZXMgZm9yIHN0YW5kYXJkIG9wdGlvbnMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvZGF5ID0gZGF0ZVByb3BlcnR5LmdldERhdGVGb3JPcHRpb24oJ3RvZGF5Jyk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh0b2RheS5nZXREYXRlKCkpLnRvQmUoMTUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgdG9tb3Jyb3cgPSBkYXRlUHJvcGVydHkuZ2V0RGF0ZUZvck9wdGlvbigndG9tb3Jyb3cnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHRvbW9ycm93LmdldERhdGUoKSkudG9CZSgxNik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY3JlYXRlRmllbGRMaW5rJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgY2xpY2thYmxlIGxpbmsgZWxlbWVudCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbGluayA9IGRhdGVQcm9wZXJ0eS5jcmVhdGVGaWVsZExpbmsoJzIwMjQtMDMtMTUnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChsaW5rLnRhZ05hbWUpLnRvQmUoJ0RJVicpO1xyXG4gICAgICAgICAgICBleHBlY3QobGluay5jbGFzc0xpc3QuY29udGFpbnMoJ2ZpZWxkLWxpbmsnKSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KGxpbmsuc3R5bGUuY3Vyc29yKS50b0JlKCdwb2ludGVyJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgc2hvdyBwbGFjZWhvbGRlciBmb3IgZW1wdHkgdmFsdWVzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gZGF0ZVByb3BlcnR5LmNyZWF0ZUZpZWxkTGluaygnJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChsaW5rLnRleHRDb250ZW50KS50b0JlKCdBdWN1bmUgZGF0ZSBzw6lsZWN0aW9ubsOpZScpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NyZWF0ZUZpZWxkRGF0ZScsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBpbnB1dCB3aXRoIGZsYXRwaWNrciBpbml0aWFsaXphdGlvbicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlRm4gPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZGF0ZVByb3BlcnR5LmNyZWF0ZUZpZWxkRGF0ZSgnMjAyNC0wMy0xNScsIHVwZGF0ZUZuLCBsaW5rKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChpbnB1dC50YWdOYW1lKS50b0JlKCdJTlBVVCcpO1xyXG4gICAgICAgICAgICBleHBlY3QoaW5wdXQudmFsdWUpLnRvQmUoJzIwMjQtMDMtMTUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGlucHV0LmNsYXNzTGlzdC5jb250YWlucygnZmllbGQtaW5wdXQnKSkudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjcmVhdGVRdWlja1NlbGVjdCcsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBidXR0b25zIGZvciBxdWljayBzZWxlY3Qgb3B0aW9ucycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlRm4gPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBEZWJ1ZzogVsOpcmlmaWVyIHF1ZSB2YXVsdCBldCBhcHAgc29udCBiaWVuIGTDqWZpbmlzXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkYXRlUHJvcGVydHkudmF1bHQ6JywgZGF0ZVByb3BlcnR5LnZhdWx0KTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2RhdGVQcm9wZXJ0eS52YXVsdC5hcHA6JywgZGF0ZVByb3BlcnR5LnZhdWx0Py5hcHApO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZGF0ZVByb3BlcnR5LmNyZWF0ZVF1aWNrU2VsZWN0KCcnLCB1cGRhdGVGbiwgbGluaywgaW5wdXQpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci50YWdOYW1lKS50b0JlKCdESVYnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ3F1aWNrLXNlbGVjdC1jb250YWluZXInKSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChidXR0b25zLmxlbmd0aCkudG9CZSgzKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCd1cGRhdGVGaWVsZCcsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIHVwZGF0ZSBmaWVsZCB3aXRoIHZhbGlkIGlucHV0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVGbiA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaW5wdXQudmFsdWUgPSAnMjAyNC0wMy0yMCc7XHJcbiAgICAgICAgICAgIGRhdGVQcm9wZXJ0eS52YWxpZGF0ZSA9IGplc3QuZm4oKCkgPT4gJzIwMjQtMDMtMjAnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGF3YWl0IGRhdGVQcm9wZXJ0eS51cGRhdGVGaWVsZCh1cGRhdGVGbiwgaW5wdXQsIGxpbmspO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHVwZGF0ZUZuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnMjAyNC0wMy0yMCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2ZpbGxEaXNwbGF5JywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGRpc3BsYXkgc3RydWN0dXJlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVGbiA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGF0ZVByb3BlcnR5LmZpbGxEaXNwbGF5KCcyMDI0LTAzLTE1JywgdXBkYXRlRm4pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZVRydXRoeSgpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmNsYXNzTGlzdC5jb250YWlucygnZmllbGQtY29udGFpbmVyLWNvbHVtbicpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2VkZ2UgY2FzZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbnVsbCB2YWx1ZXMgZ3JhY2VmdWxseScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGRhdGVQcm9wZXJ0eS5jcmVhdGVGaWVsZExpbmsobnVsbCBhcyBhbnkpO1xyXG4gICAgICAgICAgICAgICAgZGF0ZVByb3BlcnR5LmZvcm1hdERhdGVGb3JEaXNwbGF5KCcnKTtcclxuICAgICAgICAgICAgfSkubm90LnRvVGhyb3coKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgcXVpY2sgc2VsZWN0IGljb25zJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wID0gbmV3IERhdGVQcm9wZXJ0eSgndGVzdCcsIG1vY2tWYXVsdCwgW10pO1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVGbiA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHByb3AuY3JlYXRlUXVpY2tTZWxlY3QoJycsIHVwZGF0ZUZuLCBsaW5rLCBpbnB1dCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoYnV0dG9ucy5sZW5ndGgpLnRvQmUoMCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==