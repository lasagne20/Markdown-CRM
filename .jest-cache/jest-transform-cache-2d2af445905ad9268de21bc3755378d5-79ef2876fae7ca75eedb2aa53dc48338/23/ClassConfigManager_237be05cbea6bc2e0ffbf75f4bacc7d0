2c1fa791bee666e36f960f82750dca7b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ClassConfigManager = void 0;
const Classe_1 = require("../vault/Classe");
const ConfigLoader_1 = require("./ConfigLoader");
class ClassConfigManager {
    constructor(configPath, vault) {
        this.loadedClasses = new Map();
        this.configLoader = new ConfigLoader_1.ConfigLoader(configPath, vault);
    }
    /**
     * Create a dynamic Classe from configuration
     */
    async createDynamicClasse(className) {
        if (this.loadedClasses.has(className)) {
            return this.loadedClasses.get(className);
        }
        const config = await this.configLoader.loadClassConfig(className);
        console.log(`ðŸ“‹ Configuration chargÃ©e pour ${className}:`, JSON.stringify(config, null, 2));
        class DynamicClasse extends Classe_1.Classe {
            constructor(vault, file, data) {
                super(vault, file, data);
                this.name = config.className || className;
                this.icon = config.classIcon || 'ðŸ“„';
                // Initialize instance properties from static configuration
                this.properties = [];
                for (const [key, property] of Object.entries(DynamicClasse.Properties)) {
                    this.properties.push(property);
                }
            }
            static getConstructor() {
                return DynamicClasse;
            }
            getConstructor() {
                return DynamicClasse;
            }
            async populate(...args) {
                // Default implementation - can be overridden in config if needed
            }
            async getTopDisplayContent() {
                const container = document.createElement("div");
                if (config.display && config.display.containers) {
                    for (const containerConfig of config.display.containers) {
                        const displayContainer = await this.createDisplayContainer(containerConfig);
                        container.appendChild(displayContainer);
                    }
                }
                else {
                    // Default display: show all properties
                    const properties = document.createElement("div");
                    for (let property of this.getProperties()) {
                        properties.appendChild(await property.getDisplay(this));
                    }
                    container.appendChild(properties);
                }
                return container;
            }
            async createDisplayContainer(containerConfig) {
                const container = document.createElement("div");
                if (containerConfig.className) {
                    container.classList.add(containerConfig.className);
                }
                // Add CSS class based on container type
                switch (containerConfig.type) {
                    case 'line':
                        container.classList.add("metadata-line");
                        break;
                    case 'column':
                        container.classList.add("metadata-column");
                        break;
                }
                if (containerConfig.title) {
                    const title = document.createElement("div");
                    title.textContent = containerConfig.title;
                    title.classList.add("metadata-title");
                    container.appendChild(title);
                }
                // Add properties to container
                if (containerConfig.properties) {
                    for (const propName of containerConfig.properties) {
                        const property = this.getProperty(propName);
                        if (property) {
                            container.appendChild(await property.getDisplay(this));
                        }
                    }
                }
                return container;
            }
        }
        DynamicClasse.Properties = {};
        // Initialize static properties
        if (config.parentProperty) {
            DynamicClasse.parentProperty = this.configLoader.createProperty(config.parentProperty);
        }
        console.log(`ðŸ”§ PropriÃ©tÃ© parente pour ${className}:`, DynamicClasse.parentProperty);
        console.log("PropriÃ©tÃ©s : ", config.properties);
        // Initialize all properties
        for (const [key, propConfig] of Object.entries(config.properties)) {
            DynamicClasse.Properties[key] = this.configLoader.createProperty(propConfig);
        }
        this.loadedClasses.set(className, DynamicClasse);
        return DynamicClasse;
    }
    /**
     * Get class configuration for display purposes
     */
    async getClassConfig(className) {
        return await this.configLoader.loadClassConfig(className);
    }
    /**
     * Get all available class names
     */
    async getAvailableClasses() {
        return await this.configLoader.getAllClassNames();
    }
    /**
     * Clear the cache and reload configurations
     */
    clearCache() {
        this.loadedClasses.clear();
    }
}
exports.ClassConfigManager = ClassConfigManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXENvbmZpZ1xcQ2xhc3NDb25maWdNYW5hZ2VyLnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLDRDQUF5QztBQU96QyxpREFBOEM7QUFHOUMsTUFBYSxrQkFBa0I7SUFJM0IsWUFBWSxVQUFrQixFQUFFLEtBQVk7UUFGcEMsa0JBQWEsR0FBK0IsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUcxRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksMkJBQVksQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLG1CQUFtQixDQUFDLFNBQWlCO1FBQ3ZDLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQztZQUNwQyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBRSxDQUFDO1FBQzlDLENBQUM7UUFFRCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2xFLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUNBQWlDLFNBQVMsR0FBRyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTVGLE1BQU0sYUFBYyxTQUFRLGVBQU07WUFROUIsWUFBWSxLQUFVLEVBQUUsSUFBVSxFQUFFLElBQVU7Z0JBQzFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQVJiLFNBQUksR0FBRyxNQUFNLENBQUMsU0FBUyxJQUFJLFNBQVMsQ0FBQztnQkFDckMsU0FBSSxHQUFHLE1BQU0sQ0FBQyxTQUFTLElB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LElBQUksQ0FBQyxZQUFZLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxtQkFBbUI7UUFDckIsT0FBTyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUN0RCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxVQUFVO1FBQ04sSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUMvQixDQUFDO0NBQ0o7QUFoSkQsZ0RBZ0pDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcc3JjXFxDb25maWdcXENsYXNzQ29uZmlnTWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDbGFzc2UgfSBmcm9tICcuLi92YXVsdC9DbGFzc2UnO1xyXG5pbXBvcnQgeyBWYXVsdCB9IGZyb20gJy4uL3ZhdWx0L1ZhdWx0JztcclxuaW1wb3J0IHsgRmlsZVByb3BlcnR5IH0gZnJvbSAnLi4vcHJvcGVydGllcy9GaWxlUHJvcGVydHknO1xyXG5pbXBvcnQgeyBNdWx0aUZpbGVQcm9wZXJ0eSB9IGZyb20gJy4uL3Byb3BlcnRpZXMvTXVsdGlGaWxlUHJvcGVydHknO1xyXG5pbXBvcnQgeyBPYmplY3RQcm9wZXJ0eSB9IGZyb20gJy4uL3Byb3BlcnRpZXMvT2JqZWN0UHJvcGVydHknO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eSB9IGZyb20gJy4uL3Byb3BlcnRpZXMvUHJvcGVydHknO1xyXG5pbXBvcnQgeyBTdWJDbGFzc1Byb3BlcnR5IH0gZnJvbSAnLi4vcHJvcGVydGllcy9TdWJDbGFzc1Byb3BlcnR5JztcclxuaW1wb3J0IHsgQ29uZmlnTG9hZGVyIH0gZnJvbSAnLi9Db25maWdMb2FkZXInO1xyXG5pbXBvcnQgeyBDbGFzc0NvbmZpZywgRGlzcGxheUNvbnRhaW5lciB9IGZyb20gJy4vaW50ZXJmYWNlcyc7XHJcblxyXG5leHBvcnQgY2xhc3MgQ2xhc3NDb25maWdNYW5hZ2VyIHtcclxuICAgIHByaXZhdGUgY29uZmlnTG9hZGVyOiBDb25maWdMb2FkZXI7XHJcbiAgICBwcml2YXRlIGxvYWRlZENsYXNzZXM6IE1hcDxzdHJpbmcsIHR5cGVvZiBDbGFzc2U+ID0gbmV3IE1hcCgpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGNvbmZpZ1BhdGg6IHN0cmluZywgdmF1bHQ6IFZhdWx0KSB7XHJcbiAgICAgICAgdGhpcy5jb25maWdMb2FkZXIgPSBuZXcgQ29uZmlnTG9hZGVyKGNvbmZpZ1BhdGgsIHZhdWx0KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZSBhIGR5bmFtaWMgQ2xhc3NlIGZyb20gY29uZmlndXJhdGlvblxyXG4gICAgICovXHJcbiAgICBhc3luYyBjcmVhdGVEeW5hbWljQ2xhc3NlKGNsYXNzTmFtZTogc3RyaW5nKTogUHJvbWlzZTx0eXBlb2YgQ2xhc3NlPiB7XHJcbiAgICAgICAgaWYgKHRoaXMubG9hZGVkQ2xhc3Nlcy5oYXMoY2xhc3NOYW1lKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sb2FkZWRDbGFzc2VzLmdldChjbGFzc05hbWUpITtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IHRoaXMuY29uZmlnTG9hZGVyLmxvYWRDbGFzc0NvbmZpZyhjbGFzc05hbWUpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OLIENvbmZpZ3VyYXRpb24gY2hhcmfDqWUgcG91ciAke2NsYXNzTmFtZX06YCwgSlNPTi5zdHJpbmdpZnkoY29uZmlnLCBudWxsLCAyKSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY2xhc3MgRHluYW1pY0NsYXNzZSBleHRlbmRzIENsYXNzZSB7XHJcbiAgICAgICAgICAgIHB1YmxpYyBvdmVycmlkZSBuYW1lID0gY29uZmlnLmNsYXNzTmFtZSB8fCBjbGFzc05hbWU7XHJcbiAgICAgICAgICAgIHB1YmxpYyBvdmVycmlkZSBpY29uID0gY29uZmlnLmNsYXNzSWNvbiB8fCAn8J+ThCc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBwdWJsaWMgc3RhdGljIHBhcmVudFByb3BlcnR5OiBGaWxlUHJvcGVydHkgfCBNdWx0aUZpbGVQcm9wZXJ0eSB8IE9iamVjdFByb3BlcnR5O1xyXG4gICAgICAgICAgICBwdWJsaWMgc3RhdGljIHN1YkNsYXNzZXNQcm9wZXJ0eTogU3ViQ2xhc3NQcm9wZXJ0eTtcclxuICAgICAgICAgICAgcHVibGljIHN0YXRpYyBvdmVycmlkZSBQcm9wZXJ0aWVzOiB7IFtrZXk6IHN0cmluZ106IFByb3BlcnR5IH0gPSB7fTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yKHZhdWx0OiBhbnksIGZpbGU/OiBhbnksIGRhdGE/OiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIHN1cGVyKHZhdWx0LCBmaWxlLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBpbnN0YW5jZSBwcm9wZXJ0aWVzIGZyb20gc3RhdGljIGNvbmZpZ3VyYXRpb25cclxuICAgICAgICAgICAgICAgIHRoaXMucHJvcGVydGllcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCBwcm9wZXJ0eV0gb2YgT2JqZWN0LmVudHJpZXMoRHluYW1pY0NsYXNzZS5Qcm9wZXJ0aWVzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcGVydGllcy5wdXNoKHByb3BlcnR5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc3RhdGljIGdldENvbnN0cnVjdG9yKCk6IHR5cGVvZiBEeW5hbWljQ2xhc3NlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBEeW5hbWljQ2xhc3NlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBnZXRDb25zdHJ1Y3RvcigpOiB0eXBlb2YgRHluYW1pY0NsYXNzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gRHluYW1pY0NsYXNzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYXN5bmMgcG9wdWxhdGUoLi4uYXJnczogYW55W10pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb24gLSBjYW4gYmUgb3ZlcnJpZGRlbiBpbiBjb25maWcgaWYgbmVlZGVkXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFzeW5jIGdldFRvcERpc3BsYXlDb250ZW50KCk6IFByb21pc2U8YW55PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmRpc3BsYXkgJiYgY29uZmlnLmRpc3BsYXkuY29udGFpbmVycykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29udGFpbmVyQ29uZmlnIG9mIGNvbmZpZy5kaXNwbGF5LmNvbnRhaW5lcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzcGxheUNvbnRhaW5lciA9IGF3YWl0IHRoaXMuY3JlYXRlRGlzcGxheUNvbnRhaW5lcihjb250YWluZXJDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGlzcGxheUNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBEZWZhdWx0IGRpc3BsYXk6IHNob3cgYWxsIHByb3BlcnRpZXNcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0aWVzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBwcm9wZXJ0eSBvZiB0aGlzLmdldFByb3BlcnRpZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLmFwcGVuZENoaWxkKGF3YWl0IHByb3BlcnR5LmdldERpc3BsYXkodGhpcykpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHByaXZhdGUgYXN5bmMgY3JlYXRlRGlzcGxheUNvbnRhaW5lcihjb250YWluZXJDb25maWc6IERpc3BsYXlDb250YWluZXIpOiBQcm9taXNlPEhUTUxFbGVtZW50PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyQ29uZmlnLmNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNvbnRhaW5lckNvbmZpZy5jbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBBZGQgQ1NTIGNsYXNzIGJhc2VkIG9uIGNvbnRhaW5lciB0eXBlXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGNvbnRhaW5lckNvbmZpZy50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbGluZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtbGluZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY29sdW1uJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1jb2x1bW5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyQ29uZmlnLnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0gY29udGFpbmVyQ29uZmlnLnRpdGxlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS10aXRsZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBBZGQgcHJvcGVydGllcyB0byBjb250YWluZXJcclxuICAgICAgICAgICAgICAgIGlmIChjb250YWluZXJDb25maWcucHJvcGVydGllcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcE5hbWUgb2YgY29udGFpbmVyQ29uZmlnLnByb3BlcnRpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHkgPSB0aGlzLmdldFByb3BlcnR5KHByb3BOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoYXdhaXQgcHJvcGVydHkuZ2V0RGlzcGxheSh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEluaXRpYWxpemUgc3RhdGljIHByb3BlcnRpZXNcclxuICAgICAgICBpZiAoY29uZmlnLnBhcmVudFByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgIER5bmFtaWNDbGFzc2UucGFyZW50UHJvcGVydHkgPSB0aGlzLmNvbmZpZ0xvYWRlci5jcmVhdGVQcm9wZXJ0eShjb25maWcucGFyZW50UHJvcGVydHkpIGFzIEZpbGVQcm9wZXJ0eSB8IE11bHRpRmlsZVByb3BlcnR5IHwgT2JqZWN0UHJvcGVydHk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhg8J+UpyBQcm9wcmnDqXTDqSBwYXJlbnRlIHBvdXIgJHtjbGFzc05hbWV9OmAsIER5bmFtaWNDbGFzc2UucGFyZW50UHJvcGVydHkpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiUHJvcHJpw6l0w6lzIDogXCIsIGNvbmZpZy5wcm9wZXJ0aWVzKTtcclxuXHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBhbGwgcHJvcGVydGllc1xyXG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgcHJvcENvbmZpZ10gb2YgT2JqZWN0LmVudHJpZXMoY29uZmlnLnByb3BlcnRpZXMpKSB7XHJcbiAgICAgICAgICAgICAgICBEeW5hbWljQ2xhc3NlLlByb3BlcnRpZXNba2V5XSA9IHRoaXMuY29uZmlnTG9hZGVyLmNyZWF0ZVByb3BlcnR5KHByb3BDb25maWcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5sb2FkZWRDbGFzc2VzLnNldChjbGFzc05hbWUsIER5bmFtaWNDbGFzc2UpO1xyXG4gICAgICAgIHJldHVybiBEeW5hbWljQ2xhc3NlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGNsYXNzIGNvbmZpZ3VyYXRpb24gZm9yIGRpc3BsYXkgcHVycG9zZXNcclxuICAgICAqL1xyXG4gICAgYXN5bmMgZ2V0Q2xhc3NDb25maWcoY2xhc3NOYW1lOiBzdHJpbmcpOiBQcm9taXNlPENsYXNzQ29uZmlnPiB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29uZmlnTG9hZGVyLmxvYWRDbGFzc0NvbmZpZyhjbGFzc05hbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGFsbCBhdmFpbGFibGUgY2xhc3MgbmFtZXNcclxuICAgICAqL1xyXG4gICAgYXN5bmMgZ2V0QXZhaWxhYmxlQ2xhc3NlcygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29uZmlnTG9hZGVyLmdldEFsbENsYXNzTmFtZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENsZWFyIHRoZSBjYWNoZSBhbmQgcmVsb2FkIGNvbmZpZ3VyYXRpb25zXHJcbiAgICAgKi9cclxuICAgIGNsZWFyQ2FjaGUoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5sb2FkZWRDbGFzc2VzLmNsZWFyKCk7XHJcbiAgICB9XHJcbn0iXSwidmVyc2lvbiI6M30=