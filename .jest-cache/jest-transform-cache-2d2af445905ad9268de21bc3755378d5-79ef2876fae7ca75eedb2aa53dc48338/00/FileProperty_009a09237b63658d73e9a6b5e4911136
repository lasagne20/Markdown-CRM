201e0ddbdbe2615a1df1c9f2364133f8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileProperty = void 0;
const Utils_1 = require("../vault/Utils");
const LinkProperty_1 = require("./LinkProperty");
class FileProperty extends LinkProperty_1.LinkProperty {
    // Used for property with a single file
    constructor(name, vault, classes, args = {}) {
        super(name, vault, args);
        this.type = "file";
        this.classes = classes;
    }
    getClasses() {
        return this.classes;
    }
    getPretty(value) {
        return this.vault.readLinkFile(value);
    }
    getClasse(file) {
        let link = this.read(file);
        if (link) {
            let classe = this.vault.getFromLink(link);
            if (classe) {
                return classe;
            }
        }
        return undefined;
    }
    validate(value) {
        // Expression régulière pour détecter les liens Obsidian au format [[...]]
        const regex = /\[\[([^\]]+)\]\]/;
        const match = value.match(regex);
        if (match && match[1]) {
            return `[[${match[1]}]]`;
        }
        return "";
    }
    getLink(value, vault) {
        if (vault) {
            this.vault = vault;
        }
        const vaultName = this.vault.app.vault.getName();
        const filePath = this.vault.readLinkFile(value, true);
        // If readLinkFile returned a path and the file exists in the vault, use it.
        if (filePath && this.vault.app.vault.getAbstractFileByPath(filePath)) {
            return `obsidian://open?vault=${encodeURIComponent(vaultName)}&file=${encodeURIComponent(filePath)}`;
        }
        // Fallback: extract the name only from the link
        const nameOnly = this.vault.readLinkFile(value);
        return `obsidian://open?vault=${encodeURIComponent(vaultName)}&file=${encodeURIComponent(nameOnly)}`;
    }
    createIconContainer(update) {
        const iconContainer = document.createElement("div");
        iconContainer.classList.add("icon-container");
        const icon = document.createElement("div");
        (0, Utils_1.setIcon)(icon, this.icon);
        iconContainer.appendChild(icon);
        if (!this.static) {
            icon.style.cursor = "pointer";
            iconContainer.addEventListener("click", async (event) => await this.handleIconClick(update, event));
        }
        return iconContainer;
    }
    // Fonction pour gérer le clic sur l'icône
    async handleIconClick(update, event) {
        let selectedFileObj = await (0, Utils_1.selectFile)(this.vault, this.classes, { hint: "Choisissez un fichier " + this.getClasses().join(" ou ") });
        if (selectedFileObj) {
            const selectedFile = selectedFileObj.getLink();
            await update(selectedFile);
            const link = event.target.closest('.metadata-field')?.querySelector('.field-link');
            if (link) {
                link.textContent = selectedFile.slice(2, -2);
            }
        }
    }
    // Fonction pour gérer le clic sur l'icône
    async modifyField(event) {
        const link = event.target.closest('.metadata-field')?.querySelector('.field-link');
        let currentField = link.textContent;
        if (!currentField) {
            return;
        }
        event.preventDefault();
        const classe = this.vault.getFromLink(currentField);
        if (classe) {
            const leaf = this.vault.app.workspace.getLeaf();
            await leaf.openFile(classe.file);
        }
        else {
            console.error(`Le fichier ${currentField}.md n'existe pas`); // TODO: Use Notice when available
        }
    }
    // Fonction pour créer le conteneur principal pour l'field
    createFieldContainerContent(update, value) {
        const fieldContainer = document.createElement("div");
        fieldContainer.classList.add("field-container");
        const currentField = this.getPretty(value);
        const link = document.createElement("a");
        link.href = this.getLink(value);
        link.textContent = currentField || "";
        link.classList.add("field-link");
        link.style.display = "block";
        fieldContainer.appendChild(link);
        return fieldContainer;
    }
}
exports.FileProperty = FileProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXEZpbGVQcm9wZXJ0eS50cyIsIm1hcHBpbmdzIjoiOzs7QUFHQSwwQ0FBcUQ7QUFDckQsaURBQThDO0FBSzlDLE1BQWEsWUFBYSxTQUFRLDJCQUFZO0lBSTFDLHVDQUF1QztJQUN2QyxZQUFZLElBQWEsRUFBRSxLQUFZLEVBQUUsT0FBaUIsRUFBRSxJQUFJLEdBQUUsRUFBRTtRQUNsRSxLQUFLLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUhYLFNBQUksR0FBWSxNQUFNLENBQUM7UUFJckMsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDekIsQ0FBQztJQUVELFVBQVU7UUFDUixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUE7SUFDckIsQ0FBQztJQUVRLFNBQVMsQ0FBQyxLQUFhO1FBQzlCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDdkMsQ0FBQztJQUVELFNBQVMsQ0FBQyxJQUFXO1FBQ25CLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUNULElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLElBQUksTUFBTSxFQUFFLENBQUM7Z0JBQ1gsT0FBTyxNQUFNLENBQUM7WUFDaEIsQ0FBQztRQUNILENBQUM7UUFDRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRVEsUUFBUSxDQUFDLEtBQWE7UUFDN0IsMEVBQTBFO1FBQzFFLE1BQU0sS0FBSyxHQUFHLGtCQUFrQixDQUFDO1FBQ2pDLE1BQU0sS0FBSyxH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QUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsV0FBVyxHQUFHLFlBQVksSUFBSSxFQUFFLENBQUM7UUFDdEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBQzVCLGNBQWMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFakMsT0FBTyxjQUFjLENBQUM7SUFDMUIsQ0FBQztDQUVKO0FBbkhELG9DQW1IQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGxlb2R1XFxEb2N1bWVudHNcXDEgLSBQcm9cXFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXHNyY1xccHJvcGVydGllc1xcRmlsZVByb3BlcnR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZpbGUgfSBmcm9tIFwiLi4vdmF1bHQvRmlsZVwiO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eSB9IGZyb20gXCIuL1Byb3BlcnR5XCI7XHJcbmltcG9ydCB7IENsYXNzZSB9IGZyb20gXCIuLi92YXVsdC9DbGFzc2VcIjtcclxuaW1wb3J0IHsgc2V0SWNvbiwgc2VsZWN0RmlsZSB9IGZyb20gXCIuLi92YXVsdC9VdGlsc1wiO1xyXG5pbXBvcnQgeyBMaW5rUHJvcGVydHkgfSBmcm9tIFwiLi9MaW5rUHJvcGVydHlcIjtcclxuaW1wb3J0IHsgdmFsIH0gZnJvbSBcImNoZWVyaW8vZGlzdC9jb21tb25qcy9hcGkvYXR0cmlidXRlc1wiO1xyXG5pbXBvcnQgeyBWYXVsdCB9IGZyb20gXCIuLi92YXVsdC9WYXVsdFwiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBGaWxlUHJvcGVydHkgZXh0ZW5kcyBMaW5rUHJvcGVydHl7XHJcblxyXG4gICAgcHVibGljIGNsYXNzZXMgOiBzdHJpbmdbXTtcclxuICAgIHB1YmxpYyBvdmVycmlkZSB0eXBlIDogc3RyaW5nID0gXCJmaWxlXCI7XHJcbiAgICAvLyBVc2VkIGZvciBwcm9wZXJ0eSB3aXRoIGEgc2luZ2xlIGZpbGVcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUgOiBzdHJpbmcsIHZhdWx0OiBWYXVsdCwgY2xhc3Nlczogc3RyaW5nW10sIGFyZ3M9IHt9KXtcclxuICAgICAgc3VwZXIobmFtZSwgdmF1bHQsIGFyZ3MpO1xyXG4gICAgICB0aGlzLmNsYXNzZXMgPSBjbGFzc2VzO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENsYXNzZXMoKSA6IHN0cmluZ1tdIHtcclxuICAgICAgcmV0dXJuIHRoaXMuY2xhc3Nlc1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGdldFByZXR0eSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnZhdWx0LnJlYWRMaW5rRmlsZSh2YWx1ZSlcclxuICAgIH1cclxuXHJcbiAgICBnZXRDbGFzc2UoZmlsZSA6IEZpbGUpOiBDbGFzc2UgfCB1bmRlZmluZWR7XHJcbiAgICAgIGxldCBsaW5rID0gdGhpcy5yZWFkKGZpbGUpO1xyXG4gICAgICBpZiAobGluaykge1xyXG4gICAgICAgIGxldCBjbGFzc2UgPSB0aGlzLnZhdWx0LmdldEZyb21MaW5rKGxpbmspO1xyXG4gICAgICAgIGlmIChjbGFzc2UpIHtcclxuICAgICAgICAgIHJldHVybiBjbGFzc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgdmFsaWRhdGUodmFsdWU6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgIC8vIEV4cHJlc3Npb24gcsOpZ3VsacOocmUgcG91ciBkw6l0ZWN0ZXIgbGVzIGxpZW5zIE9ic2lkaWFuIGF1IGZvcm1hdCBbWy4uLl1dXHJcbiAgICAgIGNvbnN0IHJlZ2V4ID0gL1xcW1xcWyhbXlxcXV0rKVxcXVxcXS87XHJcbiAgICAgIGNvbnN0IG1hdGNoID0gdmFsdWUubWF0Y2gocmVnZXgpO1xyXG4gICAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0pIHtcclxuICAgICAgICAgIHJldHVybiBgW1ske21hdGNoWzFdfV1dYDtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gXCJcIjtcclxuICAgfVxyXG5cclxuICAgb3ZlcnJpZGUgZ2V0TGluayh2YWx1ZTogc3RyaW5nLCB2YXVsdD8gOiBhbnkpOiBzdHJpbmcge1xyXG4gICAgaWYgKHZhdWx0KSB7XHJcbiAgICAgIHRoaXMudmF1bHQgPSB2YXVsdDtcclxuICAgIH1cclxuICAgIGNvbnN0IHZhdWx0TmFtZSA9IHRoaXMudmF1bHQuYXBwLnZhdWx0LmdldE5hbWUoKTsgXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IHRoaXMudmF1bHQucmVhZExpbmtGaWxlKHZhbHVlLCB0cnVlKTtcclxuXHJcbiAgICAvLyBJZiByZWFkTGlua0ZpbGUgcmV0dXJuZWQgYSBwYXRoIGFuZCB0aGUgZmlsZSBleGlzdHMgaW4gdGhlIHZhdWx0LCB1c2UgaXQuXHJcbiAgICBpZiAoZmlsZVBhdGggJiYgdGhpcy52YXVsdC5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKSkge1xyXG4gICAgICByZXR1cm4gYG9ic2lkaWFuOi8vb3Blbj92YXVsdD0ke2VuY29kZVVSSUNvbXBvbmVudCh2YXVsdE5hbWUpfSZmaWxlPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVQYXRoKX1gO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZhbGxiYWNrOiBleHRyYWN0IHRoZSBuYW1lIG9ubHkgZnJvbSB0aGUgbGlua1xyXG4gICAgY29uc3QgbmFtZU9ubHkgPSB0aGlzLnZhdWx0LnJlYWRMaW5rRmlsZSh2YWx1ZSk7XHJcbiAgICByZXR1cm4gYG9ic2lkaWFuOi8vb3Blbj92YXVsdD0ke2VuY29kZVVSSUNvbXBvbmVudCh2YXVsdE5hbWUpfSZmaWxlPSR7ZW5jb2RlVVJJQ29tcG9uZW50KG5hbWVPbmx5KX1gO1xyXG4gICB9XHJcbiAgXHJcbiAgIG92ZXJyaWRlIGNyZWF0ZUljb25Db250YWluZXIodXBkYXRlOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPikge1xyXG4gICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICBpY29uQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJpY29uLWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgIHNldEljb24oaWNvbiwgdGhpcy5pY29uKTtcclxuICAgIGljb25Db250YWluZXIuYXBwZW5kQ2hpbGQoaWNvbik7XHJcblxyXG4gICAgaWYgKCF0aGlzLnN0YXRpYykge1xyXG4gICAgICBpY29uLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiO1xyXG4gICAgICBpY29uQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZXZlbnQpID0+IGF3YWl0IHRoaXMuaGFuZGxlSWNvbkNsaWNrKHVwZGF0ZSwgZXZlbnQpKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGljb25Db250YWluZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRm9uY3Rpb24gcG91ciBnw6lyZXIgbGUgY2xpYyBzdXIgbCdpY8O0bmVcclxuICAgIGFzeW5jIGhhbmRsZUljb25DbGljayh1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+LCBldmVudDogRXZlbnQpIHtcclxuICAgICAgICBsZXQgc2VsZWN0ZWRGaWxlT2JqID0gYXdhaXQgc2VsZWN0RmlsZSh0aGlzLnZhdWx0LCB0aGlzLmNsYXNzZXMsIHtoaW50OlwiQ2hvaXNpc3NleiB1biBmaWNoaWVyIFwiICsgdGhpcy5nZXRDbGFzc2VzKCkuam9pbihcIiBvdSBcIil9KTtcclxuICAgICAgICBpZiAoc2VsZWN0ZWRGaWxlT2JqKXtcclxuICAgICAgICAgIGNvbnN0IHNlbGVjdGVkRmlsZSA9IHNlbGVjdGVkRmlsZU9iai5nZXRMaW5rKCk7XHJcbiAgICAgICAgICBhd2FpdCB1cGRhdGUoc2VsZWN0ZWRGaWxlKVxyXG4gICAgICAgICAgY29uc3QgbGluayA9IChldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQpLmNsb3Nlc3QoJy5tZXRhZGF0YS1maWVsZCcpPy5xdWVyeVNlbGVjdG9yKCcuZmllbGQtbGluaycpIGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgICAgICBpZiAobGluaykge1xyXG4gICAgICAgICAgICAgIGxpbmsudGV4dENvbnRlbnQgPSBzZWxlY3RlZEZpbGUuc2xpY2UoMiwgLTIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEZvbmN0aW9uIHBvdXIgZ8OpcmVyIGxlIGNsaWMgc3VyIGwnaWPDtG5lXHJcbiAgICBvdmVycmlkZSBhc3luYyBtb2RpZnlGaWVsZChldmVudDogRXZlbnQpIHtcclxuICAgICAgY29uc3QgbGluayA9IChldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQpLmNsb3Nlc3QoJy5tZXRhZGF0YS1maWVsZCcpPy5xdWVyeVNlbGVjdG9yKCcuZmllbGQtbGluaycpIGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICBsZXQgY3VycmVudEZpZWxkID0gbGluay50ZXh0Q29udGVudFxyXG4gICAgICBpZiAoIWN1cnJlbnRGaWVsZCl7cmV0dXJufVxyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgIFxyXG4gICAgICBjb25zdCBjbGFzc2UgPSB0aGlzLnZhdWx0LmdldEZyb21MaW5rKGN1cnJlbnRGaWVsZCk7XHJcbiAgICAgIGlmIChjbGFzc2UpIHtcclxuICAgICAgICAgIGNvbnN0IGxlYWYgPSB0aGlzLnZhdWx0LmFwcC53b3Jrc3BhY2UuZ2V0TGVhZigpO1xyXG4gICAgICAgICAgYXdhaXQgbGVhZi5vcGVuRmlsZShjbGFzc2UuZmlsZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihgTGUgZmljaGllciAke2N1cnJlbnRGaWVsZH0ubWQgbidleGlzdGUgcGFzYCkgLy8gVE9ETzogVXNlIE5vdGljZSB3aGVuIGF2YWlsYWJsZVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBGb25jdGlvbiBwb3VyIGNyw6llciBsZSBjb250ZW5ldXIgcHJpbmNpcGFsIHBvdXIgbCdmaWVsZFxyXG4gICAgb3ZlcnJpZGUgY3JlYXRlRmllbGRDb250YWluZXJDb250ZW50KHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4sIHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBmaWVsZENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgZmllbGRDb250YWluZXIuY2xhc3NMaXN0LmFkZChcImZpZWxkLWNvbnRhaW5lclwiKTtcclxuICAgICAgICBjb25zdCBjdXJyZW50RmllbGQgPSB0aGlzLmdldFByZXR0eSh2YWx1ZSk7XHJcbiAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG4gICAgICAgIGxpbmsuaHJlZiA9IHRoaXMuZ2V0TGluayh2YWx1ZSk7XHJcbiAgICAgICAgbGluay50ZXh0Q29udGVudCA9IGN1cnJlbnRGaWVsZCB8fCBcIlwiO1xyXG4gICAgICAgIGxpbmsuY2xhc3NMaXN0LmFkZChcImZpZWxkLWxpbmtcIik7XHJcbiAgICAgICAgbGluay5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiXHJcbiAgICAgICAgZmllbGRDb250YWluZXIuYXBwZW5kQ2hpbGQobGluayk7XHJcblxyXG4gICAgICAgIHJldHVybiBmaWVsZENvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbn0iXSwidmVyc2lvbiI6M30=