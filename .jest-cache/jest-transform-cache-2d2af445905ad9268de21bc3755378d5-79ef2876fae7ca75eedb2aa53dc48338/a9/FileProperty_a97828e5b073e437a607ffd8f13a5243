f31dea24334a5816f7d9eab1d102eed5
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileProperty = void 0;
const LinkProperty_1 = require("./LinkProperty");
class FileProperty extends LinkProperty_1.LinkProperty {
    // Used for property with a single file
    constructor(name, vault, classes, args = {}) {
        super(name, vault, args);
        this.type = "file";
        this.classes = classes;
    }
    getClasses() {
        return this.classes;
    }
    getPretty(value) {
        return this.vault.readLinkFile(value);
    }
    getClasse(file) {
        let link = this.read(file);
        if (link) {
            let classe = this.vault.getFromLink(link);
            if (classe) {
                return classe;
            }
        }
        return undefined;
    }
    validate(value) {
        // Expression régulière pour détecter les liens Obsidian au format [[...]]
        const regex = /\[\[([^\]]+)\]\]/;
        const match = value.match(regex);
        if (match && match[1]) {
            return `[[${match[1]}]]`;
        }
        return "";
    }
    getLink(value, vault) {
        if (vault) {
            this.vault = vault;
        }
        const vaultName = this.vault.getName();
        const filePath = this.vault.readLinkFile(value, true);
        // If readLinkFile returned a path and the file exists in the vault, use it.
        if (filePath) {
            return `obsidian://open?vault=${encodeURIComponent(vaultName)}&file=${encodeURIComponent(filePath)}`;
        }
        // Fallback: extract the name only from the link
        const nameOnly = this.vault.readLinkFile(value);
        return `obsidian://open?vault=${encodeURIComponent(vaultName)}&file=${encodeURIComponent(nameOnly)}`;
    }
    createIconContainer(update) {
        const iconContainer = document.createElement("div");
        iconContainer.classList.add("icon-container");
        const icon = document.createElement("div");
        this.vault.app.setIcon(icon, this.icon);
        iconContainer.appendChild(icon);
        if (!this.static) {
            icon.style.cursor = "pointer";
            iconContainer.addEventListener("click", async (event) => await this.handleIconClick(update, event));
        }
        return iconContainer;
    }
    // Fonction pour gérer le clic sur l'icône
    async handleIconClick(update, event) {
        let selectedFileObj = await this.vault.app.selectFile(this.vault, this.classes, { hint: "Choisissez un fichier " + this.getClasses().join(" ou ") });
        if (selectedFileObj) {
            const selectedFile = selectedFileObj.getLink();
            await update(selectedFile);
            const link = event.target.closest('.metadata-field')?.querySelector('.field-link');
            if (link) {
                link.textContent = selectedFile.slice(2, -2);
            }
        }
    }
    // Fonction pour gérer le clic sur l'icône
    async modifyField(event) {
        const link = event.target.closest('.metadata-field')?.querySelector('.field-link');
        let currentField = link.textContent;
        if (!currentField) {
            return;
        }
        event.preventDefault();
        const classe = this.vault.getFromLink(currentField);
        if (classe) {
            let path = classe.getPath();
            if (path) {
                await this.vault.app.open(path);
            }
        }
        else {
            console.error(`Le fichier ${currentField}.md n'existe pas`); // TODO: Use Notice when available
        }
    }
    // Fonction pour créer le conteneur principal pour l'field
    createFieldContainerContent(update, value) {
        const fieldContainer = document.createElement("div");
        fieldContainer.classList.add("field-container");
        const currentField = this.getPretty(value);
        const link = document.createElement("a");
        link.href = this.getLink(value);
        link.textContent = currentField || "";
        link.classList.add("field-link");
        link.style.display = "block";
        fieldContainer.appendChild(link);
        return fieldContainer;
    }
}
exports.FileProperty = FileProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXEZpbGVQcm9wZXJ0eS50cyIsIm1hcHBpbmdzIjoiOzs7QUFHQSxpREFBOEM7QUFLOUMsTUFBYSxZQUFhLFNBQVEsMkJBQVk7SUFJMUMsdUNBQXVDO0lBQ3ZDLFlBQVksSUFBYSxFQUFFLEtBQVksRUFBRSxPQUFpQixFQUFFLElBQUksR0FBRSxFQUFFO1FBQ2xFLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBSFgsU0FBSSxHQUFZLE1BQU0sQ0FBQztRQUlyQyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUN6QixDQUFDO0lBRUQsVUFBVTtRQUNSLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQTtJQUNyQixDQUFDO0lBRVEsU0FBUyxDQUFDLEtBQWE7UUFDOUIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUN2QyxDQUFDO0lBRUQsU0FBUyxDQUFDLElBQVc7UUFDbkIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQixJQUFJLElBQUksRUFBRSxDQUFDO1lBQ1QsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUMsSUFBSSxNQUFNLEVBQUUsQ0FBQztnQkFDWCxPQUFPLE1BQU0sQ0FBQztZQUNoQixDQUFDO1FBQ0gsQ0FBQztRQUNELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFUSxRQUFRLENBQUMsS0FBYTtRQUM3QiwwRUFBMEU7UUFDMUUsTUFBTSxLQUFLLEdBQUcsa0JBQWtCLENBQUM7UUFDakMsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFD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QyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsV0FBVyxHQUFHLFlBQVksSUFBSSxFQUFFLENBQUM7UUFDdEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBQzVCLGNBQWMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFakMsT0FBTyxjQUFjLENBQUM7SUFDMUIsQ0FBQztDQUVKO0FBckhELG9DQXFIQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGxlb2R1XFxEb2N1bWVudHNcXDEgLSBQcm9cXFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXHNyY1xccHJvcGVydGllc1xcRmlsZVByb3BlcnR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZpbGUgfSBmcm9tIFwiLi4vdmF1bHQvRmlsZVwiO1xyXG5pbXBvcnQgeyBQcm9wZXJ0eSB9IGZyb20gXCIuL1Byb3BlcnR5XCI7XHJcbmltcG9ydCB7IENsYXNzZSB9IGZyb20gXCIuLi92YXVsdC9DbGFzc2VcIjtcclxuaW1wb3J0IHsgTGlua1Byb3BlcnR5IH0gZnJvbSBcIi4vTGlua1Byb3BlcnR5XCI7XHJcbmltcG9ydCB7IHZhbCB9IGZyb20gXCJjaGVlcmlvL2Rpc3QvY29tbW9uanMvYXBpL2F0dHJpYnV0ZXNcIjtcclxuaW1wb3J0IHsgVmF1bHQgfSBmcm9tIFwiLi4vdmF1bHQvVmF1bHRcIjtcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgRmlsZVByb3BlcnR5IGV4dGVuZHMgTGlua1Byb3BlcnR5e1xyXG5cclxuICAgIHB1YmxpYyBjbGFzc2VzIDogc3RyaW5nW107XHJcbiAgICBwdWJsaWMgb3ZlcnJpZGUgdHlwZSA6IHN0cmluZyA9IFwiZmlsZVwiO1xyXG4gICAgLy8gVXNlZCBmb3IgcHJvcGVydHkgd2l0aCBhIHNpbmdsZSBmaWxlXHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lIDogc3RyaW5nLCB2YXVsdDogVmF1bHQsIGNsYXNzZXM6IHN0cmluZ1tdLCBhcmdzPSB7fSl7XHJcbiAgICAgIHN1cGVyKG5hbWUsIHZhdWx0LCBhcmdzKTtcclxuICAgICAgdGhpcy5jbGFzc2VzID0gY2xhc3NlcztcclxuICAgIH1cclxuXHJcbiAgICBnZXRDbGFzc2VzKCkgOiBzdHJpbmdbXSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmNsYXNzZXNcclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZSBnZXRQcmV0dHkodmFsdWU6IHN0cmluZykge1xyXG4gICAgICByZXR1cm4gdGhpcy52YXVsdC5yZWFkTGlua0ZpbGUodmFsdWUpXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2xhc3NlKGZpbGUgOiBGaWxlKTogQ2xhc3NlIHwgdW5kZWZpbmVke1xyXG4gICAgICBsZXQgbGluayA9IHRoaXMucmVhZChmaWxlKTtcclxuICAgICAgaWYgKGxpbmspIHtcclxuICAgICAgICBsZXQgY2xhc3NlID0gdGhpcy52YXVsdC5nZXRGcm9tTGluayhsaW5rKTtcclxuICAgICAgICBpZiAoY2xhc3NlKSB7XHJcbiAgICAgICAgICByZXR1cm4gY2xhc3NlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIHZhbGlkYXRlKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAvLyBFeHByZXNzaW9uIHLDqWd1bGnDqHJlIHBvdXIgZMOpdGVjdGVyIGxlcyBsaWVucyBPYnNpZGlhbiBhdSBmb3JtYXQgW1suLi5dXVxyXG4gICAgICBjb25zdCByZWdleCA9IC9cXFtcXFsoW15cXF1dKylcXF1cXF0vO1xyXG4gICAgICBjb25zdCBtYXRjaCA9IHZhbHVlLm1hdGNoKHJlZ2V4KTtcclxuICAgICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSB7XHJcbiAgICAgICAgICByZXR1cm4gYFtbJHttYXRjaFsxXX1dXWA7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgIH1cclxuXHJcbiAgIG92ZXJyaWRlIGdldExpbmsodmFsdWU6IHN0cmluZywgdmF1bHQ/IDogYW55KTogc3RyaW5nIHtcclxuICAgIGlmICh2YXVsdCkge1xyXG4gICAgICB0aGlzLnZhdWx0ID0gdmF1bHQ7XHJcbiAgICB9XHJcbiAgICBjb25zdCB2YXVsdE5hbWUgPSB0aGlzLnZhdWx0LmdldE5hbWUoKTsgXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IHRoaXMudmF1bHQucmVhZExpbmtGaWxlKHZhbHVlLCB0cnVlKTtcclxuXHJcbiAgICAvLyBJZiByZWFkTGlua0ZpbGUgcmV0dXJuZWQgYSBwYXRoIGFuZCB0aGUgZmlsZSBleGlzdHMgaW4gdGhlIHZhdWx0LCB1c2UgaXQuXHJcbiAgICBpZiAoZmlsZVBhdGgpIHtcclxuICAgICAgcmV0dXJuIGBvYnNpZGlhbjovL29wZW4/dmF1bHQ9JHtlbmNvZGVVUklDb21wb25lbnQodmF1bHROYW1lKX0mZmlsZT0ke2VuY29kZVVSSUNvbXBvbmVudChmaWxlUGF0aCl9YDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBGYWxsYmFjazogZXh0cmFjdCB0aGUgbmFtZSBvbmx5IGZyb20gdGhlIGxpbmtcclxuICAgIGNvbnN0IG5hbWVPbmx5ID0gdGhpcy52YXVsdC5yZWFkTGlua0ZpbGUodmFsdWUpO1xyXG4gICAgcmV0dXJuIGBvYnNpZGlhbjovL29wZW4/dmF1bHQ9JHtlbmNvZGVVUklDb21wb25lbnQodmF1bHROYW1lKX0mZmlsZT0ke2VuY29kZVVSSUNvbXBvbmVudChuYW1lT25seSl9YDtcclxuICAgfVxyXG4gIFxyXG4gICBvdmVycmlkZSBjcmVhdGVJY29uQ29udGFpbmVyKHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4pIHtcclxuICAgIGNvbnN0IGljb25Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgaWNvbkNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiaWNvbi1jb250YWluZXJcIik7XHJcblxyXG4gICAgY29uc3QgaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICB0aGlzLnZhdWx0LmFwcC5zZXRJY29uKGljb24sIHRoaXMuaWNvbik7XHJcbiAgICBpY29uQ29udGFpbmVyLmFwcGVuZENoaWxkKGljb24pO1xyXG5cclxuICAgIGlmICghdGhpcy5zdGF0aWMpIHtcclxuICAgICAgaWNvbi5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgaWNvbkNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKGV2ZW50KSA9PiBhd2FpdCB0aGlzLmhhbmRsZUljb25DbGljayh1cGRhdGUsIGV2ZW50KSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBpY29uQ29udGFpbmVyO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZvbmN0aW9uIHBvdXIgZ8OpcmVyIGxlIGNsaWMgc3VyIGwnaWPDtG5lXHJcbiAgICBhc3luYyBoYW5kbGVJY29uQ2xpY2sodXBkYXRlOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPiwgZXZlbnQ6IEV2ZW50KSB7XHJcbiAgICAgICAgbGV0IHNlbGVjdGVkRmlsZU9iaiA9IGF3YWl0IHRoaXMudmF1bHQuYXBwLnNlbGVjdEZpbGUodGhpcy52YXVsdCwgdGhpcy5jbGFzc2VzLCB7aGludDpcIkNob2lzaXNzZXogdW4gZmljaGllciBcIiArIHRoaXMuZ2V0Q2xhc3NlcygpLmpvaW4oXCIgb3UgXCIpfSk7XHJcbiAgICAgICAgaWYgKHNlbGVjdGVkRmlsZU9iail7XHJcbiAgICAgICAgICBjb25zdCBzZWxlY3RlZEZpbGUgPSBzZWxlY3RlZEZpbGVPYmouZ2V0TGluaygpO1xyXG4gICAgICAgICAgYXdhaXQgdXBkYXRlKHNlbGVjdGVkRmlsZSlcclxuICAgICAgICAgIGNvbnN0IGxpbmsgPSAoZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50KS5jbG9zZXN0KCcubWV0YWRhdGEtZmllbGQnKT8ucXVlcnlTZWxlY3RvcignLmZpZWxkLWxpbmsnKSBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICAgICAgaWYgKGxpbmspIHtcclxuICAgICAgICAgICAgICBsaW5rLnRleHRDb250ZW50ID0gc2VsZWN0ZWRGaWxlLnNsaWNlKDIsIC0yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBGb25jdGlvbiBwb3VyIGfDqXJlciBsZSBjbGljIHN1ciBsJ2ljw7RuZVxyXG4gICAgb3ZlcnJpZGUgYXN5bmMgbW9kaWZ5RmllbGQoZXZlbnQ6IEV2ZW50KSB7XHJcbiAgICAgIGNvbnN0IGxpbmsgPSAoZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50KS5jbG9zZXN0KCcubWV0YWRhdGEtZmllbGQnKT8ucXVlcnlTZWxlY3RvcignLmZpZWxkLWxpbmsnKSBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgbGV0IGN1cnJlbnRGaWVsZCA9IGxpbmsudGV4dENvbnRlbnRcclxuICAgICAgaWYgKCFjdXJyZW50RmllbGQpe3JldHVybn1cclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICBcclxuICAgICAgY29uc3QgY2xhc3NlID0gdGhpcy52YXVsdC5nZXRGcm9tTGluayhjdXJyZW50RmllbGQpO1xyXG4gICAgICBpZiAoY2xhc3NlKSB7XHJcbiAgICAgICAgbGV0IHBhdGggPSBjbGFzc2UuZ2V0UGF0aCgpXHJcbiAgICAgICAgaWYgKHBhdGgpe1xyXG4gICAgICAgICAgIGF3YWl0IHRoaXMudmF1bHQuYXBwLm9wZW4ocGF0aCk7XHJcbiAgICAgICAgIH1cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGBMZSBmaWNoaWVyICR7Y3VycmVudEZpZWxkfS5tZCBuJ2V4aXN0ZSBwYXNgKSAvLyBUT0RPOiBVc2UgTm90aWNlIHdoZW4gYXZhaWxhYmxlXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIEZvbmN0aW9uIHBvdXIgY3LDqWVyIGxlIGNvbnRlbmV1ciBwcmluY2lwYWwgcG91ciBsJ2ZpZWxkXHJcbiAgICBvdmVycmlkZSBjcmVhdGVGaWVsZENvbnRhaW5lckNvbnRlbnQodXBkYXRlOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPiwgdmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgIGNvbnN0IGZpZWxkQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBmaWVsZENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiZmllbGQtY29udGFpbmVyXCIpO1xyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRGaWVsZCA9IHRoaXMuZ2V0UHJldHR5KHZhbHVlKTtcclxuICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcbiAgICAgICAgbGluay5ocmVmID0gdGhpcy5nZXRMaW5rKHZhbHVlKTtcclxuICAgICAgICBsaW5rLnRleHRDb250ZW50ID0gY3VycmVudEZpZWxkIHx8IFwiXCI7XHJcbiAgICAgICAgbGluay5jbGFzc0xpc3QuYWRkKFwiZmllbGQtbGlua1wiKTtcclxuICAgICAgICBsaW5rLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCJcclxuICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChsaW5rKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGZpZWxkQ29udGFpbmVyO1xyXG4gICAgfVxyXG5cclxufSJdLCJ2ZXJzaW9uIjozfQ==