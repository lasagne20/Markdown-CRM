3329e0f2a4f620104a821e7bc713e872
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.LinkProperty = void 0;
const Property_1 = require("./Property");
class LinkProperty extends Property_1.Property {
    constructor(name, vault, args = { icon: "square-arrow-out-up-right" }) {
        super(name, vault, args);
        this.type = "link";
    }
    createIconContainer(update) {
        const iconContainer = super.createIconContainer(update);
        iconContainer.style.cursor = "pointer";
        if (!this.static) {
            iconContainer.onclick = (event) => this.modifyField(event);
        }
        return iconContainer;
    }
    validate(url) {
        // Ajoute le préfixe "http://" si l'URL ne commence pas par http:// ou https://
        let fixedUrl = url.trim();
        // Si le lien ne commence pas par http:// ou https://, ajoute "http://"
        if (!/^https?:\/\//i.test(fixedUrl)) {
            fixedUrl = "http://" + fixedUrl;
        }
        const urlRegex = /^(https?:\/\/)?([a-zA-Z0-9_-]+\.)+[a-zA-Z]{2,6}(\/[a-zA-Z0-9_-]+)*\/?$/;
        if (!urlRegex.test(fixedUrl)) {
            return "";
        }
        return fixedUrl;
    }
    getPretty(value) {
        if (!value)
            return value;
        try {
            const urlObj = new URL(value);
            // Garde le domaine, puis les premiers segments du chemin si trop long
            let pretty = urlObj.hostname;
            if (urlObj.pathname && urlObj.pathname !== "/") {
                const segments = urlObj.pathname.split("/").filter(Boolean);
                if (segments.length > 2) {
                    pretty += "/" + segments.slice(0, 2).join("/") + "/...";
                }
                else {
                    pretty += urlObj.pathname;
                }
            }
            return pretty;
        }
        catch {
            // Si ce n'est pas une URL valide, retourne la valeur d'origine sans protocole
            return value.replace(/^https?:\/\//, "");
        }
    }
    // Fonction pour créer le lien de l'field
    createFieldLink(value) {
        const link = document.createElement("a");
        link.href = this.getLink(value);
        link.textContent = this.getPretty(value) || "";
        link.classList.add("field-link");
        link.oncontextmenu = (event) => {
            event.preventDefault();
            const value = link.textContent;
            if (value) {
                navigator.clipboard.writeText(value).then(() => {
                    this.vault.app.sendNotice("Lien copié dans le presse-papiers");
                });
            }
        };
        return link;
    }
}
exports.LinkProperty = LinkProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXExpbmtQcm9wZXJ0eS50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSx5Q0FBc0M7QUFLdEMsTUFBYSxZQUFhLFNBQVEsbUJBQVE7SUFJeEMsWUFBWSxJQUFZLEVBQUUsS0FBWSxFQUFFLE9BQXlCLEVBQUUsSUFBSSxFQUFFLDJCQUEyQixFQUFFO1FBQ3BHLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBSGxCLFNBQUksR0FBWSxNQUFNLENBQUM7SUFJaEMsQ0FBQztJQUVRLG1CQUFtQixDQUFDLE1BQXdDO1FBQ25FLE1BQU0sYUFBYSxHQUFHLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4RCxhQUFhLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUM7UUFFdkMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNqQixhQUFhLENBQUMsT0FBTyxHQUFHLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdELENBQUM7UUFFRCxPQUFPLGFBQWEsQ0FBQztJQUN2QixDQUFDO0lBR1UsUUFBUSxDQUFDLEdBQVc7UUFDM0IsK0VBQStFO1FBQy9FLElBQUksUUFBUSxHQUFHLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUUxQix1RUFBdUU7UUFDdkUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztZQUNsQyxRQUFRLEdBQUcsU0FBUyxHQUFHLFFBQVEsQ0FBQztRQUNwQyxDQUFDO1FBQ0QsTUFBTSxRQUFRLEdBQUcsd0VBQXdFLENBQUM7UUFDMUYsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztZQUMzQixPQUFPLEVBQUUsQ0FBQztRQUNkLENBQUM7UUFDRCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBR1EsU0FBUyxDQUFDLEtBQWE7UUFDOUIsSUFBSSxDQUFDLEtBQUs7WUFBRSxPQUFPLEtBQUssQ0FBQztRQUN6QixJQUFJLENBQUM7WUFDSCxNQUFNLE1BQU0sR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM5QixzRUFBc0U7WUFDdEUsSUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQztZQUM3QixJQUFJLE1BQU0sQ0FBQyxRQUFRLElBQUksTUFBTSxDQUFDLFFBQVEsS0FBSyxHQUFHLEVBQUUsQ0FBQztnQkFDL0MsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUM1RCxJQUFJLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQ3hCLE1BQU0sSUFBSSxHQUFHLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQztnQkFDMUQsQ0FBQztxQkFBTSxDQUFDO29CQUNOLE1BQU0sSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDO2dCQUM1QixDQUFDO1lBQ0gsQ0FBQztZQUNELE9BQU8sTUFBTSxDQUFDO1FBQ2hCLENBQUM7UUFBQyxNQUFNLENBQUM7WUFDUCw4RUFBOEU7WUFDOUUsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMzQyxDQUFDO0lBQ0gsQ0FBQztJQUVELHlDQUF5QztJQUNoQyxlQUFlLENBQUMsS0FBYTtRQUNwQyxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQy9DLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUM3QixLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7WUFDdkIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztZQUMvQixJQUFJLEtBQUssRUFBRSxDQUFDO2dCQUNSLFNBQVMsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUU7b0JBQy9DLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO2dCQUNqRSxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUM7UUFDSCxDQUFDLENBQUM7UUFDRixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Q0FDSjtBQTFFRCxvQ0EwRUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXExpbmtQcm9wZXJ0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcm9wZXJ0eSB9IGZyb20gXCIuL1Byb3BlcnR5XCI7XHJcbmltcG9ydCB7IFZhdWx0IH0gZnJvbSBcIi4uL3ZhdWx0L1ZhdWx0XCI7XHJcblxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBMaW5rUHJvcGVydHkgZXh0ZW5kcyBQcm9wZXJ0eXtcclxuXHJcbiAgb3ZlcnJpZGUgdHlwZSA6IHN0cmluZyA9IFwibGlua1wiO1xyXG5cclxuICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIHZhdWx0OiBWYXVsdCwgYXJnczogeyBpY29uPzogc3RyaW5nfSA9IHsgaWNvbjogXCJzcXVhcmUtYXJyb3ctb3V0LXVwLXJpZ2h0XCIgfSkge1xyXG4gICAgc3VwZXIobmFtZSwgdmF1bHQsIGFyZ3MpO1xyXG4gIH1cclxuXHJcbiAgb3ZlcnJpZGUgY3JlYXRlSWNvbkNvbnRhaW5lcih1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+KSB7XHJcbiAgICBjb25zdCBpY29uQ29udGFpbmVyID0gc3VwZXIuY3JlYXRlSWNvbkNvbnRhaW5lcih1cGRhdGUpO1xyXG4gICAgaWNvbkNvbnRhaW5lci5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuXHJcbiAgICBpZiAoIXRoaXMuc3RhdGljKSB7XHJcbiAgICAgIGljb25Db250YWluZXIub25jbGljayA9IChldmVudCkgPT4gdGhpcy5tb2RpZnlGaWVsZChldmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGljb25Db250YWluZXI7XHJcbiAgfVxyXG5cclxuXHJcbiAgICBvdmVycmlkZSB2YWxpZGF0ZSh1cmw6IHN0cmluZykge1xyXG4gICAgICAvLyBBam91dGUgbGUgcHLDqWZpeGUgXCJodHRwOi8vXCIgc2kgbCdVUkwgbmUgY29tbWVuY2UgcGFzIHBhciBodHRwOi8vIG91IGh0dHBzOi8vXHJcbiAgICAgIGxldCBmaXhlZFVybCA9IHVybC50cmltKCk7XHJcbiAgXHJcbiAgICAgIC8vIFNpIGxlIGxpZW4gbmUgY29tbWVuY2UgcGFzIHBhciBodHRwOi8vIG91IGh0dHBzOi8vLCBham91dGUgXCJodHRwOi8vXCJcclxuICAgICAgaWYgKCEvXmh0dHBzPzpcXC9cXC8vaS50ZXN0KGZpeGVkVXJsKSkge1xyXG4gICAgICAgICAgZml4ZWRVcmwgPSBcImh0dHA6Ly9cIiArIGZpeGVkVXJsO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbnN0IHVybFJlZ2V4ID0gL14oaHR0cHM/OlxcL1xcLyk/KFthLXpBLVowLTlfLV0rXFwuKStbYS16QS1aXXsyLDZ9KFxcL1thLXpBLVowLTlfLV0rKSpcXC8/JC87XHJcbiAgICAgIGlmICghdXJsUmVnZXgudGVzdChmaXhlZFVybCkpIHtcclxuICAgICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBmaXhlZFVybDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgb3ZlcnJpZGUgZ2V0UHJldHR5KHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgaWYgKCF2YWx1ZSkgcmV0dXJuIHZhbHVlO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVybE9iaiA9IG5ldyBVUkwodmFsdWUpO1xyXG4gICAgICAgIC8vIEdhcmRlIGxlIGRvbWFpbmUsIHB1aXMgbGVzIHByZW1pZXJzIHNlZ21lbnRzIGR1IGNoZW1pbiBzaSB0cm9wIGxvbmdcclxuICAgICAgICBsZXQgcHJldHR5ID0gdXJsT2JqLmhvc3RuYW1lO1xyXG4gICAgICAgIGlmICh1cmxPYmoucGF0aG5hbWUgJiYgdXJsT2JqLnBhdGhuYW1lICE9PSBcIi9cIikge1xyXG4gICAgICAgICAgY29uc3Qgc2VnbWVudHMgPSB1cmxPYmoucGF0aG5hbWUuc3BsaXQoXCIvXCIpLmZpbHRlcihCb29sZWFuKTtcclxuICAgICAgICAgIGlmIChzZWdtZW50cy5sZW5ndGggPiAyKSB7XHJcbiAgICAgICAgICAgIHByZXR0eSArPSBcIi9cIiArIHNlZ21lbnRzLnNsaWNlKDAsIDIpLmpvaW4oXCIvXCIpICsgXCIvLi4uXCI7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwcmV0dHkgKz0gdXJsT2JqLnBhdGhuYW1lO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcHJldHR5O1xyXG4gICAgICB9IGNhdGNoIHtcclxuICAgICAgICAvLyBTaSBjZSBuJ2VzdCBwYXMgdW5lIFVSTCB2YWxpZGUsIHJldG91cm5lIGxhIHZhbGV1ciBkJ29yaWdpbmUgc2FucyBwcm90b2NvbGVcclxuICAgICAgICByZXR1cm4gdmFsdWUucmVwbGFjZSgvXmh0dHBzPzpcXC9cXC8vLCBcIlwiKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEZvbmN0aW9uIHBvdXIgY3LDqWVyIGxlIGxpZW4gZGUgbCdmaWVsZFxyXG4gICAgb3ZlcnJpZGUgY3JlYXRlRmllbGRMaW5rKHZhbHVlOiBzdHJpbmcpIDogYW55IHtcclxuICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG4gICAgICBsaW5rLmhyZWYgPSB0aGlzLmdldExpbmsodmFsdWUpO1xyXG4gICAgICBsaW5rLnRleHRDb250ZW50ID0gdGhpcy5nZXRQcmV0dHkodmFsdWUpIHx8IFwiXCI7XHJcbiAgICAgIGxpbmsuY2xhc3NMaXN0LmFkZChcImZpZWxkLWxpbmtcIik7XHJcbiAgICAgIGxpbmsub25jb250ZXh0bWVudSA9IChldmVudCkgPT4ge1xyXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBsaW5rLnRleHRDb250ZW50O1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh2YWx1ZSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudmF1bHQuYXBwLnNlbmROb3RpY2UoXCJMaWVuIGNvcGnDqSBkYW5zIGxlIHByZXNzZS1wYXBpZXJzXCIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG4gICAgICByZXR1cm4gbGluaztcclxuICAgIH1cclxufSJdLCJ2ZXJzaW9uIjozfQ==