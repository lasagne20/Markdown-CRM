6a2b192dad77159337640edf0e8e31bb
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ClassConfigManager = void 0;
const Classe_1 = require("../vault/Classe");
const ConfigLoader_1 = require("./ConfigLoader");
class ClassConfigManager {
    constructor(configPath, app) {
        this.loadedClasses = new Map();
        this.configLoader = new ConfigLoader_1.ConfigLoader(configPath, app);
    }
    /**
     * Create a dynamic Classe from configuration
     */
    async createDynamicClasse(className) {
        if (this.loadedClasses.has(className)) {
            return this.loadedClasses.get(className);
        }
        const config = await this.configLoader.loadClassConfig(className);
        class DynamicClasse extends Classe_1.Classe {
            constructor(app, vault, file) {
                super(app, vault, file);
                this.name = config.className;
                this.icon = config.classIcon;
            }
            static getConstructor() {
                return DynamicClasse;
            }
            getConstructor() {
                return DynamicClasse;
            }
            async populate(...args) {
                // Default implementation - can be overridden in config if needed
            }
            getTopDisplayContent() {
                const container = document.createElement("div");
                if (config.display && config.display.containers) {
                    for (const containerConfig of config.display.containers) {
                        const displayContainer = this.createDisplayContainer(containerConfig);
                        container.appendChild(displayContainer);
                    }
                }
                else {
                    // Default display: show all properties
                    const properties = document.createElement("div");
                    for (let property of Object.values(this.getProperties())) {
                        properties.appendChild(property.getDisplay(this));
                    }
                    container.appendChild(properties);
                }
                return container;
            }
            createDisplayContainer(containerConfig) {
                const container = document.createElement("div");
                if (containerConfig.className) {
                    container.classList.add(containerConfig.className);
                }
                // Add CSS class based on container type
                switch (containerConfig.type) {
                    case 'line':
                        container.classList.add("metadata-line");
                        break;
                    case 'column':
                        container.classList.add("metadata-column");
                        break;
                }
                if (containerConfig.title) {
                    const title = document.createElement("div");
                    title.textContent = containerConfig.title;
                    title.classList.add("metadata-title");
                    container.appendChild(title);
                }
                // Add properties to container
                if (containerConfig.properties) {
                    for (const propName of containerConfig.properties) {
                        const property = this.getProperty(propName);
                        if (property) {
                            container.appendChild(property.getDisplay(this));
                        }
                    }
                }
                return container;
            }
        }
        DynamicClasse.Properties = {};
        // Initialize static properties
        if (config.parentProperty) {
            DynamicClasse.parentProperty = this.configLoader.createProperty(config.parentProperty);
        }
        // Initialize all properties
        for (const [key, propConfig] of Object.entries(config.properties)) {
            if (propConfig.type === 'SubClassProperty' && config.subClassesProperty) {
                // Use the subClassesProperty instead
                DynamicClasse.Properties[key] = DynamicClasse.subClassesProperty;
            }
            else {
                DynamicClasse.Properties[key] = this.configLoader.createProperty(propConfig);
            }
        }
        this.loadedClasses.set(className, DynamicClasse);
        return DynamicClasse;
    }
    /**
     * Get class configuration for display purposes
     */
    async getClassConfig(className) {
        return await this.configLoader.loadClassConfig(className);
    }
    /**
     * Get all available class names
     */
    async getAvailableClasses() {
        return await this.configLoader.getAllClassNames();
    }
    /**
     * Clear the cache and reload configurations
     */
    clearCache() {
        this.loadedClasses.clear();
    }
}
exports.ClassConfigManager = ClassConfigManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXENvbmZpZ1xcQ2xhc3NDb25maWdNYW5hZ2VyLnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLDRDQUF5QztBQU16QyxpREFBOEM7QUFHOUMsTUFBYSxrQkFBa0I7SUFJM0IsWUFBWSxVQUFrQixFQUFFLEdBQVM7UUFGakMsa0JBQWEsR0FBK0IsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUcxRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksMkJBQVksQ0FBQyxVQUFVLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLG1CQUFtQixDQUFDLFNBQWlCO1FBQ3ZDLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQztZQUNwQyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBRSxDQUFDO1FBQzlDLENBQUM7UUFFRCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRWxFLE1BQU0sYUFBYyxTQUFRLGVBQU07WUFROUIsWUFBWSxHQUFRLEVBQUUsS0FBVSxFQUFFLElBQVM7Z0JBQ3ZDLEtBQUssQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQVJaLFNBQUksR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDO2dCQUN4QixTQUFJLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQztZQVF4QyxDQUFDO1lBRUQsTUFBTSxDQUFDLGNBQWM7Z0JBQ2pCLE9BQU8sYUFBYSxDQUFDO1lBQ3pCLENBQUM7WUFFRCxjQUFjO2dCQUNWLE9BQU8sYUFBYSxDQUFDO1lBQ3pCLENBQUM7WUFFRCxLQUFL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XFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXENvbmZpZ1xcQ2xhc3NDb25maWdNYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENsYXNzZSB9IGZyb20gJy4uL3ZhdWx0L0NsYXNzZSc7XHJcbmltcG9ydCB7IEZpbGVQcm9wZXJ0eSB9IGZyb20gJy4uL3Byb3BlcnRpZXMvRmlsZVByb3BlcnR5JztcclxuaW1wb3J0IHsgTXVsdGlGaWxlUHJvcGVydHkgfSBmcm9tICcuLi9wcm9wZXJ0aWVzL011bHRpRmlsZVByb3BlcnR5JztcclxuaW1wb3J0IHsgT2JqZWN0UHJvcGVydHkgfSBmcm9tICcuLi9wcm9wZXJ0aWVzL09iamVjdFByb3BlcnR5JztcclxuaW1wb3J0IHsgUHJvcGVydHkgfSBmcm9tICcuLi9wcm9wZXJ0aWVzL1Byb3BlcnR5JztcclxuaW1wb3J0IHsgU3ViQ2xhc3NQcm9wZXJ0eSB9IGZyb20gJy4uL3Byb3BlcnRpZXMvU3ViQ2xhc3NQcm9wZXJ0eSc7XHJcbmltcG9ydCB7IENvbmZpZ0xvYWRlciB9IGZyb20gJy4vQ29uZmlnTG9hZGVyJztcclxuaW1wb3J0IHsgQ2xhc3NDb25maWcsIERpc3BsYXlDb250YWluZXIgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIENsYXNzQ29uZmlnTWFuYWdlciB7XHJcbiAgICBwcml2YXRlIGNvbmZpZ0xvYWRlcjogQ29uZmlnTG9hZGVyO1xyXG4gICAgcHJpdmF0ZSBsb2FkZWRDbGFzc2VzOiBNYXA8c3RyaW5nLCB0eXBlb2YgQ2xhc3NlPiA9IG5ldyBNYXAoKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihjb25maWdQYXRoOiBzdHJpbmcsIGFwcD86IGFueSkge1xyXG4gICAgICAgIHRoaXMuY29uZmlnTG9hZGVyID0gbmV3IENvbmZpZ0xvYWRlcihjb25maWdQYXRoLCBhcHApO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIGEgZHluYW1pYyBDbGFzc2UgZnJvbSBjb25maWd1cmF0aW9uXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGNyZWF0ZUR5bmFtaWNDbGFzc2UoY2xhc3NOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHR5cGVvZiBDbGFzc2U+IHtcclxuICAgICAgICBpZiAodGhpcy5sb2FkZWRDbGFzc2VzLmhhcyhjbGFzc05hbWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvYWRlZENsYXNzZXMuZ2V0KGNsYXNzTmFtZSkhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY29uZmlnID0gYXdhaXQgdGhpcy5jb25maWdMb2FkZXIubG9hZENsYXNzQ29uZmlnKGNsYXNzTmFtZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY2xhc3MgRHluYW1pY0NsYXNzZSBleHRlbmRzIENsYXNzZSB7XHJcbiAgICAgICAgICAgIHB1YmxpYyBvdmVycmlkZSBuYW1lID0gY29uZmlnLmNsYXNzTmFtZTtcclxuICAgICAgICAgICAgcHVibGljIG92ZXJyaWRlIGljb24gPSBjb25maWcuY2xhc3NJY29uO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcHVibGljIHN0YXRpYyBwYXJlbnRQcm9wZXJ0eTogRmlsZVByb3BlcnR5IHwgTXVsdGlGaWxlUHJvcGVydHkgfCBPYmplY3RQcm9wZXJ0eTtcclxuICAgICAgICAgICAgcHVibGljIHN0YXRpYyBzdWJDbGFzc2VzUHJvcGVydHk6IFN1YkNsYXNzUHJvcGVydHk7XHJcbiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgUHJvcGVydGllczogeyBba2V5OiBzdHJpbmddOiBQcm9wZXJ0eSB9ID0ge307XHJcblxyXG4gICAgICAgICAgICBjb25zdHJ1Y3RvcihhcHA6IGFueSwgdmF1bHQ6IGFueSwgZmlsZTogYW55KSB7XHJcbiAgICAgICAgICAgICAgICBzdXBlcihhcHAsIHZhdWx0LCBmaWxlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc3RhdGljIGdldENvbnN0cnVjdG9yKCk6IHR5cGVvZiBEeW5hbWljQ2xhc3NlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBEeW5hbWljQ2xhc3NlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBnZXRDb25zdHJ1Y3RvcigpOiB0eXBlb2YgRHluYW1pY0NsYXNzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gRHluYW1pY0NsYXNzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYXN5bmMgcG9wdWxhdGUoLi4uYXJnczogYW55W10pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb24gLSBjYW4gYmUgb3ZlcnJpZGRlbiBpbiBjb25maWcgaWYgbmVlZGVkXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGdldFRvcERpc3BsYXlDb250ZW50KCk6IGFueSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmRpc3BsYXkgJiYgY29uZmlnLmRpc3BsYXkuY29udGFpbmVycykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgY29udGFpbmVyQ29uZmlnIG9mIGNvbmZpZy5kaXNwbGF5LmNvbnRhaW5lcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzcGxheUNvbnRhaW5lciA9IHRoaXMuY3JlYXRlRGlzcGxheUNvbnRhaW5lcihjb250YWluZXJDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGlzcGxheUNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBEZWZhdWx0IGRpc3BsYXk6IHNob3cgYWxsIHByb3BlcnRpZXNcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0aWVzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBwcm9wZXJ0eSBvZiBPYmplY3QudmFsdWVzKHRoaXMuZ2V0UHJvcGVydGllcygpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLmFwcGVuZENoaWxkKHByb3BlcnR5LmdldERpc3BsYXkodGhpcykpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHByaXZhdGUgY3JlYXRlRGlzcGxheUNvbnRhaW5lcihjb250YWluZXJDb25maWc6IERpc3BsYXlDb250YWluZXIpOiBIVE1MRWxlbWVudCB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyQ29uZmlnLmNsYXNzTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNvbnRhaW5lckNvbmZpZy5jbGFzc05hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBBZGQgQ1NTIGNsYXNzIGJhc2VkIG9uIGNvbnRhaW5lciB0eXBlXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGNvbnRhaW5lckNvbmZpZy50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbGluZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtbGluZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY29sdW1uJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1jb2x1bW5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGFpbmVyQ29uZmlnLnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0gY29udGFpbmVyQ29uZmlnLnRpdGxlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS10aXRsZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBBZGQgcHJvcGVydGllcyB0byBjb250YWluZXJcclxuICAgICAgICAgICAgICAgIGlmIChjb250YWluZXJDb25maWcucHJvcGVydGllcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJvcE5hbWUgb2YgY29udGFpbmVyQ29uZmlnLnByb3BlcnRpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvcGVydHkgPSB0aGlzLmdldFByb3BlcnR5KHByb3BOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJvcGVydHkuZ2V0RGlzcGxheSh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEluaXRpYWxpemUgc3RhdGljIHByb3BlcnRpZXNcclxuICAgICAgICBpZiAoY29uZmlnLnBhcmVudFByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgIER5bmFtaWNDbGFzc2UucGFyZW50UHJvcGVydHkgPSB0aGlzLmNvbmZpZ0xvYWRlci5jcmVhdGVQcm9wZXJ0eShjb25maWcucGFyZW50UHJvcGVydHkpIGFzIEZpbGVQcm9wZXJ0eSB8IE11bHRpRmlsZVByb3BlcnR5IHwgT2JqZWN0UHJvcGVydHk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBhbGwgcHJvcGVydGllc1xyXG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgcHJvcENvbmZpZ10gb2YgT2JqZWN0LmVudHJpZXMoY29uZmlnLnByb3BlcnRpZXMpKSB7XHJcbiAgICAgICAgICAgIGlmIChwcm9wQ29uZmlnLnR5cGUgPT09ICdTdWJDbGFzc1Byb3BlcnR5JyAmJiBjb25maWcuc3ViQ2xhc3Nlc1Byb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIHN1YkNsYXNzZXNQcm9wZXJ0eSBpbnN0ZWFkXHJcbiAgICAgICAgICAgICAgICBEeW5hbWljQ2xhc3NlLlByb3BlcnRpZXNba2V5XSA9IER5bmFtaWNDbGFzc2Uuc3ViQ2xhc3Nlc1Byb3BlcnR5O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgRHluYW1pY0NsYXNzZS5Qcm9wZXJ0aWVzW2tleV0gPSB0aGlzLmNvbmZpZ0xvYWRlci5jcmVhdGVQcm9wZXJ0eShwcm9wQ29uZmlnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5sb2FkZWRDbGFzc2VzLnNldChjbGFzc05hbWUsIER5bmFtaWNDbGFzc2UpO1xyXG4gICAgICAgIHJldHVybiBEeW5hbWljQ2xhc3NlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGNsYXNzIGNvbmZpZ3VyYXRpb24gZm9yIGRpc3BsYXkgcHVycG9zZXNcclxuICAgICAqL1xyXG4gICAgYXN5bmMgZ2V0Q2xhc3NDb25maWcoY2xhc3NOYW1lOiBzdHJpbmcpOiBQcm9taXNlPENsYXNzQ29uZmlnPiB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29uZmlnTG9hZGVyLmxvYWRDbGFzc0NvbmZpZyhjbGFzc05hbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGFsbCBhdmFpbGFibGUgY2xhc3MgbmFtZXNcclxuICAgICAqL1xyXG4gICAgYXN5bmMgZ2V0QXZhaWxhYmxlQ2xhc3NlcygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY29uZmlnTG9hZGVyLmdldEFsbENsYXNzTmFtZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENsZWFyIHRoZSBjYWNoZSBhbmQgcmVsb2FkIGNvbmZpZ3VyYXRpb25zXHJcbiAgICAgKi9cclxuICAgIGNsZWFyQ2FjaGUoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5sb2FkZWRDbGFzc2VzLmNsZWFyKCk7XHJcbiAgICB9XHJcbn0iXSwidmVyc2lvbiI6M30=