c50756b540279aa7b85bd5b87dbd3bae
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('../../src/vault/Utils', () => ({
    setIcon: jest.fn()
}));
const ClasseProperty_1 = require("../../src/properties/ClasseProperty");
const Property_1 = require("../../src/properties/Property");
// Import the mocked function for use in tests
const { setIcon } = jest.requireMock('../../src/vault/Utils');
describe('ClasseProperty', () => {
    let classeProperty;
    let mockVault;
    beforeEach(() => {
        // Reset DOM mocks
        document.body.innerHTML = '';
        jest.clearAllMocks();
        // Setup mock vault
        mockVault = {
            app: {
                vault: { getFiles: jest.fn(() => []) },
                setIcon: jest.fn((element, iconName) => {
                    element.setAttribute('data-icon', iconName);
                    element.textContent = `[${iconName}]`;
                })
            }
        };
        classeProperty = new ClasseProperty_1.ClasseProperty('testClasse', mockVault);
    });
    describe('constructor', () => {
        it('should create ClasseProperty with correct type', () => {
            expect(classeProperty.type).toBe('class');
        });
        it('should inherit from Property', () => {
            expect(classeProperty).toBeInstanceOf(Property_1.Property);
        });
        it('should use empty icon by default', () => {
            const defaultProperty = new ClasseProperty_1.ClasseProperty('defaultTest', mockVault, mockVault);
            expect(defaultProperty.name).toBe('defaultTest');
            expect(defaultProperty.type).toBe('class');
        });
        it('should accept custom icon', () => {
            const customProperty = new ClasseProperty_1.ClasseProperty('customName', mockVault, 'custom-icon');
            expect(customProperty.name).toBe('customName');
            expect(customProperty.icon).toBe('custom-icon');
        });
        it('should handle empty string icon', () => {
            const emptyIconProperty = new ClasseProperty_1.ClasseProperty('emptyIcon', mockVault, '');
            expect(emptyIconProperty.name).toBe('emptyIcon');
            expect(emptyIconProperty.icon).toBe('');
        });
    });
    describe('fillDisplay', () => {
        it('should create field with correct structure', () => {
            const mockUpdate = jest.fn();
            const value = 'Test Class Value';
            const result = classeProperty.fillDisplay(value, mockUpdate);
            expect(result.tagName).toBe('DIV');
            expect(result.classList.contains('metadata-field')).toBe(true);
        });
        it('should create label with correct text content', () => {
            const mockUpdate = jest.fn();
            const value = 'Test Class Value';
            const result = classeProperty.fillDisplay(value, mockUpdate);
            const label = result.querySelector('label');
            expect(label).toBeTruthy();
            expect(label?.textContent).toBe(value);
        });
        it('should set vault property', () => {
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            classeProperty.fillDisplay(value, mockUpdate);
            expect(classeProperty.vault).toBe(mockVault);
        });
        it('should handle null value', () => {
            const mockUpdate = jest.fn();
            const result = classeProperty.fillDisplay(null, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('');
        });
        it('should handle undefined value', () => {
            const mockUpdate = jest.fn();
            const result = classeProperty.fillDisplay(undefined, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('');
        });
        it('should handle empty string value', () => {
            const mockUpdate = jest.fn();
            const result = classeProperty.fillDisplay('', mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('');
        });
        it('should handle numeric value', () => {
            const mockUpdate = jest.fn();
            const numericValue = 42;
            const result = classeProperty.fillDisplay(numericValue, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('42');
        });
        it('should handle object value', () => {
            const mockUpdate = jest.fn();
            const objectValue = { name: 'test', id: 123 };
            const result = classeProperty.fillDisplay(objectValue, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('[object Object]');
        });
    });
    describe('icon handling', () => {
        it('should not create icon container when no icon', () => {
            const propertyWithoutIcon = new ClasseProperty_1.ClasseProperty('noIcon', mockVault, '');
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithoutIcon.fillDisplay(value, mockUpdate);
            const iconContainer = result.querySelector('.icon-container');
            expect(iconContainer).toBeNull();
        });
        it('should create icon container when icon provided', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('withIcon', mockVault, 'test-icon');
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithIcon.fillDisplay(value, mockUpdate);
            const iconContainer = result.querySelector('.icon-container');
            expect(iconContainer).toBeTruthy();
            expect(iconContainer?.classList.contains('icon-container')).toBe(true);
        });
        it('should call setIcon when icon is provided', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('withIcon', mockVault, 'custom-icon');
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            propertyWithIcon.fillDisplay(value, mockUpdate);
            expect(setIcon).toHaveBeenCalledWith(expect.objectContaining({
                classList: expect.objectContaining({
                    contains: expect.any(Function)
                })
            }), 'custom-icon');
        });
        it('should not call setIcon when no icon', () => {
            setIcon.mockClear();
            const propertyWithoutIcon = new ClasseProperty_1.ClasseProperty('noIcon', mockVault, '');
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            propertyWithoutIcon.fillDisplay(value, mockUpdate);
            expect(setIcon).not.toHaveBeenCalled();
        });
    });
    describe('inheritance from Property', () => {
        it('should have name property from parent', () => {
            expect(classeProperty.name).toBe('testClasse');
        });
        it('should have type property', () => {
            expect(classeProperty.type).toBe('class');
        });
        it('should have icon property from parent', () => {
            expect(classeProperty.icon).toBeDefined();
        });
        it('should have vault property that can be set', () => {
            classeProperty.vault = mockVault;
            expect(classeProperty.vault).toBe(mockVault);
        });
    });
    describe('field structure validation', () => {
        it('should have correct DOM structure without icon', () => {
            const propertyWithoutIcon = new ClasseProperty_1.ClasseProperty('test', mockVault, '');
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithoutIcon.fillDisplay(value, mockUpdate);
            expect(result.children.length).toBe(1); // Only label
            expect(result.children[0].tagName).toBe('LABEL');
        });
        it('should have correct DOM structure with icon', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('test', mockVault, 'icon');
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithIcon.fillDisplay(value, mockUpdate);
            expect(result.children.length).toBe(2); // Icon container + label
            expect(result.children[0].classList.contains('icon-container')).toBe(true);
            expect(result.children[1].tagName).toBe('LABEL');
        });
        it('should maintain correct order: icon first, then label', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('test', mockVault, 'icon');
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithIcon.fillDisplay(value, mockUpdate);
            const firstChild = result.children[0];
            const secondChild = result.children[1];
            expect(firstChild.classList.contains('icon-container')).toBe(true);
            expect(secondChild.tagName).toBe('LABEL');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXENsYXNzZVByb3BlcnR5LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUtILElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN0QyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUNyQixDQUFDLENBQUMsQ0FBQztBQUxKLHdFQUFxRTtBQUNyRSw0REFBeUQ7QUFNekQsOENBQThDO0FBQzlDLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFFOUQsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtJQUM1QixJQUFJLGNBQThCLENBQUM7SUFDbkMsSUFBSSxTQUFjLENBQUM7SUFFbkIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLGtCQUFrQjtRQUNsQixRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDN0IsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLG1CQUFtQjtRQUNuQixTQUFTLEdBQUc7WUFDUixHQUFHLEVBQUU7Z0JBQ0QsS0FBSyxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQ3RDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBb0IsRUFBRSxRQUFnQixFQUFFLEVBQUU7b0JBQ3hELE9BQU8sQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDO29CQUM1QyxPQUFPLENBQUMsV0FBVyxHQUFHLElBQUksUUFBUSxHQUFHLENBQUM7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O1lBQzdELE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSwrQkFBYyxDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFFdkUsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzdCLE1BQU0sS0FBSyxHQUFHLFlBQVksQ0FBQztZQUUzQixNQUFNLE1BQU0sR0FBRyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBRS9ELE1BQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEMsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUV2QyxNQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNuRSxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM5QyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXENsYXNzZVByb3BlcnR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBqZXN0LWVudmlyb25tZW50IGpzZG9tXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQ2xhc3NlUHJvcGVydHkgfSBmcm9tICcuLi8uLi9zcmMvcHJvcGVydGllcy9DbGFzc2VQcm9wZXJ0eSc7XHJcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSAnLi4vLi4vc3JjL3Byb3BlcnRpZXMvUHJvcGVydHknO1xyXG5cclxuamVzdC5tb2NrKCcuLi8uLi9zcmMvdmF1bHQvVXRpbHMnLCAoKSA9PiAoe1xyXG4gICAgc2V0SWNvbjogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbi8vIEltcG9ydCB0aGUgbW9ja2VkIGZ1bmN0aW9uIGZvciB1c2UgaW4gdGVzdHNcclxuY29uc3QgeyBzZXRJY29uIH0gPSBqZXN0LnJlcXVpcmVNb2NrKCcuLi8uLi9zcmMvdmF1bHQvVXRpbHMnKTtcclxuXHJcbmRlc2NyaWJlKCdDbGFzc2VQcm9wZXJ0eScsICgpID0+IHtcclxuICAgIGxldCBjbGFzc2VQcm9wZXJ0eTogQ2xhc3NlUHJvcGVydHk7XHJcbiAgICBsZXQgbW9ja1ZhdWx0OiBhbnk7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgLy8gUmVzZXQgRE9NIG1vY2tzXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBTZXR1cCBtb2NrIHZhdWx0XHJcbiAgICAgICAgbW9ja1ZhdWx0ID0ge1xyXG4gICAgICAgICAgICBhcHA6IHsgXHJcbiAgICAgICAgICAgICAgICB2YXVsdDogeyBnZXRGaWxlczogamVzdC5mbigoKSA9PiBbXSkgfSxcclxuICAgICAgICAgICAgICAgIHNldEljb246IGplc3QuZm4oKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBpY29uTmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWNvbicsIGljb25OYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnRleHRDb250ZW50ID0gYFske2ljb25OYW1lfV1gO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gYXMgYW55O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNsYXNzZVByb3BlcnR5ID0gbmV3IENsYXNzZVByb3BlcnR5KCd0ZXN0Q2xhc3NlJywgbW9ja1ZhdWx0KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjb25zdHJ1Y3RvcicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBDbGFzc2VQcm9wZXJ0eSB3aXRoIGNvcnJlY3QgdHlwZScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGNsYXNzZVByb3BlcnR5LnR5cGUpLnRvQmUoJ2NsYXNzJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaW5oZXJpdCBmcm9tIFByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoY2xhc3NlUHJvcGVydHkpLnRvQmVJbnN0YW5jZU9mKFByb3BlcnR5KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCB1c2UgZW1wdHkgaWNvbiBieSBkZWZhdWx0JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkZWZhdWx0UHJvcGVydHkgPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ2RlZmF1bHRUZXN0JywgbW9ja1ZhdWx0LCBtb2NrVmF1bHQpO1xyXG4gICAgICAgICAgICBleHBlY3QoZGVmYXVsdFByb3BlcnR5Lm5hbWUpLnRvQmUoJ2RlZmF1bHRUZXN0Jyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChkZWZhdWx0UHJvcGVydHkudHlwZSkudG9CZSgnY2xhc3MnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBhY2NlcHQgY3VzdG9tIGljb24nLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbVByb3BlcnR5ID0gbmV3IENsYXNzZVByb3BlcnR5KCdjdXN0b21OYW1lJywgbW9ja1ZhdWx0LCAnY3VzdG9tLWljb24nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGN1c3RvbVByb3BlcnR5Lm5hbWUpLnRvQmUoJ2N1c3RvbU5hbWUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGN1c3RvbVByb3BlcnR5Lmljb24pLnRvQmUoJ2N1c3RvbS1pY29uJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHN0cmluZyBpY29uJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBlbXB0eUljb25Qcm9wZXJ0eSA9IG5ldyBDbGFzc2VQcm9wZXJ0eSgnZW1wdHlJY29uJywgbW9ja1ZhdWx0LCAnJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChlbXB0eUljb25Qcm9wZXJ0eS5uYW1lKS50b0JlKCdlbXB0eUljb24nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGVtcHR5SWNvblByb3BlcnR5Lmljb24pLnRvQmUoJycpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2ZpbGxEaXNwbGF5JywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGZpZWxkIHdpdGggY29ycmVjdCBzdHJ1Y3R1cmUnLCAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICdUZXN0IENsYXNzIFZhbHVlJztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNsYXNzZVByb3BlcnR5LmZpbGxEaXNwbGF5KHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudGFnTmFtZSkudG9CZSgnRElWJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtZXRhZGF0YS1maWVsZCcpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBsYWJlbCB3aXRoIGNvcnJlY3QgdGV4dCBjb250ZW50JywgKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnVGVzdCBDbGFzcyBWYWx1ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBjbGFzc2VQcm9wZXJ0eS5maWxsRGlzcGxheSh2YWx1ZSwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gcmVzdWx0LnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobGFiZWwpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICAgICAgZXhwZWN0KGxhYmVsPy50ZXh0Q29udGVudCkudG9CZSh2YWx1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgc2V0IHZhdWx0IHByb3BlcnR5JywgKCkgPT4ge1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnVGVzdCBWYWx1ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjbGFzc2VQcm9wZXJ0eS5maWxsRGlzcGxheSh2YWx1ZSwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoY2xhc3NlUHJvcGVydHkudmF1bHQpLnRvQmUobW9ja1ZhdWx0KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbnVsbCB2YWx1ZScsICgpID0+IHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBjbGFzc2VQcm9wZXJ0eS5maWxsRGlzcGxheShudWxsLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSByZXN1bHQucXVlcnlTZWxlY3RvcignbGFiZWwnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChsYWJlbD8udGV4dENvbnRlbnQpLnRvQmUoJycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSB1bmRlZmluZWQgdmFsdWUnLCAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY2xhc3NlUHJvcGVydHkuZmlsbERpc3BsYXkodW5kZWZpbmVkLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSByZXN1bHQucXVlcnlTZWxlY3RvcignbGFiZWwnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChsYWJlbD8udGV4dENvbnRlbnQpLnRvQmUoJycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBzdHJpbmcgdmFsdWUnLCAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY2xhc3NlUHJvcGVydHkuZmlsbERpc3BsYXkoJycsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IHJlc3VsdC5xdWVyeVNlbGVjdG9yKCdsYWJlbCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGxhYmVsPy50ZXh0Q29udGVudCkudG9CZSgnJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bWVyaWMgdmFsdWUnLCAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBudW1lcmljVmFsdWUgPSA0MjtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNsYXNzZVByb3BlcnR5LmZpbGxEaXNwbGF5KG51bWVyaWNWYWx1ZSwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gcmVzdWx0LnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobGFiZWw/LnRleHRDb250ZW50KS50b0JlKCc0MicpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBvYmplY3QgdmFsdWUnLCAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBvYmplY3RWYWx1ZSA9IHsgbmFtZTogJ3Rlc3QnLCBpZDogMTIzIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBjbGFzc2VQcm9wZXJ0eS5maWxsRGlzcGxheShvYmplY3RWYWx1ZSwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gcmVzdWx0LnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobGFiZWw/LnRleHRDb250ZW50KS50b0JlKCdbb2JqZWN0IE9iamVjdF0nKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdpY29uIGhhbmRsaW5nJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgbm90IGNyZWF0ZSBpY29uIGNvbnRhaW5lciB3aGVuIG5vIGljb24nLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5V2l0aG91dEljb24gPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ25vSWNvbicsIG1vY2tWYXVsdCwgJycpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnVGVzdCBWYWx1ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9wZXJ0eVdpdGhvdXRJY29uLmZpbGxEaXNwbGF5KHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IHJlc3VsdC5xdWVyeVNlbGVjdG9yKCcuaWNvbi1jb250YWluZXInKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChpY29uQ29udGFpbmVyKS50b0JlTnVsbCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBpY29uIGNvbnRhaW5lciB3aGVuIGljb24gcHJvdmlkZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5V2l0aEljb24gPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ3dpdGhJY29uJywgbW9ja1ZhdWx0LCAndGVzdC1pY29uJyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICdUZXN0IFZhbHVlJztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5V2l0aEljb24uZmlsbERpc3BsYXkodmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBjb25zdCBpY29uQ29udGFpbmVyID0gcmVzdWx0LnF1ZXJ5U2VsZWN0b3IoJy5pY29uLWNvbnRhaW5lcicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGljb25Db250YWluZXIpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICAgICAgZXhwZWN0KGljb25Db250YWluZXI/LmNsYXNzTGlzdC5jb250YWlucygnaWNvbi1jb250YWluZXInKSkudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjYWxsIHNldEljb24gd2hlbiBpY29uIGlzIHByb3ZpZGVkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVdpdGhJY29uID0gbmV3IENsYXNzZVByb3BlcnR5KCd3aXRoSWNvbicsIG1vY2tWYXVsdCwgJ2N1c3RvbS1pY29uJyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICdUZXN0IFZhbHVlJztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHByb3BlcnR5V2l0aEljb24uZmlsbERpc3BsYXkodmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHNldEljb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgICAgIGNsYXNzTGlzdDogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBleHBlY3QuYW55KEZ1bmN0aW9uKVxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSksICdjdXN0b20taWNvbicpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIG5vdCBjYWxsIHNldEljb24gd2hlbiBubyBpY29uJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBzZXRJY29uLm1vY2tDbGVhcigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlXaXRob3V0SWNvbiA9IG5ldyBDbGFzc2VQcm9wZXJ0eSgnbm9JY29uJywgbW9ja1ZhdWx0LCAnJyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICdUZXN0IFZhbHVlJztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHByb3BlcnR5V2l0aG91dEljb24uZmlsbERpc3BsYXkodmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHNldEljb24pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnaW5oZXJpdGFuY2UgZnJvbSBQcm9wZXJ0eScsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgbmFtZSBwcm9wZXJ0eSBmcm9tIHBhcmVudCcsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGNsYXNzZVByb3BlcnR5Lm5hbWUpLnRvQmUoJ3Rlc3RDbGFzc2UnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIHR5cGUgcHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChjbGFzc2VQcm9wZXJ0eS50eXBlKS50b0JlKCdjbGFzcycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgaWNvbiBwcm9wZXJ0eSBmcm9tIHBhcmVudCcsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGNsYXNzZVByb3BlcnR5Lmljb24pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGF2ZSB2YXVsdCBwcm9wZXJ0eSB0aGF0IGNhbiBiZSBzZXQnLCAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBjbGFzc2VQcm9wZXJ0eS52YXVsdCA9IG1vY2tWYXVsdDtcclxuICAgICAgICAgICAgZXhwZWN0KGNsYXNzZVByb3BlcnR5LnZhdWx0KS50b0JlKG1vY2tWYXVsdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZmllbGQgc3RydWN0dXJlIHZhbGlkYXRpb24nLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIGNvcnJlY3QgRE9NIHN0cnVjdHVyZSB3aXRob3V0IGljb24nLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5V2l0aG91dEljb24gPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ3Rlc3QnLCBtb2NrVmF1bHQsICcnKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gJ1Rlc3QgVmFsdWUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJvcGVydHlXaXRob3V0SWNvbi5maWxsRGlzcGxheSh2YWx1ZSwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmNoaWxkcmVuLmxlbmd0aCkudG9CZSgxKTsgLy8gT25seSBsYWJlbFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmNoaWxkcmVuWzBdLnRhZ05hbWUpLnRvQmUoJ0xBQkVMJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IERPTSBzdHJ1Y3R1cmUgd2l0aCBpY29uJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVdpdGhJY29uID0gbmV3IENsYXNzZVByb3BlcnR5KCd0ZXN0JywgbW9ja1ZhdWx0LCAnaWNvbicpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnVGVzdCBWYWx1ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9wZXJ0eVdpdGhJY29uLmZpbGxEaXNwbGF5KHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2hpbGRyZW4ubGVuZ3RoKS50b0JlKDIpOyAvLyBJY29uIGNvbnRhaW5lciArIGxhYmVsXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2hpbGRyZW5bMF0uY2xhc3NMaXN0LmNvbnRhaW5zKCdpY29uLWNvbnRhaW5lcicpKS50b0JlKHRydWUpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmNoaWxkcmVuWzFdLnRhZ05hbWUpLnRvQmUoJ0xBQkVMJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgbWFpbnRhaW4gY29ycmVjdCBvcmRlcjogaWNvbiBmaXJzdCwgdGhlbiBsYWJlbCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlXaXRoSWNvbiA9IG5ldyBDbGFzc2VQcm9wZXJ0eSgndGVzdCcsIG1vY2tWYXVsdCwgJ2ljb24nKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gJ1Rlc3QgVmFsdWUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJvcGVydHlXaXRoSWNvbi5maWxsRGlzcGxheSh2YWx1ZSwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBmaXJzdENoaWxkID0gcmVzdWx0LmNoaWxkcmVuWzBdO1xyXG4gICAgICAgICAgICBjb25zdCBzZWNvbmRDaGlsZCA9IHJlc3VsdC5jaGlsZHJlblsxXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChmaXJzdENoaWxkLmNsYXNzTGlzdC5jb250YWlucygnaWNvbi1jb250YWluZXInKSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHNlY29uZENoaWxkLnRhZ05hbWUpLnRvQmUoJ0xBQkVMJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==