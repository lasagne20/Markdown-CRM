29af4e59386a9066ab44b8e00b29fe6d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MultiFileProperty = void 0;
const ObjectProperty_1 = require("./ObjectProperty");
const FileProperty_1 = require("./FileProperty");
const Utils_1 = require("../vault/Utils");
class MultiFileProperty extends ObjectProperty_1.ObjectProperty {
    constructor(name, vault, classes, args = {}) {
        super(name, vault, {}, args);
        this.type = "multiFile";
        this.flexSpan = 2;
        this.classes = classes;
        this.property = new FileProperty_1.FileProperty(name, vault, classes, args);
    }
    getClasses() {
        return this.classes;
    }
    getParentValue(values) {
        return this.property.getParentValue(values);
    }
    formatParentValue(value) {
        return [value];
    }
    // Méthode principale pour obtenir l'affichage
    fillDisplay(values, update) {
        const container = document.createElement("div");
        container.classList.add("metadata-multiFiles-container-" + this.name.toLowerCase());
        container.classList.add("metadata-multiFiles-container");
        // Créer les lignes d'objet
        this.createObjects(values, update, container);
        const addButton = this.createAddButton(values, update, container);
        container.appendChild(addButton);
        return container;
    }
    createObjects(values, update, container) {
        if (!values)
            return;
        values.forEach((objects, index) => {
            const row = this.createObjectRow(values, update, objects, index, container);
            container.appendChild(row);
        });
    }
    createObjectRow(values, update, value, index, container) {
        const row = document.createElement("div");
        row.classList.add("metadata-multiFiles-row-inline");
        // Ajouter le bouton de suppression
        const deleteButton = this.createDeleteButton(values, update, index, container);
        row.appendChild(deleteButton);
        let propertyContainer = document.createElement("div");
        propertyContainer.classList.add("metadata-multiFiles-property-inline");
        propertyContainer.appendChild(this.property.fillDisplay(this.vault, value, async (value) => await this.updateObject(values, update, index, this.property, value)));
        row.appendChild(propertyContainer);
        return row;
    }
    createDeleteButton(values, update, index, container) {
        const deleteButton = document.createElement("button");
        (0, Utils_1.setIcon)(deleteButton, "minus");
        deleteButton.classList.add("metadata-delete-button-inline-small");
        deleteButton.onclick = async () => await this.removeProperty(values, update, index, container);
        return deleteButton;
    }
    async addProperty(values, update, container) {
        const newFiles = await this.vault.app.selectMultipleFile(this.vault, this.classes, { hint: "Choisissez des fichiers " + this.getClasses().join(" ou ") });
        if (newFiles && newFiles.length > 0) {
            if (!values) {
                values = [];
            }
            newFiles.forEach((file) => {
                values.push(file.getLink());
            });
            await update(values);
            await this.reloadObjects(values, update);
        }
    }
    createAddButton(values, update, container) {
        const addButton = document.createElement("button");
        (0, Utils_1.setIcon)(addButton, "plus");
        addButton.classList.add("metadata-add-button-inline-small");
        addButton.onclick = async () => await this.addProperty(values, update, container);
        return addButton;
    }
    enableDragAndDrop() {
        // Disable drag and drop
    }
}
exports.MultiFileProperty = MultiFileProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE11bHRpRmlsZVByb3BlcnR5LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLHFEQUFrRDtBQUNsRCxpREFBOEM7QUFDOUMsMENBQXlDO0FBS3pDLE1BQWEsaUJBQWtCLFNBQVEsK0JBQWM7SUFRakQsWUFBWSxJQUFZLEVBQUUsS0FBWSxFQUFFLE9BQWtCLEVBQUUsSUFBSSxHQUFHLEVBQUU7UUFDakUsS0FBSyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBUGpCLFNBQUksR0FBWSxXQUFXLENBQUM7UUFHNUIsYUFBUSxHQUFHLENBQUMsQ0FBQztRQUt6QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksMkJBQVksQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBRVEsVUFBVTtRQUNmLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUN4QixDQUFDO0lBRVEsY0FBYyxDQUFDLE1BQVk7UUFDaEMsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUMvQyxDQUFDO0lBRVEsaUJBQWlCLENBQUMsS0FBYztRQUNyQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDbEIsQ0FBQztJQUVELDhDQUE4QztJQUNyQyxXQUFXLENBQUMsTUFBVyxFQUFFLE1BQXFDO1FBQ25FLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEQsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsZ0NBQWdDLEdBQUMsSUFBSSxD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IkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcc3JjXFxwcm9wZXJ0aWVzXFxNdWx0aUZpbGVQcm9wZXJ0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgT2JqZWN0UHJvcGVydHkgfSBmcm9tIFwiLi9PYmplY3RQcm9wZXJ0eVwiO1xyXG5pbXBvcnQgeyBGaWxlUHJvcGVydHkgfSBmcm9tIFwiLi9GaWxlUHJvcGVydHlcIjtcclxuaW1wb3J0IHsgc2V0SWNvbiB9IGZyb20gXCIuLi92YXVsdC9VdGlsc1wiO1xyXG5pbXBvcnQgeyBGaWxlIH0gZnJvbSBcIi4uL3ZhdWx0L0ZpbGVcIjtcclxuaW1wb3J0IHsgTXlWYXVsdCB9IGZyb20gXCIuLi92YXVsdC9NeVZhdWx0XCI7XHJcbmltcG9ydCB7IFZhdWx0IH0gZnJvbSBcIi4uL3ZhdWx0L1ZhdWx0XCI7XHJcblxyXG5leHBvcnQgY2xhc3MgTXVsdGlGaWxlUHJvcGVydHkgZXh0ZW5kcyBPYmplY3RQcm9wZXJ0eSB7XHJcblxyXG4gICAgcHVibGljIG92ZXJyaWRlIHR5cGUgOiBzdHJpbmcgPSBcIm11bHRpRmlsZVwiO1xyXG4gICAgcHVibGljIGNsYXNzZXM6IHN0cmluZ1tdO1xyXG4gICAgcHVibGljIHByb3BlcnR5IDogRmlsZVByb3BlcnR5O1xyXG4gICAgcHVibGljIG92ZXJyaWRlIGZsZXhTcGFuID0gMjtcclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCB2YXVsdDogVmF1bHQsIGNsYXNzZXMgOiBzdHJpbmdbXSwgYXJncyA9IHt9KXtcclxuICAgICAgICBzdXBlcihuYW1lLCB2YXVsdCwge30sIGFyZ3MpO1xyXG4gICAgICAgIHRoaXMuY2xhc3NlcyA9IGNsYXNzZXM7XHJcbiAgICAgICAgdGhpcy5wcm9wZXJ0eSA9IG5ldyBGaWxlUHJvcGVydHkobmFtZSwgdmF1bHQsIGNsYXNzZXMsIGFyZ3MpO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGdldENsYXNzZXMoKTogc3RyaW5nW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNsYXNzZXM7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgZ2V0UGFyZW50VmFsdWUodmFsdWVzIDogYW55KSA6IEZpbGUgfCB1bmRlZmluZWR7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcGVydHkuZ2V0UGFyZW50VmFsdWUodmFsdWVzKVxyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGZvcm1hdFBhcmVudFZhbHVlKHZhbHVlIDogc3RyaW5nKXtcclxuICAgICAgICByZXR1cm4gW3ZhbHVlXVxyXG4gICAgfVxyXG5cclxuICAgIC8vIE3DqXRob2RlIHByaW5jaXBhbGUgcG91ciBvYnRlbmlyIGwnYWZmaWNoYWdlXHJcbiAgICBvdmVycmlkZSBmaWxsRGlzcGxheSh2YWx1ZXM6IGFueSwgdXBkYXRlOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPikge1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1tdWx0aUZpbGVzLWNvbnRhaW5lci1cIit0aGlzLm5hbWUudG9Mb3dlckNhc2UoKSk7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1tdWx0aUZpbGVzLWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICAgICAgLy8gQ3LDqWVyIGxlcyBsaWduZXMgZCdvYmpldFxyXG4gICAgICAgIHRoaXMuY3JlYXRlT2JqZWN0cyh2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuXHJcbiAgICAgICAgY29uc3QgYWRkQnV0dG9uID0gdGhpcy5jcmVhdGVBZGRCdXR0b24odmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGFkZEJ1dHRvbik7XHJcblxyXG4gICAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgY3JlYXRlT2JqZWN0cyh2YWx1ZXM6IGFueSwgdXBkYXRlOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAgIGlmICghdmFsdWVzKSByZXR1cm47XHJcbiAgICAgICAgdmFsdWVzLmZvckVhY2goKG9iamVjdHM6IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLmNyZWF0ZU9iamVjdFJvdyh2YWx1ZXMsIHVwZGF0ZSwgb2JqZWN0cywgaW5kZXgsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChyb3cpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGNyZWF0ZU9iamVjdFJvdyh2YWx1ZXM6IGFueSwgdXBkYXRlOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgdmFsdWU6IGFueSwgaW5kZXg6IG51bWJlciwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCk6IEhUTUxEaXZFbGVtZW50IHtcclxuICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtbXVsdGlGaWxlcy1yb3ctaW5saW5lXCIpO1xyXG5cclxuICAgICAgICAvLyBBam91dGVyIGxlIGJvdXRvbiBkZSBzdXBwcmVzc2lvblxyXG4gICAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IHRoaXMuY3JlYXRlRGVsZXRlQnV0dG9uKHZhbHVlcywgdXBkYXRlLCBpbmRleCwgY29udGFpbmVyKTtcclxuICAgICAgICByb3cuYXBwZW5kQ2hpbGQoZGVsZXRlQnV0dG9uKTtcclxuXHJcblxyXG4gXHJcbiAgICAgICAgbGV0IHByb3BlcnR5Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBwcm9wZXJ0eUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtbXVsdGlGaWxlcy1wcm9wZXJ0eS1pbmxpbmVcIik7XHJcbiAgICAgICAgcHJvcGVydHlDb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5wcm9wZXJ0eS5maWxsRGlzcGxheSh0aGlzLnZhdWx0LCB2YWx1ZSwgYXN5bmMgKHZhbHVlKSA9PiBhd2FpdCB0aGlzLnVwZGF0ZU9iamVjdCh2YWx1ZXMsIHVwZGF0ZSwgaW5kZXgsIHRoaXMucHJvcGVydHksIHZhbHVlKSkpO1xyXG4gICAgICAgIHJvdy5hcHBlbmRDaGlsZChwcm9wZXJ0eUNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgIHJldHVybiByb3c7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgY3JlYXRlRGVsZXRlQnV0dG9uKHZhbHVlczogYW55LCB1cGRhdGU6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBpbmRleDogbnVtYmVyLCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KTogSFRNTEJ1dHRvbkVsZW1lbnQge1xyXG4gICAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgc2V0SWNvbihkZWxldGVCdXR0b24sIFwibWludXNcIik7XHJcbiAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1kZWxldGUtYnV0dG9uLWlubGluZS1zbWFsbFwiKTtcclxuICAgICAgICBkZWxldGVCdXR0b24ub25jbGljayA9IGFzeW5jICgpID0+IGF3YWl0IHRoaXMucmVtb3ZlUHJvcGVydHkodmFsdWVzLCB1cGRhdGUsIGluZGV4LCBjb250YWluZXIpO1xyXG4gICAgICAgIHJldHVybiBkZWxldGVCdXR0b247XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgYXN5bmMgYWRkUHJvcGVydHkodmFsdWVzOiBhbnksIHVwZGF0ZTogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICBjb25zdCBuZXdGaWxlcyA9IGF3YWl0IHRoaXMudmF1bHQuYXBwLnNlbGVjdE11bHRpcGxlRmlsZSh0aGlzLnZhdWx0LCB0aGlzLmNsYXNzZXMsIHsgaGludDogXCJDaG9pc2lzc2V6IGRlcyBmaWNoaWVycyBcIiArIHRoaXMuZ2V0Q2xhc3NlcygpLmpvaW4oXCIgb3UgXCIpIH0pO1xyXG4gICAgICAgIGlmIChuZXdGaWxlcyAmJiBuZXdGaWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGlmICghdmFsdWVzKSB7IHZhbHVlcyA9IFtdOyB9XHJcbiAgICAgICAgICAgIG5ld0ZpbGVzLmZvckVhY2goKGZpbGU6IEZpbGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKGZpbGUuZ2V0TGluaygpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZSh2YWx1ZXMpO1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnJlbG9hZE9iamVjdHModmFsdWVzLCB1cGRhdGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZSBjcmVhdGVBZGRCdXR0b24odmFsdWVzOiBhbnksIHVwZGF0ZTogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpOiBIVE1MQnV0dG9uRWxlbWVudCB7XHJcbiAgICAgICAgY29uc3QgYWRkQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICBzZXRJY29uKGFkZEJ1dHRvbiwgXCJwbHVzXCIpO1xyXG4gICAgICAgIGFkZEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtYWRkLWJ1dHRvbi1pbmxpbmUtc21hbGxcIik7XHJcbiAgICAgICAgYWRkQnV0dG9uLm9uY2xpY2sgPSBhc3luYyAoKSA9PiBhd2FpdCB0aGlzLmFkZFByb3BlcnR5KHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgIHJldHVybiBhZGRCdXR0b247XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgZW5hYmxlRHJhZ0FuZERyb3AoKSB7XHJcbiAgICAgICAgLy8gRGlzYWJsZSBkcmFnIGFuZCBkcm9wXHJcbiAgICB9XHJcbn1cclxuIl0sInZlcnNpb24iOjN9