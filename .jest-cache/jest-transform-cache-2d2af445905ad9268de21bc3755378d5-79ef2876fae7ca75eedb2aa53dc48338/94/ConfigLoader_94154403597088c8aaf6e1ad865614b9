6063d919b2ca87826a22961c81754591
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfigLoader = void 0;
const yaml = __importStar(require("js-yaml"));
const AdressProperty_1 = require("../properties/AdressProperty");
const BooleanProperty_1 = require("../properties/BooleanProperty");
const ClasseProperty_1 = require("../properties/ClasseProperty");
const DateProperty_1 = require("../properties/DateProperty");
const EmailProperty_1 = require("../properties/EmailProperty");
const FileProperty_1 = require("../properties/FileProperty");
const FormulaProperty_1 = require("../properties/FormulaProperty");
const LinkProperty_1 = require("../properties/LinkProperty");
const MediaProperty_1 = require("../properties/MediaProperty");
const MultiFileProperty_1 = require("../properties/MultiFileProperty");
const MultiSelectProperty_1 = require("../properties/MultiSelectProperty");
const NumberProperty_1 = require("../properties/NumberProperty");
const ObjectProperty_1 = require("../properties/ObjectProperty");
const PhoneProperty_1 = require("../properties/PhoneProperty");
const Property_1 = require("../properties/Property");
const RangeDateProperty_1 = require("../properties/RangeDateProperty");
const RatingProperty_1 = require("../properties/RatingProperty");
const SelectProperty_1 = require("../properties/SelectProperty");
const TextProperty_1 = require("../properties/TextProperty");
// Remove Node.js imports for Obsidian compatibility
// import { readFileSync } from 'fs';
// import { join } from 'path';
class ConfigLoader {
    constructor(configPath, vault, app) {
        this.loadedConfigs = new Map();
        this.configPath = configPath;
        this.vault = vault;
        this.app = app;
    }
    /**
     * Load a class configuration from YAML file
     */
    async loadClassConfig(className) {
        if (this.loadedConfigs.has(className)) {
            return this.loadedConfigs.get(className);
        }
        try {
            const configFilePath = `${this.configPath}/${className}.yaml`;
            let fileContent;
            if (this.app && this.app.vault) {
                // Try to read using vault adapter for plugin files
                try {
                    fileContent = await this.app.vault.adapter.read(configFilePath);
                }
                catch (error) {
                    // Fallback to vault API for files in the vault
                    const file = this.app.vault.getAbstractFileByPath(configFilePath);
                    if (!file || !('extension' in file)) {
                        throw new Error(`Configuration file not found: ${configFilePath}`);
                    }
                    fileContent = await this.app.vault.read(file);
                }
            }
            else {
                // Fallback for testing or when app is not available
                throw new Error('Obsidian app instance required to read configuration files');
            }
            const config = yaml.load(fileContent);
            this.loadedConfigs.set(className, config);
            return config;
        }
        catch (error) {
            console.error(`Failed to load config for class ${className}:`, error);
            throw new Error(`Configuration not found for class: ${className}`);
        }
    }
    /**
     * Create a Property instance from configuration
     */
    createProperty(config) {
        const options = config.icon ? { icon: config.icon } : {};
        switch (config.type) {
            case 'Property':
                return new Property_1.Property(config.name, this.vault, options);
            case 'FileProperty':
                return new FileProperty_1.FileProperty(config.name, this.vault, config.classes || [], options);
            case 'MultiFileProperty':
                return new MultiFileProperty_1.MultiFileProperty(config.name, this.vault, config.classes || [], options);
            case 'SelectProperty':
                const selectOptions = (config.options || []).map(opt => ({
                    name: opt.name,
                    color: opt.color || ''
                }));
                return new SelectProperty_1.SelectProperty(config.name, this.vault, selectOptions, options);
            case 'MultiSelectProperty':
                const multiSelectOptions = (config.options || []).map(opt => ({
                    name: opt.name,
                    color: opt.color || ''
                }));
                return new MultiSelectProperty_1.MultiSelectProperty(config.name, this.vault, multiSelectOptions, options);
            case 'EmailProperty':
                return new EmailProperty_1.EmailProperty(config.name, this.vault, options);
            case 'PhoneProperty':
                return new PhoneProperty_1.PhoneProperty(config.name, this.vault, options);
            case 'LinkProperty':
                return new LinkProperty_1.LinkProperty(config.name, this.vault, options);
            case 'ObjectProperty':
                const objProperties = {};
                if (config.properties) {
                    // Vérifier si c'est un format tableau ou objet
                    if (Array.isArray(config.properties)) {
                        // Format tableau
                        for (const row of config.properties) {
                            const propConfig = this.parseTableRowToPropertyConfig(row);
                            objProperties[row.name] = this.createProperty(propConfig);
                        }
                    }
                    else {
                        // Format objet classique
                        for (const [key, propConfig] of Object.entries(config.properties)) {
                            objProperties[key] = this.createProperty(propConfig);
                        }
                    }
                }
                // Ajouter le mode d'affichage si spécifié
                const objOptions = { ...options };
                if (config.display) {
                    objOptions.display = config.display;
                }
                return new ObjectProperty_1.ObjectProperty(config.name, this.vault, objProperties, objOptions);
            case 'RatingProperty':
                return new RatingProperty_1.RatingProperty(config.name, this.vault, options);
            case 'DateProperty':
                const defaultValues = config.defaultValue ? [config.defaultValue] : [];
                return new DateProperty_1.DateProperty(config.name, this.vault, defaultValues, options);
            case 'RangeDateProperty':
                return new RangeDateProperty_1.RangeDateProperty(config.name, this.vault, options);
            case 'AdressProperty':
                return new AdressProperty_1.AdressProperty(config.name, this.vault, options);
            case 'ClasseProperty':
                return new ClasseProperty_1.ClasseProperty(config.name, this.vault, config.icon || 'box');
            case 'TextProperty':
                return new TextProperty_1.TextProperty(config.name, this.vault, options);
            case 'BooleanProperty':
                return new BooleanProperty_1.BooleanProperty(config.name, this.vault, options);
            case 'NumberProperty':
                return new NumberProperty_1.NumberProperty(config.name, this.vault, '', { icon: config.icon || '', static: true });
            case 'SubClassProperty':
                // This will be handled separately in createSubClassProperty
                return new Property_1.Property(config.name, this.vault, options); // Placeholder
            case 'MediaProperty':
                return new MediaProperty_1.MediaProperty(config.name, this.vault, options);
            case 'FormulaProperty':
                const formula = config.formula || config.defaultValue || '';
                const formulaOptions = config.icon ? { icon: config.icon, static: true, write: true } : { icon: '', static: true, write: true };
                return new FormulaProperty_1.FormulaProperty(config.name, this.vault, formula, formulaOptions);
            default:
                console.warn(`Unknown property type: ${config.type}, falling back to Property`);
                return new Property_1.Property(config.name, this.vault, options);
        }
    }
    /**
     * Create SubClass instances from configuration
     */
    /*
    createSubClasses(config: ClassConfig, parentClass: typeof Classe): SubClass[] {
        if (!config.subClassesProperty) {
            return [];
        }

        const subClasses: SubClass[] = [];
        const configLoader = this; // Reference to the current ConfigLoader instance
        
        for (const subClassConfig of config.subClassesProperty.subClasses) {
            // Create a dynamic SubClass
            class DynamicSubClass extends SubClass {
                public subClassName = subClassConfig.name;
                public subClassIcon = subClassConfig.icon || 'box';
                
                static Properties: { [key: string]: Property } = {};
                
                constructor(classe: typeof Classe, data: any = null) {
                    super(classe, data);
                    
                    // Initialize properties if defined
                    if (subClassConfig.properties && !Object.keys(DynamicSubClass.Properties).length) {
                        for (const [key, propConfig] of Object.entries(subClassConfig.properties)) {
                            DynamicSubClass.Properties[key] = configLoader.createProperty(propConfig);
                        }
                    }
                }

                getConstructor(): typeof DynamicSubClass {
                    return DynamicSubClass;
                }
            }
            
            subClasses.push(new DynamicSubClass(parentClass));
        }
        
        return subClasses;
    }*/
    /**
     * Create SubClassProperty from configuration
     */ /*
   createSubClassProperty(config: ClassConfig, parentClass: typeof Classe): SubClassProperty | undefined {
       if (!config.subClassesProperty) {
           return undefined;
       }

       const subClasses = this.createSubClasses(config, parentClass);
       return new SubClassProperty(config.subClassesProperty.name, subClasses);
   }*/
    /**
     * Get all available class configurations
     */
    async getAllClassNames() {
        // This would scan the config directory for .yaml files
        // For now, return a hardcoded list based on existing classes
        return [
            'Personne', 'Institution', 'Lieu', 'Action', 'Animateur',
            'Evenement', 'Note', 'Partenariat'
        ];
    }
    /**
     * Parse une ligne de tableau de propriétés en PropertyConfig
     */
    parseTableRowToPropertyConfig(row) {
        const config = {
            type: row.type,
            name: row.name,
            icon: row.icon,
            defaultValue: row.default
        };
        // Parser les classes (string séparé par virgules)
        if (row.classes) {
            config.classes = row.classes.split(',').map(c => c.trim());
        }
        // Parser les options (format "name1:color1,name2:color2")
        if (row.options) {
            config.options = row.options.split(',').map(opt => {
                const [name, color = ''] = opt.split(':').map(s => s.trim());
                return { name, color };
            });
        }
        // Autres attributs
        if (row.formula) {
            config.formula = row.formula;
        }
        if (row.display) {
            config.display = row.display;
        }
        return config;
    }
    /**
     * Set the config path (useful when we need to update it)
     */
    setConfigPath(configPath) {
        this.configPath = configPath;
    }
}
exports.ConfigLoader = ConfigLoader;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXENvbmZpZ1xcQ29uZmlnTG9hZGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDhDQUFnQztBQUVoQyxpRUFBOEQ7QUFDOUQsbUVBQWdFO0FBQ2hFLGlFQUE4RDtBQUM5RCw2REFBMEQ7QUFDMUQsK0RBQTREO0FBQzVELDZEQUEwRDtBQUMxRCxtRUFBZ0U7QUFDaEUsNkRBQTBEO0FBQzFELCtEQUE0RDtBQUM1RCx1RUFBb0U7QUFDcEUsMkVBQXdFO0FBQ3hFLGlFQUE4RDtBQUM5RCxpRUFBOEQ7QUFDOUQsK0RBQTREO0FBQzVELHFEQUFrRDtBQUNsRCx1RUFBb0U7QUFDcEUsaUVBQThEO0FBQzlELGlFQUE4RDtBQUM5RCw2REFBMEQ7QUFHMUQsb0RBQW9EO0FBQ3BELHFDQUFxQztBQUNyQywrQkFBK0I7QUFFL0IsTUFBYSxZQUFZO0lBTXJCLFlBQVksVUFBa0IsRUFBRSxLQUFZLEVBQUUsR0FBUztRQUovQyxrQkFBYSxHQUE2QixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBS3hELElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBQ25CLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxlQUFlLENBQUMsU0FBaUI7UUFDbkMsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1lBQ3BDLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFFLENBQUM7UUFDOUMsQ0FBQztRQUVELElBQUksQ0FBQztZQUNELE1BQU0s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RUQsT0FBTyxNQUFNLENBQUM7SUFDbEIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsYUFBYSxDQUFDLFVBQWtCO1FBQzVCLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO0lBQ2pDLENBQUM7Q0FDSjtBQTFRRCxvQ0EwUUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXENvbmZpZ1xcQ29uZmlnTG9hZGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHlhbWwgZnJvbSAnanMteWFtbCc7XHJcbmltcG9ydCB7IENsYXNzZSB9IGZyb20gJy4uL3ZhdWx0L0NsYXNzZSc7XHJcbmltcG9ydCB7IEFkcmVzc1Byb3BlcnR5IH0gZnJvbSAnLi4vcHJvcGVydGllcy9BZHJlc3NQcm9wZXJ0eSc7XHJcbmltcG9ydCB7IEJvb2xlYW5Qcm9wZXJ0eSB9IGZyb20gJy4uL3Byb3BlcnRpZXMvQm9vbGVhblByb3BlcnR5JztcclxuaW1wb3J0IHsgQ2xhc3NlUHJvcGVydHkgfSBmcm9tICcuLi9wcm9wZXJ0aWVzL0NsYXNzZVByb3BlcnR5JztcclxuaW1wb3J0IHsgRGF0ZVByb3BlcnR5IH0gZnJvbSAnLi4vcHJvcGVydGllcy9EYXRlUHJvcGVydHknO1xyXG5pbXBvcnQgeyBFbWFpbFByb3BlcnR5IH0gZnJvbSAnLi4vcHJvcGVydGllcy9FbWFpbFByb3BlcnR5JztcclxuaW1wb3J0IHsgRmlsZVByb3BlcnR5IH0gZnJvbSAnLi4vcHJvcGVydGllcy9GaWxlUHJvcGVydHknO1xyXG5pbXBvcnQgeyBGb3JtdWxhUHJvcGVydHkgfSBmcm9tICcuLi9wcm9wZXJ0aWVzL0Zvcm11bGFQcm9wZXJ0eSc7XHJcbmltcG9ydCB7IExpbmtQcm9wZXJ0eSB9IGZyb20gJy4uL3Byb3BlcnRpZXMvTGlua1Byb3BlcnR5JztcclxuaW1wb3J0IHsgTWVkaWFQcm9wZXJ0eSB9IGZyb20gJy4uL3Byb3BlcnRpZXMvTWVkaWFQcm9wZXJ0eSc7XHJcbmltcG9ydCB7IE11bHRpRmlsZVByb3BlcnR5IH0gZnJvbSAnLi4vcHJvcGVydGllcy9NdWx0aUZpbGVQcm9wZXJ0eSc7XHJcbmltcG9ydCB7IE11bHRpU2VsZWN0UHJvcGVydHkgfSBmcm9tICcuLi9wcm9wZXJ0aWVzL011bHRpU2VsZWN0UHJvcGVydHknO1xyXG5pbXBvcnQgeyBOdW1iZXJQcm9wZXJ0eSB9IGZyb20gJy4uL3Byb3BlcnRpZXMvTnVtYmVyUHJvcGVydHknO1xyXG5pbXBvcnQgeyBPYmplY3RQcm9wZXJ0eSB9IGZyb20gJy4uL3Byb3BlcnRpZXMvT2JqZWN0UHJvcGVydHknO1xyXG5pbXBvcnQgeyBQaG9uZVByb3BlcnR5IH0gZnJvbSAnLi4vcHJvcGVydGllcy9QaG9uZVByb3BlcnR5JztcclxuaW1wb3J0IHsgUHJvcGVydHkgfSBmcm9tICcuLi9wcm9wZXJ0aWVzL1Byb3BlcnR5JztcclxuaW1wb3J0IHsgUmFuZ2VEYXRlUHJvcGVydHkgfSBmcm9tICcuLi9wcm9wZXJ0aWVzL1JhbmdlRGF0ZVByb3BlcnR5JztcclxuaW1wb3J0IHsgUmF0aW5nUHJvcGVydHkgfSBmcm9tICcuLi9wcm9wZXJ0aWVzL1JhdGluZ1Byb3BlcnR5JztcclxuaW1wb3J0IHsgU2VsZWN0UHJvcGVydHkgfSBmcm9tICcuLi9wcm9wZXJ0aWVzL1NlbGVjdFByb3BlcnR5JztcclxuaW1wb3J0IHsgVGV4dFByb3BlcnR5IH0gZnJvbSAnLi4vcHJvcGVydGllcy9UZXh0UHJvcGVydHknO1xyXG5pbXBvcnQgeyBWYXVsdCB9IGZyb20gJy4uL3ZhdWx0L1ZhdWx0JztcclxuaW1wb3J0IHsgQ2xhc3NDb25maWcsIFByb3BlcnR5Q29uZmlnLCBQcm9wZXJ0eVRhYmxlUm93IH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcclxuLy8gUmVtb3ZlIE5vZGUuanMgaW1wb3J0cyBmb3IgT2JzaWRpYW4gY29tcGF0aWJpbGl0eVxyXG4vLyBpbXBvcnQgeyByZWFkRmlsZVN5bmMgfSBmcm9tICdmcyc7XHJcbi8vIGltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcclxuXHJcbmV4cG9ydCBjbGFzcyBDb25maWdMb2FkZXIge1xyXG4gICAgcHJpdmF0ZSBjb25maWdQYXRoOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIGxvYWRlZENvbmZpZ3M6IE1hcDxzdHJpbmcsIENsYXNzQ29uZmlnPiA9IG5ldyBNYXAoKTtcclxuICAgIHByaXZhdGUgYXBwOiBhbnk7IC8vIE9ic2lkaWFuIEFwcCBpbnN0YW5jZVxyXG4gICAgcHJpdmF0ZSB2YXVsdDogVmF1bHQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IoY29uZmlnUGF0aDogc3RyaW5nLCB2YXVsdDogVmF1bHQsIGFwcD86IGFueSkge1xyXG4gICAgICAgIHRoaXMuY29uZmlnUGF0aCA9IGNvbmZpZ1BhdGg7XHJcbiAgICAgICAgdGhpcy52YXVsdCA9IHZhdWx0O1xyXG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTG9hZCBhIGNsYXNzIGNvbmZpZ3VyYXRpb24gZnJvbSBZQU1MIGZpbGVcclxuICAgICAqL1xyXG4gICAgYXN5bmMgbG9hZENsYXNzQ29uZmlnKGNsYXNzTmFtZTogc3RyaW5nKTogUHJvbWlzZTxDbGFzc0NvbmZpZz4ge1xyXG4gICAgICAgIGlmICh0aGlzLmxvYWRlZENvbmZpZ3MuaGFzKGNsYXNzTmFtZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9hZGVkQ29uZmlncy5nZXQoY2xhc3NOYW1lKSE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBjb25zdCBjb25maWdGaWxlUGF0aCA9IGAke3RoaXMuY29uZmlnUGF0aH0vJHtjbGFzc05hbWV9LnlhbWxgO1xyXG4gICAgICAgICAgICBsZXQgZmlsZUNvbnRlbnQ6IHN0cmluZztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFwcCAmJiB0aGlzLmFwcC52YXVsdCkge1xyXG4gICAgICAgICAgICAgICAgLy8gVHJ5IHRvIHJlYWQgdXNpbmcgdmF1bHQgYWRhcHRlciBmb3IgcGx1Z2luIGZpbGVzXHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVDb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5yZWFkKGNvbmZpZ0ZpbGVQYXRoKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gdmF1bHQgQVBJIGZvciBmaWxlcyBpbiB0aGUgdmF1bHRcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGNvbmZpZ0ZpbGVQYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWZpbGUgfHwgISgnZXh0ZW5zaW9uJyBpbiBmaWxlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvbmZpZ3VyYXRpb24gZmlsZSBub3QgZm91bmQ6ICR7Y29uZmlnRmlsZVBhdGh9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVDb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrIGZvciB0ZXN0aW5nIG9yIHdoZW4gYXBwIGlzIG5vdCBhdmFpbGFibGVcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignT2JzaWRpYW4gYXBwIGluc3RhbmNlIHJlcXVpcmVkIHRvIHJlYWQgY29uZmlndXJhdGlvbiBmaWxlcycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBjb25maWcgPSB5YW1sLmxvYWQoZmlsZUNvbnRlbnQpIGFzIENsYXNzQ29uZmlnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5sb2FkZWRDb25maWdzLnNldChjbGFzc05hbWUsIGNvbmZpZyk7XHJcbiAgICAgICAgICAgIHJldHVybiBjb25maWc7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgY29uZmlnIGZvciBjbGFzcyAke2NsYXNzTmFtZX06YCwgZXJyb3IpO1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvbmZpZ3VyYXRpb24gbm90IGZvdW5kIGZvciBjbGFzczogJHtjbGFzc05hbWV9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIGEgUHJvcGVydHkgaW5zdGFuY2UgZnJvbSBjb25maWd1cmF0aW9uXHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZVByb3BlcnR5KGNvbmZpZzogUHJvcGVydHlDb25maWcpOiBQcm9wZXJ0eSB7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGNvbmZpZy5pY29uID8geyBpY29uOiBjb25maWcuaWNvbiB9IDoge307XHJcbiAgICAgICAgXHJcbiAgICAgICAgc3dpdGNoIChjb25maWcudHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdQcm9wZXJ0eSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3BlcnR5KGNvbmZpZy5uYW1lLCB0aGlzLnZhdWx0LCBvcHRpb25zKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgJ0ZpbGVQcm9wZXJ0eSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpbGVQcm9wZXJ0eShjb25maWcubmFtZSwgdGhpcy52YXVsdCwgY29uZmlnLmNsYXNzZXMgfHwgW10sIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAnTXVsdGlGaWxlUHJvcGVydHknOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNdWx0aUZpbGVQcm9wZXJ0eShjb25maWcubmFtZSwgdGhpcy52YXVsdCwgY29uZmlnLmNsYXNzZXMgfHwgW10sIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAnU2VsZWN0UHJvcGVydHknOlxyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0T3B0aW9ucyA9IChjb25maWcub3B0aW9ucyB8fCBbXSkubWFwKG9wdCA9PiAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IG9wdC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBvcHQuY29sb3IgfHwgJydcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2VsZWN0UHJvcGVydHkoY29uZmlnLm5hbWUsIHRoaXMudmF1bHQsIHNlbGVjdE9wdGlvbnMsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAnTXVsdGlTZWxlY3RQcm9wZXJ0eSc6XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtdWx0aVNlbGVjdE9wdGlvbnMgPSAoY29uZmlnLm9wdGlvbnMgfHwgW10pLm1hcChvcHQgPT4gKHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBvcHQubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBjb2xvcjogb3B0LmNvbG9yIHx8ICcnXHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE11bHRpU2VsZWN0UHJvcGVydHkoY29uZmlnLm5hbWUsIHRoaXMudmF1bHQsIG11bHRpU2VsZWN0T3B0aW9ucywgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlICdFbWFpbFByb3BlcnR5JzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRW1haWxQcm9wZXJ0eShjb25maWcubmFtZSwgdGhpcy52YXVsdCwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlICdQaG9uZVByb3BlcnR5JzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUGhvbmVQcm9wZXJ0eShjb25maWcubmFtZSwgdGhpcy52YXVsdCwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlICdMaW5rUHJvcGVydHknOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMaW5rUHJvcGVydHkoY29uZmlnLm5hbWUsIHRoaXMudmF1bHQsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAnT2JqZWN0UHJvcGVydHknOlxyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2JqUHJvcGVydGllczogeyBba2V5OiBzdHJpbmddOiBQcm9wZXJ0eSB9ID0ge307XHJcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLnByb3BlcnRpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBWw6lyaWZpZXIgc2kgYydlc3QgdW4gZm9ybWF0IHRhYmxlYXUgb3Ugb2JqZXRcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWcucHJvcGVydGllcykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9ybWF0IHRhYmxlYXVcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCByb3cgb2YgY29uZmlnLnByb3BlcnRpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3BDb25maWcgPSB0aGlzLnBhcnNlVGFibGVSb3dUb1Byb3BlcnR5Q29uZmlnKHJvdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpQcm9wZXJ0aWVzW3Jvdy5uYW1lXSA9IHRoaXMuY3JlYXRlUHJvcGVydHkocHJvcENvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3JtYXQgb2JqZXQgY2xhc3NpcXVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW2tleSwgcHJvcENvbmZpZ10gb2YgT2JqZWN0LmVudHJpZXMoY29uZmlnLnByb3BlcnRpZXMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmpQcm9wZXJ0aWVzW2tleV0gPSB0aGlzLmNyZWF0ZVByb3BlcnR5KHByb3BDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gQWpvdXRlciBsZSBtb2RlIGQnYWZmaWNoYWdlIHNpIHNww6ljaWZpw6lcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9iak9wdGlvbnM6IGFueSA9IHsgLi4ub3B0aW9ucyB9O1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5kaXNwbGF5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JqT3B0aW9ucy5kaXNwbGF5ID0gY29uZmlnLmRpc3BsYXk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE9iamVjdFByb3BlcnR5KGNvbmZpZy5uYW1lLCB0aGlzLnZhdWx0LCBvYmpQcm9wZXJ0aWVzLCBvYmpPcHRpb25zKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgJ1JhdGluZ1Byb3BlcnR5JzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUmF0aW5nUHJvcGVydHkoY29uZmlnLm5hbWUsIHRoaXMudmF1bHQsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAnRGF0ZVByb3BlcnR5JzpcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZXMgPSBjb25maWcuZGVmYXVsdFZhbHVlID8gW2NvbmZpZy5kZWZhdWx0VmFsdWVdIDogW107XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGVQcm9wZXJ0eShjb25maWcubmFtZSwgIHRoaXMudmF1bHQsZGVmYXVsdFZhbHVlcywgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlICdSYW5nZURhdGVQcm9wZXJ0eSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJhbmdlRGF0ZVByb3BlcnR5KGNvbmZpZy5uYW1lLCB0aGlzLnZhdWx0LCBvcHRpb25zKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgJ0FkcmVzc1Byb3BlcnR5JzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQWRyZXNzUHJvcGVydHkoY29uZmlnLm5hbWUsIHRoaXMudmF1bHQsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAnQ2xhc3NlUHJvcGVydHknOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDbGFzc2VQcm9wZXJ0eShjb25maWcubmFtZSwgdGhpcy52YXVsdCwgY29uZmlnLmljb24gfHwgJ2JveCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAnVGV4dFByb3BlcnR5JzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVGV4dFByb3BlcnR5KGNvbmZpZy5uYW1lLCB0aGlzLnZhdWx0LCBvcHRpb25zKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgJ0Jvb2xlYW5Qcm9wZXJ0eSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJvb2xlYW5Qcm9wZXJ0eShjb25maWcubmFtZSwgdGhpcy52YXVsdCwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYXNlICdOdW1iZXJQcm9wZXJ0eSc6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE51bWJlclByb3BlcnR5KGNvbmZpZy5uYW1lLCB0aGlzLnZhdWx0LCAnJywgeyBpY29uOiBjb25maWcuaWNvbiB8fCAnJywgc3RhdGljOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2FzZSAnU3ViQ2xhc3NQcm9wZXJ0eSc6XHJcbiAgICAgICAgICAgICAgICAvLyBUaGlzIHdpbGwgYmUgaGFuZGxlZCBzZXBhcmF0ZWx5IGluIGNyZWF0ZVN1YkNsYXNzUHJvcGVydHlcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvcGVydHkoY29uZmlnLm5hbWUsIHRoaXMudmF1bHQsIG9wdGlvbnMpOyAvLyBQbGFjZWhvbGRlclxyXG5cclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ01lZGlhUHJvcGVydHknOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNZWRpYVByb3BlcnR5KGNvbmZpZy5uYW1lLCB0aGlzLnZhdWx0LCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ0Zvcm11bGFQcm9wZXJ0eSc6XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmb3JtdWxhID0gY29uZmlnLmZvcm11bGEgfHwgY29uZmlnLmRlZmF1bHRWYWx1ZSB8fCAnJztcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZvcm11bGFPcHRpb25zID0gY29uZmlnLmljb24gPyB7IGljb246IGNvbmZpZy5pY29uLCBzdGF0aWM6IHRydWUsIHdyaXRlOiB0cnVlIH0gOiB7IGljb246ICcnLCBzdGF0aWM6IHRydWUsIHdyaXRlOiB0cnVlIH07XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZvcm11bGFQcm9wZXJ0eShjb25maWcubmFtZSwgdGhpcy52YXVsdCwgZm9ybXVsYSwgZm9ybXVsYU9wdGlvbnMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgVW5rbm93biBwcm9wZXJ0eSB0eXBlOiAke2NvbmZpZy50eXBlfSwgZmFsbGluZyBiYWNrIHRvIFByb3BlcnR5YCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3BlcnR5KGNvbmZpZy5uYW1lLCB0aGlzLnZhdWx0LCBvcHRpb25zKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgU3ViQ2xhc3MgaW5zdGFuY2VzIGZyb20gY29uZmlndXJhdGlvblxyXG4gICAgICovXHJcbiAgICAvKlxyXG4gICAgY3JlYXRlU3ViQ2xhc3Nlcyhjb25maWc6IENsYXNzQ29uZmlnLCBwYXJlbnRDbGFzczogdHlwZW9mIENsYXNzZSk6IFN1YkNsYXNzW10ge1xyXG4gICAgICAgIGlmICghY29uZmlnLnN1YkNsYXNzZXNQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzdWJDbGFzc2VzOiBTdWJDbGFzc1tdID0gW107XHJcbiAgICAgICAgY29uc3QgY29uZmlnTG9hZGVyID0gdGhpczsgLy8gUmVmZXJlbmNlIHRvIHRoZSBjdXJyZW50IENvbmZpZ0xvYWRlciBpbnN0YW5jZVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZvciAoY29uc3Qgc3ViQ2xhc3NDb25maWcgb2YgY29uZmlnLnN1YkNsYXNzZXNQcm9wZXJ0eS5zdWJDbGFzc2VzKSB7XHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGR5bmFtaWMgU3ViQ2xhc3NcclxuICAgICAgICAgICAgY2xhc3MgRHluYW1pY1N1YkNsYXNzIGV4dGVuZHMgU3ViQ2xhc3Mge1xyXG4gICAgICAgICAgICAgICAgcHVibGljIHN1YkNsYXNzTmFtZSA9IHN1YkNsYXNzQ29uZmlnLm5hbWU7XHJcbiAgICAgICAgICAgICAgICBwdWJsaWMgc3ViQ2xhc3NJY29uID0gc3ViQ2xhc3NDb25maWcuaWNvbiB8fCAnYm94JztcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgc3RhdGljIFByb3BlcnRpZXM6IHsgW2tleTogc3RyaW5nXTogUHJvcGVydHkgfSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBjb25zdHJ1Y3RvcihjbGFzc2U6IHR5cGVvZiBDbGFzc2UsIGRhdGE6IGFueSA9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBzdXBlcihjbGFzc2UsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYWxpemUgcHJvcGVydGllcyBpZiBkZWZpbmVkXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YkNsYXNzQ29uZmlnLnByb3BlcnRpZXMgJiYgIU9iamVjdC5rZXlzKER5bmFtaWNTdWJDbGFzcy5Qcm9wZXJ0aWVzKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBba2V5LCBwcm9wQ29uZmlnXSBvZiBPYmplY3QuZW50cmllcyhzdWJDbGFzc0NvbmZpZy5wcm9wZXJ0aWVzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRHluYW1pY1N1YkNsYXNzLlByb3BlcnRpZXNba2V5XSA9IGNvbmZpZ0xvYWRlci5jcmVhdGVQcm9wZXJ0eShwcm9wQ29uZmlnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBnZXRDb25zdHJ1Y3RvcigpOiB0eXBlb2YgRHluYW1pY1N1YkNsYXNzIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRHluYW1pY1N1YkNsYXNzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBzdWJDbGFzc2VzLnB1c2gobmV3IER5bmFtaWNTdWJDbGFzcyhwYXJlbnRDbGFzcykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gc3ViQ2xhc3NlcztcclxuICAgIH0qL1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIFN1YkNsYXNzUHJvcGVydHkgZnJvbSBjb25maWd1cmF0aW9uXHJcbiAgICAgKi8vKlxyXG4gICAgY3JlYXRlU3ViQ2xhc3NQcm9wZXJ0eShjb25maWc6IENsYXNzQ29uZmlnLCBwYXJlbnRDbGFzczogdHlwZW9mIENsYXNzZSk6IFN1YkNsYXNzUHJvcGVydHkgfCB1bmRlZmluZWQge1xyXG4gICAgICAgIGlmICghY29uZmlnLnN1YkNsYXNzZXNQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgc3ViQ2xhc3NlcyA9IHRoaXMuY3JlYXRlU3ViQ2xhc3Nlcyhjb25maWcsIHBhcmVudENsYXNzKTtcclxuICAgICAgICByZXR1cm4gbmV3IFN1YkNsYXNzUHJvcGVydHkoY29uZmlnLnN1YkNsYXNzZXNQcm9wZXJ0eS5uYW1lLCBzdWJDbGFzc2VzKTtcclxuICAgIH0qL1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGFsbCBhdmFpbGFibGUgY2xhc3MgY29uZmlndXJhdGlvbnNcclxuICAgICAqL1xyXG4gICAgYXN5bmMgZ2V0QWxsQ2xhc3NOYW1lcygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XHJcbiAgICAgICAgLy8gVGhpcyB3b3VsZCBzY2FuIHRoZSBjb25maWcgZGlyZWN0b3J5IGZvciAueWFtbCBmaWxlc1xyXG4gICAgICAgIC8vIEZvciBub3csIHJldHVybiBhIGhhcmRjb2RlZCBsaXN0IGJhc2VkIG9uIGV4aXN0aW5nIGNsYXNzZXNcclxuICAgICAgICByZXR1cm4gW1xyXG4gICAgICAgICAgICAnUGVyc29ubmUnLCAnSW5zdGl0dXRpb24nLCAnTGlldScsICdBY3Rpb24nLCAnQW5pbWF0ZXVyJywgXHJcbiAgICAgICAgICAgICdFdmVuZW1lbnQnLCAnTm90ZScsICdQYXJ0ZW5hcmlhdCdcclxuICAgICAgICBdO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUGFyc2UgdW5lIGxpZ25lIGRlIHRhYmxlYXUgZGUgcHJvcHJpw6l0w6lzIGVuIFByb3BlcnR5Q29uZmlnXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgcGFyc2VUYWJsZVJvd1RvUHJvcGVydHlDb25maWcocm93OiBQcm9wZXJ0eVRhYmxlUm93KTogUHJvcGVydHlDb25maWcge1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZzogUHJvcGVydHlDb25maWcgPSB7XHJcbiAgICAgICAgICAgIHR5cGU6IHJvdy50eXBlLFxyXG4gICAgICAgICAgICBuYW1lOiByb3cubmFtZSxcclxuICAgICAgICAgICAgaWNvbjogcm93Lmljb24sXHJcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogcm93LmRlZmF1bHRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBQYXJzZXIgbGVzIGNsYXNzZXMgKHN0cmluZyBzw6lwYXLDqSBwYXIgdmlyZ3VsZXMpXHJcbiAgICAgICAgaWYgKHJvdy5jbGFzc2VzKSB7XHJcbiAgICAgICAgICAgIGNvbmZpZy5jbGFzc2VzID0gcm93LmNsYXNzZXMuc3BsaXQoJywnKS5tYXAoYyA9PiBjLnRyaW0oKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBQYXJzZXIgbGVzIG9wdGlvbnMgKGZvcm1hdCBcIm5hbWUxOmNvbG9yMSxuYW1lMjpjb2xvcjJcIilcclxuICAgICAgICBpZiAocm93Lm9wdGlvbnMpIHtcclxuICAgICAgICAgICAgY29uZmlnLm9wdGlvbnMgPSByb3cub3B0aW9ucy5zcGxpdCgnLCcpLm1hcChvcHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgW25hbWUsIGNvbG9yID0gJyddID0gb3B0LnNwbGl0KCc6JykubWFwKHMgPT4gcy50cmltKCkpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgbmFtZSwgY29sb3IgfTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBBdXRyZXMgYXR0cmlidXRzXHJcbiAgICAgICAgaWYgKHJvdy5mb3JtdWxhKSB7XHJcbiAgICAgICAgICAgIGNvbmZpZy5mb3JtdWxhID0gcm93LmZvcm11bGE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChyb3cuZGlzcGxheSkge1xyXG4gICAgICAgICAgICBjb25maWcuZGlzcGxheSA9IHJvdy5kaXNwbGF5O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldCB0aGUgY29uZmlnIHBhdGggKHVzZWZ1bCB3aGVuIHdlIG5lZWQgdG8gdXBkYXRlIGl0KVxyXG4gICAgICovXHJcbiAgICBzZXRDb25maWdQYXRoKGNvbmZpZ1BhdGg6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuY29uZmlnUGF0aCA9IGNvbmZpZ1BhdGg7XHJcbiAgICB9XHJcbn0iXSwidmVyc2lvbiI6M30=