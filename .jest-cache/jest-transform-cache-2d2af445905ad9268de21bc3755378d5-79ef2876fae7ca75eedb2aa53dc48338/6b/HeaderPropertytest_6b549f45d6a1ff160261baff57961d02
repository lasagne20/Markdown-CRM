a18c0f32ee45b0d12856fa5ff21bb656
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
const HeaderProperty_1 = require("../../properties/HeaderProperty");
describe('HearderProperty', () => {
    let headerProperty;
    beforeEach(() => {
        // Reset DOM mocks
        document.body.innerHTML = '';
        jest.clearAllMocks();
        // Mock focus pour tous les éléments HTML
        HTMLElement.prototype.focus = jest.fn();
    });
    describe('constructor', () => {
        it('should create HearderProperty with default values', () => {
            headerProperty = new HeaderProperty_1.HearderProperty('testHeader');
            expect(headerProperty.name).toBe('testHeader');
            expect(headerProperty.type).toBe('header');
        });
        it('should create HearderProperty with custom args', () => {
            headerProperty = new HeaderProperty_1.HearderProperty('testHeader', { icon: 'heading', staticProperty: true });
            expect(headerProperty.name).toBe('testHeader');
            expect(headerProperty.type).toBe('header');
            expect(headerProperty.icon).toBe('heading');
            expect(headerProperty.static).toBe(true);
        });
    });
    describe('fillDisplay', () => {
        beforeEach(() => {
            headerProperty = new HeaderProperty_1.HearderProperty('testHeader');
        });
        it('should create container with correct structure', () => {
            const mockUpdate = jest.fn();
            const container = headerProperty.fillDisplay({}, 'Test Header', mockUpdate);
            expect(container.tagName).toBe('DIV');
            expect(container.classList.contains('metadata-headerfield')).toBe(true);
            const fieldContainer = container.querySelector('.field-container');
            expect(fieldContainer).toBeTruthy();
        });
        it('should apply custom size to header elements', () => {
            const mockUpdate = jest.fn();
            const container = headerProperty.fillDisplay({}, 'Test Header', mockUpdate, { size: '3em' });
            const link = container.querySelector('.field-headerlink');
            const input = container.querySelector('.field-header');
            expect(link?.style.fontSize).toBe('3em');
            expect(input?.style.fontSize).toBe('3em');
        });
        it('should use default size when no size specified', () => {
            const mockUpdate = jest.fn();
            const container = headerProperty.fillDisplay({}, 'Test Header', mockUpdate);
            const link = container.querySelector('.field-headerlink');
            const input = container.querySelector('.field-header');
            expect(link?.style.fontSize).toBe('2em');
            expect(input?.style.fontSize).toBe('2em');
        });
    });
    describe('createFieldInput', () => {
        beforeEach(() => {
            headerProperty = new HeaderProperty_1.HearderProperty('testHeader');
        });
        it('should create input element with header class', () => {
            const input = headerProperty.createFieldInput('Test Value');
            expect(input.tagName).toBe('INPUT');
            expect(input.type).toBe('text');
            expect(input.value).toBe('Test Value');
            expect(input.classList.contains('field-header')).toBe(true);
        });
        it('should create input with empty value when no value provided', () => {
            const input = headerProperty.createFieldInput('');
            expect(input.value).toBe('');
        });
        it('should handle null/undefined value', () => {
            const input = headerProperty.createFieldInput(null);
            expect(input.value).toBe('');
        });
    });
    describe('createFieldContainer', () => {
        beforeEach(() => {
            headerProperty = new HeaderProperty_1.HearderProperty('testHeader');
        });
        it('should create container with metadata-headerfield class', () => {
            const container = headerProperty.createFieldContainer();
            expect(container.tagName).toBe('DIV');
            expect(container.classList.contains('metadata-headerfield')).toBe(true);
        });
    });
    describe('createFieldLink', () => {
        beforeEach(() => {
            headerProperty = new HeaderProperty_1.HearderProperty('testHeader');
        });
        it('should create h2 element with header link class', () => {
            const link = headerProperty.createFieldLink('Test Header');
            expect(link.tagName).toBe('H2');
            expect(link.innerHTML).toBe('Test Header');
            expect(link.classList.contains('field-headerlink')).toBe(true);
            expect(link.style.cursor).toBe('text');
        });
        it('should create link with empty content when no value', () => {
            const link = headerProperty.createFieldLink('');
            expect(link.innerHTML).toBe('');
        });
        it('should set cursor to default when static', () => {
            headerProperty.static = true;
            const link = headerProperty.createFieldLink('Test Header');
            expect(link.style.cursor).toBe('default');
        });
        it('should handle click event to trigger modifyField when not static', () => {
            const spy = jest.spyOn(headerProperty, 'modifyField');
            const link = headerProperty.createFieldLink('Test Header');
            link.click();
            expect(spy).toHaveBeenCalledWith(expect.objectContaining({
                type: 'click'
            }));
        });
        it('should not add click listener when static', () => {
            headerProperty.static = true;
            const spy = jest.spyOn(headerProperty, 'modifyField');
            const link = headerProperty.createFieldLink('Test Header');
            link.click();
            expect(spy).not.toHaveBeenCalled();
        });
    });
    describe('modifyField', () => {
        beforeEach(() => {
            headerProperty = new HeaderProperty_1.HearderProperty('testHeader');
        });
        it('should switch from link to input on event', () => {
            // Créer la structure DOM attendue
            const container = document.createElement('div');
            container.classList.add('metadata-headerfield');
            const fieldContainer = document.createElement('div');
            fieldContainer.classList.add('field-container');
            const link = document.createElement('h2');
            link.classList.add('field-headerlink');
            link.textContent = 'Test Header';
            const input = document.createElement('input');
            input.classList.add('field-header');
            input.value = 'Test Header';
            fieldContainer.appendChild(link);
            fieldContainer.appendChild(input);
            container.appendChild(fieldContainer);
            document.body.appendChild(container);
            const focusSpy = jest.spyOn(input, 'focus');
            // État initial
            link.style.display = 'block';
            input.style.display = 'none';
            // Créer l'événement avec target = link
            const event = {
                target: link
            };
            headerProperty.modifyField(event);
            expect(link.style.display).toBe('none');
            expect(input.style.display).toBe('block');
            expect(focusSpy).toHaveBeenCalled();
        });
        it('should handle missing elements gracefully', () => {
            const event = {
                target: document.createElement('div')
            };
            // Ne devrait pas lever d'erreur
            expect(() => headerProperty.modifyField(event)).not.toThrow();
        });
    });
    describe('handleFieldInput', () => {
        beforeEach(() => {
            headerProperty = new HeaderProperty_1.HearderProperty('testHeader');
        });
        it('should handle blur event', async () => {
            const mockUpdate = jest.fn().mockResolvedValue(undefined);
            const input = document.createElement('input');
            const link = document.createElement('h2');
            const spy = jest.spyOn(headerProperty, 'updateField').mockResolvedValue(undefined);
            headerProperty.handleFieldInput(mockUpdate, input, link);
            // Simuler l'événement blur
            const blurEvent = new Event('blur');
            input.dispatchEvent(blurEvent);
            // Attendre que les promesses se résolvent
            await new Promise(resolve => setTimeout(resolve, 0));
            expect(spy).toHaveBeenCalledWith(mockUpdate, input, link);
        });
        it('should add keydown event handler', () => {
            const mockUpdate = jest.fn();
            const input = document.createElement('input');
            const link = document.createElement('h2');
            headerProperty.handleFieldInput(mockUpdate, input, link);
            expect(input.onkeydown).toBeDefined();
            expect(typeof input.onkeydown).toBe('function');
        });
        it('should add blur event handler', () => {
            const mockUpdate = jest.fn();
            const input = document.createElement('input');
            const link = document.createElement('h2');
            headerProperty.handleFieldInput(mockUpdate, input, link);
            expect(input.onblur).toBeDefined();
            expect(typeof input.onblur).toBe('function');
        });
        it('should not handle other key presses', async () => {
            const mockUpdate = jest.fn().mockResolvedValue(undefined);
            const input = document.createElement('input');
            const link = document.createElement('h2');
            const spy = jest.spyOn(headerProperty, 'updateField').mockResolvedValue(undefined);
            headerProperty.handleFieldInput(mockUpdate, input, link);
            // Simuler l'appui sur une autre touche
            const otherKeyEvent = new KeyboardEvent('keydown', { key: 'a' });
            input.dispatchEvent(otherKeyEvent);
            // Attendre que les promesses se résolvent
            await new Promise(resolve => setTimeout(resolve, 0));
            expect(spy).not.toHaveBeenCalled();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXF9fdGVzdHNfX1xcUHJvcGVydGllc1xcSGVhZGVyUHJvcGVydHkudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgsb0VBQWtFO0FBRWxFLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDN0IsSUFBSSxjQUErQixDQUFDO0lBRXBDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixrQkFBa0I7UUFDbEIsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUVyQix5Q0FBeUM7UUFDekMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQzVDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDekIsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLEdBQUcsRUFBRTtZQUN6RCxjQUFjLEdBQUcsSUFBSSxnQ0FBZSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRW5ELE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQy9DLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdEQUFnRCxFQUFFLEdBQUcsRUFBRTtZQUN0RCxjQUFjLEdBQUcsSUFBSSxnQ0FBZSxDQUFDLFlBQVksRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7WUFFOUYsTUFBTSxDQUFD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TUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM5QyxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLGFBQWEsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRW5GLGNBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRXpELHVDQUF1QztZQUN2QyxNQUFNLGFBQWEsR0FBRyxJQUFJLGFBQWEsQ0FBQyxTQUFTLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUNqRSxLQUFLLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRW5DLDBDQUEwQztZQUMxQyxNQUFNLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXJELE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXF9fdGVzdHNfX1xcUHJvcGVydGllc1xcSGVhZGVyUHJvcGVydHkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGplc3QtZW52aXJvbm1lbnQganNkb21cclxuICovXHJcblxyXG5pbXBvcnQgeyBIZWFyZGVyUHJvcGVydHkgfSBmcm9tICcuLi8uLi9wcm9wZXJ0aWVzL0hlYWRlclByb3BlcnR5JztcclxuXHJcbmRlc2NyaWJlKCdIZWFyZGVyUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICBsZXQgaGVhZGVyUHJvcGVydHk6IEhlYXJkZXJQcm9wZXJ0eTtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAvLyBSZXNldCBET00gbW9ja3NcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9ICcnO1xyXG4gICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIE1vY2sgZm9jdXMgcG91ciB0b3VzIGxlcyDDqWzDqW1lbnRzIEhUTUxcclxuICAgICAgICBIVE1MRWxlbWVudC5wcm90b3R5cGUuZm9jdXMgPSBqZXN0LmZuKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY29uc3RydWN0b3InLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgSGVhcmRlclByb3BlcnR5IHdpdGggZGVmYXVsdCB2YWx1ZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGhlYWRlclByb3BlcnR5ID0gbmV3IEhlYXJkZXJQcm9wZXJ0eSgndGVzdEhlYWRlcicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGhlYWRlclByb3BlcnR5Lm5hbWUpLnRvQmUoJ3Rlc3RIZWFkZXInKTtcclxuICAgICAgICAgICAgZXhwZWN0KGhlYWRlclByb3BlcnR5LnR5cGUpLnRvQmUoJ2hlYWRlcicpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBIZWFyZGVyUHJvcGVydHkgd2l0aCBjdXN0b20gYXJncycsICgpID0+IHtcclxuICAgICAgICAgICAgaGVhZGVyUHJvcGVydHkgPSBuZXcgSGVhcmRlclByb3BlcnR5KCd0ZXN0SGVhZGVyJywgeyBpY29uOiAnaGVhZGluZycsIHN0YXRpY1Byb3BlcnR5OiB0cnVlIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGhlYWRlclByb3BlcnR5Lm5hbWUpLnRvQmUoJ3Rlc3RIZWFkZXInKTtcclxuICAgICAgICAgICAgZXhwZWN0KGhlYWRlclByb3BlcnR5LnR5cGUpLnRvQmUoJ2hlYWRlcicpO1xyXG4gICAgICAgICAgICBleHBlY3QoaGVhZGVyUHJvcGVydHkuaWNvbikudG9CZSgnaGVhZGluZycpO1xyXG4gICAgICAgICAgICBleHBlY3QoaGVhZGVyUHJvcGVydHkuc3RhdGljKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2ZpbGxEaXNwbGF5JywgKCkgPT4ge1xyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICBoZWFkZXJQcm9wZXJ0eSA9IG5ldyBIZWFyZGVyUHJvcGVydHkoJ3Rlc3RIZWFkZXInKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgY29udGFpbmVyIHdpdGggY29ycmVjdCBzdHJ1Y3R1cmUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGhlYWRlclByb3BlcnR5LmZpbGxEaXNwbGF5KHt9LCAnVGVzdCBIZWFkZXInLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIudGFnTmFtZSkudG9CZSgnRElWJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdtZXRhZGF0YS1oZWFkZXJmaWVsZCcpKS50b0JlKHRydWUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgZmllbGRDb250YWluZXIgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmZpZWxkLWNvbnRhaW5lcicpO1xyXG4gICAgICAgICAgICBleHBlY3QoZmllbGRDb250YWluZXIpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBhcHBseSBjdXN0b20gc2l6ZSB0byBoZWFkZXIgZWxlbWVudHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGhlYWRlclByb3BlcnR5LmZpbGxEaXNwbGF5KHt9LCAnVGVzdCBIZWFkZXInLCBtb2NrVXBkYXRlLCB7IHNpemU6ICczZW0nIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgbGluayA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZmllbGQtaGVhZGVybGluaycpIGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZmllbGQtaGVhZGVyJykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChsaW5rPy5zdHlsZS5mb250U2l6ZSkudG9CZSgnM2VtJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChpbnB1dD8uc3R5bGUuZm9udFNpemUpLnRvQmUoJzNlbScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHVzZSBkZWZhdWx0IHNpemUgd2hlbiBubyBzaXplIHNwZWNpZmllZCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gaGVhZGVyUHJvcGVydHkuZmlsbERpc3BsYXkoe30sICdUZXN0IEhlYWRlcicsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgbGluayA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZmllbGQtaGVhZGVybGluaycpIGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZmllbGQtaGVhZGVyJykgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChsaW5rPy5zdHlsZS5mb250U2l6ZSkudG9CZSgnMmVtJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChpbnB1dD8uc3R5bGUuZm9udFNpemUpLnRvQmUoJzJlbScpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NyZWF0ZUZpZWxkSW5wdXQnLCAoKSA9PiB7XHJcbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGhlYWRlclByb3BlcnR5ID0gbmV3IEhlYXJkZXJQcm9wZXJ0eSgndGVzdEhlYWRlcicpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBpbnB1dCBlbGVtZW50IHdpdGggaGVhZGVyIGNsYXNzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGhlYWRlclByb3BlcnR5LmNyZWF0ZUZpZWxkSW5wdXQoJ1Rlc3QgVmFsdWUnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChpbnB1dC50YWdOYW1lKS50b0JlKCdJTlBVVCcpO1xyXG4gICAgICAgICAgICBleHBlY3QoaW5wdXQudHlwZSkudG9CZSgndGV4dCcpO1xyXG4gICAgICAgICAgICBleHBlY3QoaW5wdXQudmFsdWUpLnRvQmUoJ1Rlc3QgVmFsdWUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGlucHV0LmNsYXNzTGlzdC5jb250YWlucygnZmllbGQtaGVhZGVyJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGlucHV0IHdpdGggZW1wdHkgdmFsdWUgd2hlbiBubyB2YWx1ZSBwcm92aWRlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBoZWFkZXJQcm9wZXJ0eS5jcmVhdGVGaWVsZElucHV0KCcnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChpbnB1dC52YWx1ZSkudG9CZSgnJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bGwvdW5kZWZpbmVkIHZhbHVlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGhlYWRlclByb3BlcnR5LmNyZWF0ZUZpZWxkSW5wdXQobnVsbCBhcyBhbnkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGlucHV0LnZhbHVlKS50b0JlKCcnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjcmVhdGVGaWVsZENvbnRhaW5lcicsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgaGVhZGVyUHJvcGVydHkgPSBuZXcgSGVhcmRlclByb3BlcnR5KCd0ZXN0SGVhZGVyJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGNvbnRhaW5lciB3aXRoIG1ldGFkYXRhLWhlYWRlcmZpZWxkIGNsYXNzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBoZWFkZXJQcm9wZXJ0eS5jcmVhdGVGaWVsZENvbnRhaW5lcigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci50YWdOYW1lKS50b0JlKCdESVYnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ21ldGFkYXRhLWhlYWRlcmZpZWxkJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY3JlYXRlRmllbGRMaW5rJywgKCkgPT4ge1xyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICBoZWFkZXJQcm9wZXJ0eSA9IG5ldyBIZWFyZGVyUHJvcGVydHkoJ3Rlc3RIZWFkZXInKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgaDIgZWxlbWVudCB3aXRoIGhlYWRlciBsaW5rIGNsYXNzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gaGVhZGVyUHJvcGVydHkuY3JlYXRlRmllbGRMaW5rKCdUZXN0IEhlYWRlcicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGxpbmsudGFnTmFtZSkudG9CZSgnSDInKTtcclxuICAgICAgICAgICAgZXhwZWN0KGxpbmsuaW5uZXJIVE1MKS50b0JlKCdUZXN0IEhlYWRlcicpO1xyXG4gICAgICAgICAgICBleHBlY3QobGluay5jbGFzc0xpc3QuY29udGFpbnMoJ2ZpZWxkLWhlYWRlcmxpbmsnKSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KGxpbmsuc3R5bGUuY3Vyc29yKS50b0JlKCd0ZXh0Jyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGxpbmsgd2l0aCBlbXB0eSBjb250ZW50IHdoZW4gbm8gdmFsdWUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBoZWFkZXJQcm9wZXJ0eS5jcmVhdGVGaWVsZExpbmsoJycpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGxpbmsuaW5uZXJIVE1MKS50b0JlKCcnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBzZXQgY3Vyc29yIHRvIGRlZmF1bHQgd2hlbiBzdGF0aWMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGhlYWRlclByb3BlcnR5LnN0YXRpYyA9IHRydWU7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBoZWFkZXJQcm9wZXJ0eS5jcmVhdGVGaWVsZExpbmsoJ1Rlc3QgSGVhZGVyJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobGluay5zdHlsZS5jdXJzb3IpLnRvQmUoJ2RlZmF1bHQnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2xpY2sgZXZlbnQgdG8gdHJpZ2dlciBtb2RpZnlGaWVsZCB3aGVuIG5vdCBzdGF0aWMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oaGVhZGVyUHJvcGVydHksICdtb2RpZnlGaWVsZCcpO1xyXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gaGVhZGVyUHJvcGVydHkuY3JlYXRlRmllbGRMaW5rKCdUZXN0IEhlYWRlcicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbGluay5jbGljaygpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ2NsaWNrJ1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgbm90IGFkZCBjbGljayBsaXN0ZW5lciB3aGVuIHN0YXRpYycsICgpID0+IHtcclxuICAgICAgICAgICAgaGVhZGVyUHJvcGVydHkuc3RhdGljID0gdHJ1ZTtcclxuICAgICAgICAgICAgY29uc3Qgc3B5ID0gamVzdC5zcHlPbihoZWFkZXJQcm9wZXJ0eSwgJ21vZGlmeUZpZWxkJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBoZWFkZXJQcm9wZXJ0eS5jcmVhdGVGaWVsZExpbmsoJ1Rlc3QgSGVhZGVyJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBsaW5rLmNsaWNrKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3Qoc3B5KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ21vZGlmeUZpZWxkJywgKCkgPT4ge1xyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICBoZWFkZXJQcm9wZXJ0eSA9IG5ldyBIZWFyZGVyUHJvcGVydHkoJ3Rlc3RIZWFkZXInKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBzd2l0Y2ggZnJvbSBsaW5rIHRvIGlucHV0IG9uIGV2ZW50JywgKCkgPT4ge1xyXG4gICAgICAgICAgICAvLyBDcsOpZXIgbGEgc3RydWN0dXJlIERPTSBhdHRlbmR1ZVxyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ21ldGFkYXRhLWhlYWRlcmZpZWxkJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBmaWVsZENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBmaWVsZENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdmaWVsZC1jb250YWluZXInKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gICAgICAgICAgICBsaW5rLmNsYXNzTGlzdC5hZGQoJ2ZpZWxkLWhlYWRlcmxpbmsnKTtcclxuICAgICAgICAgICAgbGluay50ZXh0Q29udGVudCA9ICdUZXN0IEhlYWRlcic7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ2ZpZWxkLWhlYWRlcicpO1xyXG4gICAgICAgICAgICBpbnB1dC52YWx1ZSA9ICdUZXN0IEhlYWRlcic7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChsaW5rKTtcclxuICAgICAgICAgICAgZmllbGRDb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpO1xyXG4gICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZmllbGRDb250YWluZXIpO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBmb2N1c1NweSA9IGplc3Quc3B5T24oaW5wdXQsICdmb2N1cycpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gw4l0YXQgaW5pdGlhbFxyXG4gICAgICAgICAgICBsaW5rLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICAgICAgICBpbnB1dC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQ3LDqWVyIGwnw6l2w6luZW1lbnQgYXZlYyB0YXJnZXQgPSBsaW5rXHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0ge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiBsaW5rXHJcbiAgICAgICAgICAgIH0gYXMgdW5rbm93biBhcyBFdmVudDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGhlYWRlclByb3BlcnR5Lm1vZGlmeUZpZWxkKGV2ZW50KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChsaW5rLnN0eWxlLmRpc3BsYXkpLnRvQmUoJ25vbmUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGlucHV0LnN0eWxlLmRpc3BsYXkpLnRvQmUoJ2Jsb2NrJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb2N1c1NweSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXNzaW5nIGVsZW1lbnRzIGdyYWNlZnVsbHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0ge1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxyXG4gICAgICAgICAgICB9IGFzIHVua25vd24gYXMgRXZlbnQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBOZSBkZXZyYWl0IHBhcyBsZXZlciBkJ2VycmV1clxyXG4gICAgICAgICAgICBleHBlY3QoKCkgPT4gaGVhZGVyUHJvcGVydHkubW9kaWZ5RmllbGQoZXZlbnQpKS5ub3QudG9UaHJvdygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2hhbmRsZUZpZWxkSW5wdXQnLCAoKSA9PiB7XHJcbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGhlYWRlclByb3BlcnR5ID0gbmV3IEhlYXJkZXJQcm9wZXJ0eSgndGVzdEhlYWRlcicpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBibHVyIGV2ZW50JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcclxuICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHNweSA9IGplc3Quc3B5T24oaGVhZGVyUHJvcGVydHksICd1cGRhdGVGaWVsZCcpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBoZWFkZXJQcm9wZXJ0eS5oYW5kbGVGaWVsZElucHV0KG1vY2tVcGRhdGUsIGlucHV0LCBsaW5rKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNpbXVsZXIgbCfDqXbDqW5lbWVudCBibHVyXHJcbiAgICAgICAgICAgIGNvbnN0IGJsdXJFdmVudCA9IG5ldyBFdmVudCgnYmx1cicpO1xyXG4gICAgICAgICAgICBpbnB1dC5kaXNwYXRjaEV2ZW50KGJsdXJFdmVudCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBBdHRlbmRyZSBxdWUgbGVzIHByb21lc3NlcyBzZSByw6lzb2x2ZW50XHJcbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAwKSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrVXBkYXRlLCBpbnB1dCwgbGluayk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgYWRkIGtleWRvd24gZXZlbnQgaGFuZGxlcicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xyXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGhlYWRlclByb3BlcnR5LmhhbmRsZUZpZWxkSW5wdXQobW9ja1VwZGF0ZSwgaW5wdXQsIGxpbmspO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGlucHV0Lm9ua2V5ZG93bikudG9CZURlZmluZWQoKTtcclxuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBpbnB1dC5vbmtleWRvd24pLnRvQmUoJ2Z1bmN0aW9uJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgYWRkIGJsdXIgZXZlbnQgaGFuZGxlcicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xyXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGhlYWRlclByb3BlcnR5LmhhbmRsZUZpZWxkSW5wdXQobW9ja1VwZGF0ZSwgaW5wdXQsIGxpbmspO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGlucHV0Lm9uYmx1cikudG9CZURlZmluZWQoKTtcclxuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiBpbnB1dC5vbmJsdXIpLnRvQmUoJ2Z1bmN0aW9uJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgbm90IGhhbmRsZSBvdGhlciBrZXkgcHJlc3NlcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gICAgICAgICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKGhlYWRlclByb3BlcnR5LCAndXBkYXRlRmllbGQnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaGVhZGVyUHJvcGVydHkuaGFuZGxlRmllbGRJbnB1dChtb2NrVXBkYXRlLCBpbnB1dCwgbGluayk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTaW11bGVyIGwnYXBwdWkgc3VyIHVuZSBhdXRyZSB0b3VjaGVcclxuICAgICAgICAgICAgY29uc3Qgb3RoZXJLZXlFdmVudCA9IG5ldyBLZXlib2FyZEV2ZW50KCdrZXlkb3duJywgeyBrZXk6ICdhJyB9KTtcclxuICAgICAgICAgICAgaW5wdXQuZGlzcGF0Y2hFdmVudChvdGhlcktleUV2ZW50KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEF0dGVuZHJlIHF1ZSBsZXMgcHJvbWVzc2VzIHNlIHLDqXNvbHZlbnRcclxuICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDApKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChzcHkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9