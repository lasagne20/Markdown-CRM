{"file":"C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\properties\\FileProperty.ts","mappings":"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","names":[],"sources":["C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\properties\\FileProperty.ts"],"sourcesContent":["import { File } from \"../vault/File\";\r\nimport { Property } from \"./Property\";\r\nimport { Classe } from \"../vault/Classe\";\r\nimport { LinkProperty } from \"./LinkProperty\";\r\nimport { val } from \"cheerio/dist/commonjs/api/attributes\";\r\nimport { Vault } from \"../vault/Vault\";\r\n\r\n\r\nexport class FileProperty extends LinkProperty{\r\n\r\n    public classes : string[];\r\n    public override type : string = \"file\";\r\n    // Used for property with a single file\r\n    constructor(name : string, vault: Vault, classes: string[], args= {}){\r\n      super(name, vault, args);\r\n      this.classes = classes;\r\n    }\r\n\r\n    getClasses() : string[] {\r\n      return this.classes\r\n    }\r\n\r\n    override getPretty(value: string) {\r\n      return this.vault.readLinkFile(value)\r\n    }\r\n\r\n    async getClasse(file : File): Promise<Classe | undefined>{\r\n      let link = this.read(file);\r\n      if (link) {\r\n        let classe = await this.vault.getFromLink(link);\r\n        if (classe) {\r\n          return classe;\r\n        }\r\n      }\r\n      return undefined;\r\n    }\r\n\r\n    override validate(value: string): string {\r\n      // Expression régulière pour détecter les liens Obsidian au format [[...]]\r\n      const regex = /\\[\\[([^\\]]+)\\]\\]/;\r\n      const match = value.match(regex);\r\n      if (match && match[1]) {\r\n          return `[[${match[1]}]]`;\r\n      }\r\n      return \"\";\r\n   }\r\n\r\n   override getLink(value: string, vault? : any): string {\r\n    if (vault) {\r\n      this.vault = vault;\r\n    }\r\n    const vaultName = this.vault.getName(); \r\n    const filePath = this.vault.readLinkFile(value, true);\r\n\r\n    // If readLinkFile returned a path and the file exists in the vault, use it.\r\n    if (filePath) {\r\n      return `obsidian://open?vault=${encodeURIComponent(vaultName)}&file=${encodeURIComponent(filePath)}`;\r\n    }\r\n\r\n    // Fallback: extract the name only from the link\r\n    const nameOnly = this.vault.readLinkFile(value);\r\n    return `obsidian://open?vault=${encodeURIComponent(vaultName)}&file=${encodeURIComponent(nameOnly)}`;\r\n   }\r\n  \r\n   override createIconContainer(update: (value: string) => Promise<void>) {\r\n    const iconContainer = document.createElement(\"div\");\r\n    iconContainer.classList.add(\"icon-container\");\r\n\r\n    const icon = document.createElement(\"div\");\r\n    this.vault.app.setIcon(icon, this.icon);\r\n    iconContainer.appendChild(icon);\r\n\r\n    if (!this.static) {\r\n      icon.style.cursor = \"pointer\";\r\n      iconContainer.addEventListener(\"click\", async (event) => await this.handleIconClick(update, event));\r\n    }\r\n    \r\n    return iconContainer;\r\n    }\r\n\r\n    // Fonction pour gérer le clic sur l'icône\r\n    async handleIconClick(update: (value: string) => Promise<void>, event: Event) {\r\n        let selectedFileObj = await this.vault.app.selectFile(this.vault, this.classes, {hint:\"Choisissez un fichier \" + this.getClasses().join(\" ou \")});\r\n        if (selectedFileObj){\r\n          const selectedFile = selectedFileObj.getLink();\r\n          await update(selectedFile)\r\n          const link = (event.target as HTMLElement).closest('.metadata-field')?.querySelector('.field-link') as HTMLElement;\r\n            if (link) {\r\n              link.textContent = selectedFile.slice(2, -2);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Fonction pour gérer le clic sur l'icône\r\n    override async modifyField(event: Event) {\r\n      const link = (event.target as HTMLElement).closest('.metadata-field')?.querySelector('.field-link') as HTMLElement;\r\n      let currentField = link.textContent\r\n      if (!currentField){return}\r\n      event.preventDefault();\r\n     \r\n      const classe = await this.vault.getFromLink(currentField);\r\n      if (classe) {\r\n        let path = classe.getPath()\r\n        if (path){\r\n           await this.vault.app.open(path);\r\n         }\r\n      } else {\r\n        console.error(`Le fichier ${currentField}.md n'existe pas`) // TODO: Use Notice when available\r\n      }\r\n    }\r\n    // Fonction pour créer le conteneur principal pour l'field\r\n    override createFieldContainerContent(update: (value: string) => Promise<void>, value: string) {\r\n        const fieldContainer = document.createElement(\"div\");\r\n        fieldContainer.classList.add(\"field-container\");\r\n        const currentField = this.getPretty(value);\r\n        const link = document.createElement(\"a\");\r\n        link.href = this.getLink(value);\r\n        link.textContent = currentField || \"\";\r\n        link.classList.add(\"field-link\");\r\n        link.style.display = \"block\"\r\n        fieldContainer.appendChild(link);\r\n\r\n        return fieldContainer;\r\n    }\r\n\r\n}"],"version":3}