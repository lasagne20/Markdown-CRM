{"file":"C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\properties\\RangeDateProperty.ts","mappings":";;;;;;AAAA,0DAAkC;AAClC,qCAAmC;AACnC,iDAA8C;AAI9C,MAAa,iBAAkB,SAAQ,2BAAY;IAG/C,YAAY,IAAY,EAAE,KAAY,EAAE,IAAI,GAAG,EAAE;QAC7C,KAAK,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,EAAE,IAAI,CAAC,CAAC;QAFjB,SAAI,GAAY,WAAW,CAAC;IAG5C,CAAC;IAEQ,eAAe,CAAC,KAAa,EAAE,MAAwC,EAAE,IAAoB;QAClG,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;QAC9C,KAAK,CAAC,IAAI,GAAG,MAAM,CAAC;QACpB,KAAK,CAAC,KAAK,GAAG,KAAK,IAAI,EAAE,CAAC,CAAE,2CAA2C;QACvE,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QAEnC,IAAA,mBAAS,EAAC,KAAK,EAAE;YACb,UAAU,EAAE,OAAO,EAAG,0BAA0B;YAChD,WAAW,EAAE,KAAK,IAAI,EAAE;YACxB,MAAM,EAAE,IAAI,EAAG,sDAAsD;YACrE,IAAI,EAAE,OAAO,EAAG,4CAA4C;YAC5D,QAAQ,EAAE,KAAK,EAAE,aAAqB,EAAE,EAAE;gBACtC,IAAI,aAAa,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;oBAC7B,MAAM,SAAS,GAAG,aAAa,CAAC,CAAC,CAAC,CAAC;oBACnC,MAAM,OAAO,GAAG,aAAa,CAAC,CAAC,CAAC,CAAC;oBACjC,IAAI,SAAS,IAAI,OAAO,EAAE,CAAC;wBACvB,4EAA4E;wBAC5E,IAAI,SAAS,CAAC,OAAO,EAAE,KAAK,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC;4BAC5C,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,CAAC;wBACvD,CAAC;6BAAM,CAAC;4BACJ,KAAK,CAAC,KAAK,GAAG,GAAG,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,OAAO,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,EAAE,CAAC;wBACrG,CAAC;wBACD,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;oBAChD,CAAC;gBACL,CAAC;YACL,CAAC;YACD,OAAO,EAAE,KAAK,IAAI,EAAE,CAAC,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,CAAC;SACnE,CAAC,CAAC;QAEH,OAAO,KAAK,CAAC;IACjB,CAAC;IACD,8FAA8F;IACrF,eAAe,CAAC,KAAa;QAClC,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC3C,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,0BAA0B,CAAC;QAC9F,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;QACtC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;QACjC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,SAAS,CAAC;QAC9B,IAAI,CAAC,OAAO,GAAG,CAAC,KAAK,EAAE,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAClD,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,yGAAyG;IACzG,yBAAyB,CAAC,SAAiB;QACvC,MAAM,CAAC,SAAS,EAAE,OAAO,CAAC,GAAG,SAAS,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QACrD,MAAM,kBAAkB,GAAG,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,kBAAkB,CAAC,OAAO,EAAE;YACvE,OAAO,EAAE,MAAM;YACf,GAAG,EAAE,SAAS;YACd,KAAK,EAAE,MAAM;YACb,IAAI,EAAE,SAAS;SAClB,CAAC,CAAC;QACH,IAAI,CAAC,OAAO,EAAE,CAAC;YACX,OAAO,GAAG,kBAAkB,EAAE,CAAC;QACnC,CAAC;QACD,MAAM,gBAAgB,GAAG,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,kBAAkB,CAAC,OAAO,EAAE;YACnE,OAAO,EAAE,MAAM;YACf,GAAG,EAAE,SAAS;YACd,KAAK,EAAE,MAAM;YACb,IAAI,EAAE,SAAS;SAClB,CAAC,CAAC;QACH,OAAO,GAAG,kBAAkB,OAAO,gBAAgB,EAAE,CAAC;IAC1D,CAAC;IAED,2EAA2E;IAClE,2BAA2B,CAAC,MAAwC,EAAE,KAAa;QACxF,MAAM,cAAc,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QACrD,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;QAChD,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QAE/C,MAAM,YAAY,GAAG,KAAK,CAAC;QAC3B,MAAM,IAAI,GAAG,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;QAChD,MAAM,KAAK,GAAG,IAAI,CAAC,eAAe,CAAC,YAAY,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;QAE/D,oEAAoE;QACpE,IAAI,YAAY,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,CAAC;YACvC,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;YAC7B,KAAK,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QACjC,CAAC;aAAM,CAAC;YACJ,KAAK,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;YAC9B,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QAChC,CAAC;QAED,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QACjC,cAAc,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAElC,OAAO,cAAc,CAAC;IAC1B,CAAC;IAED,4FAA4F;IACnF,KAAK,CAAC,WAAW,CAAC,MAAwC,EAAE,KAAuB,EAAE,IAAiB;QAC3G,IAAI,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACvC,IAAI,KAAK,EAAE,CAAC;YACR,MAAM,MAAM,CAAC,KAAK,CAAC,CAAC,CAAE,yEAAyE;YAC/F,KAAK,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;YAC7B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,CAAC,CAAE,oCAAoC;YAC/F,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;QACjC,CAAC;aAAM,CAAC;YACJ,MAAM,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAC9B,CAAC;IACL,CAAC;IAED,gEAAgE;IACvD,QAAQ,CAAC,KAAa;QAC3B,MAAM,cAAc,GAAG,6CAA6C,CAAC;QACrE,OAAO,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;IACnD,CAAC;IAGD,qFAAqF;IAC9E,MAAM,CAAC,gBAAgB,CAAE,OAAe;QAC/C,8DAA8D;QAC9D,MAAM,OAAO,GAA8B;YACvC,SAAS,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC;YACtE,SAAS,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,WAAW,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,UAAU,EAAE,EAAE,EAAE,UAAU,EAAE,EAAE;SACtF,CAAC;QACJ,MAAM,KAAK,GAAG,yBAAyB,CAAC;QACxC,MAAM,iBAAiB,GAAG,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAC,CAAC,iBAAiB;QACrG,MAAM,KAAK,GAAG,iBAAiB,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAE7C,IAAI,KAAK,EAAE,CAAC;YACR,MAAM,CAAC,EAAE,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,GAAG,KAAK,CAAC;YACnC,MAAM,SAAS,GAAG,OAAO,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;YAE/C,IAAI,SAAS,KAAK,SAAS,EAAE,CAAC;gBAC9B,OAAO,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC;YAC1D,CAAC;QACL,CAAC;QAED,OAAO,IAAI,CAAC;IACZ,CAAC;IAAA,CAAC;CACL;AAzID,8CAyIC","names":[],"sources":["C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\properties\\RangeDateProperty.ts"],"sourcesContent":["import flatpickr from \"flatpickr\";\r\nimport \"flatpickr/dist/l10n/fr.js\";\r\nimport { DateProperty } from \"./DateProperty\";\r\nimport { Vault } from \"../vault/Vault\";\r\n\r\n\r\nexport class RangeDateProperty extends DateProperty {\r\n\r\n    public override type : string = \"dateRange\";\r\n    constructor(name: string, vault: Vault, args = {}) {\r\n        super(name, vault, [], args);\r\n    }\r\n\r\n    override createFieldDate(value: string, update: (value: string) => Promise<void>, link: HTMLDivElement) {\r\n        const input = document.createElement(\"input\");\r\n        input.type = \"text\";\r\n        input.value = value || \"\";  // Formaté en \"YYYY-MM-DD\" pour le stockage\r\n        input.classList.add(\"field-input\");\r\n    \r\n        flatpickr(input, {\r\n            dateFormat: \"Y-m-d\",  // Stocker en \"YYYY-MM-DD\"\r\n            defaultDate: value || \"\",\r\n            locale: \"fr\",  // Utilisation de la langue française pour l'affichage\r\n            mode: \"range\",  // Permet de sélectionner une plage de dates\r\n            onChange: async (selectedDates: Date[]) => {\r\n                if (selectedDates.length === 2) {\r\n                    const startDate = selectedDates[0];\r\n                    const endDate = selectedDates[1];\r\n                    if (startDate && endDate) {\r\n                        // Met à jour la valeur de l'input avec le format \"YYYY-MM-DD to YYYY-MM-DD\"\r\n                        if (startDate.getTime() === endDate.getTime()) {\r\n                            input.value = this.formatDateForStorage(startDate);\r\n                        } else {\r\n                            input.value = `${this.formatDateForStorage(startDate)} to ${this.formatDateForStorage(endDate)}`;\r\n                        }\r\n                        await this.updateField(update, input, link);\r\n                    }\r\n                }\r\n            },\r\n            onClose: async () => await this.updateField(update, input, link)\r\n        });\r\n    \r\n        return input;\r\n    }\r\n    // Crée un lien qui affiche la plage de dates (au format \"26 février 2025 au 28 février 2025\")\r\n    override createFieldLink(value: string) {\r\n        const link = document.createElement(\"div\");\r\n        link.textContent = value ? this.formatDateRangeForDisplay(value) : \"Aucune date sélectionnée\";\r\n        link.classList.add(\"date-field-link\");\r\n        link.classList.add(\"field-link\");\r\n        link.style.cursor = \"pointer\";\r\n        link.onclick = (event) => this.modifyField(event);\r\n        return link;\r\n    }\r\n\r\n    // Formate la plage de dates pour l'affichage : \"26 février 2025\" ou \"26 février 2025 au 28 février 2025\"\r\n    formatDateRangeForDisplay(dateRange: string): string {\r\n        const [startDate, endDate] = dateRange.split(\" to \");\r\n        const formattedStartDate = new Date(startDate).toLocaleDateString(\"fr-FR\", { \r\n            weekday: \"long\",\r\n            day: \"numeric\", \r\n            month: \"long\", \r\n            year: \"numeric\" \r\n        });\r\n        if (!endDate) {\r\n            return `${formattedStartDate}`;\r\n        }\r\n        const formattedEndDate = new Date(endDate).toLocaleDateString(\"fr-FR\", { \r\n            weekday: \"long\",\r\n            day: \"numeric\", \r\n            month: \"long\", \r\n            year: \"numeric\" \r\n        });\r\n        return `${formattedStartDate} au ${formattedEndDate}`;\r\n    }\r\n\r\n    // Crée un conteneur pour afficher la plage de dates et la sélection rapide\r\n    override createFieldContainerContent(update: (value: string) => Promise<void>, value: string): HTMLDivElement {\r\n        const fieldContainer = document.createElement(\"div\");\r\n        fieldContainer.classList.add(\"field-container\");\r\n        fieldContainer.classList.add(\"metadata-field\");\r\n\r\n        const currentField = value;\r\n        const link = this.createFieldLink(currentField);\r\n        const input = this.createFieldDate(currentField, update, link);\r\n\r\n        // Affichage initial : Si la plage de dates existe, afficher le lien\r\n        if (currentField && this.validate(value)) {\r\n            link.style.display = \"block\";\r\n            input.style.display = \"none\";\r\n        } else {\r\n            input.style.display = \"block\";\r\n            link.style.display = \"none\";\r\n        }\r\n\r\n        fieldContainer.appendChild(link);\r\n        fieldContainer.appendChild(input);\r\n\r\n        return fieldContainer;\r\n    }\r\n\r\n    // Met à jour la valeur de la plage de dates et bascule l'affichage entre le lien et l'input\r\n    override async updateField(update: (value: string) => Promise<void>, input: HTMLInputElement, link: HTMLElement) {\r\n        let value = this.validate(input.value);\r\n        if (value) {\r\n            await update(value);  // Met à jour avec la plage de dates au format \"YYYY-MM-DD to YYYY-MM-DD\"\r\n            input.style.display = \"none\";\r\n            link.textContent = this.formatDateRangeForDisplay(value);  // Affichage avec le mois en lettres\r\n            link.style.display = \"block\";\r\n        } else {\r\n            await update(input.value);\r\n        }\r\n    }\r\n\r\n    // Valide la plage de dates au format \"YYYY-MM-DD to YYYY-MM-DD\"\r\n    override validate(value: string): string {\r\n        const dateRangeRegex = /^\\d{4}-\\d{2}-\\d{2}( to \\d{4}-\\d{2}-\\d{2})?$/;\r\n        return dateRangeRegex.test(value) ? value : \"\";\r\n    }\r\n\r\n\r\n    // Fonction pour extraire la première date d'une chaîne et la convertir en objet Date\r\n    public static extractFirstDate (dateStr: string): Date | null {\r\n    // Regex pour trouver la première date (ex: \"26 janvier 2025\")\r\n    const moisMap: { [key: string]: number } = {\r\n        \"janvier\": 0, \"fevrier\": 1, \"mars\": 2, \"avril\": 3, \"mai\": 4, \"juin\": 5,\r\n        \"juillet\": 6, \"aout\": 7, \"septembre\": 8, \"octobre\": 9, \"novembre\": 10, \"décembre\": 11\r\n      };\r\n    const regex = /(\\d{1,2}) (\\w+) (\\d{4})/;\r\n    const normalizedDateStr = dateStr.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"); // Remove accents\r\n    const match = normalizedDateStr.match(regex);\r\n    \r\n    if (match) {\r\n        const [, day, month, year] = match;\r\n        const moisIndex = moisMap[month.toLowerCase()];\r\n    \r\n        if (moisIndex !== undefined) {\r\n        return new Date(parseInt(year), moisIndex, parseInt(day));\r\n        }\r\n    }\r\n    \r\n    return null;\r\n    };\r\n}\r\n"],"version":3}