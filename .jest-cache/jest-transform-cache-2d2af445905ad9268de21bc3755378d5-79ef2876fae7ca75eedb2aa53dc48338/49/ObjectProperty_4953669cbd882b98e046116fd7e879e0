7d6794cdb71778ad024602236322ac96
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ObjectProperty = void 0;
const Property_1 = require("./Property");
const Utils_1 = require("../vault/Utils");
const FileProperty_1 = require("./FileProperty");
class ObjectProperty extends Property_1.Property {
    constructor(name, properties, args = {}) {
        super(name, args);
        this.type = "object";
        this.flexSpan = 2;
        this.appendFirst = false;
        this.allowMove = true;
        this.display = "object"; // Can be "object", "table" or "list"
        this.appendFirst = args?.appendFirst || false;
        this.properties = properties;
        this.allowMove = args?.allowMove || true;
        // Assign any additional arguments to the instance
        Object.assign(this, args);
    }
    getClasses() {
        for (let prop of Object.values(this.properties)) {
            if (prop instanceof FileProperty_1.FileProperty || prop instanceof ObjectProperty || prop.type == "multiFile") {
                return prop.getClasses();
            }
        }
        throw new Error("No class found");
    }
    // Used by the ClasseProperty to get the parent file
    getParentValue(values) {
        if (values && values.length) {
            for (let prop of Object.values(this.properties)) {
                if (prop instanceof FileProperty_1.FileProperty || prop instanceof ObjectProperty || prop.type == "multiFile") {
                    return prop.getParentValue(values[0][prop.name]);
                }
            }
        }
        return undefined;
    }
    findValue(file, value, propertyName) {
        let values = this.read(file);
        if (values && values.length) {
            for (let i = 0; i < values.length; i++) {
                for (let prop of Object.values(this.properties)) {
                    let propValue = values[i][prop.name];
                    if (propValue && (propValue == value || (typeof propValue === "string" && propValue.includes(value)))) {
                        return values[i][propertyName];
                    }
                }
            }
        }
        return null;
    }
    getDisplayProperties(file, propertyClasseName, propertyName, isStatic = true) {
        let properties = [];
        this.vault = file.vault;
        let values = this.read(file);
        if (!(propertyName in this.properties)) {
            throw new Error("Property " + propertyName + " not found in ObjectProperty " + this.name);
        }
        let property = this.properties[propertyName];
        if (values && values.length) {
            for (let [index, row] of values.entries()) {
                property.static = isStatic;
                let display = property.fillDisplay(this.vault, row[property.name], async (value) => await this.updateObject(values, async (value) => await file.updateMetadata(this.name, value), index, property, value));
                let classe = this.vault.getFromLink(row[this.properties[propertyClasseName].name]);
                properties.push({ classe: classe, display: display });
            }
        }
        return properties;
    }
    formatParentValue(value) {
        let newObject = {};
        Object.values(this.properties).forEach(prop => {
            if (value && prop instanceof FileProperty_1.FileProperty || prop instanceof ObjectProperty || prop.type == "multiFile") {
                newObject[prop.name] = value;
                value = ""; // Only one parent
            }
            else {
                newObject[prop.name] = "";
            }
        });
        return [newObject];
    }
    getDisplay(file, args) {
        this.display = args?.display || this.display;
        return super.getDisplay(file, args);
    }
    // Méthode principale pour obtenir l'affichage
    fillDisplay(vault, values, update) {
        this.vault = vault;
        const container = document.createElement("div");
        container.classList.add("metadata-object-container-" + this.name.toLowerCase());
        // Créer l'en-tête
        this.createHeader(values, update, container);
        if (this.display == "table") {
            this.createTable(values, update, container);
        }
        else {
            // Affichage par défaut (objet)
            this.createObjects(values, update, container);
        }
        // Créer les lignes d'objet
        return container;
    }
    createTable(values, update, container) {
        // Créer un tableau pour les objets
        const tableWrapper = document.createElement("div");
        tableWrapper.style.position = "relative";
        container.appendChild(tableWrapper);
        let addButton = this.createAddButton(values, update, container);
        addButton.style.position = "absolute";
        addButton.style.top = "0";
        addButton.style.right = "0";
        tableWrapper.appendChild(addButton);
        const table = document.createElement("table");
        table.classList.add("metadata-object-table");
        tableWrapper.appendChild(table);
        // Créer l'en-tête du tableau
        const headerRow = document.createElement("tr");
        Object.values(this.properties).forEach(property => {
            const th = document.createElement("th");
            th.textContent = property.name;
            headerRow.appendChild(th);
        });
        // Ajouter une colonne pour le bouton de suppression
        const thDelete = document.createElement("th");
        headerRow.appendChild(thDelete);
        table.appendChild(headerRow);
        if (values && values.length) {
            // Créer les lignes d'objet
            values.forEach((objects, index) => {
                const row = document.createElement("tr");
                Object.values(this.properties).forEach(property => {
                    const td = document.createElement("td");
                    td.appendChild(property.fillDisplay(this.vault, objects[property.name], async (value) => await this.updateObject(values, update, index, property, value)));
                    row.appendChild(td);
                });
                // Cellule pour le bouton de suppression
                const tdDelete = document.createElement("td");
                tdDelete.classList.add("metadata-object-delete-cell");
                const deleteButton = this.createDeleteButton(values, update, index, container);
                deleteButton.classList.add("metadata-object-delete-button");
                tdDelete.appendChild(deleteButton);
                row.appendChild(tdDelete);
                table.appendChild(row);
            });
        }
    }
    // Crée l'en-tête avec les propriétés
    createHeader(values, update, container) {
        const headerRow = document.createElement("div");
        headerRow.classList.add("metadata-object-header-row");
        let title = document.createElement("div");
        title.textContent = this.title ? this.title : this.name + " : ";
        title.classList.add("metadata-header");
        headerRow.appendChild(title);
        // Ajouter le bouton d'ajout
        const addButton = this.createAddButton(values, update, container);
        headerRow.appendChild(addButton);
        container.appendChild(headerRow);
    }
    // Crée le bouton d'ajout d'un nouvel objet
    createAddButton(values, update, container) {
        const addButton = document.createElement("button");
        (0, Utils_1.setIcon)(addButton, "circle-plus");
        addButton.classList.add("metadata-add-button");
        addButton.onclick = async () => await this.addProperty(values, update, container);
        return addButton;
    }
    // Crée les objets et les lignes à afficher
    createObjects(values, update, container) {
        if (!values) {
            return;
        }
        values.forEach((objects, index) => {
            const row = this.createObjectRow(values, update, objects, index, container);
            container.appendChild(row);
        });
        if (this.allowMove) {
            this.enableDragAndDrop(values, update, container);
        }
    }
    // Crée une ligne d'objet avec ses propriétés
    createObjectRow(values, update, objects, index, container) {
        const row = document.createElement("div");
        row.classList.add("metadata-object-row");
        if (this.allowMove) {
            row.draggable = true;
            row.dataset.index = index.toString();
            row.style.cursor = "grab";
        }
        // Ajouter le bouton de suppression
        const deleteButton = this.createDeleteButton(values, update, index, container);
        deleteButton.style.position = "absolute";
        deleteButton.style.top = "0";
        deleteButton.style.right = "0";
        row.style.position = "relative";
        row.appendChild(deleteButton);
        Object.values(this.properties).forEach(property => {
            let value = objects[property.name];
            let propertyContainer = document.createElement("div");
            propertyContainer.classList.add("metadata-object-property");
            if (property.flexSpan) {
                propertyContainer.style.gridColumn = "span " + property.flexSpan;
            }
            const title = document.createElement("div");
            title.textContent = property.name;
            title.classList.add("metadata-title");
            propertyContainer.appendChild(title);
            propertyContainer.appendChild(property.fillDisplay(this.vault, value, async (value) => await this.updateObject(values, update, index, property, value)));
            row.appendChild(propertyContainer);
        });
        return row;
    }
    // Crée un bouton de suppression pour une ligne d'objet
    createDeleteButton(values, update, index, container) {
        const deleteButton = document.createElement("button");
        (0, Utils_1.setIcon)(deleteButton, "circle-minus");
        deleteButton.classList.add("metadata-delete-button");
        deleteButton.onclick = async () => await this.removeProperty(values, update, index, container);
        return deleteButton;
    }
    // Gère le glisser-déposer pour réordonner les objets
    enableDragAndDrop(values, update, container) {
        let draggedElement = null;
        let isEditing = false;
        // Lorsque l'utilisateur clique dans un champ d'édition (input), on active l'édition
        document.addEventListener("focus", (event) => {
            const input = event.target;
            if (input?.classList.contains('field-input')) {
                isEditing = true; // Le champ est en mode édition
            }
        }, true);
        // Lorsque l'utilisateur quitte un champ d'édition (blur), on désactive l'édition
        document.addEventListener("blur", (event) => {
            const input = event.target;
            if (input?.classList.contains('field-input')) {
                isEditing = false; // Le champ n'est plus en mode édition
            }
        }, true);
        container.addEventListener("dragstart", (event) => {
            if (isEditing) {
                event.preventDefault();
                return;
            }
            draggedElement = event.target;
            draggedElement.classList.add("dragging");
        });
        container.addEventListener("dragover", (event) => {
            event.preventDefault();
            const afterElement = this.getDragAfterElement(container, event.clientY);
            if (afterElement == null) {
                container.appendChild(draggedElement);
            }
            else {
                container.insertBefore(draggedElement, afterElement);
            }
        });
        container.addEventListener("dragend", async () => {
            if (!draggedElement)
                return;
            draggedElement.classList.remove("dragging");
            // Récupérer le nouvel ordre des éléments
            await this.updateOrder(values, update, container);
        });
    }
    // Trouver l'élément après lequel insérer (pour le Drag & Drop)
    getDragAfterElement(container, y) {
        const draggableElements = Array.from(container.querySelectorAll(".metadata-object-row:not(.dragging)"));
        const result = draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            return offset < 0 && offset > closest.offset ? { offset, element: child } : closest;
        }, { offset: Number.NEGATIVE_INFINITY, element: null });
        return result.element;
    }
    // Met à jour l'ordre des éléments après un glisser-déposer
    async updateOrder(values, update, container) {
        console.log("Update order");
        let newOrder = [];
        Array.from(container.querySelectorAll(".metadata-object-row")).forEach((row) => {
            // Assurer qu'on travaille avec un HTMLElement pour accéder à dataset
            if (row instanceof HTMLElement && row.dataset.index) {
                let index = parseInt(row.dataset.index);
                newOrder.push(values[index]);
            }
        });
        // Mettre à jour les métadonnées
        await update(newOrder);
        await this.reloadObjects(newOrder, update);
    }
    // Fonction pour supprimer un objet
    async removeProperty(values, update, index, container) {
        console.log("Remove index : ", index);
        values.splice(index, 1);
        await update(values);
        await this.reloadObjects(values, update);
    }
    // Fonction pour ajouter un objet
    async addProperty(values, update, container) {
        console.log("Add new");
        let newObject = {};
        for (let prop of Object.values(this.properties)) {
            let defaultValue = prop.getDefaultValue(this.vault);
            console.log("Default value : ", defaultValue);
            if (Object.values(this.properties)[0] == prop && (prop instanceof FileProperty_1.FileProperty)) {
                prop.vault = this.vault; // Assurez-vous que vault est défini pour le premier FileProperty
                const fileProp = prop; // Cast pour accéder à handleIconClick
                defaultValue = await new Promise(async (resolve) => {
                    await fileProp.handleIconClick(async (value) => {
                        resolve(value);
                        console.log("Default value after click : ", value);
                    }, new MouseEvent("click"));
                });
            }
            console.log("Default value after click : ", defaultValue);
            if (defaultValue == "like-precedent") {
                if (values && values.length) {
                    if (this.appendFirst) {
                        defaultValue = values[0][prop.name];
                    }
                    else {
                        defaultValue = values[values.length - 1][prop.name];
                    }
                }
                else {
                    defaultValue = "";
                }
            }
            newObject[prop.name] = defaultValue;
        }
        ;
        // Valeurs par défaut
        if (!values) {
            values = [];
        }
        if (this.appendFirst) {
            values.unshift(newObject);
        }
        else {
            values.push(newObject);
        }
        await update(values);
        await this.reloadObjects(values, update);
    }
    // Mise à jour des métadonnées
    async updateObject(values, update, index, property, value) {
        console.log("Update index : ", index);
        if (values) {
            values[index][property.name] = value;
        }
        else {
            values = [{ [property.name]: value }];
        }
        console.log("Updated Values : ", values);
        await update(values);
        await this.reloadObjects(values, update);
    }
    // Recharge dynamiquement les objets
    async reloadObjects(values, update) {
        const container = document.querySelector(".metadata-object-container-" + this.name.toLowerCase());
        if (container) {
            container.innerHTML = "";
            // Recréer l'en-tête et les objets
            console.log("Values : ", values);
            this.createHeader(values, update, container);
            if (this.display == "table") {
                this.createTable(values, update, container);
            }
            else {
                // Affichage par défaut (objet)
                this.createObjects(values, update, container);
            }
        }
    }
}
exports.ObjectProperty = ObjectProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE9iamVjdFByb3BlcnR5LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLHlDQUFzQztBQUd0QywwQ0FBeUM7QUFDekMsaURBQThDO0FBSTlDLE1BQWEsY0FBZSxTQUFRLG1CQUFRO0lBVXhDLFlBQVksSUFBWSxFQUFFLFVBQXVDLEVBQUUsT0FBMEUsRUFBRTtRQUMzSSxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBUE4sU0FBSSxHQUFZLFFBQVEsQ0FBQztRQUN6QixhQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLGdCQUFXLEdBQWEsS0FBSyxDQUFDO1FBQzlCLGNBQVMsR0FBYSxJQUFJLENBQUM7UUFDM0IsWUFBTyxHQUFZLFFBQVEsQ0FBQyxDQUFDLHFDQUFxQztRQUlyRSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksRUFBRSxXQUFXLElBQUksS0FBSyxDQUFDO1FBQzlDLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxFQUFFLFNBQVMsSUFBSSxJQUFJLENBQUM7UUFFekMsa0RBQWtEO1FBQ2xELE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRCxVQUFVO1FBQ04sS0FBSyxJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBQyxDQUFDO1lBQzdDLElBQUksSUFBSSxZQUFZLDJCQUFZLElBQUksSUFBSSxZQUFZLGNBQWMsSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLFdBQVcsRUFBQyxDQUFDO2dCQUM1RixPQUFRLElBQVksQ0FBQyxVQUFVLEVBQUUsQ0FBQTtZQUNyQyxD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LE1BQU0sRUFBRSxTQUFTLENBQUMsQ0FBQztZQUNsRCxDQUFDO1FBQ0wsQ0FBQztJQUVMLENBQUM7Q0FDRjtBQXphSCx3Q0F5YUciLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE9iamVjdFByb3BlcnR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQgeyBQcm9wZXJ0eSB9IGZyb20gXCIuL1Byb3BlcnR5XCI7XHJcbmltcG9ydCB7IEZpbGUgfSBmcm9tIFwiLi4vdmF1bHQvRmlsZVwiO1xyXG5pbXBvcnQgeyBNeVZhdWx0IH0gZnJvbSBcIi4uL3ZhdWx0L015VmF1bHRcIjtcclxuaW1wb3J0IHsgc2V0SWNvbiB9IGZyb20gXCIuLi92YXVsdC9VdGlsc1wiO1xyXG5pbXBvcnQgeyBGaWxlUHJvcGVydHkgfSBmcm9tIFwiLi9GaWxlUHJvcGVydHlcIjtcclxuaW1wb3J0IHsgVGV4dFByb3BlcnR5IH0gZnJvbSBcIi4vVGV4dFByb3BlcnR5XCI7XHJcbmltcG9ydCB7IE11bHRpRmlsZVByb3BlcnR5IH0gZnJvbSBcIi4vTXVsdGlGaWxlUHJvcGVydHlcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBPYmplY3RQcm9wZXJ0eSBleHRlbmRzIFByb3BlcnR5e1xyXG4gICAgLy8gVXNlZCBmb3IgcHJvcGVydHkgb2JqZWN0XHJcblxyXG4gICAgcHVibGljIHByb3BlcnRpZXMgOiB7W2tleSA6IHN0cmluZ10gOiBQcm9wZXJ0eX07XHJcbiAgICBwdWJsaWMgb3ZlcnJpZGUgdHlwZSA6IHN0cmluZyA9IFwib2JqZWN0XCI7XHJcbiAgICBwdWJsaWMgb3ZlcnJpZGUgZmxleFNwYW4gPSAyO1xyXG4gICAgcHVibGljIGFwcGVuZEZpcnN0IDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHVibGljIGFsbG93TW92ZSA6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgcHVibGljIGRpc3BsYXkgOiBzdHJpbmcgPSBcIm9iamVjdFwiOyAvLyBDYW4gYmUgXCJvYmplY3RcIiwgXCJ0YWJsZVwiIG9yIFwibGlzdFwiXHJcblxyXG4gICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCBwcm9wZXJ0aWVzOiB7IFtrZXk6IHN0cmluZ106IFByb3BlcnR5IH0sIGFyZ3M6IHsgYWxsb3dNb3ZlPzogYm9vbGVhbiwgYXBwZW5kRmlyc3Q/OiBib29sZWFuLCBba2V5OiBzdHJpbmddOiBhbnl9ID0ge30pIHtcclxuICAgICAgICBzdXBlcihuYW1lLCBhcmdzKTtcclxuICAgICAgICB0aGlzLmFwcGVuZEZpcnN0ID0gYXJncz8uYXBwZW5kRmlyc3QgfHwgZmFsc2U7XHJcbiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllcztcclxuICAgICAgICB0aGlzLmFsbG93TW92ZSA9IGFyZ3M/LmFsbG93TW92ZSB8fCB0cnVlO1xyXG5cclxuICAgICAgICAvLyBBc3NpZ24gYW55IGFkZGl0aW9uYWwgYXJndW1lbnRzIHRvIHRoZSBpbnN0YW5jZVxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgYXJncyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2xhc3NlcygpOiBzdHJpbmdbXXtcclxuICAgICAgICBmb3IgKGxldCBwcm9wIG9mIE9iamVjdC52YWx1ZXModGhpcy5wcm9wZXJ0aWVzKSl7XHJcbiAgICAgICAgICAgIGlmIChwcm9wIGluc3RhbmNlb2YgRmlsZVByb3BlcnR5IHx8IHByb3AgaW5zdGFuY2VvZiBPYmplY3RQcm9wZXJ0eSB8fCBwcm9wLnR5cGUgPT0gXCJtdWx0aUZpbGVcIil7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKHByb3AgYXMgYW55KS5nZXRDbGFzc2VzKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBjbGFzcyBmb3VuZFwiKVxyXG4gICAgICB9XHJcblxyXG4gICAgLy8gVXNlZCBieSB0aGUgQ2xhc3NlUHJvcGVydHkgdG8gZ2V0IHRoZSBwYXJlbnQgZmlsZVxyXG4gICAgZ2V0UGFyZW50VmFsdWUodmFsdWVzIDogYW55KSA6IEZpbGUgfCB1bmRlZmluZWR7XHJcbiAgICAgICAgaWYgKHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoKXtcclxuICAgICAgICAgIGZvciAobGV0IHByb3Agb2YgT2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnRpZXMpKXtcclxuICAgICAgICAgICAgaWYgKHByb3AgaW5zdGFuY2VvZiBGaWxlUHJvcGVydHkgfHwgcHJvcCBpbnN0YW5jZW9mIE9iamVjdFByb3BlcnR5IHx8IHByb3AudHlwZSA9PSBcIm11bHRpRmlsZVwiKXtcclxuICAgICAgICAgICAgICByZXR1cm4gKHByb3AgYXMgYW55KS5nZXRQYXJlbnRWYWx1ZSh2YWx1ZXNbMF1bcHJvcC5uYW1lXSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmRWYWx1ZShmaWxlOiBhbnksIHZhbHVlOiBzdHJpbmcsIHByb3BlcnR5TmFtZTogc3RyaW5nKTogYW55IHtcclxuICAgICAgICBsZXQgdmFsdWVzID0gdGhpcy5yZWFkKGZpbGUpO1xyXG4gICAgICAgIGlmICh2YWx1ZXMgJiYgdmFsdWVzLmxlbmd0aCl7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBwcm9wIG9mIE9iamVjdC52YWx1ZXModGhpcy5wcm9wZXJ0aWVzKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHByb3BWYWx1ZSA9IHZhbHVlc1tpXVtwcm9wLm5hbWVdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wVmFsdWUgJiYgKHByb3BWYWx1ZSA9PSB2YWx1ZSB8fCAodHlwZW9mIHByb3BWYWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiBwcm9wVmFsdWUuaW5jbHVkZXModmFsdWUpKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlc1tpXVtwcm9wZXJ0eU5hbWVdXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXREaXNwbGF5UHJvcGVydGllcyhmaWxlOiBGaWxlLCBwcm9wZXJ0eUNsYXNzZU5hbWUgOiBzdHJpbmcsIHByb3BlcnR5TmFtZSA6IHN0cmluZywgaXNTdGF0aWM6IGJvb2xlYW4gPSB0cnVlKToge2NsYXNzZSA6IGFueSAsIGRpc3BsYXkgOiBhbnl9W10ge1xyXG4gICAgICAgIGxldCBwcm9wZXJ0aWVzOiB7Y2xhc3NlIDogYW55ICwgZGlzcGxheSA6IGFueX1bXSA9IFtdO1xyXG4gICAgICAgIHRoaXMudmF1bHQgPSBmaWxlLnZhdWx0O1xyXG4gICAgICAgIGxldCB2YWx1ZXMgPSB0aGlzLnJlYWQoZmlsZSk7XHJcbiAgICAgICAgaWYgKCEocHJvcGVydHlOYW1lIGluIHRoaXMucHJvcGVydGllcykpe1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQcm9wZXJ0eSBcIiArIHByb3BlcnR5TmFtZSArIFwiIG5vdCBmb3VuZCBpbiBPYmplY3RQcm9wZXJ0eSBcIiArIHRoaXMubmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBwcm9wZXJ0eSA9IHRoaXMucHJvcGVydGllc1twcm9wZXJ0eU5hbWVdO1xyXG5cclxuICAgICAgICBpZiAodmFsdWVzICYmIHZhbHVlcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICBmb3IgKGxldCBbaW5kZXgsIHJvd10gb2YgdmFsdWVzLmVudHJpZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydHkuc3RhdGljID0gaXNTdGF0aWM7XHJcbiAgICAgICAgICAgICAgICBsZXQgZGlzcGxheSA9IHByb3BlcnR5LmZpbGxEaXNwbGF5KHRoaXMudmF1bHQsIHJvd1twcm9wZXJ0eS5uYW1lXSxcclxuICAgICAgICAgICAgICAgICAgICBhc3luYyAodmFsdWUpID0+IGF3YWl0IHRoaXMudXBkYXRlT2JqZWN0KHZhbHVlcywgYXN5bmMgKHZhbHVlKSA9PiBhd2FpdCBmaWxlLnVwZGF0ZU1ldGFkYXRhKHRoaXMubmFtZSwgdmFsdWUpLCBpbmRleCwgcHJvcGVydHksIHZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGxldCBjbGFzc2UgPSB0aGlzLnZhdWx0LmdldEZyb21MaW5rKHJvd1t0aGlzLnByb3BlcnRpZXNbcHJvcGVydHlDbGFzc2VOYW1lXS5uYW1lXSlcclxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXMucHVzaCh7Y2xhc3NlOiBjbGFzc2UsIGRpc3BsYXkgOiBkaXNwbGF5fSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHByb3BlcnRpZXM7XHJcbiAgICB9XHJcblxyXG4gICAgZm9ybWF0UGFyZW50VmFsdWUodmFsdWUgOiBzdHJpbmcpe1xyXG4gICAgICAgIGxldCBuZXdPYmplY3Q6IGFueSA9IHt9O1xyXG4gICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wcm9wZXJ0aWVzKS5mb3JFYWNoKHByb3AgPT4ge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgJiYgcHJvcCBpbnN0YW5jZW9mIEZpbGVQcm9wZXJ0eSB8fCBwcm9wIGluc3RhbmNlb2YgT2JqZWN0UHJvcGVydHkgfHwgcHJvcC50eXBlID09IFwibXVsdGlGaWxlXCIpe1xyXG4gICAgICAgICAgICAgICAgbmV3T2JqZWN0W3Byb3AubmFtZV0gPSB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBcIlwiIC8vIE9ubHkgb25lIHBhcmVudFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbmV3T2JqZWN0W3Byb3AubmFtZV0gPSBcIlwiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gW25ld09iamVjdF1cclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZSBnZXREaXNwbGF5KGZpbGU6IGFueSwgYXJncz86IHsgc3RhdGljTW9kZT86IGJvb2xlYW47IHRpdGxlPzogc3RyaW5nOyBkaXNwbGF5PyA6IHN0cmluZ30pOiBIVE1MRGl2RWxlbWVudCB7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5ID0gYXJncz8uZGlzcGxheSB8fCB0aGlzLmRpc3BsYXk7XHJcbiAgICAgICAgcmV0dXJuIHN1cGVyLmdldERpc3BsYXkoZmlsZSwgYXJncyk7XHJcbiAgICB9XHJcblxyXG4gICAgIC8vIE3DqXRob2RlIHByaW5jaXBhbGUgcG91ciBvYnRlbmlyIGwnYWZmaWNoYWdlXHJcbiAgICAgb3ZlcnJpZGUgZmlsbERpc3BsYXkodmF1bHQgOiBhbnksIHZhbHVlczogYW55LCB1cGRhdGU6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+KSB7XHJcbiAgICAgICAgdGhpcy52YXVsdCA9IHZhdWx0XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLW9iamVjdC1jb250YWluZXItXCIrdGhpcy5uYW1lLnRvTG93ZXJDYXNlKCkpO1xyXG5cclxuICAgICAgICAvLyBDcsOpZXIgbCdlbi10w6p0ZVxyXG4gICAgICAgIHRoaXMuY3JlYXRlSGVhZGVyKHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5kaXNwbGF5ID09IFwidGFibGVcIikge1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZVRhYmxlKHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gQWZmaWNoYWdlIHBhciBkw6lmYXV0IChvYmpldClcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVPYmplY3RzKHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBDcsOpZXIgbGVzIGxpZ25lcyBkJ29iamV0XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICAgIH1cclxuICAgIGNyZWF0ZVRhYmxlKHZhbHVlczogYW55LCB1cGRhdGU6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KSB7XHJcbiAgICAgICAgLy8gQ3LDqWVyIHVuIHRhYmxlYXUgcG91ciBsZXMgb2JqZXRzXHJcbiAgICAgICAgY29uc3QgdGFibGVXcmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICB0YWJsZVdyYXBwZXIuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRhYmxlV3JhcHBlcik7XHJcblxyXG4gICAgICAgIGxldCBhZGRCdXR0b24gPSB0aGlzLmNyZWF0ZUFkZEJ1dHRvbih2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKVxyXG4gICAgICAgIGFkZEJ1dHRvbi5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcclxuICAgICAgICBhZGRCdXR0b24uc3R5bGUudG9wID0gXCIwXCI7XHJcbiAgICAgICAgYWRkQnV0dG9uLnN0eWxlLnJpZ2h0ID0gXCIwXCI7XHJcbiAgICAgICAgdGFibGVXcmFwcGVyLmFwcGVuZENoaWxkKGFkZEJ1dHRvbik7XHJcblxyXG5cclxuICAgICAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0YWJsZVwiKTtcclxuICAgICAgICB0YWJsZS5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtb2JqZWN0LXRhYmxlXCIpO1xyXG4gICAgICAgIHRhYmxlV3JhcHBlci5hcHBlbmRDaGlsZCh0YWJsZSk7XHJcblxyXG5cclxuICAgICAgICAvLyBDcsOpZXIgbCdlbi10w6p0ZSBkdSB0YWJsZWF1XHJcbiAgICAgICAgY29uc3QgaGVhZGVyUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xyXG4gICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wcm9wZXJ0aWVzKS5mb3JFYWNoKHByb3BlcnR5ID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGhcIik7XHJcbiAgICAgICAgICAgIHRoLnRleHRDb250ZW50ID0gcHJvcGVydHkubmFtZTtcclxuICAgICAgICAgICAgaGVhZGVyUm93LmFwcGVuZENoaWxkKHRoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBBam91dGVyIHVuZSBjb2xvbm5lIHBvdXIgbGUgYm91dG9uIGRlIHN1cHByZXNzaW9uXHJcbiAgICAgICAgY29uc3QgdGhEZWxldGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGhcIik7XHJcbiAgICAgICAgaGVhZGVyUm93LmFwcGVuZENoaWxkKHRoRGVsZXRlKTtcclxuXHJcbiAgICAgICAgdGFibGUuYXBwZW5kQ2hpbGQoaGVhZGVyUm93KTtcclxuXHJcbiAgICAgICAgaWYgKHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIC8vIENyw6llciBsZXMgbGlnbmVzIGQnb2JqZXRcclxuICAgICAgICAgICAgdmFsdWVzLmZvckVhY2goKG9iamVjdHM6IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xyXG4gICAgICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnRpZXMpLmZvckVhY2gocHJvcGVydHkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRkLmFwcGVuZENoaWxkKHByb3BlcnR5LmZpbGxEaXNwbGF5KHRoaXMudmF1bHQsIG9iamVjdHNbcHJvcGVydHkubmFtZV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jICh2YWx1ZSkgPT4gYXdhaXQgdGhpcy51cGRhdGVPYmplY3QodmFsdWVzLCB1cGRhdGUsIGluZGV4LCBwcm9wZXJ0eSwgdmFsdWUpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcm93LmFwcGVuZENoaWxkKHRkKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIENlbGx1bGUgcG91ciBsZSBib3V0b24gZGUgc3VwcHJlc3Npb25cclxuICAgICAgICAgICAgICAgIGNvbnN0IHRkRGVsZXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xyXG4gICAgICAgICAgICAgICAgdGREZWxldGUuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLW9iamVjdC1kZWxldGUtY2VsbFwiKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IHRoaXMuY3JlYXRlRGVsZXRlQnV0dG9uKHZhbHVlcywgdXBkYXRlLCBpbmRleCwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtb2JqZWN0LWRlbGV0ZS1idXR0b25cIik7XHJcbiAgICAgICAgICAgICAgICB0ZERlbGV0ZS5hcHBlbmRDaGlsZChkZWxldGVCdXR0b24pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZCh0ZERlbGV0ZSk7XHJcbiAgICAgICAgICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZChyb3cpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgXHJcbiAgICAgIC8vIENyw6llIGwnZW4tdMOqdGUgYXZlYyBsZXMgcHJvcHJpw6l0w6lzXHJcbiAgICAgIGNyZWF0ZUhlYWRlcih2YWx1ZXMgOiBhbnksIHVwZGF0ZSA6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KSB7XHJcbiAgICAgICAgICBjb25zdCBoZWFkZXJSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgaGVhZGVyUm93LmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1vYmplY3QtaGVhZGVyLXJvd1wiKTtcclxuXHJcbiAgICAgICAgICBsZXQgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSB0aGlzLnRpdGxlID8gdGhpcy50aXRsZSA6IHRoaXMubmFtZSArIFwiIDogXCI7XHJcbiAgICAgICAgICB0aXRsZS5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtaGVhZGVyXCIpO1xyXG4gICAgICAgICAgaGVhZGVyUm93LmFwcGVuZENoaWxkKHRpdGxlKTtcclxuICBcclxuICAgICAgICAgIC8vIEFqb3V0ZXIgbGUgYm91dG9uIGQnYWpvdXRcclxuICAgICAgICAgIGNvbnN0IGFkZEJ1dHRvbiA9IHRoaXMuY3JlYXRlQWRkQnV0dG9uKHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgaGVhZGVyUm93LmFwcGVuZENoaWxkKGFkZEJ1dHRvbik7XHJcbiAgXHJcbiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoaGVhZGVyUm93KTtcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBDcsOpZSBsZSBib3V0b24gZCdham91dCBkJ3VuIG5vdXZlbCBvYmpldFxyXG4gICAgICBjcmVhdGVBZGRCdXR0b24odmFsdWVzIDogYW55LCB1cGRhdGUgOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCk6IEhUTUxCdXR0b25FbGVtZW50IHtcclxuICAgICAgICAgIGNvbnN0IGFkZEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgICBzZXRJY29uKGFkZEJ1dHRvbiwgXCJjaXJjbGUtcGx1c1wiKVxyXG4gICAgICAgICAgYWRkQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1hZGQtYnV0dG9uXCIpO1xyXG4gICAgICAgICAgYWRkQnV0dG9uLm9uY2xpY2sgPSBhc3luYyAoKSA9PiBhd2FpdCB0aGlzLmFkZFByb3BlcnR5KHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgcmV0dXJuIGFkZEJ1dHRvbjtcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBDcsOpZSBsZXMgb2JqZXRzIGV0IGxlcyBsaWduZXMgw6AgYWZmaWNoZXJcclxuICAgICAgY3JlYXRlT2JqZWN0cyh2YWx1ZXM6IGFueSwgdXBkYXRlIDogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sICBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KSB7XHJcbiAgICAgICAgICBpZiAoIXZhbHVlcyl7cmV0dXJufVxyXG4gICAgICAgICAgdmFsdWVzLmZvckVhY2goKG9iamVjdHM6IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IHJvdyA9IHRoaXMuY3JlYXRlT2JqZWN0Um93KHZhbHVlcywgdXBkYXRlLCBvYmplY3RzLCBpbmRleCwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocm93KTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgaWYgKHRoaXMuYWxsb3dNb3ZlKXtcclxuICAgICAgICAgICAgICB0aGlzLmVuYWJsZURyYWdBbmREcm9wKHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICBcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBDcsOpZSB1bmUgbGlnbmUgZCdvYmpldCBhdmVjIHNlcyBwcm9wcmnDqXTDqXNcclxuICAgIGNyZWF0ZU9iamVjdFJvdyh2YWx1ZXMgOiBhbnksIHVwZGF0ZSA6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBvYmplY3RzOiBhbnksIGluZGV4OiBudW1iZXIsIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpOiBIVE1MRGl2RWxlbWVudCB7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICByb3cuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLW9iamVjdC1yb3dcIik7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmFsbG93TW92ZSl7XHJcbiAgICAgICAgICAgIHJvdy5kcmFnZ2FibGUgPSB0cnVlO1xyXG4gICAgICAgICAgICByb3cuZGF0YXNldC5pbmRleCA9IGluZGV4LnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIHJvdy5zdHlsZS5jdXJzb3IgPSBcImdyYWJcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQWpvdXRlciBsZSBib3V0b24gZGUgc3VwcHJlc3Npb25cclxuICAgICAgICBjb25zdCBkZWxldGVCdXR0b24gPSB0aGlzLmNyZWF0ZURlbGV0ZUJ1dHRvbih2YWx1ZXMsIHVwZGF0ZSwgaW5kZXgsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgZGVsZXRlQnV0dG9uLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xyXG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5zdHlsZS50b3AgPSBcIjBcIjtcclxuICAgICAgICBkZWxldGVCdXR0b24uc3R5bGUucmlnaHQgPSBcIjBcIjtcclxuICAgICAgICByb3cuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XHJcbiAgICAgICAgcm93LmFwcGVuZENoaWxkKGRlbGV0ZUJ1dHRvbik7XHJcblxyXG4gICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wcm9wZXJ0aWVzKS5mb3JFYWNoKHByb3BlcnR5ID0+IHtcclxuICAgICAgICAgICAgbGV0IHZhbHVlID0gb2JqZWN0c1twcm9wZXJ0eS5uYW1lXVxyXG4gICAgICAgICAgICBsZXQgcHJvcGVydHlDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBwcm9wZXJ0eUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtb2JqZWN0LXByb3BlcnR5XCIpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHByb3BlcnR5LmZsZXhTcGFuKXtcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5Q29udGFpbmVyLnN0eWxlLmdyaWRDb2x1bW4gPSBcInNwYW4gXCIrcHJvcGVydHkuZmxleFNwYW47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSBwcm9wZXJ0eS5uYW1lO1xyXG4gICAgICAgICAgICB0aXRsZS5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtdGl0bGVcIik7XHJcbiAgICAgICAgICAgIHByb3BlcnR5Q29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcclxuICAgICAgICAgICAgcHJvcGVydHlDb250YWluZXIuYXBwZW5kQ2hpbGQocHJvcGVydHkuZmlsbERpc3BsYXkodGhpcy52YXVsdCwgdmFsdWUsXHJcbiAgICAgICAgICAgICAgICBhc3luYyAodmFsdWUpID0+IGF3YWl0IHRoaXMudXBkYXRlT2JqZWN0KHZhbHVlcywgdXBkYXRlLCBpbmRleCwgcHJvcGVydHksIHZhbHVlKSkpO1xyXG4gICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQocHJvcGVydHlDb250YWluZXIpO1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJvdztcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBDcsOpZSB1biBib3V0b24gZGUgc3VwcHJlc3Npb24gcG91ciB1bmUgbGlnbmUgZCdvYmpldFxyXG4gICAgICBjcmVhdGVEZWxldGVCdXR0b24odmFsdWVzIDogYW55LCB1cGRhdGUgOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgaW5kZXg6IG51bWJlciwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCk6IEhUTUxCdXR0b25FbGVtZW50IHtcclxuICAgICAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgICBzZXRJY29uKGRlbGV0ZUJ1dHRvbiwgXCJjaXJjbGUtbWludXNcIik7XHJcbiAgICAgICAgICBkZWxldGVCdXR0b24uY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLWRlbGV0ZS1idXR0b25cIik7XHJcbiAgICAgICAgICBkZWxldGVCdXR0b24ub25jbGljayA9IGFzeW5jICgpID0+IGF3YWl0IHRoaXMucmVtb3ZlUHJvcGVydHkodmFsdWVzLCB1cGRhdGUsIGluZGV4LCBjb250YWluZXIpO1xyXG4gICAgICAgICAgcmV0dXJuIGRlbGV0ZUJ1dHRvbjtcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBHw6hyZSBsZSBnbGlzc2VyLWTDqXBvc2VyIHBvdXIgcsOpb3Jkb25uZXIgbGVzIG9iamV0c1xyXG4gICAgICBlbmFibGVEcmFnQW5kRHJvcCh2YWx1ZXMgOiBhbnksIHVwZGF0ZSA6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KSB7XHJcbiAgICAgICAgICBsZXQgZHJhZ2dlZEVsZW1lbnQ6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgbGV0IGlzRWRpdGluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgIC8vIExvcnNxdWUgbCd1dGlsaXNhdGV1ciBjbGlxdWUgZGFucyB1biBjaGFtcCBkJ8OpZGl0aW9uIChpbnB1dCksIG9uIGFjdGl2ZSBsJ8OpZGl0aW9uXHJcbiAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgaWYgKGlucHV0Py5jbGFzc0xpc3QuY29udGFpbnMoJ2ZpZWxkLWlucHV0JykpIHtcclxuICAgICAgICAgICAgICAgICAgaXNFZGl0aW5nID0gdHJ1ZTsgIC8vIExlIGNoYW1wIGVzdCBlbiBtb2RlIMOpZGl0aW9uXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgLy8gTG9yc3F1ZSBsJ3V0aWxpc2F0ZXVyIHF1aXR0ZSB1biBjaGFtcCBkJ8OpZGl0aW9uIChibHVyKSwgb24gZMOpc2FjdGl2ZSBsJ8OpZGl0aW9uXHJcbiAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBpbnB1dCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICAgICAgICBpZiAoaW5wdXQ/LmNsYXNzTGlzdC5jb250YWlucygnZmllbGQtaW5wdXQnKSkge1xyXG4gICAgICAgICAgICAgICAgICBpc0VkaXRpbmcgPSBmYWxzZTsgIC8vIExlIGNoYW1wIG4nZXN0IHBsdXMgZW4gbW9kZSDDqWRpdGlvblxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ3N0YXJ0XCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXNFZGl0aW5nKSB7XHJcbiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZHJhZ2dlZEVsZW1lbnQgPSBldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGRyYWdnZWRFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkcmFnZ2luZ1wiKTtcclxuICAgICAgICAgIH0pO1xyXG4gIFxyXG4gICAgICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgIGNvbnN0IGFmdGVyRWxlbWVudCA9IHRoaXMuZ2V0RHJhZ0FmdGVyRWxlbWVudChjb250YWluZXIsIGV2ZW50LmNsaWVudFkpO1xyXG4gICAgICAgICAgICAgIGlmIChhZnRlckVsZW1lbnQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZHJhZ2dlZEVsZW1lbnQhKTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmluc2VydEJlZm9yZShkcmFnZ2VkRWxlbWVudCEsIGFmdGVyRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgXHJcbiAgICAgICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdlbmRcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgIGlmICghZHJhZ2dlZEVsZW1lbnQpIHJldHVybjtcclxuICAgICAgICAgICAgICBkcmFnZ2VkRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiZHJhZ2dpbmdcIik7XHJcbiAgXHJcbiAgICAgICAgICAgICAgLy8gUsOpY3Vww6lyZXIgbGUgbm91dmVsIG9yZHJlIGRlcyDDqWzDqW1lbnRzXHJcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVPcmRlcih2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIC8vIFRyb3V2ZXIgbCfDqWzDqW1lbnQgYXByw6hzIGxlcXVlbCBpbnPDqXJlciAocG91ciBsZSBEcmFnICYgRHJvcClcclxuICAgICAgZ2V0RHJhZ0FmdGVyRWxlbWVudChjb250YWluZXI6IEhUTUxEaXZFbGVtZW50LCB5OiBudW1iZXIpOiBFbGVtZW50IHwgbnVsbCB7XHJcbiAgICAgICAgICBjb25zdCBkcmFnZ2FibGVFbGVtZW50cyA9IEFycmF5LmZyb20oY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIubWV0YWRhdGEtb2JqZWN0LXJvdzpub3QoLmRyYWdnaW5nKVwiKSk7XHJcbiAgXHJcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBkcmFnZ2FibGVFbGVtZW50cy5yZWR1Y2UoKGNsb3Nlc3Q6IHsgb2Zmc2V0OiBudW1iZXI7IGVsZW1lbnQ6IEVsZW1lbnQgfCBudWxsIH0sIGNoaWxkKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgYm94ID0gY2hpbGQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0geSAtIGJveC50b3AgLSBib3guaGVpZ2h0IC8gMjtcclxuICAgICAgICAgICAgICByZXR1cm4gb2Zmc2V0IDwgMCAmJiBvZmZzZXQgPiBjbG9zZXN0Lm9mZnNldCA/IHsgb2Zmc2V0LCBlbGVtZW50OiBjaGlsZCB9IDogY2xvc2VzdDtcclxuICAgICAgICAgIH0sIHsgb2Zmc2V0OiBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIGVsZW1lbnQ6IG51bGwgYXMgRWxlbWVudCB8IG51bGwgfSk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIHJldHVybiByZXN1bHQuZWxlbWVudDtcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBNZXQgw6Agam91ciBsJ29yZHJlIGRlcyDDqWzDqW1lbnRzIGFwcsOocyB1biBnbGlzc2VyLWTDqXBvc2VyXHJcbiAgICAgIGFzeW5jIHVwZGF0ZU9yZGVyKHZhbHVlcyA6IGFueSwgdXBkYXRlIDogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlVwZGF0ZSBvcmRlclwiKVxyXG4gICAgICAgICAgbGV0IG5ld09yZGVyOiBhbnlbXSA9IFtdO1xyXG4gICAgICAgICAgQXJyYXkuZnJvbShjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChcIi5tZXRhZGF0YS1vYmplY3Qtcm93XCIpKS5mb3JFYWNoKChyb3cpID0+IHtcclxuICAgICAgICAgICAgICAvLyBBc3N1cmVyIHF1J29uIHRyYXZhaWxsZSBhdmVjIHVuIEhUTUxFbGVtZW50IHBvdXIgYWNjw6lkZXIgw6AgZGF0YXNldFxyXG4gICAgICAgICAgICAgIGlmIChyb3cgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCAmJiByb3cuZGF0YXNldC5pbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSBwYXJzZUludChyb3cuZGF0YXNldC5pbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgIG5ld09yZGVyLnB1c2godmFsdWVzW2luZGV4XSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICAvLyBNZXR0cmUgw6Agam91ciBsZXMgbcOpdGFkb25uw6llc1xyXG4gICAgICAgICAgYXdhaXQgdXBkYXRlKG5ld09yZGVyKTtcclxuICAgICAgICAgIGF3YWl0IHRoaXMucmVsb2FkT2JqZWN0cyhuZXdPcmRlciwgdXBkYXRlKVxyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIC8vIEZvbmN0aW9uIHBvdXIgc3VwcHJpbWVyIHVuIG9iamV0XHJcbiAgICAgIGFzeW5jIHJlbW92ZVByb3BlcnR5KHZhbHVlcyA6IGFueSwgdXBkYXRlIDogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGluZGV4OiBudW1iZXIsIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVtb3ZlIGluZGV4IDogXCIsIGluZGV4KVxyXG4gICAgICAgICAgdmFsdWVzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICBhd2FpdCB1cGRhdGUodmFsdWVzKTtcclxuICAgICAgICAgIGF3YWl0IHRoaXMucmVsb2FkT2JqZWN0cyh2YWx1ZXMsIHVwZGF0ZSlcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBGb25jdGlvbiBwb3VyIGFqb3V0ZXIgdW4gb2JqZXRcclxuICAgICAgYXN5bmMgYWRkUHJvcGVydHkodmFsdWVzIDogYW55LCB1cGRhdGUgOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coXCJBZGQgbmV3XCIpXHJcbiAgICAgICAgICBsZXQgbmV3T2JqZWN0OiBhbnkgPSB7fTtcclxuICAgICAgICAgIGZvciAobGV0IHByb3Agb2YgT2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnRpZXMpKSB7XHJcbiAgICAgICAgICAgIGxldCBkZWZhdWx0VmFsdWUgPSBwcm9wLmdldERlZmF1bHRWYWx1ZSh0aGlzLnZhdWx0KVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRlZmF1bHQgdmFsdWUgOiBcIiwgZGVmYXVsdFZhbHVlKVxyXG4gICAgICAgICAgICBpZiAoT2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnRpZXMpWzBdID09IHByb3AgJiYgKHByb3AgaW5zdGFuY2VvZiBGaWxlUHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgICAgICBwcm9wLnZhdWx0ID0gdGhpcy52YXVsdDsgLy8gQXNzdXJlei12b3VzIHF1ZSB2YXVsdCBlc3QgZMOpZmluaSBwb3VyIGxlIHByZW1pZXIgRmlsZVByb3BlcnR5XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlUHJvcCA9IHByb3AgYXMgYW55OyAvLyBDYXN0IHBvdXIgYWNjw6lkZXIgw6AgaGFuZGxlSWNvbkNsaWNrXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWUgPSBhd2FpdCBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGZpbGVQcm9wLmhhbmRsZUljb25DbGljayhhc3luYyAodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJEZWZhdWx0IHZhbHVlIGFmdGVyIGNsaWNrIDogXCIsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBuZXcgTW91c2VFdmVudChcImNsaWNrXCIpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGVmYXVsdCB2YWx1ZSBhZnRlciBjbGljayA6IFwiLCBkZWZhdWx0VmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRlZmF1bHRWYWx1ZSA9PSBcImxpa2UtcHJlY2VkZW50XCIpe1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5hcHBlbmRGaXJzdCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZSA9IHZhbHVlc1swXVtwcm9wLm5hbWVdXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWUgPSB2YWx1ZXNbdmFsdWVzLmxlbmd0aC0xXVtwcm9wLm5hbWVdXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7ZGVmYXVsdFZhbHVlID0gXCJcIn1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBuZXdPYmplY3RbcHJvcC5uYW1lXSA9IGRlZmF1bHRWYWx1ZVxyXG4gICAgICAgIFxyXG4gICAgICAgIH07IFxyXG4gICAgICAgIC8vIFZhbGV1cnMgcGFyIGTDqWZhdXRcclxuICAgICAgICBpZiAoIXZhbHVlcyl7dmFsdWVzID0gW119XHJcbiAgICAgICAgaWYgKHRoaXMuYXBwZW5kRmlyc3QpIHtcclxuICAgICAgICAgICAgdmFsdWVzLnVuc2hpZnQobmV3T2JqZWN0KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2YWx1ZXMucHVzaChuZXdPYmplY3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAgIGF3YWl0IHVwZGF0ZSh2YWx1ZXMpO1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5yZWxvYWRPYmplY3RzKHZhbHVlcywgdXBkYXRlKVxyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIC8vIE1pc2Ugw6Agam91ciBkZXMgbcOpdGFkb25uw6llc1xyXG4gICAgICBhc3luYyB1cGRhdGVPYmplY3QodmFsdWVzIDogYW55LCB1cGRhdGUgOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgaW5kZXg6IG51bWJlciwgcHJvcGVydHk6IFByb3BlcnR5LCB2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGUgaW5kZXggOiBcIiwgaW5kZXgpXHJcbiAgICAgICAgICBpZiAodmFsdWVzKXtcclxuICAgICAgICAgICAgdmFsdWVzW2luZGV4XVtwcm9wZXJ0eS5uYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhbHVlcyA9IFt7W3Byb3BlcnR5Lm5hbWVdIDogdmFsdWV9XVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGVkIFZhbHVlcyA6IFwiLCB2YWx1ZXMpXHJcbiAgICAgICAgICBhd2FpdCB1cGRhdGUodmFsdWVzKTtcclxuICAgICAgICAgIGF3YWl0IHRoaXMucmVsb2FkT2JqZWN0cyh2YWx1ZXMsIHVwZGF0ZSlcclxuICAgICAgfVxyXG5cclxuICAgIC8vIFJlY2hhcmdlIGR5bmFtaXF1ZW1lbnQgbGVzIG9iamV0c1xyXG4gICAgYXN5bmMgcmVsb2FkT2JqZWN0cyh2YWx1ZXMgOiBhbnksIHVwZGF0ZSA6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCkge1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubWV0YWRhdGEtb2JqZWN0LWNvbnRhaW5lci1cIit0aGlzLm5hbWUudG9Mb3dlckNhc2UoKSkgYXMgSFRNTERpdkVsZW1lbnQ7XHJcbiAgICAgICAgaWYgKGNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgICAgICAgICAgLy8gUmVjcsOpZXIgbCdlbi10w6p0ZSBldCBsZXMgb2JqZXRzXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVmFsdWVzIDogXCIsIHZhbHVlcylcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVIZWFkZXIodmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRpc3BsYXkgPT0gXCJ0YWJsZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVRhYmxlKHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gQWZmaWNoYWdlIHBhciBkw6lmYXV0IChvYmpldClcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlT2JqZWN0cyh2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIH1cclxuICB9XHJcbiAgIl0sInZlcnNpb24iOjN9