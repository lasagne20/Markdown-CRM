1d27b91b4ea212bf33293264d24fc62f
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock flatpickr completely
jest.mock('flatpickr', () => {
    const mockInstance = {
        destroy: jest.fn(),
        setDate: jest.fn(),
        clear: jest.fn()
    };
    const mockFlatpickr = jest.fn((element, options) => {
        element.flatpickrOptions = options;
        element.flatpickrInstance = mockInstance;
        return mockInstance;
    });
    return mockFlatpickr;
});
// Mock French locale
jest.mock('flatpickr/dist/l10n/fr.js', () => ({
    French: { locale: 'fr' }
}));
// Mock all dependencies
jest.mock('../../classes/Classe', () => ({}));
jest.mock('../../vault/File', () => ({}));
jest.mock('../../vault/MyVault', () => ({}));
jest.mock('../../vault/Utils', () => ({
    setIcon: jest.fn((element, iconName) => {
        element.setAttribute('data-icon', iconName);
        element.textContent = `[${iconName}]`;
    })
}));
// Mock Property base class
jest.mock('../../properties/Property', () => {
    return {
        Property: class MockProperty {
            constructor(name, type, ...args) {
                this.title = '';
                this.static = false;
                this.icon = '';
                this.read = jest.fn(() => '');
                this.validate = jest.fn((value) => value);
                this.getPretty = jest.fn(() => '');
                this.getDisplay = jest.fn(() => document.createElement('div'));
                this.fillDisplay = jest.fn(() => {
                    const div = document.createElement('div');
                    div.classList.add('field-container-column');
                    const field = document.createElement('div');
                    field.classList.add('metadata-field');
                    div.appendChild(field);
                    return div;
                });
                this.name = name;
                this.type = type;
                if (args.length > 0 && typeof args[0] === 'object') {
                    Object.assign(this, args[0]);
                }
            }
        }
    };
});
const DateProperty_1 = require("../../properties/DateProperty");
describe('DateProperty', () => {
    let dateProperty;
    let mockVault;
    let mockFile;
    beforeEach(() => {
        jest.clearAllMocks();
        document.body.innerHTML = '';
        mockVault = {
            app: { vault: { getFiles: jest.fn(() => []) } }
        };
        mockFile = {
            getMetadata: jest.fn(() => ({ eventDate: '2024-03-15' })),
            getMetadataValue: jest.fn((key) => key === 'eventDate' ? '2024-03-15' : undefined),
            updateMetadata: jest.fn(),
            vault: mockVault
        };
        dateProperty = new DateProperty_1.DateProperty('eventDate', ['today', 'tomorrow', 'next-week']);
        jest.useFakeTimers();
        jest.setSystemTime(new Date('2024-03-15T10:00:00Z'));
    });
    afterEach(() => {
        jest.useRealTimers();
    });
    describe('constructor', () => {
        it('should create DateProperty with correct properties', () => {
            const quickIcons = ['today', 'tomorrow'];
            const prop = new DateProperty_1.DateProperty('testDate', quickIcons);
            expect(prop.name).toBe('testDate');
            expect(prop.type).toBe('date');
            expect(prop.quickSelectIcons).toEqual(quickIcons);
        });
    });
    describe('formatDateForStorage', () => {
        it('should format date in YYYY-MM-DD format', () => {
            const testDate = new Date('2024-03-15T10:30:00Z');
            const result = dateProperty.formatDateForStorage(testDate);
            expect(result).toBe('2024-03-15');
        });
    });
    describe('formatDateForDisplay', () => {
        it('should format valid date strings', () => {
            const result = dateProperty.formatDateForDisplay('2024-03-15');
            expect(result).toBeTruthy();
            expect(typeof result).toBe('string');
        });
        it('should handle invalid dates', () => {
            const result = dateProperty.formatDateForDisplay('invalid-date');
            expect(result).toBe('Invalid Date');
        });
    });
    describe('getDateForOption', () => {
        it('should return correct dates for standard options', () => {
            const today = dateProperty.getDateForOption('today');
            expect(today.getDate()).toBe(15);
            const tomorrow = dateProperty.getDateForOption('tomorrow');
            expect(tomorrow.getDate()).toBe(16);
        });
    });
    describe('createFieldLink', () => {
        it('should create a clickable link element', () => {
            const link = dateProperty.createFieldLink('2024-03-15');
            expect(link.tagName).toBe('DIV');
            expect(link.classList.contains('field-link')).toBe(true);
            expect(link.style.cursor).toBe('pointer');
        });
        it('should show placeholder for empty values', () => {
            const link = dateProperty.createFieldLink('');
            expect(link.textContent).toBe('Aucune date sélectionnée');
        });
    });
    describe('createFieldDate', () => {
        it('should create input with flatpickr initialization', () => {
            const updateFn = jest.fn();
            const link = document.createElement('div');
            const input = dateProperty.createFieldDate('2024-03-15', updateFn, link);
            expect(input.tagName).toBe('INPUT');
            expect(input.value).toBe('2024-03-15');
            expect(input.classList.contains('field-input')).toBe(true);
        });
    });
    describe('createQuickSelect', () => {
        it('should create buttons for quick select options', () => {
            const updateFn = jest.fn();
            const link = document.createElement('div');
            const input = document.createElement('input');
            const container = dateProperty.createQuickSelect('', updateFn, link, input);
            expect(container.tagName).toBe('DIV');
            expect(container.classList.contains('quick-select-container')).toBe(true);
            const buttons = container.querySelectorAll('button');
            expect(buttons.length).toBe(3);
        });
    });
    describe('updateField', () => {
        it('should update field with valid input', async () => {
            const updateFn = jest.fn().mockResolvedValue(undefined);
            const input = document.createElement('input');
            const link = document.createElement('div');
            input.value = '2024-03-20';
            dateProperty.validate = jest.fn(() => '2024-03-20');
            await dateProperty.updateField(updateFn, input, link);
            expect(updateFn).toHaveBeenCalledWith('2024-03-20');
        });
    });
    describe('fillDisplay', () => {
        it('should create display structure', () => {
            const updateFn = jest.fn();
            const result = dateProperty.fillDisplay(mockVault, '2024-03-15', updateFn);
            expect(result).toBeTruthy();
            expect(result.classList.contains('field-container-column')).toBe(true);
        });
    });
    describe('edge cases', () => {
        it('should handle null values gracefully', () => {
            expect(() => {
                dateProperty.createFieldLink(null);
                dateProperty.formatDateForDisplay('');
            }).not.toThrow();
        });
        it('should handle empty quick select icons', () => {
            const prop = new DateProperty_1.DateProperty('test', []);
            const updateFn = jest.fn();
            const link = document.createElement('div');
            const input = document.createElement('input');
            const container = prop.createQuickSelect('', updateFn, link, input);
            const buttons = container.querySelectorAll('button');
            expect(buttons.length).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXF9fdGVzdHNfX1xcUHJvcGVydGllc1xcRGF0ZVByb3BlcnR5LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUlILDRCQUE0QjtBQUM1QixJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7SUFDeEIsTUFBTSxZQUFZLEdBQUc7UUFDakIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbEIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDbkIsQ0FBQztJQUVGLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLEVBQUU7UUFDOUMsT0FBZSxDQUFDLGdCQUFnQixHQUFHLE9BQU8sQ0FBQztRQUMzQyxPQUFlLENBQUMsaUJBQWlCLEdBQUcsWUFBWSxDQUFDO1FBQ2xELE9BQU8sWUFBWSxDQUFDO0lBQ3hCLENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxhQUFhLENBQUM7QUFDekIsQ0FBQyxDQUFDLENBQUM7QUFFSCxxQkFBcUI7QUFDckIsSUFBSSxDQUFDLElBQUksQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzFDLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Q0FDM0IsQ0FBQyxDQUFDLENBQUM7QUFFSix3QkFBd0I7QUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDOUMsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFD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UUFBUSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNwRSxNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFckQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcc3JjXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXERhdGVQcm9wZXJ0eS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAamVzdC1lbnZpcm9ubWVudCBqc2RvbVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IERhdGVQcm9wZXJ0eSB9IGZyb20gJy4uLy4uL3Byb3BlcnRpZXMvRGF0ZVByb3BlcnR5JztcclxuXHJcbi8vIE1vY2sgZmxhdHBpY2tyIGNvbXBsZXRlbHlcclxuamVzdC5tb2NrKCdmbGF0cGlja3InLCAoKSA9PiB7XHJcbiAgICBjb25zdCBtb2NrSW5zdGFuY2UgPSB7XHJcbiAgICAgICAgZGVzdHJveTogamVzdC5mbigpLFxyXG4gICAgICAgIHNldERhdGU6IGplc3QuZm4oKSxcclxuICAgICAgICBjbGVhcjogamVzdC5mbigpXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBjb25zdCBtb2NrRmxhdHBpY2tyID0gamVzdC5mbigoZWxlbWVudCwgb3B0aW9ucykgPT4ge1xyXG4gICAgICAgIChlbGVtZW50IGFzIGFueSkuZmxhdHBpY2tyT3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICAgICAgKGVsZW1lbnQgYXMgYW55KS5mbGF0cGlja3JJbnN0YW5jZSA9IG1vY2tJbnN0YW5jZTtcclxuICAgICAgICByZXR1cm4gbW9ja0luc3RhbmNlO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIHJldHVybiBtb2NrRmxhdHBpY2tyO1xyXG59KTtcclxuXHJcbi8vIE1vY2sgRnJlbmNoIGxvY2FsZVxyXG5qZXN0Lm1vY2soJ2ZsYXRwaWNrci9kaXN0L2wxMG4vZnIuanMnLCAoKSA9PiAoe1xyXG4gICAgRnJlbmNoOiB7IGxvY2FsZTogJ2ZyJyB9XHJcbn0pKTtcclxuXHJcbi8vIE1vY2sgYWxsIGRlcGVuZGVuY2llc1xyXG5qZXN0Lm1vY2soJy4uLy4uL2NsYXNzZXMvQ2xhc3NlJywgKCkgPT4gKHt9KSk7XHJcbmplc3QubW9jaygnLi4vLi4vdmF1bHQvRmlsZScsICgpID0+ICh7fSkpO1xyXG5qZXN0Lm1vY2soJy4uLy4uL3ZhdWx0L015VmF1bHQnLCAoKSA9PiAoe30pKTtcclxuamVzdC5tb2NrKCcuLi8uLi92YXVsdC9VdGlscycsICgpID0+ICh7XHJcbiAgICBzZXRJY29uOiBqZXN0LmZuKChlbGVtZW50OiBIVE1MRWxlbWVudCwgaWNvbk5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWljb24nLCBpY29uTmFtZSk7XHJcbiAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9IGBbJHtpY29uTmFtZX1dYDtcclxuICAgIH0pXHJcbn0pKTtcclxuXHJcbi8vIE1vY2sgUHJvcGVydHkgYmFzZSBjbGFzc1xyXG5qZXN0Lm1vY2soJy4uLy4uL3Byb3BlcnRpZXMvUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIFByb3BlcnR5OiBjbGFzcyBNb2NrUHJvcGVydHkge1xyXG4gICAgICAgICAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICAgICAgICAgIHR5cGU6IHN0cmluZztcclxuICAgICAgICAgICAgdGl0bGU6IHN0cmluZyA9ICcnO1xyXG4gICAgICAgICAgICBzdGF0aWM6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgaWNvbjogc3RyaW5nID0gJyc7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGFueTtcclxuICAgICAgICAgICAgdmF1bHQ6IGFueTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgdHlwZTogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDAgJiYgdHlwZW9mIGFyZ3NbMF0gPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBhcmdzWzBdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmVhZCA9IGplc3QuZm4oKCkgPT4gJycpO1xyXG4gICAgICAgICAgICB2YWxpZGF0ZSA9IGplc3QuZm4oKHZhbHVlOiBzdHJpbmcpID0+IHZhbHVlKTtcclxuICAgICAgICAgICAgZ2V0UHJldHR5ID0gamVzdC5mbigoKSA9PiAnJyk7XHJcbiAgICAgICAgICAgIGdldERpc3BsYXkgPSBqZXN0LmZuKCgpID0+IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTtcclxuICAgICAgICAgICAgZmlsbERpc3BsYXkgPSBqZXN0LmZuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgZGl2LmNsYXNzTGlzdC5hZGQoJ2ZpZWxkLWNvbnRhaW5lci1jb2x1bW4nKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICBmaWVsZC5jbGFzc0xpc3QuYWRkKCdtZXRhZGF0YS1maWVsZCcpO1xyXG4gICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGZpZWxkKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkaXY7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pO1xyXG5cclxuZGVzY3JpYmUoJ0RhdGVQcm9wZXJ0eScsICgpID0+IHtcclxuICAgIGxldCBkYXRlUHJvcGVydHk6IERhdGVQcm9wZXJ0eTtcclxuICAgIGxldCBtb2NrVmF1bHQ6IGFueTtcclxuICAgIGxldCBtb2NrRmlsZTogYW55O1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gJyc7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbW9ja1ZhdWx0ID0ge1xyXG4gICAgICAgICAgICBhcHA6IHsgdmF1bHQ6IHsgZ2V0RmlsZXM6IGplc3QuZm4oKCkgPT4gW10pIH0gfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIG1vY2tGaWxlID0ge1xyXG4gICAgICAgICAgICBnZXRNZXRhZGF0YTogamVzdC5mbigoKSA9PiAoeyBldmVudERhdGU6ICcyMDI0LTAzLTE1JyB9KSksXHJcbiAgICAgICAgICAgIGdldE1ldGFkYXRhVmFsdWU6IGplc3QuZm4oKGtleTogc3RyaW5nKSA9PiBrZXkgPT09ICdldmVudERhdGUnID8gJzIwMjQtMDMtMTUnIDogdW5kZWZpbmVkKSxcclxuICAgICAgICAgICAgdXBkYXRlTWV0YWRhdGE6IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgdmF1bHQ6IG1vY2tWYXVsdFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGRhdGVQcm9wZXJ0eSA9IG5ldyBEYXRlUHJvcGVydHkoJ2V2ZW50RGF0ZScsIFsndG9kYXknLCAndG9tb3Jyb3cnLCAnbmV4dC13ZWVrJ10pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGplc3QudXNlRmFrZVRpbWVycygpO1xyXG4gICAgICAgIGplc3Quc2V0U3lzdGVtVGltZShuZXcgRGF0ZSgnMjAyNC0wMy0xNVQxMDowMDowMFonKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgICAgIGplc3QudXNlUmVhbFRpbWVycygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NvbnN0cnVjdG9yJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIERhdGVQcm9wZXJ0eSB3aXRoIGNvcnJlY3QgcHJvcGVydGllcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcXVpY2tJY29ucyA9IFsndG9kYXknLCAndG9tb3Jyb3cnXTtcclxuICAgICAgICAgICAgY29uc3QgcHJvcCA9IG5ldyBEYXRlUHJvcGVydHkoJ3Rlc3REYXRlJywgcXVpY2tJY29ucyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocHJvcC5uYW1lKS50b0JlKCd0ZXN0RGF0ZScpO1xyXG4gICAgICAgICAgICBleHBlY3QocHJvcC50eXBlKS50b0JlKCdkYXRlJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdCgocHJvcCBhcyBhbnkpLnF1aWNrU2VsZWN0SWNvbnMpLnRvRXF1YWwocXVpY2tJY29ucyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZm9ybWF0RGF0ZUZvclN0b3JhZ2UnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBmb3JtYXQgZGF0ZSBpbiBZWVlZLU1NLUREIGZvcm1hdCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdGVzdERhdGUgPSBuZXcgRGF0ZSgnMjAyNC0wMy0xNVQxMDozMDowMFonKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGF0ZVByb3BlcnR5LmZvcm1hdERhdGVGb3JTdG9yYWdlKHRlc3REYXRlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnMjAyNC0wMy0xNScpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2Zvcm1hdERhdGVGb3JEaXNwbGF5JywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgZm9ybWF0IHZhbGlkIGRhdGUgc3RyaW5ncycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGF0ZVByb3BlcnR5LmZvcm1hdERhdGVGb3JEaXNwbGF5KCcyMDI0LTAzLTE1Jyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICAgICAgZXhwZWN0KHR5cGVvZiByZXN1bHQpLnRvQmUoJ3N0cmluZycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIGRhdGVzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBkYXRlUHJvcGVydHkuZm9ybWF0RGF0ZUZvckRpc3BsYXkoJ2ludmFsaWQtZGF0ZScpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdJbnZhbGlkIERhdGUnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdnZXREYXRlRm9yT3B0aW9uJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgZGF0ZXMgZm9yIHN0YW5kYXJkIG9wdGlvbnMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRvZGF5ID0gZGF0ZVByb3BlcnR5LmdldERhdGVGb3JPcHRpb24oJ3RvZGF5Jyk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh0b2RheS5nZXREYXRlKCkpLnRvQmUoMTUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgdG9tb3Jyb3cgPSBkYXRlUHJvcGVydHkuZ2V0RGF0ZUZvck9wdGlvbigndG9tb3Jyb3cnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHRvbW9ycm93LmdldERhdGUoKSkudG9CZSgxNik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY3JlYXRlRmllbGRMaW5rJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgY2xpY2thYmxlIGxpbmsgZWxlbWVudCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbGluayA9IGRhdGVQcm9wZXJ0eS5jcmVhdGVGaWVsZExpbmsoJzIwMjQtMDMtMTUnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChsaW5rLnRhZ05hbWUpLnRvQmUoJ0RJVicpO1xyXG4gICAgICAgICAgICBleHBlY3QobGluay5jbGFzc0xpc3QuY29udGFpbnMoJ2ZpZWxkLWxpbmsnKSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KGxpbmsuc3R5bGUuY3Vyc29yKS50b0JlKCdwb2ludGVyJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgc2hvdyBwbGFjZWhvbGRlciBmb3IgZW1wdHkgdmFsdWVzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gZGF0ZVByb3BlcnR5LmNyZWF0ZUZpZWxkTGluaygnJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChsaW5rLnRleHRDb250ZW50KS50b0JlKCdBdWN1bmUgZGF0ZSBzw6lsZWN0aW9ubsOpZScpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NyZWF0ZUZpZWxkRGF0ZScsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBpbnB1dCB3aXRoIGZsYXRwaWNrciBpbml0aWFsaXphdGlvbicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlRm4gPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZGF0ZVByb3BlcnR5LmNyZWF0ZUZpZWxkRGF0ZSgnMjAyNC0wMy0xNScsIHVwZGF0ZUZuLCBsaW5rKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChpbnB1dC50YWdOYW1lKS50b0JlKCdJTlBVVCcpO1xyXG4gICAgICAgICAgICBleHBlY3QoaW5wdXQudmFsdWUpLnRvQmUoJzIwMjQtMDMtMTUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGlucHV0LmNsYXNzTGlzdC5jb250YWlucygnZmllbGQtaW5wdXQnKSkudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjcmVhdGVRdWlja1NlbGVjdCcsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBidXR0b25zIGZvciBxdWljayBzZWxlY3Qgb3B0aW9ucycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlRm4gPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkYXRlUHJvcGVydHkuY3JlYXRlUXVpY2tTZWxlY3QoJycsIHVwZGF0ZUZuLCBsaW5rLCBpbnB1dCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoY29udGFpbmVyLnRhZ05hbWUpLnRvQmUoJ0RJVicpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29udGFpbmVyLmNsYXNzTGlzdC5jb250YWlucygncXVpY2stc2VsZWN0LWNvbnRhaW5lcicpKS50b0JlKHRydWUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgYnV0dG9ucyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGJ1dHRvbnMubGVuZ3RoKS50b0JlKDMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ3VwZGF0ZUZpZWxkJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgdXBkYXRlIGZpZWxkIHdpdGggdmFsaWQgaW5wdXQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZUZuID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpbnB1dC52YWx1ZSA9ICcyMDI0LTAzLTIwJztcclxuICAgICAgICAgICAgZGF0ZVByb3BlcnR5LnZhbGlkYXRlID0gamVzdC5mbigoKSA9PiAnMjAyNC0wMy0yMCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYXdhaXQgZGF0ZVByb3BlcnR5LnVwZGF0ZUZpZWxkKHVwZGF0ZUZuLCBpbnB1dCwgbGluayk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QodXBkYXRlRm4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcyMDI0LTAzLTIwJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZmlsbERpc3BsYXknLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgZGlzcGxheSBzdHJ1Y3R1cmUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZUZuID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBkYXRlUHJvcGVydHkuZmlsbERpc3BsYXkobW9ja1ZhdWx0LCAnMjAyNC0wMy0xNScsIHVwZGF0ZUZuKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jbGFzc0xpc3QuY29udGFpbnMoJ2ZpZWxkLWNvbnRhaW5lci1jb2x1bW4nKSkudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdlZGdlIGNhc2VzJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bGwgdmFsdWVzIGdyYWNlZnVsbHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBkYXRlUHJvcGVydHkuY3JlYXRlRmllbGRMaW5rKG51bGwgYXMgYW55KTtcclxuICAgICAgICAgICAgICAgIGRhdGVQcm9wZXJ0eS5mb3JtYXREYXRlRm9yRGlzcGxheSgnJyk7XHJcbiAgICAgICAgICAgIH0pLm5vdC50b1Rocm93KCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHF1aWNrIHNlbGVjdCBpY29ucycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcHJvcCA9IG5ldyBEYXRlUHJvcGVydHkoJ3Rlc3QnLCBbXSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZUZuID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gcHJvcC5jcmVhdGVRdWlja1NlbGVjdCgnJywgdXBkYXRlRm4sIGxpbmssIGlucHV0KTtcclxuICAgICAgICAgICAgY29uc3QgYnV0dG9ucyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChidXR0b25zLmxlbmd0aCkudG9CZSgwKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=