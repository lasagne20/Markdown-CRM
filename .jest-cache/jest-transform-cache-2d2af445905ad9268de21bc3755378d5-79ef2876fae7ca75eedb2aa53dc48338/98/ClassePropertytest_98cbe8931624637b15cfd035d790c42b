a0bcb4f244ef1e33f5d671e561b66395
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
jest.mock('../src/vault/Utils', () => ({
    setIcon: jest.fn()
}));
const ClasseProperty_1 = require("../src/properties/ClasseProperty");
const Property_1 = require("../src/properties/Property");
// Import the mocked function for use in tests
const { setIcon } = jest.requireMock('../src/vault/Utils');
describe('ClasseProperty', () => {
    let classeProperty;
    beforeEach(() => {
        // Reset DOM mocks
        document.body.innerHTML = '';
        jest.clearAllMocks();
    });
    beforeEach(() => {
        classeProperty = new ClasseProperty_1.ClasseProperty('testClasse');
    });
    describe('constructor', () => {
        it('should create ClasseProperty with correct type', () => {
            expect(classeProperty.type).toBe('class');
        });
        it('should inherit from Property', () => {
            expect(classeProperty).toBeInstanceOf(Property_1.Property);
        });
        it('should use empty icon by default', () => {
            const defaultProperty = new ClasseProperty_1.ClasseProperty('defaultTest');
            expect(defaultProperty.name).toBe('defaultTest');
            expect(defaultProperty.type).toBe('class');
        });
        it('should accept custom icon', () => {
            const customProperty = new ClasseProperty_1.ClasseProperty('customName', 'custom-icon');
            expect(customProperty.name).toBe('customName');
            expect(customProperty.icon).toBe('custom-icon');
        });
        it('should handle empty string icon', () => {
            const emptyIconProperty = new ClasseProperty_1.ClasseProperty('emptyIcon', '');
            expect(emptyIconProperty.name).toBe('emptyIcon');
            expect(emptyIconProperty.icon).toBe('');
        });
    });
    describe('fillDisplay', () => {
        it('should create field with correct structure', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Class Value';
            const result = classeProperty.fillDisplay(mockVault, value, mockUpdate);
            expect(result.tagName).toBe('DIV');
            expect(result.classList.contains('metadata-field')).toBe(true);
        });
        it('should create label with correct text content', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Class Value';
            const result = classeProperty.fillDisplay(mockVault, value, mockUpdate);
            const label = result.querySelector('label');
            expect(label).toBeTruthy();
            expect(label?.textContent).toBe(value);
        });
        it('should set vault property', () => {
            const mockVault = { files: [] };
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            classeProperty.fillDisplay(mockVault, value, mockUpdate);
            expect(classeProperty.vault).toBe(mockVault);
        });
        it('should handle null value', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const result = classeProperty.fillDisplay(mockVault, null, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('');
        });
        it('should handle undefined value', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const result = classeProperty.fillDisplay(mockVault, undefined, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('');
        });
        it('should handle empty string value', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const result = classeProperty.fillDisplay(mockVault, '', mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('');
        });
        it('should handle numeric value', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const numericValue = 42;
            const result = classeProperty.fillDisplay(mockVault, numericValue, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('42');
        });
        it('should handle object value', () => {
            const mockVault = {};
            const mockUpdate = jest.fn();
            const objectValue = { name: 'test', id: 123 };
            const result = classeProperty.fillDisplay(mockVault, objectValue, mockUpdate);
            const label = result.querySelector('label');
            expect(label?.textContent).toBe('[object Object]');
        });
    });
    describe('icon handling', () => {
        it('should not create icon container when no icon', () => {
            const propertyWithoutIcon = new ClasseProperty_1.ClasseProperty('noIcon', '');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithoutIcon.fillDisplay(mockVault, value, mockUpdate);
            const iconContainer = result.querySelector('.icon-container');
            expect(iconContainer).toBeNull();
        });
        it('should create icon container when icon provided', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('withIcon', 'test-icon');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithIcon.fillDisplay(mockVault, value, mockUpdate);
            const iconContainer = result.querySelector('.icon-container');
            expect(iconContainer).toBeTruthy();
            expect(iconContainer?.classList.contains('icon-container')).toBe(true);
        });
        it('should call setIcon when icon is provided', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('withIcon', 'custom-icon');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            propertyWithIcon.fillDisplay(mockVault, value, mockUpdate);
            expect(setIcon).toHaveBeenCalledWith(expect.objectContaining({
                classList: expect.objectContaining({
                    contains: expect.any(Function)
                })
            }), 'custom-icon');
        });
        it('should not call setIcon when no icon', () => {
            setIcon.mockClear();
            const propertyWithoutIcon = new ClasseProperty_1.ClasseProperty('noIcon', '');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            propertyWithoutIcon.fillDisplay(mockVault, value, mockUpdate);
            expect(setIcon).not.toHaveBeenCalled();
        });
    });
    describe('inheritance from Property', () => {
        it('should have name property from parent', () => {
            expect(classeProperty.name).toBe('testClasse');
        });
        it('should have type property', () => {
            expect(classeProperty.type).toBe('class');
        });
        it('should have icon property from parent', () => {
            expect(classeProperty.icon).toBeDefined();
        });
        it('should have vault property that can be set', () => {
            const mockVault = { test: 'vault' };
            classeProperty.vault = mockVault;
            expect(classeProperty.vault).toBe(mockVault);
        });
    });
    describe('field structure validation', () => {
        it('should have correct DOM structure without icon', () => {
            const propertyWithoutIcon = new ClasseProperty_1.ClasseProperty('test', '');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithoutIcon.fillDisplay(mockVault, value, mockUpdate);
            expect(result.children.length).toBe(1); // Only label
            expect(result.children[0].tagName).toBe('LABEL');
        });
        it('should have correct DOM structure with icon', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('test', 'icon');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithIcon.fillDisplay(mockVault, value, mockUpdate);
            expect(result.children.length).toBe(2); // Icon container + label
            expect(result.children[0].classList.contains('icon-container')).toBe(true);
            expect(result.children[1].tagName).toBe('LABEL');
        });
        it('should maintain correct order: icon first, then label', () => {
            const propertyWithIcon = new ClasseProperty_1.ClasseProperty('test', 'icon');
            const mockVault = {};
            const mockUpdate = jest.fn();
            const value = 'Test Value';
            const result = propertyWithIcon.fillDisplay(mockVault, value, mockUpdate);
            const firstChild = result.children[0];
            const secondChild = result.children[1];
            expect(firstChild.classList.contains('icon-container')).toBe(true);
            expect(secondChild.tagName).toBe('LABEL');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXENsYXNzZVByb3BlcnR5LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUtILElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNuQyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUNyQixDQUFDLENBQUMsQ0FBQztBQUxKLHFFQUFrRTtBQUNsRSx5REFBc0Q7QUFNdEQsOENBQThDO0FBQzlDLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFFM0QsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtJQUM1QixJQUFJLGNBQThCLENBQUM7SUFFbkMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLGtCQUFrQjtRQUNsQixRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDN0IsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3pCLENBQUMsQ0FBQyxDQUFDO0lBRUgsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLGNBQWMsR0FBRyxJQUFJLCtCQUFjLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDdEQsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUN6QixFQUFFLENBQUMsZ0RBQWdELEVBQUUsR0FBRyxFQUFFO1lBQ3RELE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzlDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtZQUNw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Q0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0UsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3JELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVEQUF1RCxFQUFFLEdBQUcsRUFBRTtZQUM3RCxNQUFNLGdCQUFnQixHQUFHLElBQUksK0JBQWMsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDNUQsTUFBTSxTQUFTLEdBQUcsRUFBRSxDQUFDO1lBQ3JCLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUM3QixNQUFNLEtBQUssR0FBRyxZQUFZLENBQUM7WUFFM0IsTUFBTSxNQUFNLEdBQUcsZ0JBQWdCLENBQUMsV0FBVyxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsVUFBVSxDQUFDLENBQUM7WUFFMUUsTUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QyxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXZDLE1BQU0sQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ25FLE1BQU0sQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzlDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGxlb2R1XFxEb2N1bWVudHNcXDEgLSBQcm9cXFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXF9fdGVzdHNfX1xcUHJvcGVydGllc1xcQ2xhc3NlUHJvcGVydHkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGplc3QtZW52aXJvbm1lbnQganNkb21cclxuICovXHJcblxyXG5pbXBvcnQgeyBDbGFzc2VQcm9wZXJ0eSB9IGZyb20gJy4uL3NyYy9wcm9wZXJ0aWVzL0NsYXNzZVByb3BlcnR5JztcclxuaW1wb3J0IHsgUHJvcGVydHkgfSBmcm9tICcuLi9zcmMvcHJvcGVydGllcy9Qcm9wZXJ0eSc7XHJcblxyXG5qZXN0Lm1vY2soJy4uL3NyYy92YXVsdC9VdGlscycsICgpID0+ICh7XHJcbiAgICBzZXRJY29uOiBqZXN0LmZuKClcclxufSkpO1xyXG5cclxuLy8gSW1wb3J0IHRoZSBtb2NrZWQgZnVuY3Rpb24gZm9yIHVzZSBpbiB0ZXN0c1xyXG5jb25zdCB7IHNldEljb24gfSA9IGplc3QucmVxdWlyZU1vY2soJy4uL3NyYy92YXVsdC9VdGlscycpO1xyXG5cclxuZGVzY3JpYmUoJ0NsYXNzZVByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgbGV0IGNsYXNzZVByb3BlcnR5OiBDbGFzc2VQcm9wZXJ0eTtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAvLyBSZXNldCBET00gbW9ja3NcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9ICcnO1xyXG4gICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgY2xhc3NlUHJvcGVydHkgPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ3Rlc3RDbGFzc2UnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjb25zdHJ1Y3RvcicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBDbGFzc2VQcm9wZXJ0eSB3aXRoIGNvcnJlY3QgdHlwZScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGNsYXNzZVByb3BlcnR5LnR5cGUpLnRvQmUoJ2NsYXNzJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaW5oZXJpdCBmcm9tIFByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoY2xhc3NlUHJvcGVydHkpLnRvQmVJbnN0YW5jZU9mKFByb3BlcnR5KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCB1c2UgZW1wdHkgaWNvbiBieSBkZWZhdWx0JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkZWZhdWx0UHJvcGVydHkgPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ2RlZmF1bHRUZXN0Jyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChkZWZhdWx0UHJvcGVydHkubmFtZSkudG9CZSgnZGVmYXVsdFRlc3QnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGRlZmF1bHRQcm9wZXJ0eS50eXBlKS50b0JlKCdjbGFzcycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGFjY2VwdCBjdXN0b20gaWNvbicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY3VzdG9tUHJvcGVydHkgPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ2N1c3RvbU5hbWUnLCAnY3VzdG9tLWljb24nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGN1c3RvbVByb3BlcnR5Lm5hbWUpLnRvQmUoJ2N1c3RvbU5hbWUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGN1c3RvbVByb3BlcnR5Lmljb24pLnRvQmUoJ2N1c3RvbS1pY29uJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHN0cmluZyBpY29uJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBlbXB0eUljb25Qcm9wZXJ0eSA9IG5ldyBDbGFzc2VQcm9wZXJ0eSgnZW1wdHlJY29uJywgJycpO1xyXG4gICAgICAgICAgICBleHBlY3QoZW1wdHlJY29uUHJvcGVydHkubmFtZSkudG9CZSgnZW1wdHlJY29uJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChlbXB0eUljb25Qcm9wZXJ0eS5pY29uKS50b0JlKCcnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdmaWxsRGlzcGxheScsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBmaWVsZCB3aXRoIGNvcnJlY3Qgc3RydWN0dXJlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnVGVzdCBDbGFzcyBWYWx1ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBjbGFzc2VQcm9wZXJ0eS5maWxsRGlzcGxheShtb2NrVmF1bHQsIHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQudGFnTmFtZSkudG9CZSgnRElWJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtZXRhZGF0YS1maWVsZCcpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBsYWJlbCB3aXRoIGNvcnJlY3QgdGV4dCBjb250ZW50JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnVGVzdCBDbGFzcyBWYWx1ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBjbGFzc2VQcm9wZXJ0eS5maWxsRGlzcGxheShtb2NrVmF1bHQsIHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSByZXN1bHQucXVlcnlTZWxlY3RvcignbGFiZWwnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChsYWJlbCkudG9CZVRydXRoeSgpO1xyXG4gICAgICAgICAgICBleHBlY3QobGFiZWw/LnRleHRDb250ZW50KS50b0JlKHZhbHVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBzZXQgdmF1bHQgcHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tWYXVsdCA9IHsgZmlsZXM6IFtdIH07XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gJ1Rlc3QgVmFsdWUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY2xhc3NlUHJvcGVydHkuZmlsbERpc3BsYXkobW9ja1ZhdWx0LCB2YWx1ZSwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoY2xhc3NlUHJvcGVydHkudmF1bHQpLnRvQmUobW9ja1ZhdWx0KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbnVsbCB2YWx1ZScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1ZhdWx0ID0ge307XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBjbGFzc2VQcm9wZXJ0eS5maWxsRGlzcGxheShtb2NrVmF1bHQsIG51bGwsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IHJlc3VsdC5xdWVyeVNlbGVjdG9yKCdsYWJlbCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGxhYmVsPy50ZXh0Q29udGVudCkudG9CZSgnJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHVuZGVmaW5lZCB2YWx1ZScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1ZhdWx0ID0ge307XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBjbGFzc2VQcm9wZXJ0eS5maWxsRGlzcGxheShtb2NrVmF1bHQsIHVuZGVmaW5lZCwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gcmVzdWx0LnF1ZXJ5U2VsZWN0b3IoJ2xhYmVsJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobGFiZWw/LnRleHRDb250ZW50KS50b0JlKCcnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgc3RyaW5nIHZhbHVlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNsYXNzZVByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgJycsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IHJlc3VsdC5xdWVyeVNlbGVjdG9yKCdsYWJlbCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGxhYmVsPy50ZXh0Q29udGVudCkudG9CZSgnJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG51bWVyaWMgdmFsdWUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tWYXVsdCA9IHt9O1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBudW1lcmljVmFsdWUgPSA0MjtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNsYXNzZVByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgbnVtZXJpY1ZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSByZXN1bHQucXVlcnlTZWxlY3RvcignbGFiZWwnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChsYWJlbD8udGV4dENvbnRlbnQpLnRvQmUoJzQyJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG9iamVjdCB2YWx1ZScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1ZhdWx0ID0ge307XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IG9iamVjdFZhbHVlID0geyBuYW1lOiAndGVzdCcsIGlkOiAxMjMgfTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNsYXNzZVByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgb2JqZWN0VmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IHJlc3VsdC5xdWVyeVNlbGVjdG9yKCdsYWJlbCcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGxhYmVsPy50ZXh0Q29udGVudCkudG9CZSgnW29iamVjdCBPYmplY3RdJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnaWNvbiBoYW5kbGluZycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIG5vdCBjcmVhdGUgaWNvbiBjb250YWluZXIgd2hlbiBubyBpY29uJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVdpdGhvdXRJY29uID0gbmV3IENsYXNzZVByb3BlcnR5KCdub0ljb24nLCAnJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tWYXVsdCA9IHt9O1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICdUZXN0IFZhbHVlJztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5V2l0aG91dEljb24uZmlsbERpc3BsYXkobW9ja1ZhdWx0LCB2YWx1ZSwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGljb25Db250YWluZXIgPSByZXN1bHQucXVlcnlTZWxlY3RvcignLmljb24tY29udGFpbmVyJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoaWNvbkNvbnRhaW5lcikudG9CZU51bGwoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgaWNvbiBjb250YWluZXIgd2hlbiBpY29uIHByb3ZpZGVkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVdpdGhJY29uID0gbmV3IENsYXNzZVByb3BlcnR5KCd3aXRoSWNvbicsICd0ZXN0LWljb24nKTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1ZhdWx0ID0ge307XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gJ1Rlc3QgVmFsdWUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJvcGVydHlXaXRoSWNvbi5maWxsRGlzcGxheShtb2NrVmF1bHQsIHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IHJlc3VsdC5xdWVyeVNlbGVjdG9yKCcuaWNvbi1jb250YWluZXInKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChpY29uQ29udGFpbmVyKS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChpY29uQ29udGFpbmVyPy5jbGFzc0xpc3QuY29udGFpbnMoJ2ljb24tY29udGFpbmVyJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgY2FsbCBzZXRJY29uIHdoZW4gaWNvbiBpcyBwcm92aWRlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlXaXRoSWNvbiA9IG5ldyBDbGFzc2VQcm9wZXJ0eSgnd2l0aEljb24nLCAnY3VzdG9tLWljb24nKTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1ZhdWx0ID0ge307XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gJ1Rlc3QgVmFsdWUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcHJvcGVydHlXaXRoSWNvbi5maWxsRGlzcGxheShtb2NrVmF1bHQsIHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChzZXRJY29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICAgICAgICBjbGFzc0xpc3Q6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICAgICAgICAgICAgICBjb250YWluczogZXhwZWN0LmFueShGdW5jdGlvbilcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pLCAnY3VzdG9tLWljb24nKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBub3QgY2FsbCBzZXRJY29uIHdoZW4gbm8gaWNvbicsICgpID0+IHtcclxuICAgICAgICAgICAgc2V0SWNvbi5tb2NrQ2xlYXIoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5V2l0aG91dEljb24gPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ25vSWNvbicsICcnKTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1ZhdWx0ID0ge307XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gJ1Rlc3QgVmFsdWUnO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcHJvcGVydHlXaXRob3V0SWNvbi5maWxsRGlzcGxheShtb2NrVmF1bHQsIHZhbHVlLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChzZXRJY29uKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2luaGVyaXRhbmNlIGZyb20gUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIG5hbWUgcHJvcGVydHkgZnJvbSBwYXJlbnQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChjbGFzc2VQcm9wZXJ0eS5uYW1lKS50b0JlKCd0ZXN0Q2xhc3NlJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGF2ZSB0eXBlIHByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoY2xhc3NlUHJvcGVydHkudHlwZSkudG9CZSgnY2xhc3MnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIGljb24gcHJvcGVydHkgZnJvbSBwYXJlbnQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChjbGFzc2VQcm9wZXJ0eS5pY29uKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgdmF1bHQgcHJvcGVydHkgdGhhdCBjYW4gYmUgc2V0JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7IHRlc3Q6ICd2YXVsdCcgfTtcclxuICAgICAgICAgICAgY2xhc3NlUHJvcGVydHkudmF1bHQgPSBtb2NrVmF1bHQ7XHJcbiAgICAgICAgICAgIGV4cGVjdChjbGFzc2VQcm9wZXJ0eS52YXVsdCkudG9CZShtb2NrVmF1bHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2ZpZWxkIHN0cnVjdHVyZSB2YWxpZGF0aW9uJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgaGF2ZSBjb3JyZWN0IERPTSBzdHJ1Y3R1cmUgd2l0aG91dCBpY29uJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcm9wZXJ0eVdpdGhvdXRJY29uID0gbmV3IENsYXNzZVByb3BlcnR5KCd0ZXN0JywgJycpO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnVGVzdCBWYWx1ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9wZXJ0eVdpdGhvdXRJY29uLmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgdmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jaGlsZHJlbi5sZW5ndGgpLnRvQmUoMSk7IC8vIE9ubHkgbGFiZWxcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jaGlsZHJlblswXS50YWdOYW1lKS50b0JlKCdMQUJFTCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBET00gc3RydWN0dXJlIHdpdGggaWNvbicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcHJvcGVydHlXaXRoSWNvbiA9IG5ldyBDbGFzc2VQcm9wZXJ0eSgndGVzdCcsICdpY29uJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tWYXVsdCA9IHt9O1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICdUZXN0IFZhbHVlJztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5V2l0aEljb24uZmlsbERpc3BsYXkobW9ja1ZhdWx0LCB2YWx1ZSwgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmNoaWxkcmVuLmxlbmd0aCkudG9CZSgyKTsgLy8gSWNvbiBjb250YWluZXIgKyBsYWJlbFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmNoaWxkcmVuWzBdLmNsYXNzTGlzdC5jb250YWlucygnaWNvbi1jb250YWluZXInKSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jaGlsZHJlblsxXS50YWdOYW1lKS50b0JlKCdMQUJFTCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIG1haW50YWluIGNvcnJlY3Qgb3JkZXI6IGljb24gZmlyc3QsIHRoZW4gbGFiZWwnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByb3BlcnR5V2l0aEljb24gPSBuZXcgQ2xhc3NlUHJvcGVydHkoJ3Rlc3QnLCAnaWNvbicpO1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVmF1bHQgPSB7fTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSAnVGVzdCBWYWx1ZSc7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9wZXJ0eVdpdGhJY29uLmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgdmFsdWUsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgZmlyc3RDaGlsZCA9IHJlc3VsdC5jaGlsZHJlblswXTtcclxuICAgICAgICAgICAgY29uc3Qgc2Vjb25kQ2hpbGQgPSByZXN1bHQuY2hpbGRyZW5bMV07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoZmlyc3RDaGlsZC5jbGFzc0xpc3QuY29udGFpbnMoJ2ljb24tY29udGFpbmVyJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChzZWNvbmRDaGlsZC50YWdOYW1lKS50b0JlKCdMQUJFTCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=