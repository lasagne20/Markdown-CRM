de7cde230627a86ef1ce49c775894f53
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock ConfigLoader
jest.mock('../../src/Config/ConfigLoader');
const ClassConfigManager_1 = require("../../src/Config/ClassConfigManager");
const ConfigLoader_1 = require("../../src/Config/ConfigLoader");
describe('ClassConfigManager', () => {
    let configManager;
    let mockConfigLoader;
    let mockApp;
    beforeEach(() => {
        jest.clearAllMocks();
        mockApp = {
            getVaultPath: jest.fn(() => '/test/vault'),
            getName: jest.fn(() => 'TestVault')
        };
        // Create mock config loader with correct methods
        mockConfigLoader = {
            loadClassConfig: jest.fn()
        };
        // Mock the constructor
        ConfigLoader_1.ConfigLoader.mockImplementation(() => mockConfigLoader);
        configManager = new ClassConfigManager_1.ClassConfigManager('./test-config', mockApp);
    });
    describe('constructor', () => {
        it('should create instance with config loader', () => {
            expect(ConfigLoader_1.ConfigLoader).toHaveBeenCalledWith('./test-config', mockApp);
        });
    });
    describe('createDynamicClasse', () => {
        it('should create dynamic class from config', async () => {
            const mockConfig = {
                className: 'TestClass',
                classIcon: 'test-icon',
                properties: {},
                displayContainer: {
                    template: 'default',
                    components: []
                }
            };
            mockConfigLoader.loadClassConfig.mockResolvedValue(mockConfig);
            const DynamicClass = await configManager.createDynamicClasse('TestClass');
            expect(mockConfigLoader.loadClassConfig).toHaveBeenCalledWith('TestClass');
            expect(DynamicClass).toBeDefined();
            // Test instance creation
            const mockVault = { app: mockApp };
            const mockFile = { path: 'test.md' };
            const instance = new DynamicClass(mockVault, mockFile);
            expect(instance.name).toBe('TestClass');
            expect(instance.icon).toBe('test-icon');
        });
        it('should return cached class if already loaded', async () => {
            const mockConfig = {
                className: 'TestClass',
                classIcon: 'test-icon',
                properties: {},
                displayContainer: {
                    template: 'default',
                    components: []
                }
            };
            mockConfigLoader.loadClassConfig.mockResolvedValue(mockConfig);
            // First call
            const firstClass = await configManager.createDynamicClasse('TestClass');
            // Second call - should return cached version
            jest.clearAllMocks();
            const secondClass = await configManager.createDynamicClasse('TestClass');
            expect(firstClass).toBe(secondClass);
            expect(mockConfigLoader.loadClassConfig).not.toHaveBeenCalled();
        });
        it('should handle config loading errors', async () => {
            const error = new Error('Config not found');
            mockConfigLoader.loadClassConfig.mockRejectedValue(error);
            await expect(configManager.createDynamicClasse('NonExistentClass'))
                .rejects.toThrow('Config not found');
        });
    });
    describe('getClassConfig', () => {
        it('should delegate to config loader', async () => {
            const mockConfig = {
                className: 'TestClass',
                classIcon: 'test-icon',
                properties: {},
                displayContainer: { template: 'default' }
            };
            mockConfigLoader.loadClassConfig.mockResolvedValue(mockConfig);
            const result = await configManager.getClassConfig('TestClass');
            expect(mockConfigLoader.loadClassConfig).toHaveBeenCalledWith('TestClass');
            expect(result).toBe(mockConfig);
        });
    });
    describe('getAvailableClasses', () => {
        it('should return empty array as default implementation', async () => {
            const result = await configManager.getAvailableClasses();
            expect(Array.isArray(result)).toBe(true);
        });
    });
    describe('clearCache', () => {
        it('should clear loaded classes cache', () => {
            // Add something to cache first
            configManager.loadedClasses.set('TestClass', class {
            });
            expect(configManager.loadedClasses.size).toBe(1);
            configManager.clearCache();
            expect(configManager.loadedClasses.size).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXENvbmZpZ1xcQ2xhc3NDb25maWdNYW5hZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFHQSxvQkFBb0I7QUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0FBSjNDLDRFQUF5RTtBQUN6RSxnRUFBNkQ7QUFLN0QsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNoQyxJQUFJLGFBQWlDLENBQUM7SUFDdEMsSUFBSSxnQkFBMkMsQ0FBQztJQUNoRCxJQUFJLE9BQVksQ0FBQztJQUVqQixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ1osSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLE9BQU8sR0FBRztZQUNOLFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLGFBQWEsQ0FBQztZQUMxQyxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUM7U0FDdEMsQ0FBQztRQUVGLGlEQUFpRDtRQUNqRCxnQkFBZ0IsR0FBRztZQUNmLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ3RCLENBQUM7UUFFVCx1QkFBdUI7UUFDdEIsMkJBQXNELENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUVuRyxhQUFhLEdBQUcsSUFBSSx1Q0FBa0IsQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDckUsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUN6QixFQUFFLENBQUMsMkNBQTJDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELE1BQU0sQ0FBQywyQkFBWSxDQUFDLENB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LGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFMUQsYUFBYSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBRTNCLE1BQU0sQ0FBRSxhQUFxQixDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcX190ZXN0c19fXFxDb25maWdcXENsYXNzQ29uZmlnTWFuYWdlci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENsYXNzQ29uZmlnTWFuYWdlciB9IGZyb20gJy4uLy4uL3NyYy9Db25maWcvQ2xhc3NDb25maWdNYW5hZ2VyJztcclxuaW1wb3J0IHsgQ29uZmlnTG9hZGVyIH0gZnJvbSAnLi4vLi4vc3JjL0NvbmZpZy9Db25maWdMb2FkZXInO1xyXG5cclxuLy8gTW9jayBDb25maWdMb2FkZXJcclxuamVzdC5tb2NrKCcuLi8uLi9zcmMvQ29uZmlnL0NvbmZpZ0xvYWRlcicpO1xyXG5cclxuZGVzY3JpYmUoJ0NsYXNzQ29uZmlnTWFuYWdlcicsICgpID0+IHtcclxuICAgIGxldCBjb25maWdNYW5hZ2VyOiBDbGFzc0NvbmZpZ01hbmFnZXI7XHJcbiAgICBsZXQgbW9ja0NvbmZpZ0xvYWRlcjogamVzdC5Nb2NrZWQ8Q29uZmlnTG9hZGVyPjtcclxuICAgIGxldCBtb2NrQXBwOiBhbnk7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbW9ja0FwcCA9IHtcclxuICAgICAgICAgICAgZ2V0VmF1bHRQYXRoOiBqZXN0LmZuKCgpID0+ICcvdGVzdC92YXVsdCcpLFxyXG4gICAgICAgICAgICBnZXROYW1lOiBqZXN0LmZuKCgpID0+ICdUZXN0VmF1bHQnKVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSBtb2NrIGNvbmZpZyBsb2FkZXIgd2l0aCBjb3JyZWN0IG1ldGhvZHNcclxuICAgICAgICBtb2NrQ29uZmlnTG9hZGVyID0ge1xyXG4gICAgICAgICAgICBsb2FkQ2xhc3NDb25maWc6IGplc3QuZm4oKVxyXG4gICAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgICAvLyBNb2NrIHRoZSBjb25zdHJ1Y3RvclxyXG4gICAgICAgIChDb25maWdMb2FkZXIgYXMgamVzdC5Nb2NrZWRDbGFzczx0eXBlb2YgQ29uZmlnTG9hZGVyPikubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IG1vY2tDb25maWdMb2FkZXIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbmZpZ01hbmFnZXIgPSBuZXcgQ2xhc3NDb25maWdNYW5hZ2VyKCcuL3Rlc3QtY29uZmlnJywgbW9ja0FwcCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY29uc3RydWN0b3InLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgaW5zdGFuY2Ugd2l0aCBjb25maWcgbG9hZGVyJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoQ29uZmlnTG9hZGVyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnLi90ZXN0LWNvbmZpZycsIG1vY2tBcHApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NyZWF0ZUR5bmFtaWNDbGFzc2UnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgZHluYW1pYyBjbGFzcyBmcm9tIGNvbmZpZycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja0NvbmZpZyA9IHtcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ1Rlc3RDbGFzcycsXHJcbiAgICAgICAgICAgICAgICBjbGFzc0ljb246ICd0ZXN0LWljb24nLFxyXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczoge30sXHJcbiAgICAgICAgICAgICAgICBkaXNwbGF5Q29udGFpbmVyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdkZWZhdWx0JyxcclxuICAgICAgICAgICAgICAgICAgICBjb21wb25lbnRzOiBbXVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgbW9ja0NvbmZpZ0xvYWRlci5sb2FkQ2xhc3NDb25maWcubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbmZpZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBEeW5hbWljQ2xhc3MgPSBhd2FpdCBjb25maWdNYW5hZ2VyLmNyZWF0ZUR5bmFtaWNDbGFzc2UoJ1Rlc3RDbGFzcycpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tDb25maWdMb2FkZXIubG9hZENsYXNzQ29uZmlnKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnVGVzdENsYXNzJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChEeW5hbWljQ2xhc3MpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBUZXN0IGluc3RhbmNlIGNyZWF0aW9uXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tWYXVsdCA9IHsgYXBwOiBtb2NrQXBwIH0gYXMgYW55O1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrRmlsZSA9IHsgcGF0aDogJ3Rlc3QubWQnIH0gYXMgYW55O1xyXG4gICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IG5ldyBEeW5hbWljQ2xhc3MobW9ja1ZhdWx0LCBtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoaW5zdGFuY2UubmFtZSkudG9CZSgnVGVzdENsYXNzJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChpbnN0YW5jZS5pY29uKS50b0JlKCd0ZXN0LWljb24nKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gY2FjaGVkIGNsYXNzIGlmIGFscmVhZHkgbG9hZGVkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrQ29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnVGVzdENsYXNzJyxcclxuICAgICAgICAgICAgICAgIGNsYXNzSWNvbjogJ3Rlc3QtaWNvbicsXHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7fSxcclxuICAgICAgICAgICAgICAgIGRpc3BsYXlDb250YWluZXI6IHtcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ2RlZmF1bHQnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudHM6IFtdXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBtb2NrQ29uZmlnTG9hZGVyLmxvYWRDbGFzc0NvbmZpZy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29uZmlnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEZpcnN0IGNhbGxcclxuICAgICAgICAgICAgY29uc3QgZmlyc3RDbGFzcyA9IGF3YWl0IGNvbmZpZ01hbmFnZXIuY3JlYXRlRHluYW1pY0NsYXNzZSgnVGVzdENsYXNzJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTZWNvbmQgY2FsbCAtIHNob3VsZCByZXR1cm4gY2FjaGVkIHZlcnNpb25cclxuICAgICAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlY29uZENsYXNzID0gYXdhaXQgY29uZmlnTWFuYWdlci5jcmVhdGVEeW5hbWljQ2xhc3NlKCdUZXN0Q2xhc3MnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChmaXJzdENsYXNzKS50b0JlKHNlY29uZENsYXNzKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tDb25maWdMb2FkZXIubG9hZENsYXNzQ29uZmlnKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25maWcgbG9hZGluZyBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdDb25maWcgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgIG1vY2tDb25maWdMb2FkZXIubG9hZENsYXNzQ29uZmlnLm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGF3YWl0IGV4cGVjdChjb25maWdNYW5hZ2VyLmNyZWF0ZUR5bmFtaWNDbGFzc2UoJ05vbkV4aXN0ZW50Q2xhc3MnKSlcclxuICAgICAgICAgICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ0NvbmZpZyBub3QgZm91bmQnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdnZXRDbGFzc0NvbmZpZycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGRlbGVnYXRlIHRvIGNvbmZpZyBsb2FkZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tDb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdUZXN0Q2xhc3MnLFxyXG4gICAgICAgICAgICAgICAgY2xhc3NJY29uOiAndGVzdC1pY29uJyxcclxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHt9LFxyXG4gICAgICAgICAgICAgICAgZGlzcGxheUNvbnRhaW5lcjogeyB0ZW1wbGF0ZTogJ2RlZmF1bHQnIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG1vY2tDb25maWdMb2FkZXIubG9hZENsYXNzQ29uZmlnLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDb25maWcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29uZmlnTWFuYWdlci5nZXRDbGFzc0NvbmZpZygnVGVzdENsYXNzJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobW9ja0NvbmZpZ0xvYWRlci5sb2FkQ2xhc3NDb25maWcpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdUZXN0Q2xhc3MnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShtb2NrQ29uZmlnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdnZXRBdmFpbGFibGVDbGFzc2VzJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGFycmF5IGFzIGRlZmF1bHQgaW1wbGVtZW50YXRpb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbmZpZ01hbmFnZXIuZ2V0QXZhaWxhYmxlQ2xhc3NlcygpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0KSkudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdjbGVhckNhY2hlJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY2xlYXIgbG9hZGVkIGNsYXNzZXMgY2FjaGUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIEFkZCBzb21ldGhpbmcgdG8gY2FjaGUgZmlyc3RcclxuICAgICAgICAgICAgKGNvbmZpZ01hbmFnZXIgYXMgYW55KS5sb2FkZWRDbGFzc2VzLnNldCgnVGVzdENsYXNzJywgY2xhc3Mge30pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KChjb25maWdNYW5hZ2VyIGFzIGFueSkubG9hZGVkQ2xhc3Nlcy5zaXplKS50b0JlKDEpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uZmlnTWFuYWdlci5jbGVhckNhY2hlKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoKGNvbmZpZ01hbmFnZXIgYXMgYW55KS5sb2FkZWRDbGFzc2VzLnNpemUpLnRvQmUoMCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9