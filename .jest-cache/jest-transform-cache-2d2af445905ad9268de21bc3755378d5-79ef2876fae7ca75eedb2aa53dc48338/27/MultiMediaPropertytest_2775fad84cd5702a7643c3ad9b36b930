16f9a44dbf2b822ce96b5e37c5ad4d8c
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock the vault utilities
jest.mock('../../vault/Utils', () => ({
    selectMedia: jest.fn(),
    setIcon: jest.fn()
}));
const MediaProperty_1 = require("../../properties/MediaProperty");
const MultiMediaProperty_1 = require("../../properties/MultiMediaProperty");
// Import the mocked functions
const { selectMedia, setIcon } = jest.requireMock('../../vault/Utils');
describe('MultiMediaProperty', () => {
    let multiMediaProperty;
    let mockVault;
    beforeEach(() => {
        // Reset DOM mocks
        document.body.innerHTML = '';
        jest.clearAllMocks();
        // Mock vault with necessary methods
        mockVault = {
            getMediaFromLink: jest.fn().mockReturnValue({ name: 'test.jpg', path: 'path/to/test.jpg' }),
            files: []
        };
        // Assign selectMedia mock to globalThis
        globalThis.selectMedia = selectMedia;
    });
    beforeEach(() => {
        multiMediaProperty = new MultiMediaProperty_1.MultiMediaProperty('testMedia');
    });
    describe('constructor', () => {
        it('should create MultiMediaProperty with correct type', () => {
            expect(multiMediaProperty.type).toBe('multiMedia');
        });
        it('should create MediaProperty instance', () => {
            expect(multiMediaProperty.property).toBeInstanceOf(MediaProperty_1.MediaProperty);
        });
        it('should pass args to parent constructor and MediaProperty', () => {
            const customArgs = { flexSpan: 3 };
            const customProperty = new MultiMediaProperty_1.MultiMediaProperty('customName', customArgs);
            expect(customProperty.name).toBe('customName');
            // flexSpan is hardcoded to 2 in the class, so we test the default value
            expect(customProperty.flexSpan).toBe(2);
        });
    });
    describe('fillDisplay', () => {
        it('should create container with correct classes', () => {
            const update = jest.fn();
            const result = multiMediaProperty.fillDisplay(mockVault, null, update);
            expect(result.classList.contains('metadata-multiFiles-container-testmedia')).toBe(true);
            expect(result.classList.contains('metadata-multiFiles-container')).toBe(true);
        });
        it('should create add button when no values', () => {
            const update = jest.fn();
            const result = multiMediaProperty.fillDisplay(mockVault, null, update);
            const addButton = result.querySelector('.metadata-add-button-inline-small');
            expect(addButton).toBeTruthy();
        });
        it('should create objects when values present', () => {
            const update = jest.fn();
            const values = ['[[file1.jpg]]', '[[file2.jpg]]'];
            const result = multiMediaProperty.fillDisplay(mockVault, values, update);
            const rows = result.querySelectorAll('.metadata-multiFiles-row-inline');
            expect(rows.length).toBe(2);
        });
        it('should set vault property', () => {
            const update = jest.fn();
            multiMediaProperty.fillDisplay(mockVault, null, update);
            expect(multiMediaProperty.vault).toBe(mockVault);
        });
    });
    describe('createObjects', () => {
        it('should handle empty array', () => {
            const update = jest.fn();
            const container = document.createElement('div');
            multiMediaProperty.createObjects([], update, container);
            expect(container.children.length).toBe(0);
        });
        it('should handle null values', () => {
            const update = jest.fn();
            const container = document.createElement('div');
            multiMediaProperty.createObjects(null, update, container);
            expect(container.children.length).toBe(0);
        });
        it('should create rows for each value', () => {
            const update = jest.fn();
            const container = document.createElement('div');
            const values = ['[[file1.jpg]]', '[[file2.jpg]]'];
            multiMediaProperty.vault = mockVault;
            multiMediaProperty.createObjects(values, update, container);
            expect(container.children.length).toBe(2);
        });
    });
    describe('createObjectRow', () => {
        it('should create row with correct structure', () => {
            const update = jest.fn();
            const container = document.createElement('div');
            const values = ['[[test.jpg]]'];
            const value = '[[test.jpg]]';
            const index = 0;
            multiMediaProperty.vault = mockVault;
            const row = multiMediaProperty.createObjectRow(values, update, value, index, container);
            expect(row.classList.contains('metadata-multiFiles-row-inline')).toBe(true);
            expect(row.querySelector('.metadata-delete-button-inline-small')).toBeTruthy();
        });
        it('should call property.fillDisplay with correct parameters', () => {
            const update = jest.fn();
            const container = document.createElement('div');
            const values = ['[[test.jpg]]'];
            const value = '[[test.jpg]]';
            const index = 0;
            multiMediaProperty.vault = mockVault;
            const spy = jest.spyOn(multiMediaProperty.property, 'fillDisplay');
            multiMediaProperty.createObjectRow(values, update, value, index, container);
            expect(spy).toHaveBeenCalledWith(mockVault, value, expect.any(Function));
        });
    });
    describe('createDeleteButton', () => {
        it('should create button with correct classes and icon', () => {
            const values = ['[[file1.jpg]]'];
            const index = 0;
            const update = jest.fn();
            const container = document.createElement('div');
            const button = multiMediaProperty.createDeleteButton(values, update, index, container);
            expect(button.classList.contains('metadata-delete-button-inline-small')).toBe(true);
        });
        it('should have onclick handler', () => {
            const values = ['[[file1.jpg]]'];
            const index = 0;
            const update = jest.fn();
            const container = document.createElement('div');
            const button = multiMediaProperty.createDeleteButton(values, update, index, container);
            expect(button.onclick).toBeTruthy();
        });
    });
    describe('createAddButton', () => {
        it('should create button with correct classes and icon', () => {
            const values = [];
            const update = jest.fn();
            const container = document.createElement('div');
            const button = multiMediaProperty.createAddButton(values, update, container);
            expect(button.classList.contains('metadata-add-button-inline-small')).toBe(true);
        });
        it('should have onclick handler', () => {
            const values = [];
            const update = jest.fn();
            const container = document.createElement('div');
            const button = multiMediaProperty.createAddButton(values, update, container);
            expect(button.onclick).toBeTruthy();
        });
    });
    describe('addProperty', () => {
        it('should add media when selectMedia returns file', async () => {
            const mockUpdate = jest.fn();
            const container = document.createElement('div');
            const mockFile = { path: 'path/to/image.jpg', name: 'image.jpg' };
            const values = [];
            multiMediaProperty.vault = mockVault;
            selectMedia.mockResolvedValue(mockFile);
            jest.spyOn(multiMediaProperty, 'reloadObjects').mockResolvedValue(undefined);
            await multiMediaProperty.addProperty(values, mockUpdate, container);
            expect(values).toContain('[[path/to/image.jpg|image.jpg]]');
            expect(mockUpdate).toHaveBeenCalledWith(values);
        });
        it('should initialize values array if null', async () => {
            const mockUpdate = jest.fn();
            const container = document.createElement('div');
            const mockFile = { path: 'path/to/image.jpg', name: 'image.jpg' };
            let values = null;
            multiMediaProperty.vault = mockVault;
            selectMedia.mockResolvedValue(mockFile);
            jest.spyOn(multiMediaProperty, 'reloadObjects').mockResolvedValue(undefined);
            await multiMediaProperty.addProperty(values, mockUpdate, container);
            expect(mockUpdate).toHaveBeenCalled();
        });
        it('should not update when selectMedia returns null', async () => {
            const mockUpdate = jest.fn();
            const container = document.createElement('div');
            const values = [];
            multiMediaProperty.vault = mockVault;
            selectMedia.mockResolvedValue(null);
            await multiMediaProperty.addProperty(values, mockUpdate, container);
            expect(values).toHaveLength(0);
            expect(mockUpdate).not.toHaveBeenCalled();
        });
        it('should not update when selectMedia returns undefined', async () => {
            const mockUpdate = jest.fn();
            const container = document.createElement('div');
            const values = [];
            multiMediaProperty.vault = mockVault;
            selectMedia.mockResolvedValue(undefined);
            await multiMediaProperty.addProperty(values, mockUpdate, container);
            expect(values).toHaveLength(0);
            expect(mockUpdate).not.toHaveBeenCalled();
        });
    });
    describe('reloadObjects method inheritance', () => {
        it('should have reloadObjects method from parent class', () => {
            expect(typeof multiMediaProperty.reloadObjects).toBe('function');
        });
        it('should call reloadObjects when implemented by mock', async () => {
            const values = ['[[file1.jpg]]'];
            const update = jest.fn();
            jest.spyOn(multiMediaProperty, 'reloadObjects').mockResolvedValue(undefined);
            await multiMediaProperty.reloadObjects(values, update);
            expect(multiMediaProperty.reloadObjects).toHaveBeenCalledWith(values, update);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXF9fdGVzdHNfX1xcUHJvcGVydGllc1xcTXVsdGlNZWRpYVByb3BlcnR5LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUtILDJCQUEyQjtBQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDbEMsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDdEIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDckIsQ0FBQyxDQUFDLENBQUM7QUFQSixrRUFBK0Q7QUFDL0QsNEVBQXlFO0FBUXpFLDhCQUE4QjtBQUM5QixNQUFNLEVBQUUsV0FBVyxFQUFFLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUV2RSxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO0lBQ2hDLElBQUksa0JBQXNDLENBQUM7SUFDM0MsSUFBSSxTQUFjLENBQUM7SUFFbkIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLGtCQUFrQjtRQUNsQixRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDN0IsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLG9DQUFvQztRQUNwQyxTQUFTLEdBQUc7WUFDUixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQztZQUMzRixLQUFLLEVBQUUsRUFBRTtTQUNaLENBQUM7UUFFRix3Q0FBd0M7UUFDeEMsVUFBVSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7SUFDekMsQ0FBQyxD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LENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3JFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG9EQUFvRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2hFLE1BQU0sTUFBTSxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDakMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBRXpCLElBQUksQ0FBQyxLQUFLLENBQUMsa0JBQWtCLEVBQUUsZUFBZSxDQUFDLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFN0UsTUFBTSxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRXZELE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDbEYsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcc3JjXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXE11bHRpTWVkaWFQcm9wZXJ0eS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAamVzdC1lbnZpcm9ubWVudCBqc2RvbVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IE1lZGlhUHJvcGVydHkgfSBmcm9tICcuLi8uLi9wcm9wZXJ0aWVzL01lZGlhUHJvcGVydHknO1xyXG5pbXBvcnQgeyBNdWx0aU1lZGlhUHJvcGVydHkgfSBmcm9tICcuLi8uLi9wcm9wZXJ0aWVzL011bHRpTWVkaWFQcm9wZXJ0eSc7XHJcblxyXG4vLyBNb2NrIHRoZSB2YXVsdCB1dGlsaXRpZXNcclxuamVzdC5tb2NrKCcuLi8uLi92YXVsdC9VdGlscycsICgpID0+ICh7XHJcbiAgICBzZWxlY3RNZWRpYTogamVzdC5mbigpLFxyXG4gICAgc2V0SWNvbjogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbi8vIEltcG9ydCB0aGUgbW9ja2VkIGZ1bmN0aW9uc1xyXG5jb25zdCB7IHNlbGVjdE1lZGlhLCBzZXRJY29uIH0gPSBqZXN0LnJlcXVpcmVNb2NrKCcuLi8uLi92YXVsdC9VdGlscycpO1xyXG5cclxuZGVzY3JpYmUoJ011bHRpTWVkaWFQcm9wZXJ0eScsICgpID0+IHtcclxuICAgIGxldCBtdWx0aU1lZGlhUHJvcGVydHk6IE11bHRpTWVkaWFQcm9wZXJ0eTtcclxuICAgIGxldCBtb2NrVmF1bHQ6IGFueTtcclxuXHJcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAvLyBSZXNldCBET00gbW9ja3NcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmlubmVySFRNTCA9ICcnO1xyXG4gICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIE1vY2sgdmF1bHQgd2l0aCBuZWNlc3NhcnkgbWV0aG9kc1xyXG4gICAgICAgIG1vY2tWYXVsdCA9IHtcclxuICAgICAgICAgICAgZ2V0TWVkaWFGcm9tTGluazogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IG5hbWU6ICd0ZXN0LmpwZycsIHBhdGg6ICdwYXRoL3RvL3Rlc3QuanBnJyB9KSxcclxuICAgICAgICAgICAgZmlsZXM6IFtdXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gQXNzaWduIHNlbGVjdE1lZGlhIG1vY2sgdG8gZ2xvYmFsVGhpc1xyXG4gICAgICAgIGdsb2JhbFRoaXMuc2VsZWN0TWVkaWEgPSBzZWxlY3RNZWRpYTtcclxuICAgIH0pO1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIG11bHRpTWVkaWFQcm9wZXJ0eSA9IG5ldyBNdWx0aU1lZGlhUHJvcGVydHkoJ3Rlc3RNZWRpYScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NvbnN0cnVjdG9yJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIE11bHRpTWVkaWFQcm9wZXJ0eSB3aXRoIGNvcnJlY3QgdHlwZScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KG11bHRpTWVkaWFQcm9wZXJ0eS50eXBlKS50b0JlKCdtdWx0aU1lZGlhJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIE1lZGlhUHJvcGVydHkgaW5zdGFuY2UnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChtdWx0aU1lZGlhUHJvcGVydHkucHJvcGVydHkpLnRvQmVJbnN0YW5jZU9mKE1lZGlhUHJvcGVydHkpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHBhc3MgYXJncyB0byBwYXJlbnQgY29uc3RydWN0b3IgYW5kIE1lZGlhUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbUFyZ3MgPSB7IGZsZXhTcGFuOiAzIH07XHJcbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbVByb3BlcnR5ID0gbmV3IE11bHRpTWVkaWFQcm9wZXJ0eSgnY3VzdG9tTmFtZScsIGN1c3RvbUFyZ3MpO1xyXG4gICAgICAgICAgICBleHBlY3QoY3VzdG9tUHJvcGVydHkubmFtZSkudG9CZSgnY3VzdG9tTmFtZScpO1xyXG4gICAgICAgICAgICAvLyBmbGV4U3BhbiBpcyBoYXJkY29kZWQgdG8gMiBpbiB0aGUgY2xhc3MsIHNvIHdlIHRlc3QgdGhlIGRlZmF1bHQgdmFsdWVcclxuICAgICAgICAgICAgZXhwZWN0KGN1c3RvbVByb3BlcnR5LmZsZXhTcGFuKS50b0JlKDIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2ZpbGxEaXNwbGF5JywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGNvbnRhaW5lciB3aXRoIGNvcnJlY3QgY2xhc3NlcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBtdWx0aU1lZGlhUHJvcGVydHkuZmlsbERpc3BsYXkobW9ja1ZhdWx0LCBudWxsLCB1cGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jbGFzc0xpc3QuY29udGFpbnMoJ21ldGFkYXRhLW11bHRpRmlsZXMtY29udGFpbmVyLXRlc3RtZWRpYScpKS50b0JlKHRydWUpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmNsYXNzTGlzdC5jb250YWlucygnbWV0YWRhdGEtbXVsdGlGaWxlcy1jb250YWluZXInKSkudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgYWRkIGJ1dHRvbiB3aGVuIG5vIHZhbHVlcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBtdWx0aU1lZGlhUHJvcGVydHkuZmlsbERpc3BsYXkobW9ja1ZhdWx0LCBudWxsLCB1cGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgYWRkQnV0dG9uID0gcmVzdWx0LnF1ZXJ5U2VsZWN0b3IoJy5tZXRhZGF0YS1hZGQtYnV0dG9uLWlubGluZS1zbWFsbCcpO1xyXG4gICAgICAgICAgICBleHBlY3QoYWRkQnV0dG9uKS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIG9iamVjdHMgd2hlbiB2YWx1ZXMgcHJlc2VudCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBbJ1tbZmlsZTEuanBnXV0nLCAnW1tmaWxlMi5qcGddXSddO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBtdWx0aU1lZGlhUHJvcGVydHkuZmlsbERpc3BsYXkobW9ja1ZhdWx0LCB2YWx1ZXMsIHVwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCByb3dzID0gcmVzdWx0LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tZXRhZGF0YS1tdWx0aUZpbGVzLXJvdy1pbmxpbmUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJvd3MubGVuZ3RoKS50b0JlKDIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHNldCB2YXVsdCBwcm9wZXJ0eScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbXVsdGlNZWRpYVByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgbnVsbCwgdXBkYXRlKTtcclxuICAgICAgICAgICAgZXhwZWN0KG11bHRpTWVkaWFQcm9wZXJ0eS52YXVsdCkudG9CZShtb2NrVmF1bHQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NyZWF0ZU9iamVjdHMnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgYXJyYXknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtdWx0aU1lZGlhUHJvcGVydHkuY3JlYXRlT2JqZWN0cyhbXSwgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCkudG9CZSgwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbnVsbCB2YWx1ZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtdWx0aU1lZGlhUHJvcGVydHkuY3JlYXRlT2JqZWN0cyhudWxsLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoKS50b0JlKDApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSByb3dzIGZvciBlYWNoIHZhbHVlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBbJ1tbZmlsZTEuanBnXV0nLCAnW1tmaWxlMi5qcGddXSddO1xyXG4gICAgICAgICAgICBtdWx0aU1lZGlhUHJvcGVydHkudmF1bHQgPSBtb2NrVmF1bHQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtdWx0aU1lZGlhUHJvcGVydHkuY3JlYXRlT2JqZWN0cyh2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGgpLnRvQmUoMik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY3JlYXRlT2JqZWN0Um93JywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIHJvdyB3aXRoIGNvcnJlY3Qgc3RydWN0dXJlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBbJ1tbdGVzdC5qcGddXSddO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICdbW3Rlc3QuanBnXV0nO1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IDA7XHJcbiAgICAgICAgICAgIG11bHRpTWVkaWFQcm9wZXJ0eS52YXVsdCA9IG1vY2tWYXVsdDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJvdyA9IG11bHRpTWVkaWFQcm9wZXJ0eS5jcmVhdGVPYmplY3RSb3codmFsdWVzLCB1cGRhdGUsIHZhbHVlLCBpbmRleCwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdtZXRhZGF0YS1tdWx0aUZpbGVzLXJvdy1pbmxpbmUnKSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJvdy5xdWVyeVNlbGVjdG9yKCcubWV0YWRhdGEtZGVsZXRlLWJ1dHRvbi1pbmxpbmUtc21hbGwnKSkudG9CZVRydXRoeSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNhbGwgcHJvcGVydHkuZmlsbERpc3BsYXkgd2l0aCBjb3JyZWN0IHBhcmFtZXRlcnMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IFsnW1t0ZXN0LmpwZ11dJ107XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gJ1tbdGVzdC5qcGddXSc7XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gMDtcclxuICAgICAgICAgICAgbXVsdGlNZWRpYVByb3BlcnR5LnZhdWx0ID0gbW9ja1ZhdWx0O1xyXG4gICAgICAgICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKG11bHRpTWVkaWFQcm9wZXJ0eS5wcm9wZXJ0eSwgJ2ZpbGxEaXNwbGF5Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtdWx0aU1lZGlhUHJvcGVydHkuY3JlYXRlT2JqZWN0Um93KHZhbHVlcywgdXBkYXRlLCB2YWx1ZSwgaW5kZXgsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3Qoc3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrVmF1bHQsIHZhbHVlLCBleHBlY3QuYW55KEZ1bmN0aW9uKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnY3JlYXRlRGVsZXRlQnV0dG9uJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGJ1dHRvbiB3aXRoIGNvcnJlY3QgY2xhc3NlcyBhbmQgaWNvbicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gWydbW2ZpbGUxLmpwZ11dJ107XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gMDtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9IG11bHRpTWVkaWFQcm9wZXJ0eS5jcmVhdGVEZWxldGVCdXR0b24odmFsdWVzLCB1cGRhdGUsIGluZGV4LCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoJ21ldGFkYXRhLWRlbGV0ZS1idXR0b24taW5saW5lLXNtYWxsJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGF2ZSBvbmNsaWNrIGhhbmRsZXInLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IFsnW1tmaWxlMS5qcGddXSddO1xyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IDA7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBidXR0b24gPSBtdWx0aU1lZGlhUHJvcGVydHkuY3JlYXRlRGVsZXRlQnV0dG9uKHZhbHVlcywgdXBkYXRlLCBpbmRleCwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChidXR0b24ub25jbGljaykudG9CZVRydXRoeSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2NyZWF0ZUFkZEJ1dHRvbicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBidXR0b24gd2l0aCBjb3JyZWN0IGNsYXNzZXMgYW5kIGljb24nLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlczogYW55W10gPSBbXTtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9IG11bHRpTWVkaWFQcm9wZXJ0eS5jcmVhdGVBZGRCdXR0b24odmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygnbWV0YWRhdGEtYWRkLWJ1dHRvbi1pbmxpbmUtc21hbGwnKSkudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIG9uY2xpY2sgaGFuZGxlcicsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gbXVsdGlNZWRpYVByb3BlcnR5LmNyZWF0ZUFkZEJ1dHRvbih2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChidXR0b24ub25jbGljaykudG9CZVRydXRoeSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2FkZFByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgYWRkIG1lZGlhIHdoZW4gc2VsZWN0TWVkaWEgcmV0dXJucyBmaWxlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja0ZpbGUgPSB7IHBhdGg6ICdwYXRoL3RvL2ltYWdlLmpwZycsIG5hbWU6ICdpbWFnZS5qcGcnIH07XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlczogYW55W10gPSBbXTtcclxuICAgICAgICAgICAgbXVsdGlNZWRpYVByb3BlcnR5LnZhdWx0ID0gbW9ja1ZhdWx0O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgKHNlbGVjdE1lZGlhIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBqZXN0LnNweU9uKG11bHRpTWVkaWFQcm9wZXJ0eSwgJ3JlbG9hZE9iamVjdHMnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYXdhaXQgbXVsdGlNZWRpYVByb3BlcnR5LmFkZFByb3BlcnR5KHZhbHVlcywgbW9ja1VwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdCh2YWx1ZXMpLnRvQ29udGFpbignW1twYXRoL3RvL2ltYWdlLmpwZ3xpbWFnZS5qcGddXScpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1VwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgodmFsdWVzKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHZhbHVlcyBhcnJheSBpZiBudWxsJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgY29uc3QgbW9ja0ZpbGUgPSB7IHBhdGg6ICdwYXRoL3RvL2ltYWdlLmpwZycsIG5hbWU6ICdpbWFnZS5qcGcnIH07XHJcbiAgICAgICAgICAgIGxldCB2YWx1ZXM6IGFueSA9IG51bGw7XHJcbiAgICAgICAgICAgIG11bHRpTWVkaWFQcm9wZXJ0eS52YXVsdCA9IG1vY2tWYXVsdDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIChzZWxlY3RNZWRpYSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgamVzdC5zcHlPbihtdWx0aU1lZGlhUHJvcGVydHksICdyZWxvYWRPYmplY3RzJykubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGF3YWl0IG11bHRpTWVkaWFQcm9wZXJ0eS5hZGRQcm9wZXJ0eSh2YWx1ZXMsIG1vY2tVcGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QobW9ja1VwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIG5vdCB1cGRhdGUgd2hlbiBzZWxlY3RNZWRpYSByZXR1cm5zIG51bGwnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZXM6IGFueVtdID0gW107XHJcbiAgICAgICAgICAgIG11bHRpTWVkaWFQcm9wZXJ0eS52YXVsdCA9IG1vY2tWYXVsdDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIChzZWxlY3RNZWRpYSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYXdhaXQgbXVsdGlNZWRpYVByb3BlcnR5LmFkZFByb3BlcnR5KHZhbHVlcywgbW9ja1VwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdCh2YWx1ZXMpLnRvSGF2ZUxlbmd0aCgwKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tVcGRhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgbm90IHVwZGF0ZSB3aGVuIHNlbGVjdE1lZGlhIHJldHVybnMgdW5kZWZpbmVkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xyXG4gICAgICAgICAgICBtdWx0aU1lZGlhUHJvcGVydHkudmF1bHQgPSBtb2NrVmF1bHQ7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAoc2VsZWN0TWVkaWEgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYXdhaXQgbXVsdGlNZWRpYVByb3BlcnR5LmFkZFByb3BlcnR5KHZhbHVlcywgbW9ja1VwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdCh2YWx1ZXMpLnRvSGF2ZUxlbmd0aCgwKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tVcGRhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgncmVsb2FkT2JqZWN0cyBtZXRob2QgaW5oZXJpdGFuY2UnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYXZlIHJlbG9hZE9iamVjdHMgbWV0aG9kIGZyb20gcGFyZW50IGNsYXNzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QodHlwZW9mIG11bHRpTWVkaWFQcm9wZXJ0eS5yZWxvYWRPYmplY3RzKS50b0JlKCdmdW5jdGlvbicpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNhbGwgcmVsb2FkT2JqZWN0cyB3aGVuIGltcGxlbWVudGVkIGJ5IG1vY2snLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IFsnW1tmaWxlMS5qcGddXSddO1xyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBqZXN0LnNweU9uKG11bHRpTWVkaWFQcm9wZXJ0eSwgJ3JlbG9hZE9iamVjdHMnKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYXdhaXQgbXVsdGlNZWRpYVByb3BlcnR5LnJlbG9hZE9iamVjdHModmFsdWVzLCB1cGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KG11bHRpTWVkaWFQcm9wZXJ0eS5yZWxvYWRPYmplY3RzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh2YWx1ZXMsIHVwZGF0ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9