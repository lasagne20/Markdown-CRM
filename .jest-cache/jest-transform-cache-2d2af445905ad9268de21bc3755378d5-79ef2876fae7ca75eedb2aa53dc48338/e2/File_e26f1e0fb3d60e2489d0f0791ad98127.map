{"file":"C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\vault\\File.ts","mappings":"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","names":[],"sources":["C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\vault\\File.ts"],"sourcesContent":["import { IApp, IFile, IFolder } from \"../interfaces/IApp\";\r\nimport { Vault } from \"./Vault\";\r\nimport { waitForFileMetaDataUpdate, waitForMetaDataCacheUpdate } from \"./Utils\";\r\nimport { dump, load as parseYaml } from 'js-yaml';\r\n\r\nexport class Folder {\r\n\r\n}\r\n\r\nexport class File implements IFile {\r\n    /*\r\n    Allow to quickly use files methods\r\n    */\r\n    public vault : Vault;\r\n    public file: any;\r\n    private lock : boolean;\r\n    public linkRegex = /^\"?\\[\\[(.*?)\\]\\]\"?$/;\r\n\r\n    public name : string;\r\n    public path : string;\r\n    public basename : string;\r\n    public extension : string;\r\n\r\n    constructor(vault : Vault, file: IFile) {\r\n      this.vault = vault;\r\n      this.file = file;\r\n      this.lock = false\r\n\r\n      this.name = file.name;\r\n      this.path = file.path;\r\n      this.basename = file.basename;\r\n      this.extension = file.extension;\r\n\r\n    }\r\n\r\n    getFolderPath(){\r\n      return this.file.path.substring(0, this.file.path.lastIndexOf(\"/\"))\r\n    }\r\n\r\n    getFile(){\r\n      return this.file\r\n    }\r\n\r\n    isFolderFile(){\r\n      // Return true if the file is also a folder\r\n      return this.file.path.substring(0, this.file.path.lastIndexOf(\"/\")).endsWith(this.getName().replace(\".md\", \"\"))\r\n    }\r\n\r\n    getFolderFilePath(){\r\n      // Return the folderFile path\r\n      let path = this.getFolderPath()\r\n      if (this.isFolderFile()){\r\n        return path\r\n      }\r\n      return path + \"/\" + this.getName(false)\r\n    }\r\n\r\n    getParentFolderPath(){\r\n      let path = this.getFolderPath()\r\n      if (this.isFolderFile()){\r\n        path = path.substring(0, path.lastIndexOf(\"/\"))\r\n      }\r\n      return path\r\n    }\r\n\r\n    getName(md=true){\r\n      if (md){\r\n        return this.file.name\r\n      }\r\n      return this.file.name.replace(\".md\",\"\")\r\n    }\r\n\r\n    async getID(): Promise<string> {\r\n      let id = (await this.getMetadata())?.Id\r\n      if (!id){\r\n        id = require(\"uuid\").v4()\r\n        this.updateMetadata(\"Id\", id)\r\n      }\r\n      return id\r\n    }\r\n\r\n    getPath(){\r\n      // Return the file path\r\n      return this.file.path\r\n    }\r\n\r\n    getLink(){\r\n      return `[[${this.getPath()}|${this.getName(false)}]]`\r\n    }\r\n\r\n    async move(targetFolderPath: string, targetFileName?: string) {\r\n      if (this.lock) {\r\n        while (this.lock) {\r\n          await new Promise(resolve => setTimeout(resolve, 100));\r\n          console.log(\"Waiting for lock\")\r\n        }\r\n      };\r\n      this.lock = true;\r\n      if (!targetFileName){\r\n        targetFileName = this.getName();\r\n      }\r\n      try {\r\n        // Check if the folder of the target pathname exist\r\n        let subtargetPath = targetFolderPath + \"/\" + targetFileName\r\n        const folder = await this.vault.app.getFile(subtargetPath);\r\n        if (folder) {\r\n          targetFolderPath = subtargetPath;\r\n        }\r\n\r\n        // Check if we need to move the file or the folder\r\n        let moveFile : any = this.file\r\n        let newFilePath = `${targetFolderPath}/${targetFileName}`;\r\n        if (this.isFolderFile()){\r\n          let folder = await this.vault.app.getFile(this.getFolderPath())\r\n          if (folder){\r\n            moveFile = folder\r\n            newFilePath = newFilePath.replace(\".md\",\"\")\r\n          }\r\n        }\r\n\r\n        // Vérification si le fichier cible existe déjà\r\n        const existingFile = await this.vault.app.getFile(newFilePath);\r\n        if (existingFile) {\r\n            console.log('Le fichier existe déjà, impossible de déplacer.');\r\n            this.lock = false;\r\n            return;\r\n        }\r\n    \r\n        try {\r\n            // Essayer de déplacer le fichier\r\n            if (moveFile) {\r\n                await this.vault.app.renameFile(moveFile, newFilePath);\r\n                console.log(`Fichier déplacé vers ${newFilePath}`);\r\n            }\r\n        } catch (error) {\r\n            console.error('Erreur lors du déplacement du fichier :', error);\r\n        }\r\n      }\r\n      finally {\r\n          this.lock = false;\r\n      }\r\n  }\r\n  getFromLink(name:  string) : any{\r\n    return this.vault.getFromLink(name)\r\n  }\r\n\r\n    async getMetadata() : Promise <Record<string, any>>{\r\n      let metadata = await this.vault.app.getMetadata(this.file);\r\n      return metadata\r\n    }\r\n\r\n    async getMetadataValue(key: string){\r\n      let metadata = await this.getMetadata();\r\n      return metadata ? metadata[key] : undefined;\r\n    }\r\n\r\n    getAllProperties(){\r\n      let metadata = this.getMetadata();\r\n      if (!metadata) return {};\r\n      // Return property objects that match the expected format\r\n      const properties: Record<string, any> = {};\r\n      for (const key in metadata) {\r\n        properties[key] = { name: key };\r\n      }\r\n      return properties;\r\n    }\r\n\r\n  \r\n    async updateMetadata(key: string, value: any) {\r\n      if (this.lock) {\r\n        while (this.lock) {\r\n          await new Promise(resolve => setTimeout(resolve, 100));\r\n          console.log(\"Waiting for lock\")\r\n        }\r\n      };\r\n      this.lock = true;\r\n      \r\n      try {\r\n        console.log(\"Update metadata on \" + this.getName() +\" : \" + key + \" --> \" + value)\r\n        const fileContent = await this.vault.app.readFile(this.file);\r\n        const { body } = this.extractFrontmatter(fileContent);\r\n      \r\n        const { existingFrontmatter } = this.extractFrontmatter(fileContent);\r\n\r\n        if (!existingFrontmatter) {this.lock = false; return;}\r\n\r\n        try {\r\n            let frontmatter = parseYaml(existingFrontmatter) as any;\r\n\r\n            if (!frontmatter) {this.lock = false; return;};\r\n            frontmatter[key] = value;\r\n            const newFrontmatter = dump(frontmatter);\r\n\r\n            const newContent = `---\\n${newFrontmatter}\\n---\\n${body}`; //${extraText}\r\n            await this.vault.app.writeFile(this.file, newContent);\r\n            await this.vault.app.waitForFileMetaDataUpdate(this.getPath(), key, async () => { return; })\r\n            console.log(\"Metdata updated\")\r\n\r\n        } catch (error) {\r\n            console.error(\"❌ Erreur lors du parsing du frontmatter:\", error);\r\n        }\r\n      }\r\n      finally {\r\n          this.lock = false;\r\n      }\r\n    }\r\n\r\n    async removeMetadata(key: string) {\r\n      console.log(\"Remove metadata \" + key)\r\n      const frontmatter = await this.getMetadata();\r\n      if (!frontmatter) return;\r\n      delete frontmatter[key]\r\n      await this.saveFrontmatter(frontmatter);\r\n    }\r\n    \r\n    async reorderMetadata(propertiesOrder: string[]) {\r\n        const frontmatter = this.getMetadata();\r\n        if (!frontmatter) return;\r\n\r\n        propertiesOrder.push(\"Id\")\r\n\r\n        if (JSON.stringify(propertiesOrder) === JSON.stringify(Object.keys(frontmatter))) return;\r\n\r\n        console.log(\"Re-order metadata\");\r\n        // Sort properties and extract extra ones\r\n        const { sortedFrontmatter, extraProperties } = this.sortFrontmatter(frontmatter, propertiesOrder);\r\n        await this.saveFrontmatter(sortedFrontmatter, extraProperties);\r\n    }\r\n    \r\n    async saveFrontmatter(frontmatter: Record<string, any>, extraProperties: string[] = []) {\r\n        const fileContent = await this.vault.app.readFile(this.file);\r\n        const { body } = this.extractFrontmatter(fileContent);\r\n    \r\n        // Reformater le frontmatter\r\n        const newFrontmatter = dump(frontmatter);\r\n        const filteredExtraProperties = extraProperties.filter(prop => prop && prop.trim() !== \"\");\r\n        //const extraText = filteredExtraProperties.length > 0 ? `\\n${filteredExtraProperties.join(\"\\n\")}` : \"\";\r\n\r\n        \r\n        // Sauvegarde du fichier\r\n        const newContent = `---\\n${newFrontmatter}\\n---\\n${body}`; //${extraText}\r\n        await this.vault.app.writeFile(this.file, newContent);\r\n        console.log(\"Updated file\")\r\n    }\r\n\r\n    \r\n    // Extraire le frontmatter et le reste du contenu\r\n    extractFrontmatter(content: string) {\r\n        const frontmatterRegex = /^---\\n([\\s\\S]+?)\\n---\\n/;\r\n        const match = content.match(frontmatterRegex);\r\n        return {\r\n            existingFrontmatter: match ? match[1] : \"\",\r\n            body: match ? content.replace(match[0], \"\") : content,\r\n        };\r\n    }\r\n    \r\n    // Trier les propriétés et identifier celles en surplus\r\n    // Méthode simple pour les tests\r\n    formatFrontmatter(frontmatter: Record<string, any>): string {\r\n        return dump(frontmatter);\r\n    }\r\n\r\n    sortFrontmatter(frontmatter: Record<string, any>, propertiesOrder: string[]) {\r\n        let sortedFrontmatter: Record<string, any> = {};\r\n        let extraProperties: string[] = [];\r\n        \r\n        propertiesOrder.forEach(prop => {\r\n            if (prop in frontmatter) {\r\n                sortedFrontmatter[prop] = frontmatter[prop];\r\n            } else {\r\n                sortedFrontmatter[prop] = null;\r\n            }\r\n        });\r\n        \r\n        Object.keys(frontmatter).forEach(prop => {\r\n            if (!propertiesOrder.includes(prop)) {\r\n                extraProperties.push(`${prop}: ${JSON.stringify(frontmatter[prop])}`);\r\n            }\r\n        });\r\n        \r\n        return { sortedFrontmatter, extraProperties };\r\n    }\r\n}"],"version":3}