df91666d49d721000977d13de408b8bf
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DateProperty = void 0;
const flatpickr_1 = __importDefault(require("flatpickr"));
const fr_js_1 = require("flatpickr/dist/l10n/fr.js");
const Utils_1 = require("../vault/Utils");
const Property_1 = require("./Property");
const iconMap = {
    "yesterday": "calendar-arrow-down",
    "today": "calendar-check",
    "tomorrow": "calendar-arrow-up",
    "next-week": "calendar-clock"
};
class DateProperty extends Property_1.Property {
    constructor(name, quickSelectIcons, args = {}) {
        super(name, args);
        this.type = "date";
        this.quickSelectIcons = quickSelectIcons;
    }
    // Crée l'affichage du champ date
    fillDisplay(vault, value, update) {
        this.vault = vault;
        const fieldContainer = document.createElement("div");
        fieldContainer.classList.add("field-container-column");
        const field = document.createElement("div");
        field.classList.add("metadata-field");
        const dateContainer = this.createFieldContainerContent(update, value);
        field.appendChild(dateContainer);
        if (this.title) {
            const header = document.createElement("div");
            header.classList.add("metadata-header");
            header.textContent = this.name;
            fieldContainer.appendChild(header);
        }
        fieldContainer.appendChild(field);
        return fieldContainer;
    }
    // Crée un champ d'input pour la date
    createFieldDate(value, update, link) {
        const input = document.createElement("input");
        input.type = "text";
        input.value = value || ""; // Formaté en "YYYY-MM-DD" pour le stockage
        input.classList.add("field-input");
        (0, flatpickr_1.default)(input, {
            dateFormat: "Y-m-d", // Stocker en "YYYY-MM-DD"
            defaultDate: value || "",
            locale: fr_js_1.French,
            onChange: async (selectedDates) => {
                const selectedDate = selectedDates[0];
                if (selectedDate) {
                    // Met à jour la valeur de l'input avec le format "YYYY-MM-DD"
                    input.value = this.formatDateForStorage(selectedDate);
                    await this.updateField(update, input, link);
                }
            },
            onClose: async () => {
                input.value = "";
                await this.updateField(update, input, link);
            }
        });
        return input;
    }
    // Crée un lien qui affiche la date (au format "26 février 2025")
    createFieldLink(value) {
        const link = document.createElement("div");
        link.textContent = value ? this.formatDateForDisplay(value) : "Aucune date sélectionnée";
        link.classList.add("date-field-link");
        link.classList.add("field-link");
        link.style.cursor = "pointer";
        link.addEventListener("click", (event) => this.modifyField(event));
        return link;
    }
    // Formate la date pour l'affichage : "26 février 2025"
    formatDateForDisplay(date) {
        const parsedDate = new Date(date);
        return parsedDate.toLocaleDateString("fr-FR", {
            day: "numeric",
            month: "long",
            year: "numeric"
        });
    }
    // Formate la date pour le stockage : "YYYY-MM-DD"
    formatDateForStorage(date) {
        // Use toISOString to avoid timezone issues, then extract date part
        return date.toISOString().split('T')[0];
    }
    // Ajoute les options "Aujourd'hui", "Demain", "Semaine prochaine"
    createQuickSelect(value, update, link, input) {
        const quickSelectContainer = document.createElement("div");
        quickSelectContainer.classList.add("quick-select-container");
        this.quickSelectIcons.forEach(option => {
            const button = document.createElement("button");
            (0, Utils_1.setIcon)(button, iconMap[option]);
            button.addEventListener("click", async () => {
                const date = this.getDateForOption(option); // Obtenir la date pour l'option choisie
                await update(this.formatDateForStorage(date));
                link.textContent = this.formatDateForDisplay(this.formatDateForStorage(date));
                link.style.display = "block";
                input.style.display = "none";
            });
            quickSelectContainer.appendChild(button);
        });
        return quickSelectContainer;
    }
    getDefaultValue() {
        return this.formatDateForStorage(this.getDateForOption(this.default));
    }
    getDateForOption(option) {
        const today = new Date();
        switch (option) {
            case "yesterday": {
                const yesterday = new Date(today);
                yesterday.setDate(today.getDate() - 1);
                return yesterday;
            }
            case "today": return new Date(today);
            case "tomorrow": {
                const tomorrow = new Date(today);
                tomorrow.setDate(today.getDate() + 1);
                return tomorrow;
            }
            case "next-week": {
                const nextWeek = new Date(today);
                nextWeek.setDate(today.getDate() + 7);
                return nextWeek;
            }
            case "2-week": {
                const twoWeeks = new Date(today);
                twoWeeks.setDate(today.getDate() + 14);
                return twoWeeks;
            }
            default: return new Date(today);
        }
    }
    // Crée un conteneur pour afficher la date et la sélection rapide
    createFieldContainerContent(update, value) {
        const fieldContainer = document.createElement("div");
        fieldContainer.classList.add("field-container");
        fieldContainer.classList.add("metadata-field");
        const currentField = value;
        const link = this.createFieldLink(currentField);
        const input = this.createFieldDate(currentField, update, link);
        // Affichage initial : Si la date existe, afficher le lien
        if (currentField && this.validate(value)) {
            link.style.display = "block";
            input.style.display = "none";
        }
        else {
            input.style.display = "block";
            link.style.display = "none";
        }
        // Créer un conteneur avec les boutons de sélection rapide
        const quickSelectContainer = this.createQuickSelect(currentField, update, link, input);
        fieldContainer.appendChild(link);
        fieldContainer.appendChild(input);
        fieldContainer.appendChild(quickSelectContainer);
        return fieldContainer;
    }
    // Met à jour la valeur de la date et bascule l'affichage entre le lien et l'input
    async updateField(update, input, link) {
        let value = this.validate(input.value);
        if (value) {
            await update(value); // Met à jour avec la date au format "YYYY-MM-DD"
            input.style.display = "none";
            link.textContent = this.formatDateForDisplay(value); // Affichage avec le mois en lettres
            link.style.display = "block";
        }
        else {
            await update(input.value);
        }
    }
}
exports.DateProperty = DateProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXERhdGVQcm9wZXJ0eS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSwwREFBa0M7QUFDbEMscURBQW1EO0FBQ25ELDBDQUF5QztBQUN6Qyx5Q0FBc0M7QUFFdEMsTUFBTSxPQUFPLEdBQTZCO0lBQ3RDLFdBQVcsRUFBRyxxQkFBcUI7SUFDbkMsT0FBTyxFQUFHLGdCQUFnQjtJQUMxQixVQUFVLEVBQUcsbUJBQW1CO0lBQ2hDLFdBQVcsRUFBRyxnQkFBZ0I7Q0FDakMsQ0FBQTtBQUVELE1BQWEsWUFBYSxTQUFRLG1CQUFRO0lBS3RDLFlBQVksSUFBWSxFQUFFLGdCQUEwQixFQUFFLElBQUksR0FBRyxFQUFFO1FBQzNELEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFITixTQUFJLEdBQVksTUFBTSxDQUFDO1FBSW5DLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxnQkFBZ0IsQ0FBQTtJQUU1QyxDQUFDO0lBR0QsaUNBQWlDO0lBQ3hCLFdBQVcsQ0FBQyxLQUFXLEVBQUUsS0FBVyxFQUFFLE1BQXdDO1FBQ25GLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLE1BQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckQsY0FBYyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUV2RCxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzVDLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDdEMsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLDJCQUEyQixDQUFDLE1BQU0sRUFBRSxL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c3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXHNyY1xccHJvcGVydGllc1xcRGF0ZVByb3BlcnR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmbGF0cGlja3IgZnJvbSBcImZsYXRwaWNrclwiO1xyXG5pbXBvcnQgeyBGcmVuY2ggfSBmcm9tIFwiZmxhdHBpY2tyL2Rpc3QvbDEwbi9mci5qc1wiO1xyXG5pbXBvcnQgeyBzZXRJY29uIH0gZnJvbSBcIi4uL3ZhdWx0L1V0aWxzXCI7XHJcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSBcIi4vUHJvcGVydHlcIjtcclxuXHJcbmNvbnN0IGljb25NYXAgOiB7W2tleTogc3RyaW5nXSA6IHN0cmluZ309IHsgXHJcbiAgICBcInllc3RlcmRheVwiIDogXCJjYWxlbmRhci1hcnJvdy1kb3duXCIsXHJcbiAgICBcInRvZGF5XCIgOiBcImNhbGVuZGFyLWNoZWNrXCIsXHJcbiAgICBcInRvbW9ycm93XCIgOiBcImNhbGVuZGFyLWFycm93LXVwXCIsXHJcbiAgICBcIm5leHQtd2Vla1wiIDogXCJjYWxlbmRhci1jbG9ja1wiXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBEYXRlUHJvcGVydHkgZXh0ZW5kcyBQcm9wZXJ0eSB7XHJcblxyXG4gICAgcHJpdmF0ZSBxdWlja1NlbGVjdEljb25zOiBzdHJpbmdbXTtcclxuICAgIHB1YmxpYyBvdmVycmlkZSB0eXBlIDogc3RyaW5nID0gXCJkYXRlXCI7XHJcblxyXG4gICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCBxdWlja1NlbGVjdEljb25zOiBzdHJpbmdbXSwgYXJncyA9IHt9KSB7XHJcbiAgICAgICAgc3VwZXIobmFtZSwgYXJncyk7XHJcbiAgICAgICAgdGhpcy5xdWlja1NlbGVjdEljb25zID0gcXVpY2tTZWxlY3RJY29uc1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLyBDcsOpZSBsJ2FmZmljaGFnZSBkdSBjaGFtcCBkYXRlXHJcbiAgICBvdmVycmlkZSBmaWxsRGlzcGxheSh2YXVsdCA6IGFueSwgdmFsdWUgOiBhbnksIHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4pIHtcclxuICAgICAgICB0aGlzLnZhdWx0ID0gdmF1bHQ7XHJcbiAgICAgICAgY29uc3QgZmllbGRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGZpZWxkQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJmaWVsZC1jb250YWluZXItY29sdW1uXCIpO1xyXG5cclxuICAgICAgICBjb25zdCBmaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgZmllbGQuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLWZpZWxkXCIpO1xyXG4gICAgICAgIGNvbnN0IGRhdGVDb250YWluZXIgPSB0aGlzLmNyZWF0ZUZpZWxkQ29udGFpbmVyQ29udGVudCh1cGRhdGUsIHZhbHVlKTtcclxuICAgICAgICBmaWVsZC5hcHBlbmRDaGlsZChkYXRlQ29udGFpbmVyKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMudGl0bGUpIHtcclxuICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgaGVhZGVyLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1oZWFkZXJcIik7XHJcbiAgICAgICAgICAgIGhlYWRlci50ZXh0Q29udGVudCA9IHRoaXMubmFtZVxyXG4gICAgICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChoZWFkZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChmaWVsZCk7XHJcblxyXG4gICAgICAgIHJldHVybiBmaWVsZENvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gQ3LDqWUgdW4gY2hhbXAgZCdpbnB1dCBwb3VyIGxhIGRhdGVcclxuICAgIGNyZWF0ZUZpZWxkRGF0ZSh2YWx1ZTogc3RyaW5nLCB1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+LCBsaW5rOiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgIGlucHV0LnR5cGUgPSBcInRleHRcIjtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IHZhbHVlIHx8IFwiXCI7ICAvLyBGb3JtYXTDqSBlbiBcIllZWVktTU0tRERcIiBwb3VyIGxlIHN0b2NrYWdlXHJcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZChcImZpZWxkLWlucHV0XCIpO1xyXG4gICAgXHJcbiAgICAgICAgZmxhdHBpY2tyKGlucHV0LCB7XHJcbiAgICAgICAgICAgIGRhdGVGb3JtYXQ6IFwiWS1tLWRcIiwgIC8vIFN0b2NrZXIgZW4gXCJZWVlZLU1NLUREXCJcclxuICAgICAgICAgICAgZGVmYXVsdERhdGU6IHZhbHVlIHx8IFwiXCIsXHJcbiAgICAgICAgICAgIGxvY2FsZTogRnJlbmNoLFxyXG4gICAgICAgICAgICBvbkNoYW5nZTogYXN5bmMgKHNlbGVjdGVkRGF0ZXM6IERhdGVbXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWREYXRlID0gc2VsZWN0ZWREYXRlc1swXTtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZERhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBNZXQgw6Agam91ciBsYSB2YWxldXIgZGUgbCdpbnB1dCBhdmVjIGxlIGZvcm1hdCBcIllZWVktTU0tRERcIlxyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gdGhpcy5mb3JtYXREYXRlRm9yU3RvcmFnZShzZWxlY3RlZERhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlRmllbGQodXBkYXRlLCBpbnB1dCwgbGluaylcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb25DbG9zZSA6IGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gXCJcIlxyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVGaWVsZCh1cGRhdGUsIGlucHV0LCBsaW5rKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGlucHV0O1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDcsOpZSB1biBsaWVuIHF1aSBhZmZpY2hlIGxhIGRhdGUgKGF1IGZvcm1hdCBcIjI2IGbDqXZyaWVyIDIwMjVcIilcclxuICAgIG92ZXJyaWRlIGNyZWF0ZUZpZWxkTGluayh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgbGluay50ZXh0Q29udGVudCA9IHZhbHVlID8gdGhpcy5mb3JtYXREYXRlRm9yRGlzcGxheSh2YWx1ZSkgOiBcIkF1Y3VuZSBkYXRlIHPDqWxlY3Rpb25uw6llXCI7XHJcbiAgICAgICAgbGluay5jbGFzc0xpc3QuYWRkKFwiZGF0ZS1maWVsZC1saW5rXCIpO1xyXG4gICAgICAgIGxpbmsuY2xhc3NMaXN0LmFkZChcImZpZWxkLWxpbmtcIik7XHJcbiAgICAgICAgbGluay5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHRoaXMubW9kaWZ5RmllbGQoZXZlbnQpKTtcclxuICAgICAgICByZXR1cm4gbGluaztcclxuICAgIH1cclxuXHJcbiAgICAvLyBGb3JtYXRlIGxhIGRhdGUgcG91ciBsJ2FmZmljaGFnZSA6IFwiMjYgZsOpdnJpZXIgMjAyNVwiXHJcbiAgICBmb3JtYXREYXRlRm9yRGlzcGxheShkYXRlOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IHBhcnNlZERhdGUgPSBuZXcgRGF0ZShkYXRlKTtcclxuICAgICAgICByZXR1cm4gcGFyc2VkRGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoXCJmci1GUlwiLCB7IFxyXG4gICAgICAgICAgICBkYXk6IFwibnVtZXJpY1wiLCBcclxuICAgICAgICAgICAgbW9udGg6IFwibG9uZ1wiLCBcclxuICAgICAgICAgICAgeWVhcjogXCJudW1lcmljXCIgXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRm9ybWF0ZSBsYSBkYXRlIHBvdXIgbGUgc3RvY2thZ2UgOiBcIllZWVktTU0tRERcIlxyXG4gICAgZm9ybWF0RGF0ZUZvclN0b3JhZ2UoZGF0ZTogRGF0ZSk6IHN0cmluZyB7XHJcbiAgICAgICAgLy8gVXNlIHRvSVNPU3RyaW5nIHRvIGF2b2lkIHRpbWV6b25lIGlzc3VlcywgdGhlbiBleHRyYWN0IGRhdGUgcGFydFxyXG4gICAgICAgIHJldHVybiBkYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gQWpvdXRlIGxlcyBvcHRpb25zIFwiQXVqb3VyZCdodWlcIiwgXCJEZW1haW5cIiwgXCJTZW1haW5lIHByb2NoYWluZVwiXHJcbiAgICBjcmVhdGVRdWlja1NlbGVjdCh2YWx1ZTogc3RyaW5nLCB1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+LCBsaW5rOiBIVE1MRWxlbWVudCwgaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQpIHtcclxuICAgICAgICBjb25zdCBxdWlja1NlbGVjdENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgcXVpY2tTZWxlY3RDb250YWluZXIuY2xhc3NMaXN0LmFkZChcInF1aWNrLXNlbGVjdC1jb250YWluZXJcIik7XHJcblxyXG4gICAgICAgIHRoaXMucXVpY2tTZWxlY3RJY29ucy5mb3JFYWNoKG9wdGlvbiA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgICAgIHNldEljb24oYnV0dG9uLCBpY29uTWFwW29wdGlvbl0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gdGhpcy5nZXREYXRlRm9yT3B0aW9uKG9wdGlvbik7ICAvLyBPYnRlbmlyIGxhIGRhdGUgcG91ciBsJ29wdGlvbiBjaG9pc2llXHJcbiAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGUodGhpcy5mb3JtYXREYXRlRm9yU3RvcmFnZShkYXRlKSk7XHJcbiAgICAgICAgICAgICAgICBsaW5rLnRleHRDb250ZW50ID0gdGhpcy5mb3JtYXREYXRlRm9yRGlzcGxheSh0aGlzLmZvcm1hdERhdGVGb3JTdG9yYWdlKGRhdGUpKTtcclxuICAgICAgICAgICAgICAgIGxpbmsuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgICAgICAgICAgICAgIGlucHV0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICAgICAgfSk7IFxyXG4gICAgXHJcbiAgICAgICAgICAgIHF1aWNrU2VsZWN0Q29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBxdWlja1NlbGVjdENvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZSBnZXREZWZhdWx0VmFsdWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0RGF0ZUZvclN0b3JhZ2UodGhpcy5nZXREYXRlRm9yT3B0aW9uKHRoaXMuZGVmYXVsdCkpXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RGF0ZUZvck9wdGlvbihvcHRpb246IHN0cmluZyk6IERhdGUge1xyXG4gICAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTtcclxuICAgICAgICBzd2l0Y2gob3B0aW9uKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJ5ZXN0ZXJkYXlcIjoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgeWVzdGVyZGF5ID0gbmV3IERhdGUodG9kYXkpO1xyXG4gICAgICAgICAgICAgICAgeWVzdGVyZGF5LnNldERhdGUodG9kYXkuZ2V0RGF0ZSgpIC0gMSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geWVzdGVyZGF5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgXCJ0b2RheVwiOiByZXR1cm4gbmV3IERhdGUodG9kYXkpO1xyXG4gICAgICAgICAgICBjYXNlIFwidG9tb3Jyb3dcIjoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdG9tb3Jyb3cgPSBuZXcgRGF0ZSh0b2RheSk7XHJcbiAgICAgICAgICAgICAgICB0b21vcnJvdy5zZXREYXRlKHRvZGF5LmdldERhdGUoKSArIDEpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRvbW9ycm93O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgXCJuZXh0LXdlZWtcIjoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dFdlZWsgPSBuZXcgRGF0ZSh0b2RheSk7XHJcbiAgICAgICAgICAgICAgICBuZXh0V2Vlay5zZXREYXRlKHRvZGF5LmdldERhdGUoKSArIDcpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5leHRXZWVrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgXCIyLXdlZWtcIjoge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHdvV2Vla3MgPSBuZXcgRGF0ZSh0b2RheSk7XHJcbiAgICAgICAgICAgICAgICB0d29XZWVrcy5zZXREYXRlKHRvZGF5LmdldERhdGUoKSArIDE0KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0d29XZWVrcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gbmV3IERhdGUodG9kYXkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBDcsOpZSB1biBjb250ZW5ldXIgcG91ciBhZmZpY2hlciBsYSBkYXRlIGV0IGxhIHPDqWxlY3Rpb24gcmFwaWRlXHJcbiAgICBvdmVycmlkZSBjcmVhdGVGaWVsZENvbnRhaW5lckNvbnRlbnQodXBkYXRlOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPiwgdmFsdWU6IHN0cmluZyk6IEhUTUxEaXZFbGVtZW50IHtcclxuICAgICAgICBjb25zdCBmaWVsZENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgZmllbGRDb250YWluZXIuY2xhc3NMaXN0LmFkZChcImZpZWxkLWNvbnRhaW5lclwiKTtcclxuICAgICAgICBmaWVsZENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtZmllbGRcIik7XHJcblxyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRGaWVsZCA9IHZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGxpbmsgPSB0aGlzLmNyZWF0ZUZpZWxkTGluayhjdXJyZW50RmllbGQpO1xyXG4gICAgICAgIGNvbnN0IGlucHV0ID0gdGhpcy5jcmVhdGVGaWVsZERhdGUoY3VycmVudEZpZWxkLCB1cGRhdGUsIGxpbmspO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICAvLyBBZmZpY2hhZ2UgaW5pdGlhbCA6IFNpIGxhIGRhdGUgZXhpc3RlLCBhZmZpY2hlciBsZSBsaWVuXHJcbiAgICAgICAgaWYgKGN1cnJlbnRGaWVsZCAmJiB0aGlzLnZhbGlkYXRlKHZhbHVlKSkge1xyXG4gICAgICAgICAgICBsaW5rLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICAgICAgICAgIGlucHV0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpbnB1dC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgICAgICAgICBsaW5rLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENyw6llciB1biBjb250ZW5ldXIgYXZlYyBsZXMgYm91dG9ucyBkZSBzw6lsZWN0aW9uIHJhcGlkZVxyXG4gICAgICAgIGNvbnN0IHF1aWNrU2VsZWN0Q29udGFpbmVyID0gdGhpcy5jcmVhdGVRdWlja1NlbGVjdChjdXJyZW50RmllbGQsIHVwZGF0ZSwgbGluaywgaW5wdXQpO1xyXG5cclxuICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChsaW5rKTtcclxuICAgICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChpbnB1dCk7XHJcbiAgICAgICAgZmllbGRDb250YWluZXIuYXBwZW5kQ2hpbGQocXVpY2tTZWxlY3RDb250YWluZXIpO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICByZXR1cm4gZmllbGRDb250YWluZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTWV0IMOgIGpvdXIgbGEgdmFsZXVyIGRlIGxhIGRhdGUgZXQgYmFzY3VsZSBsJ2FmZmljaGFnZSBlbnRyZSBsZSBsaWVuIGV0IGwnaW5wdXRcclxuICAgIG92ZXJyaWRlIGFzeW5jIHVwZGF0ZUZpZWxkKHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4sIGlucHV0OiBIVE1MSW5wdXRFbGVtZW50LCBsaW5rOiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMudmFsaWRhdGUoaW5wdXQudmFsdWUpO1xyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBhd2FpdCB1cGRhdGUodmFsdWUpOyAgLy8gTWV0IMOgIGpvdXIgYXZlYyBsYSBkYXRlIGF1IGZvcm1hdCBcIllZWVktTU0tRERcIlxyXG4gICAgICAgICAgICBpbnB1dC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgIGxpbmsudGV4dENvbnRlbnQgPSB0aGlzLmZvcm1hdERhdGVGb3JEaXNwbGF5KHZhbHVlKTsgIC8vIEFmZmljaGFnZSBhdmVjIGxlIG1vaXMgZW4gbGV0dHJlc1xyXG4gICAgICAgICAgICBsaW5rLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYXdhaXQgdXBkYXRlKGlucHV0LnZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG4iXSwidmVyc2lvbiI6M30=