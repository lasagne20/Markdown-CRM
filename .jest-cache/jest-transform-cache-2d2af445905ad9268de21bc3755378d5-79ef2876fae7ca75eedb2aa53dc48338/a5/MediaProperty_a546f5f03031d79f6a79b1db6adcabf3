c68a5358c581cd6167a1ef9c87d221df
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MediaProperty = void 0;
const FileProperty_1 = require("./FileProperty");
class MediaProperty extends FileProperty_1.FileProperty {
    // Used for property with a single file
    constructor(name, vault, args = { icon: "media", create: "" }) {
        super(name, vault, [], args);
        this.type = "media";
        this.createOption = args.create || "";
        this.display = args.display;
    }
    async getDisplay(file, args = { staticMode: false, title: "", display: "name" }) {
        this.display = args.display || "name";
        if (!this.read(file) && this.createOption) {
            // If the file is not set, we return a container with a button to create a new file
            const container = document.createElement("div");
            container.classList.add("create-freecad-container");
            const button = document.createElement("button");
            button.classList.add("mod-cta");
            if (args.createOptions && args.createOptions.createFunction) {
                button.textContent = args.createOptions.title || "Cr√©er un fichier";
                button.addEventListener("click", async () => {
                    if (args.createOptions && typeof args.createOptions.createFunction === "function") {
                        let path = await args.createOptions.createFunction();
                        await file.updateMetadata(this.name, `[[${path}|${path.split("/").pop()}]]`);
                        setTimeout(() => {
                            // On attend 2 secondes pour que le fichier soit cr√©√© et d√©placer dans le bon dossier avant de l'ouvrir
                            path = file.vault.getMediaFromLink(path)?.path || path;
                            const vaultPath = file.vault.app.vault.adapter.basePath || file.vault.adapter.getBasePath?.();
                            const absoluteMediaPath = vaultPath ? require('path').join(vaultPath, path) : path;
                            this.vault.app.open(absoluteMediaPath);
                        }, 1000);
                        await file.check();
                    }
                });
                container.appendChild(button);
                return container;
            }
        }
        let value = this.read(file);
        let container = this.fillDisplay(value, async (value) => await file.updateMetadata(this.name, value), file);
        if (args.updateOptions && args.updateOptions.updateFunction) {
            const refreshButton = document.createElement("button");
            refreshButton.classList.add("mod-cta");
            this.vault.app.setIcon(refreshButton, args.updateOptions.icon || "refresh-ccw");
            refreshButton.addEventListener("click", async () => {
                if (args.updateOptions && typeof args.updateOptions.updateFunction === "function") {
                    let path = await args.updateOptions.updateFunction();
                    await file.updateMetadata(this.name, `[[${path}|${path.split("/").pop()}]]`);
                }
            });
            container.appendChild(refreshButton);
        }
        return container;
    }
    getLink(value, vault) {
        if (!value) {
            return "";
        }
        return this.vault.readLinkFile(value) || "";
    }
    openFile(value) {
        // Get the absolute path to the file in the vault
        let mediaPath = this.vault.readLinkFile(value, true);
        const absoluteMediaPath = this.vault.getPath() ? require('path').join(this.vault.getPath(), mediaPath) : mediaPath;
        this.vault.app.open(absoluteMediaPath);
    }
    fillDisplay(value, update, file = null) {
        if (value && value.startsWith("[[") && value.endsWith("]]")) {
            if (this.display === "embed") {
                // If it is an image : 
                let mediaPath = this.vault.readLinkFile(value, true);
                let container = document.createElement("div");
                if (mediaPath) {
                    const ext = mediaPath.toLowerCase().split('.').pop();
                    if (ext && ["png", "jpg", "jpeg", "gif"].includes(ext)) {
                        container = this.createEmbedImageContainer(mediaPath, update);
                    }
                    else if (ext && ["glb", "gltf", "fcstd"].includes(ext)) {
                        // Pour les fichiers 3D, cr√©er un message pour utiliser 3DModelProperty
                        container = document.createElement("div");
                        container.classList.add("embed-container");
                        const messageDiv = document.createElement("div");
                        messageDiv.textContent = "Fichier 3D d√©tect√©. Utilisez 3DModelProperty pour l'affichage 3D.";
                        messageDiv.style.textAlign = "center";
                        messageDiv.style.margin = "20px";
                        messageDiv.style.padding = "10px";
                        messageDiv.style.backgroundColor = "#f0f0f0";
                        messageDiv.style.border = "1px solid #ccc";
                        messageDiv.style.borderRadius = "5px";
                        container.appendChild(messageDiv);
                    }
                    container.style.position = "relative";
                    container.appendChild(this.createEmbedOpenContainer(update, value));
                    container.appendChild(this.createEmbedEditContainer(update, value));
                }
                return container;
            }
            else if (this.display === "icon") {
                const container = document.createElement("div");
                container.classList.add("metadata-field", "media-field");
                const iconDiv = document.createElement("div");
                iconDiv.classList.add("big-icon-div");
                this.vault.app.setIcon(iconDiv, this.getFileIcon(value));
                const fileName = document.createElement("div");
                fileName.classList.add("media-field-file-name");
                fileName.textContent = this.vault.readLinkFile(value, true) || "Fichier non trouv√©";
                container.appendChild(iconDiv);
                container.appendChild(fileName);
                container.appendChild(iconDiv);
                container.appendChild(fileName);
                // üîó Ouvrir le fichier au clic (sur tout le conteneur)
                container.style.cursor = "pointer";
                container.addEventListener("click", () => {
                    this.openFile(value);
                });
                return container;
            }
            else if (this.display === "button") {
                const container = document.createElement("div");
                container.classList.add("create-freecad-container");
                const button = document.createElement("button");
                button.classList.add("mod-cta");
                button.textContent = this.title || "Ouvrir le fichier";
                button.addEventListener("click", () => {
                    this.openFile(value);
                });
                container.appendChild(button);
                return container;
            }
        }
        return super.fillDisplay(value, update);
    }
    getFileIcon(value) {
        if (value && value.startsWith("[[") && value.endsWith("]]")) {
            const mediaPath = this.vault.readLinkFile(value, true);
            if (mediaPath) {
                const ext = mediaPath.toLowerCase().split('.').pop();
                if (ext && ["png", "jpg", "jpeg", "gif"].includes(ext)) {
                    return "image";
                }
                else if (ext && ["glb", "gltf", "fcstd"].includes(ext)) {
                    return "cube3d";
                }
                else if (ext && ["pdf", "docx", "txt"].includes(ext)) {
                    return "file";
                }
                else if (ext && ["mp4", "webm", "ogg"].includes(ext)) {
                    return "video";
                }
                else if (ext && ["mp3", "wav"].includes(ext)) {
                    return "audio";
                }
                else if (ext && ["zip", "rar"].includes(ext)) {
                    return "archive";
                }
                else if (ext && ["sla"].includes(ext)) {
                    return "square-pen";
                }
                else if (ext && ["lbrn2"].includes(ext)) {
                    return "flame";
                }
            }
        }
        return this.icon || "media";
    }
    createEmbedEditContainer(update, value) {
        const container = document.createElement("div");
        container.classList.add("embed-edit-container");
        container.style.position = "absolute"; // Position the icon container absolutely
        container.style.top = "5px"; // Adjust the top position
        container.style.left = "5px"; // Adjust the right position
        container.style.cursor = "pointer"; // Change cursor to pointer
        const iconContainer = document.createElement("div");
        iconContainer.classList.add("icon-container");
        const icon = document.createElement("i");
        this.vault.app.setIcon(icon, "link");
        icon.addEventListener("click", async (event) => await this.handleIconClick(update, event));
        iconContainer.appendChild(icon);
        container.appendChild(iconContainer);
        return container;
    }
    createEmbedOpenContainer(update, value) {
        const container = document.createElement("div");
        container.classList.add("embed-open-container");
        container.style.position = "absolute"; // Position the icon container absolutely
        container.style.top = "5px"; // Adjust the top position
        container.style.right = "5px"; // Adjust the right position
        container.style.cursor = "pointer"; // Change cursor to pointer
        const iconContainer = document.createElement("div");
        iconContainer.classList.add("icon-container");
        const icon = document.createElement("i");
        this.vault.app.setIcon(icon, "external-link");
        icon.addEventListener("click", (event) => {
            event.preventDefault();
            if (value) {
                this.openFile(value);
            }
            else {
                this.vault.app.sendNotice("Unable to generate link for the media.");
            }
        });
        iconContainer.appendChild(icon);
        container.appendChild(iconContainer);
        return container;
    }
    createEmbedImageContainer(mediaPath, update) {
        const container = document.createElement("div");
        container.classList.add("metadata-field", "media-field", "embed-container");
        const embed = document.createElement("img");
        embed.src = this.vault.app.getAbsolutePath(mediaPath);
        embed.alt = "Media";
        embed.classList.add("embed-media");
        const iconContainer = document.createElement("div");
        iconContainer.classList.add("icon-container");
        const icon = document.createElement("i");
        icon.classList.add("icon", this.icon);
        icon.addEventListener("click", async (event) => await this.handleIconClick(update, event));
        iconContainer.appendChild(icon);
        container.appendChild(embed);
        container.appendChild(iconContainer);
        return container;
    }
    // Fonction pour g√©rer le clic sur l'ic√¥ne
    async handleIconClick(update, event) {
        let selectedFile = await this.vault.app.selectMedia(this.vault, "Choisissez un document");
        if (selectedFile) {
            await update(`[[${selectedFile.path}|${selectedFile.name}]]`);
            const link = event.target.closest('.metadata-field')?.querySelector('.field-link');
            if (link) {
                link.textContent = selectedFile.name;
            }
        }
    }
    // Override the createFieldContainerContent function to truncate the link
    createFieldContainerContent(update, value) {
        const fieldContainer = document.createElement("div");
        fieldContainer.classList.add("field-container");
        const currentField = this.getLink(value);
        const link = document.createElement("a");
        link.href = "#";
        const truncatedField = currentField?.length > 12 ? currentField.slice(0, 12) + "..." : currentField;
        link.textContent = truncatedField || "";
        link.setAttribute("full-text", currentField || "");
        link.addEventListener("click", async (event) => await this.modifyField(event));
        link.classList.add("field-link");
        link.style.display = "block";
        fieldContainer.appendChild(link);
        return fieldContainer;
    }
    // Fonction pour g√©rer le clic sur l'ic√¥ne
    async modifyField(event) {
        const link = event.target.closest('.metadata-field')?.querySelector('.field-link');
        let currentField = link.getAttribute("full-text");
        if (!currentField) {
            return;
        }
        event.preventDefault();
        const file = await this.vault.app.getFile(currentField);
        if (file) {
            await this.vault.app.open(file.path);
        }
        else {
            this.vault.app.sendNotice(`Le fichier ${currentField} n'existe pas`);
        }
    }
}
exports.MediaProperty = MediaProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE1lZGlhUHJvcGVydHkudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQ0EsaURBQThDO0FBSTlDLE1BQWEsYUFBYyxTQUFRLDJCQUFZO0lBTTNDLHVDQUF1QztJQUN2QyxZQUFZLElBQVksRUFBRSxLQUFZLEVBQUUsT0FBNEQsRUFBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUM7UUFDN0gsS0FBSyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBSGpCLFNBQUksR0FBWSxPQUFPLENBQUM7UUFJcEMsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQztRQUN0QyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDOUIsQ0FBQztJQUVRLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBUyxFQUFFLE9BRy9CLEVBQUMsVUFBVSxFQUFHLEtBQUssRUFBRSxLQUFLLEVBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUM7UUFDakQsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxJQUFJLE1BQU0sQ0FBQztRQUN0QyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFDLENBQUM7WUFDekMsbUZBQW1GO1lBQ25GLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEQsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQztZQUVwRCxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxD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RSxDQUFDLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQy9FLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUU3QixjQUFjLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRWpDLE9BQU8sY0FBYyxDQUFDO0lBQ3hCLENBQUM7SUFFQSwwQ0FBMEM7SUFDbEMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxLQUFZO1FBQ3JDLE1BQU0sSUFBSSxHQUFJLEtBQUssQ0FBQyxNQUFzQixDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLGFBQWEsQ0FBQyxhQUFhLENBQWdCLENBQUM7UUFDbkgsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUNqRCxJQUFJLENBQUMsWUFBWSxFQUFDLENBQUM7WUFBQSxPQUFNO1FBQUEsQ0FBQztRQUMxQixLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFdkIsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDeEQsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUVQLE1BQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QyxDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxjQUFjLFlBQVksZUFBZSxDQUFDLENBQUE7UUFDdEUsQ0FBQztJQUNILENBQUM7Q0FFSjtBQXJURCxzQ0FxVEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE1lZGlhUHJvcGVydHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRmlsZSB9IGZyb20gXCIuLi92YXVsdC9GaWxlXCI7XHJcbmltcG9ydCB7IEZpbGVQcm9wZXJ0eSB9IGZyb20gXCIuL0ZpbGVQcm9wZXJ0eVwiO1xyXG5pbXBvcnQgeyBWYXVsdCB9IGZyb20gXCIuLi92YXVsdC9WYXVsdFwiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBNZWRpYVByb3BlcnR5IGV4dGVuZHMgRmlsZVByb3BlcnR5e1xyXG5cclxuICBwdWJsaWMgZGlzcGxheSA6IHN0cmluZyB8IHVuZGVmaW5lZDtcclxuICBwdWJsaWMgY3JlYXRlT3B0aW9uIDogc3RyaW5nO1xyXG5cclxuICBwdWJsaWMgb3ZlcnJpZGUgdHlwZSA6IHN0cmluZyA9IFwibWVkaWFcIjtcclxuICAgIC8vIFVzZWQgZm9yIHByb3BlcnR5IHdpdGggYSBzaW5nbGUgZmlsZVxyXG4gICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCB2YXVsdDogVmF1bHQsIGFyZ3M6IHsgaWNvbj86IHN0cmluZzsgZGlzcGxheT86IHN0cmluZzsgY3JlYXRlPzogc3RyaW5nfSA9IHtpY29uOiBcIm1lZGlhXCIsIGNyZWF0ZTogXCJcIn0pIHtcclxuICAgICAgc3VwZXIobmFtZSwgdmF1bHQsIFtdLCBhcmdzKTtcclxuICAgICAgdGhpcy5jcmVhdGVPcHRpb24gPSBhcmdzLmNyZWF0ZSB8fCBcIlwiO1xyXG4gICAgICB0aGlzLmRpc3BsYXkgPSBhcmdzLmRpc3BsYXk7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgYXN5bmMgZ2V0RGlzcGxheShmaWxlOiBhbnksIGFyZ3M6IHtzdGF0aWNNb2RlPyA6IGJvb2xlYW4sIHRpdGxlPzogc3RyaW5nLCBkaXNwbGF5Pzogc3RyaW5nO1xyXG4gICAgICAgICAgY3JlYXRlT3B0aW9ucz8gOiB7Y3JlYXRlRnVuY3Rpb24/IDogKCkgPT4gUHJvbWlzZTxzdHJpbmc+LCB0aXRsZT86IHN0cmluZ31cclxuICAgICAgICAgIHVwZGF0ZU9wdGlvbnM/IDoge2ljb246IHN0cmluZywgdXBkYXRlRnVuY3Rpb24/IDogKCkgPT4gUHJvbWlzZTxzdHJpbmc+fX0gPSBcclxuICAgICAgICAgIHtzdGF0aWNNb2RlIDogZmFsc2UsIHRpdGxlOlwiXCIsIGRpc3BsYXk6IFwibmFtZVwifSk6IFByb21pc2U8SFRNTERpdkVsZW1lbnQ+IHtcclxuICAgICAgICB0aGlzLmRpc3BsYXkgPSBhcmdzLmRpc3BsYXkgfHwgXCJuYW1lXCI7XHJcbiAgICAgICAgaWYgKCF0aGlzLnJlYWQoZmlsZSkgJiYgdGhpcy5jcmVhdGVPcHRpb24pe1xyXG4gICAgICAgICAgLy8gSWYgdGhlIGZpbGUgaXMgbm90IHNldCwgd2UgcmV0dXJuIGEgY29udGFpbmVyIHdpdGggYSBidXR0b24gdG8gY3JlYXRlIGEgbmV3IGZpbGVcclxuICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChcImNyZWF0ZS1mcmVlY2FkLWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJtb2QtY3RhXCIpO1xyXG4gICAgICAgICAgaWYgKGFyZ3MuY3JlYXRlT3B0aW9ucyAmJiBhcmdzLmNyZWF0ZU9wdGlvbnMuY3JlYXRlRnVuY3Rpb24pIHtcclxuICAgICAgICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSBhcmdzLmNyZWF0ZU9wdGlvbnMudGl0bGUgfHwgXCJDcsOpZXIgdW4gZmljaGllclwiO1xyXG4gICAgICAgICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICBpZiAoYXJncy5jcmVhdGVPcHRpb25zICYmIHR5cGVvZiBhcmdzLmNyZWF0ZU9wdGlvbnMuY3JlYXRlRnVuY3Rpb24gPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBwYXRoID0gYXdhaXQgYXJncy5jcmVhdGVPcHRpb25zLmNyZWF0ZUZ1bmN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGZpbGUudXBkYXRlTWV0YWRhdGEodGhpcy5uYW1lLCBgW1ske3BhdGh9fCR7cGF0aC5zcGxpdChcIi9cIikucG9wKCl9XV1gKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgIC8vIE9uIGF0dGVuZCAyIHNlY29uZGVzIHBvdXIgcXVlIGxlIGZpY2hpZXIgc29pdCBjcsOpw6kgZXQgZMOpcGxhY2VyIGRhbnMgbGUgYm9uIGRvc3NpZXIgYXZhbnQgZGUgbCdvdXZyaXJcclxuICAgICAgICAgICAgICAgICAgICAgIHBhdGggPSBmaWxlLnZhdWx0LmdldE1lZGlhRnJvbUxpbmsocGF0aCk/LnBhdGggfHwgcGF0aDtcclxuICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhdWx0UGF0aCA9IGZpbGUudmF1bHQuYXBwLnZhdWx0LmFkYXB0ZXIuYmFzZVBhdGggfHwgZmlsZS52YXVsdC5hZGFwdGVyLmdldEJhc2VQYXRoPy4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFic29sdXRlTWVkaWFQYXRoID0gdmF1bHRQYXRoID8gcmVxdWlyZSgncGF0aCcpLmpvaW4odmF1bHRQYXRoLCBwYXRoKSA6IHBhdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZhdWx0LmFwcC5vcGVuKGFic29sdXRlTWVkaWFQYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBmaWxlLmNoZWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KTsgXHJcbiAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbik7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcclxuICAgICAgICAgIH19XHJcblxyXG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMucmVhZChmaWxlKTtcclxuICAgICAgICBsZXQgY29udGFpbmVyID0gdGhpcy5maWxsRGlzcGxheSh2YWx1ZSwgYXN5bmMgKHZhbHVlOiBhbnkpID0+IGF3YWl0IGZpbGUudXBkYXRlTWV0YWRhdGEodGhpcy5uYW1lLCB2YWx1ZSksIGZpbGUpO1xyXG4gICAgICAgIGlmIChhcmdzLnVwZGF0ZU9wdGlvbnMgJiYgYXJncy51cGRhdGVPcHRpb25zLnVwZGF0ZUZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICBjb25zdCByZWZyZXNoQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICAgIHJlZnJlc2hCdXR0b24uY2xhc3NMaXN0LmFkZChcIm1vZC1jdGFcIik7XHJcbiAgICAgICAgICAgIHRoaXMudmF1bHQuYXBwLnNldEljb24ocmVmcmVzaEJ1dHRvbiwgYXJncy51cGRhdGVPcHRpb25zLmljb24gfHwgXCJyZWZyZXNoLWNjd1wiKTtcclxuICAgICAgICAgIHJlZnJlc2hCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGFyZ3MudXBkYXRlT3B0aW9ucyAmJiB0eXBlb2YgYXJncy51cGRhdGVPcHRpb25zLnVwZGF0ZUZ1bmN0aW9uID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgICBsZXQgcGF0aCA9IGF3YWl0IGFyZ3MudXBkYXRlT3B0aW9ucy51cGRhdGVGdW5jdGlvbigpO1xyXG4gICAgICAgICAgICAgIGF3YWl0IGZpbGUudXBkYXRlTWV0YWRhdGEodGhpcy5uYW1lLCBgW1ske3BhdGh9fCR7cGF0aC5zcGxpdChcIi9cIikucG9wKCl9XV1gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocmVmcmVzaEJ1dHRvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gY29udGFpbmVyXHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgZ2V0TGluayh2YWx1ZTogc3RyaW5nLCB2YXVsdD86IGFueSk6IHN0cmluZyB7XHJcbiAgICAgIGlmICghdmFsdWUpe1xyXG4gICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB0aGlzLnZhdWx0LnJlYWRMaW5rRmlsZSh2YWx1ZSkgfHwgXCJcIjtcclxuICAgIH1cclxuXHJcbiAgICBvcGVuRmlsZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgICAvLyBHZXQgdGhlIGFic29sdXRlIHBhdGggdG8gdGhlIGZpbGUgaW4gdGhlIHZhdWx0XHJcbiAgICAgICAgICBsZXQgbWVkaWFQYXRoID0gdGhpcy52YXVsdC5yZWFkTGlua0ZpbGUodmFsdWUsIHRydWUpO1xyXG4gICAgICAgICAgY29uc3QgYWJzb2x1dGVNZWRpYVBhdGggPSB0aGlzLnZhdWx0LmdldFBhdGgoKSA/IHJlcXVpcmUoJ3BhdGgnKS5qb2luKHRoaXMudmF1bHQuZ2V0UGF0aCgpICwgbWVkaWFQYXRoKSA6IG1lZGlhUGF0aDtcclxuICAgICAgICAgIHRoaXMudmF1bHQuYXBwLm9wZW4oYWJzb2x1dGVNZWRpYVBhdGgpO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGZpbGxEaXNwbGF5KHZhbHVlOiBhbnksIHVwZGF0ZTogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGZpbGU6IGFueSA9IG51bGwpOiBIVE1MRGl2RWxlbWVudCB7XHJcbiAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZS5zdGFydHNXaXRoKFwiW1tcIikgJiYgdmFsdWUuZW5kc1dpdGgoXCJdXVwiKSkge1xyXG4gICAgICAgIGlmICh0aGlzLmRpc3BsYXkgPT09IFwiZW1iZWRcIikge1xyXG4gICAgICAgICAgLy8gSWYgaXQgaXMgYW4gaW1hZ2UgOiBcclxuICAgICAgICAgIGxldCBtZWRpYVBhdGggPSB0aGlzLnZhdWx0LnJlYWRMaW5rRmlsZSh2YWx1ZSwgdHJ1ZSk7XHJcbiAgICAgICAgICBsZXQgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgIGlmIChtZWRpYVBhdGgpIHtcclxuICAgICAgICAgICAgY29uc3QgZXh0ID0gbWVkaWFQYXRoLnRvTG93ZXJDYXNlKCkuc3BsaXQoJy4nKS5wb3AoKTtcclxuICAgICAgICAgICAgaWYgKGV4dCAmJiBbXCJwbmdcIiwgXCJqcGdcIiwgXCJqcGVnXCIsIFwiZ2lmXCJdLmluY2x1ZGVzKGV4dCkpIHtcclxuICAgICAgICAgICAgICBjb250YWluZXIgPSB0aGlzLmNyZWF0ZUVtYmVkSW1hZ2VDb250YWluZXIobWVkaWFQYXRoLCB1cGRhdGUpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV4dCAmJiBbXCJnbGJcIiwgXCJnbHRmXCIsIFwiZmNzdGRcIl0uaW5jbHVkZXMoZXh0KSkge1xyXG4gICAgICAgICAgICAgIC8vIFBvdXIgbGVzIGZpY2hpZXJzIDNELCBjcsOpZXIgdW4gbWVzc2FnZSBwb3VyIHV0aWxpc2VyIDNETW9kZWxQcm9wZXJ0eVxyXG4gICAgICAgICAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJlbWJlZC1jb250YWluZXJcIik7XHJcbiAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgbWVzc2FnZURpdi50ZXh0Q29udGVudCA9IFwiRmljaGllciAzRCBkw6l0ZWN0w6kuIFV0aWxpc2V6IDNETW9kZWxQcm9wZXJ0eSBwb3VyIGwnYWZmaWNoYWdlIDNELlwiO1xyXG4gICAgICAgICAgICAgIG1lc3NhZ2VEaXYuc3R5bGUudGV4dEFsaWduID0gXCJjZW50ZXJcIjtcclxuICAgICAgICAgICAgICBtZXNzYWdlRGl2LnN0eWxlLm1hcmdpbiA9IFwiMjBweFwiO1xyXG4gICAgICAgICAgICAgIG1lc3NhZ2VEaXYuc3R5bGUucGFkZGluZyA9IFwiMTBweFwiO1xyXG4gICAgICAgICAgICAgIG1lc3NhZ2VEaXYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIjZjBmMGYwXCI7XHJcbiAgICAgICAgICAgICAgbWVzc2FnZURpdi5zdHlsZS5ib3JkZXIgPSBcIjFweCBzb2xpZCAjY2NjXCI7XHJcbiAgICAgICAgICAgICAgbWVzc2FnZURpdi5zdHlsZS5ib3JkZXJSYWRpdXMgPSBcIjVweFwiO1xyXG4gICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChtZXNzYWdlRGl2KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb250YWluZXIuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUVtYmVkT3BlbkNvbnRhaW5lcih1cGRhdGUsIHZhbHVlKSk7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUVtYmVkRWRpdENvbnRhaW5lcih1cGRhdGUsIHZhbHVlKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gY29udGFpbmVyXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuZGlzcGxheSA9PT0gXCJpY29uXCIpIHtcclxuICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLWZpZWxkXCIsIFwibWVkaWEtZmllbGRcIik7XHJcblxyXG4gICAgICAgICAgY29uc3QgaWNvbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICBpY29uRGl2LmNsYXNzTGlzdC5hZGQoXCJiaWctaWNvbi1kaXZcIik7XHJcbiAgICAgICAgICB0aGlzLnZhdWx0LmFwcC5zZXRJY29uKGljb25EaXYsIHRoaXMuZ2V0RmlsZUljb24odmFsdWUpKTtcclxuXHJcbiAgICAgICAgICBjb25zdCBmaWxlTmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICBmaWxlTmFtZS5jbGFzc0xpc3QuYWRkKFwibWVkaWEtZmllbGQtZmlsZS1uYW1lXCIpO1xyXG4gICAgICAgICAgZmlsZU5hbWUudGV4dENvbnRlbnQgPSB0aGlzLnZhdWx0LnJlYWRMaW5rRmlsZSh2YWx1ZSwgdHJ1ZSkgfHwgXCJGaWNoaWVyIG5vbiB0cm91dsOpXCI7XHJcblxyXG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGljb25EaXYpO1xyXG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZpbGVOYW1lKTtcclxuXHJcblxyXG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGljb25EaXYpO1xyXG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZpbGVOYW1lKTtcclxuXHJcbiAgICAgICAgICAvLyDwn5SXIE91dnJpciBsZSBmaWNoaWVyIGF1IGNsaWMgKHN1ciB0b3V0IGxlIGNvbnRlbmV1cilcclxuICAgICAgICAgIGNvbnRhaW5lci5zdHlsZS5jdXJzb3IgPSBcInBvaW50ZXJcIjtcclxuICAgICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5GaWxlKHZhbHVlKVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICByZXR1cm4gY29udGFpbmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLmRpc3BsYXkgPT09IFwiYnV0dG9uXCIpIHtcclxuICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChcImNyZWF0ZS1mcmVlY2FkLWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJtb2QtY3RhXCIpO1xyXG4gICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gdGhpcy50aXRsZSB8fCBcIk91dnJpciBsZSBmaWNoaWVyXCI7XHJcbiAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm9wZW5GaWxlKHZhbHVlKVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTtcclxuICAgICAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBzdXBlci5maWxsRGlzcGxheSh2YWx1ZSwgdXBkYXRlKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRGaWxlSWNvbih2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgaWYgKHZhbHVlICYmIHZhbHVlLnN0YXJ0c1dpdGgoXCJbW1wiKSAmJiB2YWx1ZS5lbmRzV2l0aChcIl1dXCIpKSB7XHJcbiAgICAgICAgY29uc3QgbWVkaWFQYXRoID0gdGhpcy52YXVsdC5yZWFkTGlua0ZpbGUodmFsdWUsIHRydWUpO1xyXG4gICAgICAgIGlmIChtZWRpYVBhdGgpIHtcclxuICAgICAgICAgIGNvbnN0IGV4dCA9IG1lZGlhUGF0aC50b0xvd2VyQ2FzZSgpLnNwbGl0KCcuJykucG9wKCk7XHJcbiAgICAgICAgICBpZiAoZXh0ICYmIFtcInBuZ1wiLCBcImpwZ1wiLCBcImpwZWdcIiwgXCJnaWZcIl0uaW5jbHVkZXMoZXh0KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJpbWFnZVwiO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChleHQgJiYgW1wiZ2xiXCIsIFwiZ2x0ZlwiLCBcImZjc3RkXCJdLmluY2x1ZGVzKGV4dCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFwiY3ViZTNkXCI7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGV4dCAmJiBbXCJwZGZcIiwgXCJkb2N4XCIsIFwidHh0XCJdLmluY2x1ZGVzKGV4dCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFwiZmlsZVwiO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChleHQgJiYgW1wibXA0XCIsIFwid2VibVwiLCBcIm9nZ1wiXS5pbmNsdWRlcyhleHQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcInZpZGVvXCI7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGV4dCAmJiBbXCJtcDNcIiwgXCJ3YXZcIl0uaW5jbHVkZXMoZXh0KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJhdWRpb1wiO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSBpZiAoZXh0ICYmIFtcInppcFwiLCBcInJhclwiXS5pbmNsdWRlcyhleHQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcImFyY2hpdmVcIjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2UgaWYgKGV4dCAmJiBbXCJzbGFcIl0uaW5jbHVkZXMoZXh0KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJzcXVhcmUtcGVuXCI7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIGlmIChleHQgJiYgW1wibGJybjJcIl0uaW5jbHVkZXMoZXh0KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJmbGFtZVwiO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB0aGlzLmljb24gfHwgXCJtZWRpYVwiO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUVtYmVkRWRpdENvbnRhaW5lcih1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+LCB2YWx1ZTogc3RyaW5nKTogSFRNTERpdkVsZW1lbnQge1xyXG4gICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChcImVtYmVkLWVkaXQtY29udGFpbmVyXCIpO1xyXG4gICAgICBjb250YWluZXIuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7IC8vIFBvc2l0aW9uIHRoZSBpY29uIGNvbnRhaW5lciBhYnNvbHV0ZWx5XHJcbiAgICAgIGNvbnRhaW5lci5zdHlsZS50b3AgPSBcIjVweFwiOyAvLyBBZGp1c3QgdGhlIHRvcCBwb3NpdGlvblxyXG4gICAgICBjb250YWluZXIuc3R5bGUubGVmdCA9IFwiNXB4XCI7IC8vIEFkanVzdCB0aGUgcmlnaHQgcG9zaXRpb25cclxuICAgICAgY29udGFpbmVyLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiOyAvLyBDaGFuZ2UgY3Vyc29yIHRvIHBvaW50ZXJcclxuXHJcbiAgICAgIGNvbnN0IGljb25Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBpY29uQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJpY29uLWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICAgIGNvbnN0IGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaVwiKTtcclxuICAgICAgdGhpcy52YXVsdC5hcHAuc2V0SWNvbihpY29uLCBcImxpbmtcIik7XHJcblxyXG4gICAgICBpY29uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoZXZlbnQpID0+IGF3YWl0IHRoaXMuaGFuZGxlSWNvbkNsaWNrKHVwZGF0ZSwgZXZlbnQpKTtcclxuXHJcbiAgICAgIGljb25Db250YWluZXIuYXBwZW5kQ2hpbGQoaWNvbik7XHJcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChpY29uQ29udGFpbmVyKTtcclxuXHJcbiAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlRW1iZWRPcGVuQ29udGFpbmVyKHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4sIHZhbHVlOiBzdHJpbmcpOiBIVE1MRGl2RWxlbWVudCB7XHJcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiZW1iZWQtb3Blbi1jb250YWluZXJcIik7XHJcbiAgICAgIGNvbnRhaW5lci5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjsgLy8gUG9zaXRpb24gdGhlIGljb24gY29udGFpbmVyIGFic29sdXRlbHlcclxuICAgICAgY29udGFpbmVyLnN0eWxlLnRvcCA9IFwiNXB4XCI7IC8vIEFkanVzdCB0aGUgdG9wIHBvc2l0aW9uXHJcbiAgICAgIGNvbnRhaW5lci5zdHlsZS5yaWdodCA9IFwiNXB4XCI7IC8vIEFkanVzdCB0aGUgcmlnaHQgcG9zaXRpb25cclxuICAgICAgY29udGFpbmVyLnN0eWxlLmN1cnNvciA9IFwicG9pbnRlclwiOyAvLyBDaGFuZ2UgY3Vyc29yIHRvIHBvaW50ZXJcclxuXHJcbiAgICAgIGNvbnN0IGljb25Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBpY29uQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJpY29uLWNvbnRhaW5lclwiKTtcclxuICAgICAgXHJcblxyXG4gICAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlcIik7XHJcbiAgICAgIHRoaXMudmF1bHQuYXBwLnNldEljb24oaWNvbiwgXCJleHRlcm5hbC1saW5rXCIpO1xyXG5cclxuICAgICAgaWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMub3BlbkZpbGUodmFsdWUpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy52YXVsdC5hcHAuc2VuZE5vdGljZShcIlVuYWJsZSB0byBnZW5lcmF0ZSBsaW5rIGZvciB0aGUgbWVkaWEuXCIpO1xyXG4gICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWNvbkNvbnRhaW5lci5hcHBlbmRDaGlsZChpY29uKTtcclxuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGljb25Db250YWluZXIpO1xyXG5cclxuICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICBjcmVhdGVFbWJlZEltYWdlQ29udGFpbmVyKG1lZGlhUGF0aDogc3RyaW5nLCB1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+KTogSFRNTERpdkVsZW1lbnQge1xyXG4gICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLWZpZWxkXCIsIFwibWVkaWEtZmllbGRcIiwgXCJlbWJlZC1jb250YWluZXJcIik7XHJcblxyXG4gICAgICBjb25zdCBlbWJlZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XHJcbiAgICAgIFxyXG4gICAgICBlbWJlZC5zcmMgPSB0aGlzLnZhdWx0LmFwcC5nZXRBYnNvbHV0ZVBhdGgobWVkaWFQYXRoKTtcclxuICAgICAgZW1iZWQuYWx0ID0gXCJNZWRpYVwiO1xyXG5cclxuICAgICAgZW1iZWQuY2xhc3NMaXN0LmFkZChcImVtYmVkLW1lZGlhXCIpO1xyXG5cclxuICAgICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIGljb25Db250YWluZXIuY2xhc3NMaXN0LmFkZChcImljb24tY29udGFpbmVyXCIpO1xyXG5cclxuICAgICAgY29uc3QgaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpXCIpO1xyXG4gICAgICBpY29uLmNsYXNzTGlzdC5hZGQoXCJpY29uXCIsIHRoaXMuaWNvbik7XHJcbiAgICAgIGljb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChldmVudCkgPT4gYXdhaXQgdGhpcy5oYW5kbGVJY29uQ2xpY2sodXBkYXRlLCBldmVudCkpO1xyXG5cclxuICAgICAgaWNvbkNvbnRhaW5lci5hcHBlbmRDaGlsZChpY29uKTtcclxuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGVtYmVkKTtcclxuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGljb25Db250YWluZXIpO1xyXG5cclxuICAgICAgcmV0dXJuIGNvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBGb25jdGlvbiBwb3VyIGfDqXJlciBsZSBjbGljIHN1ciBsJ2ljw7RuZVxyXG4gICAgb3ZlcnJpZGUgYXN5bmMgaGFuZGxlSWNvbkNsaWNrKHVwZGF0ZTogKHZhbHVlOiBzdHJpbmcpID0+IFByb21pc2U8dm9pZD4sIGV2ZW50OiBFdmVudCkge1xyXG4gICAgICAgIGxldCBzZWxlY3RlZEZpbGUgPSBhd2FpdCB0aGlzLnZhdWx0LmFwcC5zZWxlY3RNZWRpYSh0aGlzLnZhdWx0LCBcIkNob2lzaXNzZXogdW4gZG9jdW1lbnRcIiApXHJcbiAgICAgICAgaWYgKHNlbGVjdGVkRmlsZSl7XHJcbiAgICAgICAgICBhd2FpdCB1cGRhdGUoYFtbJHtzZWxlY3RlZEZpbGUucGF0aH18JHtzZWxlY3RlZEZpbGUubmFtZX1dXWApXHJcbiAgICAgICAgICBjb25zdCBsaW5rID0gKGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudCkuY2xvc2VzdCgnLm1ldGFkYXRhLWZpZWxkJyk/LnF1ZXJ5U2VsZWN0b3IoJy5maWVsZC1saW5rJykgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGlmIChsaW5rKSB7XHJcbiAgICAgICAgICAgICAgbGluay50ZXh0Q29udGVudCA9IHNlbGVjdGVkRmlsZS5uYW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIE92ZXJyaWRlIHRoZSBjcmVhdGVGaWVsZENvbnRhaW5lckNvbnRlbnQgZnVuY3Rpb24gdG8gdHJ1bmNhdGUgdGhlIGxpbmtcclxuICAgIG92ZXJyaWRlIGNyZWF0ZUZpZWxkQ29udGFpbmVyQ29udGVudCh1cGRhdGU6ICh2YWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPHZvaWQ+LCB2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgIGNvbnN0IGZpZWxkQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgZmllbGRDb250YWluZXIuY2xhc3NMaXN0LmFkZChcImZpZWxkLWNvbnRhaW5lclwiKTtcclxuICAgICAgY29uc3QgY3VycmVudEZpZWxkID0gdGhpcy5nZXRMaW5rKHZhbHVlKTtcclxuICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG4gICAgICBsaW5rLmhyZWYgPSBcIiNcIjtcclxuICAgICAgY29uc3QgdHJ1bmNhdGVkRmllbGQgPSBjdXJyZW50RmllbGQ/Lmxlbmd0aCA+IDEyID8gY3VycmVudEZpZWxkLnNsaWNlKDAsIDEyKSArIFwiLi4uXCIgOiBjdXJyZW50RmllbGQ7XHJcbiAgICAgIGxpbmsudGV4dENvbnRlbnQgPSB0cnVuY2F0ZWRGaWVsZCB8fCBcIlwiO1xyXG4gICAgICBsaW5rLnNldEF0dHJpYnV0ZShcImZ1bGwtdGV4dFwiLCBjdXJyZW50RmllbGQgfHwgXCJcIik7XHJcbiAgICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jIChldmVudCkgPT4gYXdhaXQgdGhpcy5tb2RpZnlGaWVsZChldmVudCkpO1xyXG4gICAgICBsaW5rLmNsYXNzTGlzdC5hZGQoXCJmaWVsZC1saW5rXCIpO1xyXG4gICAgICBsaW5rLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcblxyXG4gICAgICBmaWVsZENvbnRhaW5lci5hcHBlbmRDaGlsZChsaW5rKTtcclxuXHJcbiAgICAgIHJldHVybiBmaWVsZENvbnRhaW5lcjtcclxuICAgIH1cclxuXHJcbiAgICAgLy8gRm9uY3Rpb24gcG91ciBnw6lyZXIgbGUgY2xpYyBzdXIgbCdpY8O0bmVcclxuICAgIG92ZXJyaWRlIGFzeW5jIG1vZGlmeUZpZWxkKGV2ZW50OiBFdmVudCkge1xyXG4gICAgICBjb25zdCBsaW5rID0gKGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudCkuY2xvc2VzdCgnLm1ldGFkYXRhLWZpZWxkJyk/LnF1ZXJ5U2VsZWN0b3IoJy5maWVsZC1saW5rJykgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgIGxldCBjdXJyZW50RmllbGQgPSBsaW5rLmdldEF0dHJpYnV0ZShcImZ1bGwtdGV4dFwiKVxyXG4gICAgICBpZiAoIWN1cnJlbnRGaWVsZCl7cmV0dXJufVxyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgZmlsZSA9IGF3YWl0IHRoaXMudmF1bHQuYXBwLmdldEZpbGUoY3VycmVudEZpZWxkKTtcclxuICAgICAgaWYgKGZpbGUpIHtcclxuXHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnZhdWx0LmFwcC5vcGVuKGZpbGUucGF0aCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy52YXVsdC5hcHAuc2VuZE5vdGljZShgTGUgZmljaGllciAke2N1cnJlbnRGaWVsZH0gbidleGlzdGUgcGFzYClcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuXHJcbiJdLCJ2ZXJzaW9uIjozfQ==