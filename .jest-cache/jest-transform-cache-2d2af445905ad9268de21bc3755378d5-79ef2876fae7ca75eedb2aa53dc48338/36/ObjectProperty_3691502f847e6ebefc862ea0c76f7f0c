50386ac3aff4b32f627cc3db8b59fc3d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ObjectProperty = void 0;
const Property_1 = require("./Property");
const FileProperty_1 = require("./FileProperty");
class ObjectProperty extends Property_1.Property {
    constructor(name, vault, properties, args = {}) {
        super(name, vault, args);
        this.type = "object";
        this.flexSpan = 2;
        this.appendFirst = false;
        this.allowMove = true;
        this.display = "object"; // Can be "object", "table" or "list"
        this.appendFirst = args?.appendFirst || false;
        this.properties = properties;
        this.allowMove = args?.allowMove || true;
        // Assign any additional arguments to the instance
        Object.assign(this, args);
    }
    getClasses() {
        for (let prop of Object.values(this.properties)) {
            if (prop instanceof FileProperty_1.FileProperty || prop instanceof ObjectProperty || prop.type == "multiFile") {
                return prop.getClasses();
            }
        }
        throw new Error("No class found");
    }
    // Used by the ClasseProperty to get the parent file
    getParentValue(values) {
        if (values && values.length) {
            for (let prop of Object.values(this.properties)) {
                if (prop instanceof FileProperty_1.FileProperty || prop instanceof ObjectProperty || prop.type == "multiFile") {
                    return prop.getParentValue(values[0][prop.name]);
                }
            }
        }
        return undefined;
    }
    async findValue(file, value, propertyName) {
        let values = await this.read(file);
        if (values && values.length) {
            for (let i = 0; i < values.length; i++) {
                for (let prop of Object.values(this.properties)) {
                    let propValue = values[i][prop.name];
                    if (propValue && (propValue == value || (typeof propValue === "string" && propValue.includes(value)))) {
                        return values[i][propertyName];
                    }
                }
            }
        }
        return null;
    }
    async getDisplayProperties(file, propertyClasseName, propertyName, isStatic = true) {
        let properties = [];
        this.vault = file.vault;
        let values = await this.read(file);
        if (!(propertyName in this.properties)) {
            throw new Error("Property " + propertyName + " not found in ObjectProperty " + this.name);
        }
        let property = this.properties[propertyName];
        if (values && values.length) {
            for (let [index, row] of values.entries()) {
                property.static = isStatic;
                let display = property.fillDisplay(row[property.name], async (value) => await this.updateObject(values, async (value) => await file.updateMetadata(this.name, value), index, property, value));
                let classe = this.vault.getFromLink(row[this.properties[propertyClasseName].name]);
                properties.push({ classe: classe, display: display });
            }
        }
        return properties;
    }
    formatParentValue(value) {
        let newObject = {};
        Object.values(this.properties).forEach(prop => {
            if (value && prop instanceof FileProperty_1.FileProperty || prop instanceof ObjectProperty || prop.type == "multiFile") {
                newObject[prop.name] = value;
                value = ""; // Only one parent
            }
            else {
                newObject[prop.name] = "";
            }
        });
        return [newObject];
    }
    getDisplay(file, args) {
        this.display = args?.display || this.display;
        return super.getDisplay(file, args);
    }
    // Méthode principale pour obtenir l'affichage
    fillDisplay(values, update) {
        const container = document.createElement("div");
        container.classList.add("metadata-object-container-" + this.name.toLowerCase());
        // Créer l'en-tête
        this.createHeader(values, update, container);
        if (this.display == "table") {
            this.createTable(values, update, container);
        }
        else {
            // Affichage par défaut (objet)
            this.createObjects(values, update, container);
        }
        // Créer les lignes d'objet
        return container;
    }
    createTable(values, update, container) {
        // Créer un tableau pour les objets
        const tableWrapper = document.createElement("div");
        tableWrapper.style.position = "relative";
        container.appendChild(tableWrapper);
        let addButton = this.createAddButton(values, update, container);
        addButton.style.position = "absolute";
        addButton.style.top = "0";
        addButton.style.right = "0";
        tableWrapper.appendChild(addButton);
        const table = document.createElement("table");
        table.classList.add("metadata-object-table");
        tableWrapper.appendChild(table);
        // Créer l'en-tête du tableau
        const headerRow = document.createElement("tr");
        Object.values(this.properties).forEach(property => {
            const th = document.createElement("th");
            th.textContent = property.name;
            headerRow.appendChild(th);
        });
        // Ajouter une colonne pour le bouton de suppression
        const thDelete = document.createElement("th");
        headerRow.appendChild(thDelete);
        table.appendChild(headerRow);
        if (values && values.length) {
            // Créer les lignes d'objet
            values.forEach((objects, index) => {
                const row = document.createElement("tr");
                Object.values(this.properties).forEach(property => {
                    const td = document.createElement("td");
                    td.appendChild(property.fillDisplay(objects[property.name], async (value) => await this.updateObject(values, update, index, property, value)));
                    row.appendChild(td);
                });
                // Cellule pour le bouton de suppression
                const tdDelete = document.createElement("td");
                tdDelete.classList.add("metadata-object-delete-cell");
                const deleteButton = this.createDeleteButton(values, update, index, container);
                deleteButton.classList.add("metadata-object-delete-button");
                tdDelete.appendChild(deleteButton);
                row.appendChild(tdDelete);
                table.appendChild(row);
            });
        }
    }
    // Crée l'en-tête avec les propriétés
    createHeader(values, update, container) {
        const headerRow = document.createElement("div");
        headerRow.classList.add("metadata-object-header-row");
        let title = document.createElement("div");
        title.textContent = this.title ? this.title : this.name + " : ";
        title.classList.add("metadata-header");
        headerRow.appendChild(title);
        // Ajouter le bouton d'ajout
        const addButton = this.createAddButton(values, update, container);
        headerRow.appendChild(addButton);
        container.appendChild(headerRow);
    }
    // Crée le bouton d'ajout d'un nouvel objet
    createAddButton(values, update, container) {
        const addButton = document.createElement("button");
        this.vault.app.setIcon(addButton, "circle-plus");
        addButton.classList.add("metadata-add-button");
        addButton.onclick = async () => await this.addProperty(values, update, container);
        return addButton;
    }
    // Crée les objets et les lignes à afficher
    createObjects(values, update, container) {
        if (!values) {
            return;
        }
        values.forEach((objects, index) => {
            const row = this.createObjectRow(values, update, objects, index, container);
            container.appendChild(row);
        });
        if (this.allowMove) {
            this.enableDragAndDrop(values, update, container);
        }
    }
    // Crée une ligne d'objet avec ses propriétés
    createObjectRow(values, update, objects, index, container) {
        const row = document.createElement("div");
        row.classList.add("metadata-object-row");
        if (this.allowMove) {
            row.draggable = true;
            row.dataset.index = index.toString();
            row.style.cursor = "grab";
        }
        // Ajouter le bouton de suppression
        const deleteButton = this.createDeleteButton(values, update, index, container);
        deleteButton.style.position = "absolute";
        deleteButton.style.top = "0";
        deleteButton.style.right = "0";
        row.style.position = "relative";
        row.appendChild(deleteButton);
        Object.values(this.properties).forEach(property => {
            let value = objects[property.name];
            let propertyContainer = document.createElement("div");
            propertyContainer.classList.add("metadata-object-property");
            if (property.flexSpan) {
                propertyContainer.style.gridColumn = "span " + property.flexSpan;
            }
            const title = document.createElement("div");
            title.textContent = property.name;
            title.classList.add("metadata-title");
            propertyContainer.appendChild(title);
            propertyContainer.appendChild(property.fillDisplay(value, async (value) => await this.updateObject(values, update, index, property, value)));
            row.appendChild(propertyContainer);
        });
        return row;
    }
    // Crée un bouton de suppression pour une ligne d'objet
    createDeleteButton(values, update, index, container) {
        const deleteButton = document.createElement("button");
        this.vault.app.setIcon(deleteButton, "circle-minus");
        deleteButton.classList.add("metadata-delete-button");
        deleteButton.onclick = async () => await this.removeProperty(values, update, index, container);
        return deleteButton;
    }
    // Gère le glisser-déposer pour réordonner les objets
    enableDragAndDrop(values, update, container) {
        let draggedElement = null;
        let isEditing = false;
        // Lorsque l'utilisateur clique dans un champ d'édition (input), on active l'édition
        document.addEventListener("focus", (event) => {
            const input = event.target;
            if (input?.classList.contains('field-input')) {
                isEditing = true; // Le champ est en mode édition
            }
        }, true);
        // Lorsque l'utilisateur quitte un champ d'édition (blur), on désactive l'édition
        document.addEventListener("blur", (event) => {
            const input = event.target;
            if (input?.classList.contains('field-input')) {
                isEditing = false; // Le champ n'est plus en mode édition
            }
        }, true);
        container.addEventListener("dragstart", (event) => {
            if (isEditing) {
                event.preventDefault();
                return;
            }
            draggedElement = event.target;
            draggedElement.classList.add("dragging");
        });
        container.addEventListener("dragover", (event) => {
            event.preventDefault();
            const afterElement = this.getDragAfterElement(container, event.clientY);
            if (afterElement == null) {
                container.appendChild(draggedElement);
            }
            else {
                container.insertBefore(draggedElement, afterElement);
            }
        });
        container.addEventListener("dragend", async () => {
            if (!draggedElement)
                return;
            draggedElement.classList.remove("dragging");
            // Récupérer le nouvel ordre des éléments
            await this.updateOrder(values, update, container);
        });
    }
    // Trouver l'élément après lequel insérer (pour le Drag & Drop)
    getDragAfterElement(container, y) {
        const draggableElements = Array.from(container.querySelectorAll(".metadata-object-row:not(.dragging)"));
        const result = draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            return offset < 0 && offset > closest.offset ? { offset, element: child } : closest;
        }, { offset: Number.NEGATIVE_INFINITY, element: null });
        return result.element;
    }
    // Met à jour l'ordre des éléments après un glisser-déposer
    async updateOrder(values, update, container) {
        console.log("Update order");
        let newOrder = [];
        Array.from(container.querySelectorAll(".metadata-object-row")).forEach((row) => {
            // Assurer qu'on travaille avec un HTMLElement pour accéder à dataset
            if (row instanceof HTMLElement && row.dataset.index) {
                let index = parseInt(row.dataset.index);
                newOrder.push(values[index]);
            }
        });
        // Mettre à jour les métadonnées
        await update(newOrder);
        await this.reloadObjects(newOrder, update);
    }
    // Fonction pour supprimer un objet
    async removeProperty(values, update, index, container) {
        console.log("Remove index : ", index);
        values.splice(index, 1);
        await update(values);
        await this.reloadObjects(values, update);
    }
    // Fonction pour ajouter un objet
    async addProperty(values, update, container) {
        console.log("Add new");
        let newObject = {};
        for (let prop of Object.values(this.properties)) {
            let defaultValue = prop.getDefaultValue();
            console.log("Default value : ", defaultValue);
            if (Object.values(this.properties)[0] == prop && (prop instanceof FileProperty_1.FileProperty)) {
                prop.vault = this.vault; // Assurez-vous que vault est défini pour le premier FileProperty
                const fileProp = prop; // Cast pour accéder à handleIconClick
                defaultValue = await new Promise(async (resolve) => {
                    await fileProp.handleIconClick(async (value) => {
                        resolve(value);
                        console.log("Default value after click : ", value);
                    }, new MouseEvent("click"));
                });
            }
            console.log("Default value after click : ", defaultValue);
            if (defaultValue == "like-precedent") {
                if (values && values.length) {
                    if (this.appendFirst) {
                        defaultValue = values[0][prop.name];
                    }
                    else {
                        defaultValue = values[values.length - 1][prop.name];
                    }
                }
                else {
                    defaultValue = "";
                }
            }
            newObject[prop.name] = defaultValue;
        }
        ;
        // Valeurs par défaut
        if (!values) {
            values = [];
        }
        if (this.appendFirst) {
            values.unshift(newObject);
        }
        else {
            values.push(newObject);
        }
        await update(values);
        await this.reloadObjects(values, update);
    }
    // Mise à jour des métadonnées
    async updateObject(values, update, index, property, value) {
        console.log("Update index : ", index);
        if (values) {
            values[index][property.name] = value;
        }
        else {
            values = [{ [property.name]: value }];
        }
        console.log("Updated Values : ", values);
        await update(values);
        await this.reloadObjects(values, update);
    }
    // Recharge dynamiquement les objets
    async reloadObjects(values, update) {
        const container = document.querySelector(".metadata-object-container-" + this.name.toLowerCase());
        if (container) {
            container.innerHTML = "";
            // Recréer l'en-tête et les objets
            console.log("Values : ", values);
            this.createHeader(values, update, container);
            if (this.display == "table") {
                this.createTable(values, update, container);
            }
            else {
                // Affichage par défaut (objet)
                this.createObjects(values, update, container);
            }
        }
    }
}
exports.ObjectProperty = ObjectProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE9iamVjdFByb3BlcnR5LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLHlDQUFzQztBQUV0QyxpREFBOEM7QUFLOUMsTUFBYSxjQUFlLFNBQVEsbUJBQVE7SUFVeEMsWUFBWSxJQUFZLEVBQUUsS0FBWSxFQUFFLFVBQXVDLEVBQUUsT0FBMEUsRUFBRTtRQUN6SixLQUFLLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQVBiLFNBQUksR0FBWSxRQUFRLENBQUM7UUFDekIsYUFBUSxHQUFHLENBQUMsQ0FBQztRQUN0QixnQkFBVyxHQUFhLEtBQUssQ0FBQztRQUM5QixjQUFTLEdBQWEsSUFBSSxDQUFDO1FBQzNCLFlBQU8sR0FBWSxRQUFRLENBQUMsQ0FBQyxxQ0FBcUM7UUFJckUsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLEVBQUUsV0FBVyxJQUFJLEtBQUssQ0FBQztRQUM5QyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksRUFBRSxTQUFTLElBQUksSUFBSSxDQUFDO1FBRXpDLGtEQUFrRDtRQUNsRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQsVUFBVTtRQUNOLEtBQUssSUFBSSxJQUFJLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUMsQ0FBQztZQUM3QyxJQUFJLElBQUksWUFBWSwyQkFBWSxJQUFJLElBQUksWUFBWSxjQUFjLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxXQUFXLEVBQUMsQ0FBQztnQkFDNUYsT0FBUSxJQUFZLENBQUMsVUFBVSxFQUFFLENBQUE7WUFDckMsQ0FBQztRQUNMLENBQUM7UUFDRCxNQUFNLElBQUksS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUE7SUFDbkMsQ0FBQztJQUVILG9EQUFvRDtJQUNwRCxjQUFjLENBQUMsTUFBWTtRQUN2QixJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxFQUFDLENBQUM7WUFDM0IsS0FBSyxJQUFJLElBQUksSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBQyxDQUFDO2dCQUMvQyxJQUFJLElBQUksWUFBWSwyQkFBWSxJQUFJLElBQUksWUFBWSxjQUFjLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxXQUFXLEVBQUMsQ0FBQztvQkFDOUYsT0FBUSxJQUFZLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtnQkFDM0QsQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDckIsQ0FBQztJQUVELEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBUyxFQUFFLEtBQWEsRUFBRSxZQUFvQjtRQUMxRCxJQUFJLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkMsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sRUFBQyxDQUFDO1lBQ3pCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ3JDLEtBQUssSUFBSSxJQUFJLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUMsQ0FBQztvQkFDN0MsSUFBSSxTQUFTLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDckMsSUFBSSxTQUFTLElBQUksQ0FBQyxTQUFTLElBQUksS0FBSyxJQUFJLENBQUMsT0FBTyxTQUFTLEtBQUssUUFBUSxJQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7d0JBQ3BHLE9BQU8sTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFBO29CQUNsQyxDQUFDO2dCQUNMLENBQUM7WUFDTCxDQUFDO1FBQ0wsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFHRCxLQUFLLENBQUMsb0JBQW9CLENBQUMsSUFBVSxFQUFFLGtCQUEyQixFQUFFLFlBQXFCLEVBQUUsV0FBb0IsSUFBSTtRQUMvRyxJQUFJLFVBQVUsR0FBcUMsRUFBRSxDQUFDO1FBQ3RELElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN4QixJQUFJLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkMsSUFBSSxDQUFDLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBQyxDQUFDO1lBQ3BDLE1BQU0sSUFBSSxLQUFLLENBQUMsV0FBVyxHQUFHLFlBQVksR0FBRywrQkFBK0IsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUYsQ0FBQztRQUNELElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUM7UUFFN0MsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sRUFBQyxDQUFDO1lBQ3pCLEtBQUssSUFBSSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQztnQkFDeEMsUUFBUSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUM7Z0JBQzNCLElBQUksT0FBTyxHQUFHLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFDakQsS0FBSyxFQUFFLEtBQVcsRUFBRyxFQUFFLENBQUMsTUFBTSxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxNQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBRW5KLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGtCQUFrQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtnQkFDbEYsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFHLE9BQU8sRUFBQyxDQUFDLENBQUM7WUFDekQsQ0FBQztRQUNMLENBQUM7UUFDRCxPQUFPLFVBQVUsQ0FBQztJQUN0QixDQUFDO0lBRUQsaUJBQWlCLENBQUMsS0FBYztRQUM1QixJQUFJLFNBQVMsR0FBUSxFQUFFLENBQUM7UUFDeEIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzFDLElBQUksS0FBSyxJQUFJLElBQUksWUFBWSwyQkFBWSxJQUFJLElBQUksWUFBWSxjQUFjLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxXQUFXLEVBQUMsQ0FBQztnQkFDckcsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUE7Z0JBQzVCLEtBQUssR0FBRyxFQUFFLENBQUEsQ0FBQyxrQkFBa0I7WUFDakMsQ0FBQztpQkFDSSxDQUFDO2dCQUNGLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFBO1lBQzdCLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUNILE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQTtJQUN0QixDQUFDO0lBRVEsVUFBVSxDQUFDLElBQVMsRUFBRSxJQUFpRTtRQUM1RixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksRUFBRSxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUM3QyxPQUFPLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFFQSw4Q0FBOEM7SUFDckMsV0FBVyxDQUFDLE1BQVcsRUFBRSxNQUFxQztRQUNwRSxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hELFNBQVMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLDRCQUE0QixHQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztRQUU5RSxrQkFBa0I7UUFDbEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBRTdDLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxPQUFPLEVBQUUsQ0FBQztZQUMxQixJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDaEQsQ0FBQzthQUNJLENBQUM7WUFDRiwrQkFBK0I7WUFDL0IsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ2xELENBQUM7UUFDRCwyQkFBMkI7UUFHM0IsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUNILFdBQVcsQ0FBQyxNQUFXLEVBQUUsTUFBcUMsRUFBRSxTQUF5QjtRQUNyRixtQ0FBbUM7UUFDbkMsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuRCxZQUFZLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxVQUFVLENBQUM7UUFDekMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUVwQyxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUE7UUFDL0QsU0FBUyxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDO1FBQ3RDLFNBQVMsQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUMxQixTQUFTLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7UUFDNUIsWUFBWSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUdwQyxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzlDLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLENBQUM7UUFDN0MsWUFBWSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUdoQyw2QkFBNkI7UUFDN0IsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDOUMsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN4QyxFQUFFLENBQUMsV0FBVyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDL0IsU0FBUyxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQztRQUNILG9EQUFvRDtRQUNwRCxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLFNBQVMsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFaEMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUU3QixJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDMUIsMkJBQTJCO1lBQzNCLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFZLEVBQUUsS0FBYSxFQUFFLEVBQUU7Z0JBQzNDLE1BQU0sR0FBRyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3pDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRTtvQkFDOUMsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDeEMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQ3RELEtBQUssRUFBRSxLQUFXLEVBQUUsRUFBRSxDQUFDLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUM3RixHQUFHLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUN4QixDQUFDLENBQUMsQ0FBQztnQkFFSCx3Q0FBd0M7Z0JBQ3hDLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzlDLFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLDZCQUE2QixDQUFDLENBQUM7Z0JBQ3RELE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxTQUFTLENBQUMsQ0FBQztnQkFDL0UsWUFBWSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsK0JBQStCLENBQUMsQ0FBQztnQkFDNUQsUUFBUSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFFbkMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDMUIsS0FBSyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMzQixDQUFDLENBQUMsQ0FBQztRQUNQLENBQUM7SUFDTCxDQUFDO0lBRUMscUNBQXFDO0lBQ3JDLFlBQVksQ0FBQyxNQUFZLEVBQUUsTUFBc0MsRUFBRSxTQUF5QjtRQUN4RixNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hELFNBQVMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLDRCQUE0QixDQUFDLENBQUM7UUFFdEQsSUFBSSxLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMxQyxLQUFLLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDO1FBQ2hFLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDdkMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUU3Qiw0QkFBNEI7UUFDNUIsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ2xFLFNBQVMsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFakMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBRUQsMkNBQTJDO0lBQzNDLGVBQWUsQ0FBQyxNQUFZLEVBQUUsTUFBc0MsRUFBRSxTQUF5QjtRQUMzRixNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFDaEQsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUMvQyxTQUFTLENBQUMsT0FBTyxHQUFHLEtBQUssSUFBSSxFQUFFLENBQUMsTUFBTSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDbEYsT0FBTyxTQUFTLENBQUM7SUFDckIsQ0FBQztJQUVELDJDQUEyQztJQUMzQyxhQUFhLENBQUMsTUFBVyxFQUFFLE1BQXNDLEVBQUcsU0FBeUI7UUFDekYsSUFBSSxDQUFDLE1BQU0sRUFBQyxDQUFDO1lBQUEsT0FBTTtRQUFBLENBQUM7UUFDcEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQVksRUFBRSxLQUFhLEVBQUUsRUFBRTtZQUMzQyxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxTQUFTLENBQUMsQ0FBQztZQUM1RSxTQUFTLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFDLENBQUM7WUFDaEIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDdEQsQ0FBQztJQUVMLENBQUM7SUFFRCw2Q0FBNkM7SUFDL0MsZUFBZSxDQUFDLE1BQVksRUFBRSxNQUFzQyxFQUFFLE9BQVksRUFBRSxLQUFhLEVBQUUsU0FBeUI7UUFDeEgsTUFBTSxHQUFHLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMxQyxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBRXpDLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBQyxDQUFDO1lBQ2hCLEdBQUcsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1lBQ3JCLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNyQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDOUIsQ0FBQztRQUNELG1DQUFtQztRQUNuQyxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDL0UsWUFBWSxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDO1FBQ3pDLFlBQVksQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUM3QixZQUFZLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUM7UUFDL0IsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDO1FBQ2hDLEdBQUcsQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLENBQUM7UUFFOUIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQzlDLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUE7WUFDbEMsSUFBSSxpQkFBaUIsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3RELGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQztZQUU1RCxJQUFJLFFBQVEsQ0FBQyxRQUFRLEVBQUMsQ0FBQztnQkFDbkIsaUJBQWlCLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRyxPQUFPLEdBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQztZQUNuRSxDQUFDO1lBRUQsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM1QyxLQUFLLENBQUMsV0FBVyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDbEMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUN0QyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDckMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUNwRCxLQUFLLEVBQUUsS0FBVSxFQUFFLEVBQUUsQ0FBQyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1RixHQUFHLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFFdkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFFRCx1REFBdUQ7SUFDdkQsa0JBQWtCLENBQUMsTUFBWSxFQUFFLE1BQXNDLEVBQUUsS0FBYSxFQUFFLFNBQXlCO1FBQzdHLE1BQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxjQUFjLENBQUMsQ0FBQztRQUNyRCxZQUFZLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1FBQ3JELFlBQVksQ0FBQyxPQUFPLEdBQUcsS0FBSyxJQUFJLEVBQUUsQ0FBQyxNQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDL0YsT0FBTyxZQUFZLENBQUM7SUFDeEIsQ0FBQztJQUVELHFEQUFxRDtJQUNyRCxpQkFBaUIsQ0FBQyxNQUFZLEVBQUUsTUFBc0MsRUFBRSxTQUF5QjtRQUM3RixJQUFJLGNBQWMsR0FBdUIsSUFBSSxDQUFDO1FBRTlDLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztRQUV0QixvRkFBb0Y7UUFDcEYsUUFBUSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ3pDLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFxQixDQUFDO1lBQzFDLElBQUksS0FBSyxFQUFFLFNBQVMsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztnQkFDM0MsU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFFLCtCQUErQjtZQUN0RCxDQUFDO1FBQ0wsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRVQsaUZBQWlGO1FBQ2pGLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUN4QyxNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBcUIsQ0FBQztZQUMxQyxJQUFJLEtBQUssRUFBRSxTQUFTLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUM7Z0JBQzNDLFNBQVMsR0FBRyxLQUFLLENBQUMsQ0FBRSxzQ0FBc0M7WUFDOUQsQ0FBQztRQUNMLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUVULFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUNoRCxJQUFJLFNBQVMsRUFBRSxDQUFDO2dCQUNkLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztnQkFDdkIsT0FBTztZQUNULENBQUM7WUFDRCxjQUFjLEdBQUcsS0FBSyxDQUFDLE1BQXFCLENBQUM7WUFDN0MsY0FBYyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDM0MsQ0FBQyxDQUFDLENBQUM7UUFFSCxTQUFTLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUU7WUFDN0MsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3hFLElBQUksWUFBWSxJQUFJLElBQUksRUFBRSxDQUFDO2dCQUN2QixTQUFTLENBQUMsV0FBVyxDQUFDLGNBQWUsQ0FBQyxDQUFDO1lBQzNDLENBQUM7aUJBQU0sQ0FBQztnQkFDTixTQUFTLENBQUMsWUFBWSxDQUFDLGNBQWUsRUFBRSxZQUFZLENBQUMsQ0FBQztZQUN4RCxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxTQUFTLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdDLElBQUksQ0FBQyxjQUFjO2dCQUFFLE9BQU87WUFDNUIsY0FBYyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7WUFFNUMseUNBQXlDO1lBQ3pDLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ3RELENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELCtEQUErRDtJQUMvRCxtQkFBbUIsQ0FBQyxTQUF5QixFQUFFLENBQVM7UUFDcEQsTUFBTSxpQkFBaUIsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDLENBQUM7UUFFeEcsTUFBTSxNQUFNLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBb0QsRUFBRSxLQUFLLEVBQUUsRUFBRTtZQUNwRyxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUMxQyxNQUFNLE1BQU0sR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUM1QyxPQUFPLE1BQU0sR0FBRyxDQUFDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQ3hGLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsaUJBQWlCLEVBQUUsT0FBTyxFQUFFLElBQXNCLEVBQUUsQ0FBQyxDQUFDO1FBRTFFLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQztJQUMxQixDQUFDO0lBRUQsMkRBQTJEO0lBQzNELEtBQUssQ0FBQyxXQUFXLENBQUMsTUFBWSxFQUFFLE1BQXNDLEVBQUUsU0FBeUI7UUFDL0YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQTtRQUN6QixJQUFJLFFBQVEsR0FBVSxFQUFFLENBQUM7UUFDekIsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQzNFLHFFQUFxRTtZQUNyRSxJQUFJLEdBQUcsWUFBWSxXQUFXLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDbEQsSUFBSSxLQUFLLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3hDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDakMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ0gsZ0NBQWdDO1FBQ2hDLE1BQU0sTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZCLE1BQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDOUMsQ0FBQztJQUVELG1DQUFtQztJQUNuQyxLQUFLLENBQUMsY0FBYyxDQUFDLE1BQVksRUFBRSxNQUFzQyxFQUFFLEtBQWEsRUFBRSxTQUF5QjtRQUMvRyxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ3JDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLE1BQU0sTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3JCLE1BQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDNUMsQ0FBQztJQUVELGlDQUFpQztJQUNqQyxLQUFLLENBQUMsV0FBVyxDQUFDLE1BQVksRUFBRSxNQUFzQyxFQUFFLFNBQXlCO1FBQzdGLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUE7UUFDdEIsSUFBSSxTQUFTLEdBQVEsRUFBRSxDQUFDO1FBQ3hCLEtBQUssSUFBSSxJQUFJLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUNoRCxJQUFJLFlBQVksR0FBRyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUE7WUFDekMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxZQUFZLENBQUMsQ0FBQTtZQUM3QyxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksWUFBWSwyQkFBWSxDQUFDLEVBQUUsQ0FBQztnQkFDOUUsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsaUVBQWlFO2dCQUMxRixNQUFNLFFBQVEsR0FBRyxJQUFXLENBQUMsQ0FBQyxzQ0FBc0M7Z0JBQ3BFLFlBQVksR0FBRyxNQUFNLElBQUksT0FBTyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFBRTtvQkFDL0MsTUFBTSxRQUFRLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxLQUFVLEVBQUUsRUFBRTt3QkFDaEQsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUNmLE9BQU8sQ0FBQyxHQUFHLENBQUMsOEJBQThCLEVBQUUsS0FBSyxDQUFDLENBQUM7b0JBQ3ZELENBQUMsRUFBRSxJQUFJLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUNoQyxDQUFDLENBQUMsQ0FBQztZQUNQLENBQUM7WUFDRCxPQUFPLENBQUMsR0FBRyxDQUFDLDhCQUE4QixFQUFFLFlBQVksQ0FBQyxDQUFDO1lBRTFELElBQUksWUFBWSxJQUFJLGdCQUFnQixFQUFDLENBQUM7Z0JBQ2xDLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEVBQUMsQ0FBQztvQkFDekIsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFDLENBQUM7d0JBQ2xCLFlBQVksR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO29CQUN2QyxDQUFDO3lCQUNJLENBQUM7d0JBQ0YsWUFBWSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtvQkFDckQsQ0FBQztnQkFDTCxDQUFDO3FCQUNJLENBQUM7b0JBQUEsWUFBWSxHQUFHLEVBQUUsQ0FBQTtnQkFBQSxDQUFDO1lBQzVCLENBQUM7WUFDRCxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLFlBQVksQ0FBQTtRQUV2QyxDQUFDO1FBQUEsQ0FBQztRQUNGLHFCQUFxQjtRQUNyQixJQUFJLENBQUMsTUFBTSxFQUFDLENBQUM7WUFBQSxNQUFNLEdBQUcsRUFBRSxDQUFBO1FBQUEsQ0FBQztRQUN6QixJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNuQixNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzlCLENBQUM7YUFBTSxDQUFDO1lBQ0osTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMzQixDQUFDO1FBQ0MsTUFBTSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckIsTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQTtJQUM1QyxDQUFDO0lBRUQsOEJBQThCO0lBQzlCLEtBQUssQ0FBQyxZQUFZLENBQUMsTUFBWSxFQUFFLE1BQXNDLEVBQUUsS0FBYSxFQUFFLFFBQWtCLEVBQUUsS0FBYTtRQUN2SCxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ25DLElBQUksTUFBTSxFQUFDLENBQUM7WUFDVixNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUN2QyxDQUFDO2FBQ0ksQ0FBQztZQUNKLE1BQU0sR0FBRyxDQUFDLEVBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUcsS0FBSyxFQUFDLENBQUMsQ0FBQTtRQUN0QyxDQUFDO1FBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxNQUFNLENBQUMsQ0FBQTtRQUN4QyxNQUFNLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNyQixNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFBO0lBQzVDLENBQUM7SUFFSCxvQ0FBb0M7SUFDcEMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxNQUFZLEVBQUUsTUFBc0M7UUFDcEUsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyw2QkFBNkIsR0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFtQixDQUFDO1FBQ2xILElBQUksU0FBUyxFQUFFLENBQUM7WUFDWixTQUFTLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztZQUN6QixrQ0FBa0M7WUFDbEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsTUFBTSxDQUFDLENBQUE7WUFDaEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQzdDLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxPQUFPLEVBQUUsQ0FBQztnQkFDMUIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQ2hELENBQUM7aUJBQ0ksQ0FBQztnQkFDRiwrQkFBK0I7Z0JBQy9CLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLENBQUMsQ0FBQztZQUNsRCxDQUFDO1FBQ0wsQ0FBQztJQUVMLENBQUM7Q0FDRjtBQXhhSCx3Q0F3YUciLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE9iamVjdFByb3BlcnR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQgeyBQcm9wZXJ0eSB9IGZyb20gXCIuL1Byb3BlcnR5XCI7XHJcbmltcG9ydCB7IEZpbGUgfSBmcm9tIFwiLi4vdmF1bHQvRmlsZVwiO1xyXG5pbXBvcnQgeyBGaWxlUHJvcGVydHkgfSBmcm9tIFwiLi9GaWxlUHJvcGVydHlcIjtcclxuaW1wb3J0IHsgVGV4dFByb3BlcnR5IH0gZnJvbSBcIi4vVGV4dFByb3BlcnR5XCI7XHJcbmltcG9ydCB7IE11bHRpRmlsZVByb3BlcnR5IH0gZnJvbSBcIi4vTXVsdGlGaWxlUHJvcGVydHlcIjtcclxuaW1wb3J0IHsgVmF1bHQgfSBmcm9tIFwiLi4vdmF1bHQvVmF1bHRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBPYmplY3RQcm9wZXJ0eSBleHRlbmRzIFByb3BlcnR5e1xyXG4gICAgLy8gVXNlZCBmb3IgcHJvcGVydHkgb2JqZWN0XHJcblxyXG4gICAgcHVibGljIHByb3BlcnRpZXMgOiB7W2tleSA6IHN0cmluZ10gOiBQcm9wZXJ0eX07XHJcbiAgICBwdWJsaWMgb3ZlcnJpZGUgdHlwZSA6IHN0cmluZyA9IFwib2JqZWN0XCI7XHJcbiAgICBwdWJsaWMgb3ZlcnJpZGUgZmxleFNwYW4gPSAyO1xyXG4gICAgcHVibGljIGFwcGVuZEZpcnN0IDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgcHVibGljIGFsbG93TW92ZSA6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgcHVibGljIGRpc3BsYXkgOiBzdHJpbmcgPSBcIm9iamVjdFwiOyAvLyBDYW4gYmUgXCJvYmplY3RcIiwgXCJ0YWJsZVwiIG9yIFwibGlzdFwiXHJcblxyXG4gICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCB2YXVsdDogVmF1bHQsIHByb3BlcnRpZXM6IHsgW2tleTogc3RyaW5nXTogUHJvcGVydHkgfSwgYXJnczogeyBhbGxvd01vdmU/OiBib29sZWFuLCBhcHBlbmRGaXJzdD86IGJvb2xlYW4sIFtrZXk6IHN0cmluZ106IGFueX0gPSB7fSkge1xyXG4gICAgICAgIHN1cGVyKG5hbWUsIHZhdWx0LCBhcmdzKTtcclxuICAgICAgICB0aGlzLmFwcGVuZEZpcnN0ID0gYXJncz8uYXBwZW5kRmlyc3QgfHwgZmFsc2U7XHJcbiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllcztcclxuICAgICAgICB0aGlzLmFsbG93TW92ZSA9IGFyZ3M/LmFsbG93TW92ZSB8fCB0cnVlO1xyXG5cclxuICAgICAgICAvLyBBc3NpZ24gYW55IGFkZGl0aW9uYWwgYXJndW1lbnRzIHRvIHRoZSBpbnN0YW5jZVxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgYXJncyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Q2xhc3NlcygpOiBzdHJpbmdbXXtcclxuICAgICAgICBmb3IgKGxldCBwcm9wIG9mIE9iamVjdC52YWx1ZXModGhpcy5wcm9wZXJ0aWVzKSl7XHJcbiAgICAgICAgICAgIGlmIChwcm9wIGluc3RhbmNlb2YgRmlsZVByb3BlcnR5IHx8IHByb3AgaW5zdGFuY2VvZiBPYmplY3RQcm9wZXJ0eSB8fCBwcm9wLnR5cGUgPT0gXCJtdWx0aUZpbGVcIil7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKHByb3AgYXMgYW55KS5nZXRDbGFzc2VzKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBjbGFzcyBmb3VuZFwiKVxyXG4gICAgICB9XHJcblxyXG4gICAgLy8gVXNlZCBieSB0aGUgQ2xhc3NlUHJvcGVydHkgdG8gZ2V0IHRoZSBwYXJlbnQgZmlsZVxyXG4gICAgZ2V0UGFyZW50VmFsdWUodmFsdWVzIDogYW55KSA6IEZpbGUgfCB1bmRlZmluZWR7XHJcbiAgICAgICAgaWYgKHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoKXtcclxuICAgICAgICAgIGZvciAobGV0IHByb3Agb2YgT2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnRpZXMpKXtcclxuICAgICAgICAgICAgaWYgKHByb3AgaW5zdGFuY2VvZiBGaWxlUHJvcGVydHkgfHwgcHJvcCBpbnN0YW5jZW9mIE9iamVjdFByb3BlcnR5IHx8IHByb3AudHlwZSA9PSBcIm11bHRpRmlsZVwiKXtcclxuICAgICAgICAgICAgICByZXR1cm4gKHByb3AgYXMgYW55KS5nZXRQYXJlbnRWYWx1ZSh2YWx1ZXNbMF1bcHJvcC5uYW1lXSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGZpbmRWYWx1ZShmaWxlOiBhbnksIHZhbHVlOiBzdHJpbmcsIHByb3BlcnR5TmFtZTogc3RyaW5nKTogUHJvbWlzZSA8YW55PiB7XHJcbiAgICAgICAgbGV0IHZhbHVlcyA9IGF3YWl0IHRoaXMucmVhZChmaWxlKTtcclxuICAgICAgICBpZiAodmFsdWVzICYmIHZhbHVlcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgcHJvcCBvZiBPYmplY3QudmFsdWVzKHRoaXMucHJvcGVydGllcykpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBwcm9wVmFsdWUgPSB2YWx1ZXNbaV1bcHJvcC5uYW1lXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcFZhbHVlICYmIChwcm9wVmFsdWUgPT0gdmFsdWUgfHwgKHR5cGVvZiBwcm9wVmFsdWUgPT09IFwic3RyaW5nXCIgJiYgcHJvcFZhbHVlLmluY2x1ZGVzKHZhbHVlKSkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZXNbaV1bcHJvcGVydHlOYW1lXVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgYXN5bmMgZ2V0RGlzcGxheVByb3BlcnRpZXMoZmlsZTogRmlsZSwgcHJvcGVydHlDbGFzc2VOYW1lIDogc3RyaW5nLCBwcm9wZXJ0eU5hbWUgOiBzdHJpbmcsIGlzU3RhdGljOiBib29sZWFuID0gdHJ1ZSk6IFByb21pc2U8e2NsYXNzZSA6IGFueSAsIGRpc3BsYXkgOiBhbnl9W10+IHtcclxuICAgICAgICBsZXQgcHJvcGVydGllczoge2NsYXNzZSA6IGFueSAsIGRpc3BsYXkgOiBhbnl9W10gPSBbXTtcclxuICAgICAgICB0aGlzLnZhdWx0ID0gZmlsZS52YXVsdDtcclxuICAgICAgICBsZXQgdmFsdWVzID0gYXdhaXQgdGhpcy5yZWFkKGZpbGUpO1xyXG4gICAgICAgIGlmICghKHByb3BlcnR5TmFtZSBpbiB0aGlzLnByb3BlcnRpZXMpKXtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHJvcGVydHkgXCIgKyBwcm9wZXJ0eU5hbWUgKyBcIiBub3QgZm91bmQgaW4gT2JqZWN0UHJvcGVydHkgXCIgKyB0aGlzLm5hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcHJvcGVydHkgPSB0aGlzLnByb3BlcnRpZXNbcHJvcGVydHlOYW1lXTtcclxuXHJcbiAgICAgICAgaWYgKHZhbHVlcyAmJiB2YWx1ZXMubGVuZ3RoKXtcclxuICAgICAgICAgICAgZm9yIChsZXQgW2luZGV4LCByb3ddIG9mIHZhbHVlcy5lbnRyaWVzKCkpIHtcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5LnN0YXRpYyA9IGlzU3RhdGljO1xyXG4gICAgICAgICAgICAgICAgbGV0IGRpc3BsYXkgPSBwcm9wZXJ0eS5maWxsRGlzcGxheShyb3dbcHJvcGVydHkubmFtZV0sXHJcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMgKHZhbHVlIDogYW55ICkgPT4gYXdhaXQgdGhpcy51cGRhdGVPYmplY3QodmFsdWVzLCBhc3luYyAodmFsdWUpID0+IGF3YWl0IGZpbGUudXBkYXRlTWV0YWRhdGEodGhpcy5uYW1lLCB2YWx1ZSksIGluZGV4LCBwcm9wZXJ0eSwgdmFsdWUpKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgbGV0IGNsYXNzZSA9IHRoaXMudmF1bHQuZ2V0RnJvbUxpbmsocm93W3RoaXMucHJvcGVydGllc1twcm9wZXJ0eUNsYXNzZU5hbWVdLm5hbWVdKVxyXG4gICAgICAgICAgICAgICAgcHJvcGVydGllcy5wdXNoKHtjbGFzc2U6IGNsYXNzZSwgZGlzcGxheSA6IGRpc3BsYXl9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcHJvcGVydGllcztcclxuICAgIH1cclxuXHJcbiAgICBmb3JtYXRQYXJlbnRWYWx1ZSh2YWx1ZSA6IHN0cmluZyl7XHJcbiAgICAgICAgbGV0IG5ld09iamVjdDogYW55ID0ge307XHJcbiAgICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnRpZXMpLmZvckVhY2gocHJvcCA9PiB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiBwcm9wIGluc3RhbmNlb2YgRmlsZVByb3BlcnR5IHx8IHByb3AgaW5zdGFuY2VvZiBPYmplY3RQcm9wZXJ0eSB8fCBwcm9wLnR5cGUgPT0gXCJtdWx0aUZpbGVcIil7XHJcbiAgICAgICAgICAgICAgICBuZXdPYmplY3RbcHJvcC5uYW1lXSA9IHZhbHVlXHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IFwiXCIgLy8gT25seSBvbmUgcGFyZW50XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBuZXdPYmplY3RbcHJvcC5uYW1lXSA9IFwiXCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBbbmV3T2JqZWN0XVxyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGdldERpc3BsYXkoZmlsZTogYW55LCBhcmdzPzogeyBzdGF0aWNNb2RlPzogYm9vbGVhbjsgdGl0bGU/OiBzdHJpbmc7IGRpc3BsYXk/IDogc3RyaW5nfSk6IEhUTUxEaXZFbGVtZW50IHtcclxuICAgICAgICB0aGlzLmRpc3BsYXkgPSBhcmdzPy5kaXNwbGF5IHx8IHRoaXMuZGlzcGxheTtcclxuICAgICAgICByZXR1cm4gc3VwZXIuZ2V0RGlzcGxheShmaWxlLCBhcmdzKTtcclxuICAgIH1cclxuXHJcbiAgICAgLy8gTcOpdGhvZGUgcHJpbmNpcGFsZSBwb3VyIG9idGVuaXIgbCdhZmZpY2hhZ2VcclxuICAgICBvdmVycmlkZSBmaWxsRGlzcGxheSh2YWx1ZXM6IGFueSwgdXBkYXRlOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPikge1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1vYmplY3QtY29udGFpbmVyLVwiK3RoaXMubmFtZS50b0xvd2VyQ2FzZSgpKTtcclxuXHJcbiAgICAgICAgLy8gQ3LDqWVyIGwnZW4tdMOqdGVcclxuICAgICAgICB0aGlzLmNyZWF0ZUhlYWRlcih2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuZGlzcGxheSA9PSBcInRhYmxlXCIpIHtcclxuICAgICAgICAgICAgdGhpcy5jcmVhdGVUYWJsZSh2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIEFmZmljaGFnZSBwYXIgZMOpZmF1dCAob2JqZXQpXHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlT2JqZWN0cyh2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQ3LDqWVyIGxlcyBsaWduZXMgZCdvYmpldFxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICByZXR1cm4gY29udGFpbmVyO1xyXG4gICAgICB9XHJcbiAgICBjcmVhdGVUYWJsZSh2YWx1ZXM6IGFueSwgdXBkYXRlOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAgIC8vIENyw6llciB1biB0YWJsZWF1IHBvdXIgbGVzIG9iamV0c1xyXG4gICAgICAgIGNvbnN0IHRhYmxlV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgdGFibGVXcmFwcGVyLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xyXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0YWJsZVdyYXBwZXIpO1xyXG5cclxuICAgICAgICBsZXQgYWRkQnV0dG9uID0gdGhpcy5jcmVhdGVBZGRCdXR0b24odmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcilcclxuICAgICAgICBhZGRCdXR0b24uc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XHJcbiAgICAgICAgYWRkQnV0dG9uLnN0eWxlLnRvcCA9IFwiMFwiO1xyXG4gICAgICAgIGFkZEJ1dHRvbi5zdHlsZS5yaWdodCA9IFwiMFwiO1xyXG4gICAgICAgIHRhYmxlV3JhcHBlci5hcHBlbmRDaGlsZChhZGRCdXR0b24pO1xyXG5cclxuXHJcbiAgICAgICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGFibGVcIik7XHJcbiAgICAgICAgdGFibGUuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLW9iamVjdC10YWJsZVwiKTtcclxuICAgICAgICB0YWJsZVdyYXBwZXIuYXBwZW5kQ2hpbGQodGFibGUpO1xyXG5cclxuXHJcbiAgICAgICAgLy8gQ3LDqWVyIGwnZW4tdMOqdGUgZHUgdGFibGVhdVxyXG4gICAgICAgIGNvbnN0IGhlYWRlclJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0clwiKTtcclxuICAgICAgICBPYmplY3QudmFsdWVzKHRoaXMucHJvcGVydGllcykuZm9yRWFjaChwcm9wZXJ0eSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRoXCIpO1xyXG4gICAgICAgICAgICB0aC50ZXh0Q29udGVudCA9IHByb3BlcnR5Lm5hbWU7XHJcbiAgICAgICAgICAgIGhlYWRlclJvdy5hcHBlbmRDaGlsZCh0aCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gQWpvdXRlciB1bmUgY29sb25uZSBwb3VyIGxlIGJvdXRvbiBkZSBzdXBwcmVzc2lvblxyXG4gICAgICAgIGNvbnN0IHRoRGVsZXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRoXCIpO1xyXG4gICAgICAgIGhlYWRlclJvdy5hcHBlbmRDaGlsZCh0aERlbGV0ZSk7XHJcblxyXG4gICAgICAgIHRhYmxlLmFwcGVuZENoaWxkKGhlYWRlclJvdyk7XHJcblxyXG4gICAgICAgIGlmICh2YWx1ZXMgJiYgdmFsdWVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAvLyBDcsOpZXIgbGVzIGxpZ25lcyBkJ29iamV0XHJcbiAgICAgICAgICAgIHZhbHVlcy5mb3JFYWNoKChvYmplY3RzOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0clwiKTtcclxuICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXModGhpcy5wcm9wZXJ0aWVzKS5mb3JFYWNoKHByb3BlcnR5ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZC5hcHBlbmRDaGlsZChwcm9wZXJ0eS5maWxsRGlzcGxheShvYmplY3RzW3Byb3BlcnR5Lm5hbWVdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhc3luYyAodmFsdWUgOiBhbnkpID0+IGF3YWl0IHRoaXMudXBkYXRlT2JqZWN0KHZhbHVlcywgdXBkYXRlLCBpbmRleCwgcHJvcGVydHksIHZhbHVlKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJvdy5hcHBlbmRDaGlsZCh0ZCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDZWxsdWxlIHBvdXIgbGUgYm91dG9uIGRlIHN1cHByZXNzaW9uXHJcbiAgICAgICAgICAgICAgICBjb25zdCB0ZERlbGV0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcclxuICAgICAgICAgICAgICAgIHRkRGVsZXRlLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1vYmplY3QtZGVsZXRlLWNlbGxcIik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkZWxldGVCdXR0b24gPSB0aGlzLmNyZWF0ZURlbGV0ZUJ1dHRvbih2YWx1ZXMsIHVwZGF0ZSwgaW5kZXgsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgICAgICBkZWxldGVCdXR0b24uY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLW9iamVjdC1kZWxldGUtYnV0dG9uXCIpO1xyXG4gICAgICAgICAgICAgICAgdGREZWxldGUuYXBwZW5kQ2hpbGQoZGVsZXRlQnV0dG9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQodGREZWxldGUpO1xyXG4gICAgICAgICAgICAgICAgdGFibGUuYXBwZW5kQ2hpbGQocm93KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gIFxyXG4gICAgICAvLyBDcsOpZSBsJ2VuLXTDqnRlIGF2ZWMgbGVzIHByb3ByacOpdMOpc1xyXG4gICAgICBjcmVhdGVIZWFkZXIodmFsdWVzIDogYW55LCB1cGRhdGUgOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAgICAgY29uc3QgaGVhZGVyUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgIGhlYWRlclJvdy5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtb2JqZWN0LWhlYWRlci1yb3dcIik7XHJcblxyXG4gICAgICAgICAgbGV0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0gdGhpcy50aXRsZSA/IHRoaXMudGl0bGUgOiB0aGlzLm5hbWUgKyBcIiA6IFwiO1xyXG4gICAgICAgICAgdGl0bGUuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLWhlYWRlclwiKTtcclxuICAgICAgICAgIGhlYWRlclJvdy5hcHBlbmRDaGlsZCh0aXRsZSk7XHJcbiAgXHJcbiAgICAgICAgICAvLyBBam91dGVyIGxlIGJvdXRvbiBkJ2Fqb3V0XHJcbiAgICAgICAgICBjb25zdCBhZGRCdXR0b24gPSB0aGlzLmNyZWF0ZUFkZEJ1dHRvbih2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgIGhlYWRlclJvdy5hcHBlbmRDaGlsZChhZGRCdXR0b24pO1xyXG4gIFxyXG4gICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGhlYWRlclJvdyk7XHJcbiAgICAgIH1cclxuICBcclxuICAgICAgLy8gQ3LDqWUgbGUgYm91dG9uIGQnYWpvdXQgZCd1biBub3V2ZWwgb2JqZXRcclxuICAgICAgY3JlYXRlQWRkQnV0dG9uKHZhbHVlcyA6IGFueSwgdXBkYXRlIDogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpOiBIVE1MQnV0dG9uRWxlbWVudCB7XHJcbiAgICAgICAgICBjb25zdCBhZGRCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgdGhpcy52YXVsdC5hcHAuc2V0SWNvbihhZGRCdXR0b24sIFwiY2lyY2xlLXBsdXNcIilcclxuICAgICAgICAgIGFkZEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtYWRkLWJ1dHRvblwiKTtcclxuICAgICAgICAgIGFkZEJ1dHRvbi5vbmNsaWNrID0gYXN5bmMgKCkgPT4gYXdhaXQgdGhpcy5hZGRQcm9wZXJ0eSh2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgIHJldHVybiBhZGRCdXR0b247XHJcbiAgICAgIH1cclxuICBcclxuICAgICAgLy8gQ3LDqWUgbGVzIG9iamV0cyBldCBsZXMgbGlnbmVzIMOgIGFmZmljaGVyXHJcbiAgICAgIGNyZWF0ZU9iamVjdHModmFsdWVzOiBhbnksIHVwZGF0ZSA6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCAgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAgICAgaWYgKCF2YWx1ZXMpe3JldHVybn1cclxuICAgICAgICAgIHZhbHVlcy5mb3JFYWNoKChvYmplY3RzOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLmNyZWF0ZU9iamVjdFJvdyh2YWx1ZXMsIHVwZGF0ZSwgb2JqZWN0cywgaW5kZXgsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHJvdyk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGlmICh0aGlzLmFsbG93TW92ZSl7XHJcbiAgICAgICAgICAgICAgdGhpcy5lbmFibGVEcmFnQW5kRHJvcCh2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgXHJcbiAgICAgIH1cclxuICBcclxuICAgICAgLy8gQ3LDqWUgdW5lIGxpZ25lIGQnb2JqZXQgYXZlYyBzZXMgcHJvcHJpw6l0w6lzXHJcbiAgICBjcmVhdGVPYmplY3RSb3codmFsdWVzIDogYW55LCB1cGRhdGUgOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgb2JqZWN0czogYW55LCBpbmRleDogbnVtYmVyLCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KTogSFRNTERpdkVsZW1lbnQge1xyXG4gICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1vYmplY3Qtcm93XCIpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5hbGxvd01vdmUpe1xyXG4gICAgICAgICAgICByb3cuZHJhZ2dhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgcm93LmRhdGFzZXQuaW5kZXggPSBpbmRleC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICByb3cuc3R5bGUuY3Vyc29yID0gXCJncmFiXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEFqb3V0ZXIgbGUgYm91dG9uIGRlIHN1cHByZXNzaW9uXHJcbiAgICAgICAgY29uc3QgZGVsZXRlQnV0dG9uID0gdGhpcy5jcmVhdGVEZWxldGVCdXR0b24odmFsdWVzLCB1cGRhdGUsIGluZGV4LCBjb250YWluZXIpO1xyXG4gICAgICAgIGRlbGV0ZUJ1dHRvbi5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcclxuICAgICAgICBkZWxldGVCdXR0b24uc3R5bGUudG9wID0gXCIwXCI7XHJcbiAgICAgICAgZGVsZXRlQnV0dG9uLnN0eWxlLnJpZ2h0ID0gXCIwXCI7XHJcbiAgICAgICAgcm93LnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xyXG4gICAgICAgIHJvdy5hcHBlbmRDaGlsZChkZWxldGVCdXR0b24pO1xyXG5cclxuICAgICAgICBPYmplY3QudmFsdWVzKHRoaXMucHJvcGVydGllcykuZm9yRWFjaChwcm9wZXJ0eSA9PiB7XHJcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IG9iamVjdHNbcHJvcGVydHkubmFtZV1cclxuICAgICAgICAgICAgbGV0IHByb3BlcnR5Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgcHJvcGVydHlDb250YWluZXIuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLW9iamVjdC1wcm9wZXJ0eVwiKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwcm9wZXJ0eS5mbGV4U3Bhbil7XHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eUNvbnRhaW5lci5zdHlsZS5ncmlkQ29sdW1uID0gXCJzcGFuIFwiK3Byb3BlcnR5LmZsZXhTcGFuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0gcHJvcGVydHkubmFtZTtcclxuICAgICAgICAgICAgdGl0bGUuY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLXRpdGxlXCIpO1xyXG4gICAgICAgICAgICBwcm9wZXJ0eUNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XHJcbiAgICAgICAgICAgIHByb3BlcnR5Q29udGFpbmVyLmFwcGVuZENoaWxkKHByb3BlcnR5LmZpbGxEaXNwbGF5KHZhbHVlLFxyXG4gICAgICAgICAgICAgICAgYXN5bmMgKHZhbHVlOiBhbnkpID0+IGF3YWl0IHRoaXMudXBkYXRlT2JqZWN0KHZhbHVlcywgdXBkYXRlLCBpbmRleCwgcHJvcGVydHksIHZhbHVlKSkpO1xyXG4gICAgICAgICAgICByb3cuYXBwZW5kQ2hpbGQocHJvcGVydHlDb250YWluZXIpO1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJvdztcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBDcsOpZSB1biBib3V0b24gZGUgc3VwcHJlc3Npb24gcG91ciB1bmUgbGlnbmUgZCdvYmpldFxyXG4gICAgICBjcmVhdGVEZWxldGVCdXR0b24odmFsdWVzIDogYW55LCB1cGRhdGUgOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgaW5kZXg6IG51bWJlciwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCk6IEhUTUxCdXR0b25FbGVtZW50IHtcclxuICAgICAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgICB0aGlzLnZhdWx0LmFwcC5zZXRJY29uKGRlbGV0ZUJ1dHRvbiwgXCJjaXJjbGUtbWludXNcIik7XHJcbiAgICAgICAgICBkZWxldGVCdXR0b24uY2xhc3NMaXN0LmFkZChcIm1ldGFkYXRhLWRlbGV0ZS1idXR0b25cIik7XHJcbiAgICAgICAgICBkZWxldGVCdXR0b24ub25jbGljayA9IGFzeW5jICgpID0+IGF3YWl0IHRoaXMucmVtb3ZlUHJvcGVydHkodmFsdWVzLCB1cGRhdGUsIGluZGV4LCBjb250YWluZXIpO1xyXG4gICAgICAgICAgcmV0dXJuIGRlbGV0ZUJ1dHRvbjtcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBHw6hyZSBsZSBnbGlzc2VyLWTDqXBvc2VyIHBvdXIgcsOpb3Jkb25uZXIgbGVzIG9iamV0c1xyXG4gICAgICBlbmFibGVEcmFnQW5kRHJvcCh2YWx1ZXMgOiBhbnksIHVwZGF0ZSA6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KSB7XHJcbiAgICAgICAgICBsZXQgZHJhZ2dlZEVsZW1lbnQ6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgbGV0IGlzRWRpdGluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgIC8vIExvcnNxdWUgbCd1dGlsaXNhdGV1ciBjbGlxdWUgZGFucyB1biBjaGFtcCBkJ8OpZGl0aW9uIChpbnB1dCksIG9uIGFjdGl2ZSBsJ8OpZGl0aW9uXHJcbiAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgaWYgKGlucHV0Py5jbGFzc0xpc3QuY29udGFpbnMoJ2ZpZWxkLWlucHV0JykpIHtcclxuICAgICAgICAgICAgICAgICAgaXNFZGl0aW5nID0gdHJ1ZTsgIC8vIExlIGNoYW1wIGVzdCBlbiBtb2RlIMOpZGl0aW9uXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICAgLy8gTG9yc3F1ZSBsJ3V0aWxpc2F0ZXVyIHF1aXR0ZSB1biBjaGFtcCBkJ8OpZGl0aW9uIChibHVyKSwgb24gZMOpc2FjdGl2ZSBsJ8OpZGl0aW9uXHJcbiAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBpbnB1dCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICAgICAgICBpZiAoaW5wdXQ/LmNsYXNzTGlzdC5jb250YWlucygnZmllbGQtaW5wdXQnKSkge1xyXG4gICAgICAgICAgICAgICAgICBpc0VkaXRpbmcgPSBmYWxzZTsgIC8vIExlIGNoYW1wIG4nZXN0IHBsdXMgZW4gbW9kZSDDqWRpdGlvblxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0sIHRydWUpO1xyXG5cclxuICAgICAgICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ3N0YXJ0XCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXNFZGl0aW5nKSB7XHJcbiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZHJhZ2dlZEVsZW1lbnQgPSBldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGRyYWdnZWRFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJkcmFnZ2luZ1wiKTtcclxuICAgICAgICAgIH0pO1xyXG4gIFxyXG4gICAgICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgIGNvbnN0IGFmdGVyRWxlbWVudCA9IHRoaXMuZ2V0RHJhZ0FmdGVyRWxlbWVudChjb250YWluZXIsIGV2ZW50LmNsaWVudFkpO1xyXG4gICAgICAgICAgICAgIGlmIChhZnRlckVsZW1lbnQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZHJhZ2dlZEVsZW1lbnQhKTtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmluc2VydEJlZm9yZShkcmFnZ2VkRWxlbWVudCEsIGFmdGVyRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgXHJcbiAgICAgICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdlbmRcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgIGlmICghZHJhZ2dlZEVsZW1lbnQpIHJldHVybjtcclxuICAgICAgICAgICAgICBkcmFnZ2VkRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiZHJhZ2dpbmdcIik7XHJcbiAgXHJcbiAgICAgICAgICAgICAgLy8gUsOpY3Vww6lyZXIgbGUgbm91dmVsIG9yZHJlIGRlcyDDqWzDqW1lbnRzXHJcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVPcmRlcih2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIC8vIFRyb3V2ZXIgbCfDqWzDqW1lbnQgYXByw6hzIGxlcXVlbCBpbnPDqXJlciAocG91ciBsZSBEcmFnICYgRHJvcClcclxuICAgICAgZ2V0RHJhZ0FmdGVyRWxlbWVudChjb250YWluZXI6IEhUTUxEaXZFbGVtZW50LCB5OiBudW1iZXIpOiBFbGVtZW50IHwgbnVsbCB7XHJcbiAgICAgICAgICBjb25zdCBkcmFnZ2FibGVFbGVtZW50cyA9IEFycmF5LmZyb20oY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIubWV0YWRhdGEtb2JqZWN0LXJvdzpub3QoLmRyYWdnaW5nKVwiKSk7XHJcbiAgXHJcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBkcmFnZ2FibGVFbGVtZW50cy5yZWR1Y2UoKGNsb3Nlc3Q6IHsgb2Zmc2V0OiBudW1iZXI7IGVsZW1lbnQ6IEVsZW1lbnQgfCBudWxsIH0sIGNoaWxkKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgYm94ID0gY2hpbGQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0geSAtIGJveC50b3AgLSBib3guaGVpZ2h0IC8gMjtcclxuICAgICAgICAgICAgICByZXR1cm4gb2Zmc2V0IDwgMCAmJiBvZmZzZXQgPiBjbG9zZXN0Lm9mZnNldCA/IHsgb2Zmc2V0LCBlbGVtZW50OiBjaGlsZCB9IDogY2xvc2VzdDtcclxuICAgICAgICAgIH0sIHsgb2Zmc2V0OiBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIGVsZW1lbnQ6IG51bGwgYXMgRWxlbWVudCB8IG51bGwgfSk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIHJldHVybiByZXN1bHQuZWxlbWVudDtcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBNZXQgw6Agam91ciBsJ29yZHJlIGRlcyDDqWzDqW1lbnRzIGFwcsOocyB1biBnbGlzc2VyLWTDqXBvc2VyXHJcbiAgICAgIGFzeW5jIHVwZGF0ZU9yZGVyKHZhbHVlcyA6IGFueSwgdXBkYXRlIDogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlVwZGF0ZSBvcmRlclwiKVxyXG4gICAgICAgICAgbGV0IG5ld09yZGVyOiBhbnlbXSA9IFtdO1xyXG4gICAgICAgICAgQXJyYXkuZnJvbShjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChcIi5tZXRhZGF0YS1vYmplY3Qtcm93XCIpKS5mb3JFYWNoKChyb3cpID0+IHtcclxuICAgICAgICAgICAgICAvLyBBc3N1cmVyIHF1J29uIHRyYXZhaWxsZSBhdmVjIHVuIEhUTUxFbGVtZW50IHBvdXIgYWNjw6lkZXIgw6AgZGF0YXNldFxyXG4gICAgICAgICAgICAgIGlmIChyb3cgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCAmJiByb3cuZGF0YXNldC5pbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSBwYXJzZUludChyb3cuZGF0YXNldC5pbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgIG5ld09yZGVyLnB1c2godmFsdWVzW2luZGV4XSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICAvLyBNZXR0cmUgw6Agam91ciBsZXMgbcOpdGFkb25uw6llc1xyXG4gICAgICAgICAgYXdhaXQgdXBkYXRlKG5ld09yZGVyKTtcclxuICAgICAgICAgIGF3YWl0IHRoaXMucmVsb2FkT2JqZWN0cyhuZXdPcmRlciwgdXBkYXRlKVxyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIC8vIEZvbmN0aW9uIHBvdXIgc3VwcHJpbWVyIHVuIG9iamV0XHJcbiAgICAgIGFzeW5jIHJlbW92ZVByb3BlcnR5KHZhbHVlcyA6IGFueSwgdXBkYXRlIDogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGluZGV4OiBudW1iZXIsIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVtb3ZlIGluZGV4IDogXCIsIGluZGV4KVxyXG4gICAgICAgICAgdmFsdWVzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICBhd2FpdCB1cGRhdGUodmFsdWVzKTtcclxuICAgICAgICAgIGF3YWl0IHRoaXMucmVsb2FkT2JqZWN0cyh2YWx1ZXMsIHVwZGF0ZSlcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICAvLyBGb25jdGlvbiBwb3VyIGFqb3V0ZXIgdW4gb2JqZXRcclxuICAgICAgYXN5bmMgYWRkUHJvcGVydHkodmFsdWVzIDogYW55LCB1cGRhdGUgOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coXCJBZGQgbmV3XCIpXHJcbiAgICAgICAgICBsZXQgbmV3T2JqZWN0OiBhbnkgPSB7fTtcclxuICAgICAgICAgIGZvciAobGV0IHByb3Agb2YgT2JqZWN0LnZhbHVlcyh0aGlzLnByb3BlcnRpZXMpKSB7XHJcbiAgICAgICAgICAgIGxldCBkZWZhdWx0VmFsdWUgPSBwcm9wLmdldERlZmF1bHRWYWx1ZSgpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGVmYXVsdCB2YWx1ZSA6IFwiLCBkZWZhdWx0VmFsdWUpXHJcbiAgICAgICAgICAgIGlmIChPYmplY3QudmFsdWVzKHRoaXMucHJvcGVydGllcylbMF0gPT0gcHJvcCAmJiAocHJvcCBpbnN0YW5jZW9mIEZpbGVQcm9wZXJ0eSkpIHtcclxuICAgICAgICAgICAgICAgIHByb3AudmF1bHQgPSB0aGlzLnZhdWx0OyAvLyBBc3N1cmV6LXZvdXMgcXVlIHZhdWx0IGVzdCBkw6lmaW5pIHBvdXIgbGUgcHJlbWllciBGaWxlUHJvcGVydHlcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQcm9wID0gcHJvcCBhcyBhbnk7IC8vIENhc3QgcG91ciBhY2PDqWRlciDDoCBoYW5kbGVJY29uQ2xpY2tcclxuICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZSA9IGF3YWl0IG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZmlsZVByb3AuaGFuZGxlSWNvbkNsaWNrKGFzeW5jICh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRlZmF1bHQgdmFsdWUgYWZ0ZXIgY2xpY2sgOiBcIiwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIG5ldyBNb3VzZUV2ZW50KFwiY2xpY2tcIikpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJEZWZhdWx0IHZhbHVlIGFmdGVyIGNsaWNrIDogXCIsIGRlZmF1bHRWYWx1ZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZGVmYXVsdFZhbHVlID09IFwibGlrZS1wcmVjZWRlbnRcIil7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWVzICYmIHZhbHVlcy5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmFwcGVuZEZpcnN0KXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlID0gdmFsdWVzWzBdW3Byb3AubmFtZV1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZSA9IHZhbHVlc1t2YWx1ZXMubGVuZ3RoLTFdW3Byb3AubmFtZV1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtkZWZhdWx0VmFsdWUgPSBcIlwifVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5ld09iamVjdFtwcm9wLm5hbWVdID0gZGVmYXVsdFZhbHVlXHJcbiAgICAgICAgXHJcbiAgICAgICAgfTsgXHJcbiAgICAgICAgLy8gVmFsZXVycyBwYXIgZMOpZmF1dFxyXG4gICAgICAgIGlmICghdmFsdWVzKXt2YWx1ZXMgPSBbXX1cclxuICAgICAgICBpZiAodGhpcy5hcHBlbmRGaXJzdCkge1xyXG4gICAgICAgICAgICB2YWx1ZXMudW5zaGlmdChuZXdPYmplY3QpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZhbHVlcy5wdXNoKG5ld09iamVjdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICAgYXdhaXQgdXBkYXRlKHZhbHVlcyk7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnJlbG9hZE9iamVjdHModmFsdWVzLCB1cGRhdGUpXHJcbiAgICAgIH1cclxuICBcclxuICAgICAgLy8gTWlzZSDDoCBqb3VyIGRlcyBtw6l0YWRvbm7DqWVzXHJcbiAgICAgIGFzeW5jIHVwZGF0ZU9iamVjdCh2YWx1ZXMgOiBhbnksIHVwZGF0ZSA6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBpbmRleDogbnVtYmVyLCBwcm9wZXJ0eTogUHJvcGVydHksIHZhbHVlOiBzdHJpbmcpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlVwZGF0ZSBpbmRleCA6IFwiLCBpbmRleClcclxuICAgICAgICAgIGlmICh2YWx1ZXMpe1xyXG4gICAgICAgICAgICB2YWx1ZXNbaW5kZXhdW3Byb3BlcnR5Lm5hbWVdID0gdmFsdWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFsdWVzID0gW3tbcHJvcGVydHkubmFtZV0gOiB2YWx1ZX1dXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlVwZGF0ZWQgVmFsdWVzIDogXCIsIHZhbHVlcylcclxuICAgICAgICAgIGF3YWl0IHVwZGF0ZSh2YWx1ZXMpO1xyXG4gICAgICAgICAgYXdhaXQgdGhpcy5yZWxvYWRPYmplY3RzKHZhbHVlcywgdXBkYXRlKVxyXG4gICAgICB9XHJcblxyXG4gICAgLy8gUmVjaGFyZ2UgZHluYW1pcXVlbWVudCBsZXMgb2JqZXRzXHJcbiAgICBhc3luYyByZWxvYWRPYmplY3RzKHZhbHVlcyA6IGFueSwgdXBkYXRlIDogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sKSB7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tZXRhZGF0YS1vYmplY3QtY29udGFpbmVyLVwiK3RoaXMubmFtZS50b0xvd2VyQ2FzZSgpKSBhcyBIVE1MRGl2RWxlbWVudDtcclxuICAgICAgICBpZiAoY29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgICAgICAgICAvLyBSZWNyw6llciBsJ2VuLXTDqnRlIGV0IGxlcyBvYmpldHNcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJWYWx1ZXMgOiBcIiwgdmFsdWVzKVxyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUhlYWRlcih2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGlzcGxheSA9PSBcInRhYmxlXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlVGFibGUodmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBBZmZpY2hhZ2UgcGFyIGTDqWZhdXQgKG9iamV0KVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVPYmplY3RzKHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgfVxyXG4gIH1cclxuICAiXSwidmVyc2lvbiI6M30=