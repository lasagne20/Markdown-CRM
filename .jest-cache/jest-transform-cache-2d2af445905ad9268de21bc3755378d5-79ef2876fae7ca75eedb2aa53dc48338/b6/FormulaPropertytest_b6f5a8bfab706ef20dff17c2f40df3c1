1a870cd50aa9afeab15b1665b98f1ede
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock des dépendances
jest.mock('../../classes/Classe');
jest.mock('../../vault/MyVault');
const FormulaProperty_1 = require("../../properties/FormulaProperty");
describe('FormulaProperty', () => {
    let formulaProperty;
    let mockFile;
    let mockVault;
    beforeEach(() => {
        // Configuration des mocks
        mockVault = {
            app: {
                vault: {
                    getName: jest.fn().mockReturnValue('TestVault')
                }
            },
            readLinkFile: jest.fn()
        };
        mockFile = {
            vault: mockVault,
            getName: jest.fn(),
            getAllProperties: jest.fn(),
            getMetadataValue: jest.fn(),
            updateMetadata: jest.fn()
        };
        // Reset des mocks
        jest.clearAllMocks();
    });
    describe('Constructor', () => {
        test('should create formula property with default arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', '1 + 1');
            expect(formulaProperty.name).toBe('testFormula');
            expect(formulaProperty.formula).toBe('1 + 1');
            expect(formulaProperty.type).toBe('formula');
            expect(formulaProperty.write).toBe(false);
            expect(formulaProperty.static).toBe(true);
        });
        test('should create formula property with custom arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', '2 * 3', {
                icon: 'calculator',
                static: false,
                write: true
            });
            expect(formulaProperty.name).toBe('testFormula');
            expect(formulaProperty.formula).toBe('2 * 3');
            expect(formulaProperty.type).toBe('formula');
            expect(formulaProperty.write).toBe(true);
            expect(formulaProperty.static).toBe(false);
            expect(formulaProperty.icon).toBe('calculator');
        });
        test('should handle partial arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', 'x + y', {
                icon: 'math',
                write: true
                // static will use default value from FormulaProperty constructor (true)
            });
            expect(formulaProperty.write).toBe(true);
            // La valeur sera false car LinkProperty n'override pas le default de Property
            expect(formulaProperty.static).toBe(false);
            expect(formulaProperty.icon).toBe('math');
        });
    });
    describe('validate', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', '1 + 1');
        });
        test('should return input value unchanged', () => {
            expect(formulaProperty.validate('test')).toBe('test');
            expect(formulaProperty.validate('123')).toBe('123');
            expect(formulaProperty.validate('')).toBe('');
        });
    });
    describe('read', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('totalFormula', 'price * quantity');
            // Mock des propriétés du fichier
            mockFile.getAllProperties.mockReturnValue({
                price: { name: 'price' },
                quantity: { name: 'quantity' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getName.mockReturnValue('TestFile');
        });
        test('should execute simple arithmetic formula', () => {
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 10;
                if (key === 'quantity')
                    return 5;
                return null;
            });
            const result = formulaProperty.read(mockFile);
            expect(result).toBe(50);
        });
        test('should handle formula with return statement', () => {
            const formulaWithReturn = new FormulaProperty_1.FormulaProperty('test', 'return price + quantity');
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 15;
                if (key === 'quantity')
                    return 25;
                return null;
            });
            const result = formulaWithReturn.read(mockFile);
            expect(result).toBe(40);
        });
        test('should sanitize property names (remove spaces)', () => {
            mockFile.getAllProperties.mockReturnValue({
                'unit price': { name: 'unit price' },
                'item count': { name: 'item count' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'unit price')
                    return 12;
                if (key === 'item count')
                    return 3;
                return null;
            });
            const sanitizedFormula = new FormulaProperty_1.FormulaProperty('test', 'unitprice * itemcount');
            const result = sanitizedFormula.read(mockFile);
            expect(result).toBe(36);
        });
        test('should exclude self property from formula context', () => {
            mockFile.getAllProperties.mockReturnValue({
                price: { name: 'price' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 100;
                if (key === 'totalFormula')
                    return 999; // Should be excluded
                return null;
            });
            const selfExcludingFormula = new FormulaProperty_1.FormulaProperty('totalFormula', 'price * 2');
            const result = selfExcludingFormula.read(mockFile);
            expect(result).toBe(200);
        });
        test('should handle formula errors gracefully (ReferenceError)', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockFile.getMetadataValue.mockReturnValue(null);
            const faultyFormula = new FormulaProperty_1.FormulaProperty('test', 'undefinedVariable * 5');
            const result = faultyFormula.read(mockFile);
            expect(result).toBeNull();
            // Test simple que console.error a été appelé avec le bon message
            expect(consoleSpy).toHaveBeenCalled();
            const errorCall = consoleSpy.mock.calls[0];
            expect(errorCall[0]).toContain('Formula error : undefinedVariable * 5');
            expect(errorCall[0]).toContain('This is all the properties available');
            consoleSpy.mockRestore();
        });
        test('should handle general formula errors', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockFile.getMetadataValue.mockReturnValue(null);
            const faultyFormula = new FormulaProperty_1.FormulaProperty('test', 'throw new Error("test error")');
            const result = faultyFormula.read(mockFile);
            expect(result).toBeNull();
            expect(consoleSpy).toHaveBeenCalledWith(expect.stringContaining('Formula error : throw new Error("test error")'));
            consoleSpy.mockRestore();
        });
        describe('write functionality', () => {
            test('should update metadata when write is true and value changed', () => {
                const writeFormula = new FormulaProperty_1.FormulaProperty('total', 'price + tax', {
                    icon: '',
                    write: true
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    if (key === 'total')
                        return 110; // Old value
                    return null;
                });
                const result = writeFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).toHaveBeenCalledWith('total', 120);
            });
            test('should not update metadata when write is true but value unchanged', () => {
                const writeFormula = new FormulaProperty_1.FormulaProperty('total', 'price + tax', {
                    icon: '',
                    write: true
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    if (key === 'total')
                        return 120; // Same as calculated
                    return null;
                });
                const result = writeFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).not.toHaveBeenCalled();
            });
            test('should not update metadata when write is false', () => {
                const readOnlyFormula = new FormulaProperty_1.FormulaProperty('total', 'price + tax', {
                    icon: '',
                    write: false
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    return null;
                });
                const result = readOnlyFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).not.toHaveBeenCalled();
            });
        });
    });
    describe('getPretty', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', '1 + 1');
        });
        test('should return input if falsy', () => {
            expect(formulaProperty.getPretty('')).toBe('');
            expect(formulaProperty.getPretty(null)).toBe(null);
            expect(formulaProperty.getPretty(undefined)).toBe(undefined);
        });
        test('should handle non-string values', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            const numberValue = 123;
            const result = formulaProperty.getPretty(numberValue);
            expect(result).toBe(123);
            expect(consoleSpy).toHaveBeenCalledWith('Value is not a string:', 123);
            consoleSpy.mockRestore();
        });
        test('should format dates in French locale', () => {
            const dateString = '2023-12-25';
            const result = formulaProperty.getPretty(dateString);
            expect(result).toBe('25 décembre 2023');
        });
        test('should format integers with French locale formatting', () => {
            const integerString = '1234';
            const result = formulaProperty.getPretty(integerString);
            // Vérifions d'abord le résultat réel
            console.log('Actual result:', JSON.stringify(result));
            // Le format peut varier selon l'environnement, testons que c'est bien formaté
            expect(result).toMatch(/1[,\s]234[.,]00/);
        });
        test('should not format decimal numbers as integers', () => {
            const decimalString = '123.45';
            const result = formulaProperty.getPretty(decimalString);
            expect(result).toBe('123.45');
        });
        test('should clean URLs by removing protocols', () => {
            expect(formulaProperty.getPretty('https://example.com')).toBe('example.com');
            expect(formulaProperty.getPretty('http://test.org')).toBe('test.org');
        });
        test('should clean Obsidian links by removing brackets', () => {
            expect(formulaProperty.getPretty('[[Note Title]]')).toBe('Note Title');
        });
        test('should handle complex strings with multiple cleanups', () => {
            const complexString = 'https://[[example.com]]';
            const result = formulaProperty.getPretty(complexString);
            expect(result).toBe('example.com');
        });
        test('should return regular strings unchanged', () => {
            const regularString = 'Just a normal string';
            const result = formulaProperty.getPretty(regularString);
            expect(result).toBe('Just a normal string');
        });
    });
    describe('getLink', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', '1 + 1');
            formulaProperty.vault = mockVault;
        });
        test('should return input if falsy', () => {
            expect(formulaProperty.getLink('')).toBe('');
            expect(formulaProperty.getLink(null)).toBe(null);
            expect(formulaProperty.getLink(undefined)).toBe(undefined);
        });
        test('should create mailto links for emails', () => {
            expect(formulaProperty.getLink('test@example.com')).toBe('mailto:test@example.com');
            expect(formulaProperty.getLink('user.name+tag@domain.co.uk')).toBe('mailto:user.name+tag@domain.co.uk');
        });
        test('should handle Obsidian links', () => {
            mockVault.readLinkFile.mockReturnValue([null, 'path/to/file.md']);
            const result = formulaProperty.getLink('[[My Note]]');
            expect(result).toBe('obsidian://open?vault=TestVault&file=path%2Fto%2Ffile.md');
            expect(mockVault.readLinkFile).toHaveBeenCalledWith('My Note', true);
        });
        test('should handle Obsidian link errors gracefully', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockVault.readLinkFile.mockImplementation(() => {
                throw new Error('File not found');
            });
            const result = formulaProperty.getLink('[[Invalid Note]]');
            expect(result).toBe('[[Invalid Note]]');
            expect(consoleSpy).toHaveBeenCalledWith('Error parsing link for [[Invalid Note]]:', expect.any(Error));
            consoleSpy.mockRestore();
        });
        test('should handle URLs with protocols', () => {
            expect(formulaProperty.getLink('https://example.com')).toBe('https://example.com');
            expect(formulaProperty.getLink('http://test.org/path')).toBe('http://test.org/path');
        });
        test('should add protocol to URLs without them', () => {
            expect(formulaProperty.getLink('example.com')).toBe('http://example.com');
            expect(formulaProperty.getLink('test.org/path')).toBe('http://test.org/path');
        });
        test('should return regular strings unchanged', () => {
            const regularString = 'Just a normal string';
            const result = formulaProperty.getLink(regularString);
            expect(result).toBe('Just a normal string');
        });
        test('should handle invalid URL formats', () => {
            const invalidUrl = 'not-a-url';
            const result = formulaProperty.getLink(invalidUrl);
            expect(result).toBe('not-a-url');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXF9fdGVzdHNfX1xcUHJvcGVydGllc1xcRm9ybXVsYVByb3BlcnR5LnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFJQSx1QkFBdUI7QUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUpqQyxzRUFBbUU7QUFNbkUsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUM3QixJQUFJLGVBQWdDLENBQUM7SUFDckMsSUFBSSxRQUE2QixDQUFDO0lBQ2xDLElBQUksU0FBK0IsQ0FBQztJQUVwQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ1osMEJBQTBCO1FBQzFCLFNBQVMsR0FBRztZQUNSLEdBQUcsRUFBRTtnQkFDRCxLQUFLLEVBQUU7b0JBQ0gsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDO2lCQUNsRDthQUNKO1lBQ0QsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDbkIsQ0FBQztRQUVULFFBQVEsR0FBRztZQUNQLEtBQUssRUFBRSxTQUFTO1lBQ2hCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2xCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDM0IsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUMzQixjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNyQixDQUFDO1FBRVQsa0JBQWtCO1FBQ2xCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN6QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxhQUFhLEVBQUUsR0FBRyxFQUFFO1FB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QUcsZUFBZSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUVuRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGxlb2R1XFxEb2N1bWVudHNcXDEgLSBQcm9cXFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXHNyY1xcX190ZXN0c19fXFxQcm9wZXJ0aWVzXFxGb3JtdWxhUHJvcGVydHkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDbGFzc2UgfSBmcm9tICcuLi8uLi9jbGFzc2VzL0NsYXNzZSc7XHJcbmltcG9ydCB7IE15VmF1bHQgfSBmcm9tICcuLi8uLi92YXVsdC9NeVZhdWx0JztcclxuaW1wb3J0IHsgRm9ybXVsYVByb3BlcnR5IH0gZnJvbSAnLi4vLi4vcHJvcGVydGllcy9Gb3JtdWxhUHJvcGVydHknO1xyXG5cclxuLy8gTW9jayBkZXMgZMOpcGVuZGFuY2VzXHJcbmplc3QubW9jaygnLi4vLi4vY2xhc3Nlcy9DbGFzc2UnKTtcclxuamVzdC5tb2NrKCcuLi8uLi92YXVsdC9NeVZhdWx0Jyk7XHJcblxyXG5kZXNjcmliZSgnRm9ybXVsYVByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgbGV0IGZvcm11bGFQcm9wZXJ0eTogRm9ybXVsYVByb3BlcnR5O1xyXG4gICAgbGV0IG1vY2tGaWxlOiBqZXN0Lk1vY2tlZDxDbGFzc2U+O1xyXG4gICAgbGV0IG1vY2tWYXVsdDogamVzdC5Nb2NrZWQ8TXlWYXVsdD47XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgLy8gQ29uZmlndXJhdGlvbiBkZXMgbW9ja3NcclxuICAgICAgICBtb2NrVmF1bHQgPSB7XHJcbiAgICAgICAgICAgIGFwcDoge1xyXG4gICAgICAgICAgICAgICAgdmF1bHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBnZXROYW1lOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdUZXN0VmF1bHQnKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZWFkTGlua0ZpbGU6IGplc3QuZm4oKVxyXG4gICAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgICBtb2NrRmlsZSA9IHtcclxuICAgICAgICAgICAgdmF1bHQ6IG1vY2tWYXVsdCxcclxuICAgICAgICAgICAgZ2V0TmFtZTogamVzdC5mbigpLFxyXG4gICAgICAgICAgICBnZXRBbGxQcm9wZXJ0aWVzOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICAgIGdldE1ldGFkYXRhVmFsdWU6IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgdXBkYXRlTWV0YWRhdGE6IGplc3QuZm4oKVxyXG4gICAgICAgIH0gYXMgYW55O1xyXG5cclxuICAgICAgICAvLyBSZXNldCBkZXMgbW9ja3NcclxuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdDb25zdHJ1Y3RvcicsICgpID0+IHtcclxuICAgICAgICB0ZXN0KCdzaG91bGQgY3JlYXRlIGZvcm11bGEgcHJvcGVydHkgd2l0aCBkZWZhdWx0IGFyZ3VtZW50cycsICgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdEZvcm11bGEnLCAnMSArIDEnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkubmFtZSkudG9CZSgndGVzdEZvcm11bGEnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5mb3JtdWxhKS50b0JlKCcxICsgMScpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LnR5cGUpLnRvQmUoJ2Zvcm11bGEnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS53cml0ZSkudG9CZShmYWxzZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuc3RhdGljKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgY3JlYXRlIGZvcm11bGEgcHJvcGVydHkgd2l0aCBjdXN0b20gYXJndW1lbnRzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBmb3JtdWxhUHJvcGVydHkgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0ZXN0Rm9ybXVsYScsICcyICogMycsIHtcclxuICAgICAgICAgICAgICAgIGljb246ICdjYWxjdWxhdG9yJyxcclxuICAgICAgICAgICAgICAgIHN0YXRpYzogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICB3cml0ZTogdHJ1ZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkubmFtZSkudG9CZSgndGVzdEZvcm11bGEnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5mb3JtdWxhKS50b0JlKCcyICogMycpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LnR5cGUpLnRvQmUoJ2Zvcm11bGEnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS53cml0ZSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5zdGF0aWMpLnRvQmUoZmFsc2UpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5Lmljb24pLnRvQmUoJ2NhbGN1bGF0b3InKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBwYXJ0aWFsIGFyZ3VtZW50cycsICgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdEZvcm11bGEnLCAneCArIHknLCB7XHJcbiAgICAgICAgICAgICAgICBpY29uOiAnbWF0aCcsXHJcbiAgICAgICAgICAgICAgICB3cml0ZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgLy8gc3RhdGljIHdpbGwgdXNlIGRlZmF1bHQgdmFsdWUgZnJvbSBGb3JtdWxhUHJvcGVydHkgY29uc3RydWN0b3IgKHRydWUpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS53cml0ZSkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgLy8gTGEgdmFsZXVyIHNlcmEgZmFsc2UgY2FyIExpbmtQcm9wZXJ0eSBuJ292ZXJyaWRlIHBhcyBsZSBkZWZhdWx0IGRlIFByb3BlcnR5XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuc3RhdGljKS50b0JlKGZhbHNlKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5pY29uKS50b0JlKCdtYXRoJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgndmFsaWRhdGUnLCAoKSA9PiB7XHJcbiAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGZvcm11bGFQcm9wZXJ0eSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3Rlc3QnLCAnMSArIDEnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIHJldHVybiBpbnB1dCB2YWx1ZSB1bmNoYW5nZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkudmFsaWRhdGUoJ3Rlc3QnKSkudG9CZSgndGVzdCcpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LnZhbGlkYXRlKCcxMjMnKSkudG9CZSgnMTIzJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkudmFsaWRhdGUoJycpKS50b0JlKCcnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdyZWFkJywgKCkgPT4ge1xyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICBmb3JtdWxhUHJvcGVydHkgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0b3RhbEZvcm11bGEnLCAncHJpY2UgKiBxdWFudGl0eScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gTW9jayBkZXMgcHJvcHJpw6l0w6lzIGR1IGZpY2hpZXJcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0QWxsUHJvcGVydGllcy5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcHJpY2U6IHsgbmFtZTogJ3ByaWNlJyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgIHF1YW50aXR5OiB7IG5hbWU6ICdxdWFudGl0eScgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICB0b3RhbEZvcm11bGE6IHsgbmFtZTogJ3RvdGFsRm9ybXVsYScgfSBhcyBhbnlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrRmlsZS5nZXROYW1lLm1vY2tSZXR1cm5WYWx1ZSgnVGVzdEZpbGUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGV4ZWN1dGUgc2ltcGxlIGFyaXRobWV0aWMgZm9ybXVsYScsICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAncHJpY2UnKSByZXR1cm4gMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3F1YW50aXR5JykgcmV0dXJuIDU7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSg1MCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgZm9ybXVsYSB3aXRoIHJldHVybiBzdGF0ZW1lbnQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZvcm11bGFXaXRoUmV0dXJuID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsICdyZXR1cm4gcHJpY2UgKyBxdWFudGl0eScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAncHJpY2UnKSByZXR1cm4gMTU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3F1YW50aXR5JykgcmV0dXJuIDI1O1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhV2l0aFJldHVybi5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSg0MCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBzYW5pdGl6ZSBwcm9wZXJ0eSBuYW1lcyAocmVtb3ZlIHNwYWNlcyknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIG1vY2tGaWxlLmdldEFsbFByb3BlcnRpZXMubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgICd1bml0IHByaWNlJzogeyBuYW1lOiAndW5pdCBwcmljZScgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICAnaXRlbSBjb3VudCc6IHsgbmFtZTogJ2l0ZW0gY291bnQnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgdG90YWxGb3JtdWxhOiB7IG5hbWU6ICd0b3RhbEZvcm11bGEnIH0gYXMgYW55XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAndW5pdCBwcmljZScpIHJldHVybiAxMjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnaXRlbSBjb3VudCcpIHJldHVybiAzO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzYW5pdGl6ZWRGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsICd1bml0cHJpY2UgKiBpdGVtY291bnQnKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gc2FuaXRpemVkRm9ybXVsYS5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgzNik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBleGNsdWRlIHNlbGYgcHJvcGVydHkgZnJvbSBmb3JtdWxhIGNvbnRleHQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIG1vY2tGaWxlLmdldEFsbFByb3BlcnRpZXMubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgIHByaWNlOiB7IG5hbWU6ICdwcmljZScgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICB0b3RhbEZvcm11bGE6IHsgbmFtZTogJ3RvdGFsRm9ybXVsYScgfSBhcyBhbnlcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBtb2NrRmlsZS5nZXRNZXRhZGF0YVZhbHVlXHJcbiAgICAgICAgICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uKChrZXk6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdwcmljZScpIHJldHVybiAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3RvdGFsRm9ybXVsYScpIHJldHVybiA5OTk7IC8vIFNob3VsZCBiZSBleGNsdWRlZFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzZWxmRXhjbHVkaW5nRm9ybXVsYSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3RvdGFsRm9ybXVsYScsICdwcmljZSAqIDInKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gc2VsZkV4Y2x1ZGluZ0Zvcm11bGEucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMjAwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBmb3JtdWxhIGVycm9ycyBncmFjZWZ1bGx5IChSZWZlcmVuY2VFcnJvciknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrRmlsZS5nZXRNZXRhZGF0YVZhbHVlLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGZhdWx0eUZvcm11bGEgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0ZXN0JywgJ3VuZGVmaW5lZFZhcmlhYmxlICogNScpO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmYXVsdHlGb3JtdWxhLnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcclxuICAgICAgICAgICAgLy8gVGVzdCBzaW1wbGUgcXVlIGNvbnNvbGUuZXJyb3IgYSDDqXTDqSBhcHBlbMOpIGF2ZWMgbGUgYm9uIG1lc3NhZ2VcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnNvbGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3JDYWxsID0gY29uc29sZVNweS5tb2NrLmNhbGxzWzBdO1xyXG4gICAgICAgICAgICBleHBlY3QoZXJyb3JDYWxsWzBdKS50b0NvbnRhaW4oJ0Zvcm11bGEgZXJyb3IgOiB1bmRlZmluZWRWYXJpYWJsZSAqIDUnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGVycm9yQ2FsbFswXSkudG9Db250YWluKCdUaGlzIGlzIGFsbCB0aGUgcHJvcGVydGllcyBhdmFpbGFibGUnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBnZW5lcmFsIGZvcm11bGEgZXJyb3JzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZS5tb2NrUmV0dXJuVmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBmYXVsdHlGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsICd0aHJvdyBuZXcgRXJyb3IoXCJ0ZXN0IGVycm9yXCIpJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZhdWx0eUZvcm11bGEucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnRm9ybXVsYSBlcnJvciA6IHRocm93IG5ldyBFcnJvcihcInRlc3QgZXJyb3JcIiknKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkZXNjcmliZSgnd3JpdGUgZnVuY3Rpb25hbGl0eScsICgpID0+IHtcclxuICAgICAgICAgICAgdGVzdCgnc2hvdWxkIHVwZGF0ZSBtZXRhZGF0YSB3aGVuIHdyaXRlIGlzIHRydWUgYW5kIHZhbHVlIGNoYW5nZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB3cml0ZUZvcm11bGEgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0b3RhbCcsICdwcmljZSArIHRheCcsIHtcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTW9jayBnZXRBbGxQcm9wZXJ0aWVzIHBvdXIgY2V0dGUgaW5zdGFuY2VcclxuICAgICAgICAgICAgICAgIG1vY2tGaWxlLmdldEFsbFByb3BlcnRpZXMubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgICAgICBwcmljZTogeyBuYW1lOiAncHJpY2UnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgICAgIHRheDogeyBuYW1lOiAndGF4JyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogeyBuYW1lOiAndG90YWwnIH0gYXMgYW55XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBtb2NrRmlsZS5nZXRNZXRhZGF0YVZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3ByaWNlJykgcmV0dXJuIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3RheCcpIHJldHVybiAyMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3RvdGFsJykgcmV0dXJuIDExMDsgLy8gT2xkIHZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHdyaXRlRm9ybXVsYS5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgxMjApO1xyXG4gICAgICAgICAgICAgICAgZXhwZWN0KG1vY2tGaWxlLnVwZGF0ZU1ldGFkYXRhKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndG90YWwnLCAxMjApO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRlc3QoJ3Nob3VsZCBub3QgdXBkYXRlIG1ldGFkYXRhIHdoZW4gd3JpdGUgaXMgdHJ1ZSBidXQgdmFsdWUgdW5jaGFuZ2VkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgd3JpdGVGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndG90YWwnLCAncHJpY2UgKyB0YXgnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGU6IHRydWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE1vY2sgZ2V0QWxsUHJvcGVydGllcyBwb3VyIGNldHRlIGluc3RhbmNlXHJcbiAgICAgICAgICAgICAgICBtb2NrRmlsZS5nZXRBbGxQcm9wZXJ0aWVzLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpY2U6IHsgbmFtZTogJ3ByaWNlJyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgICAgICB0YXg6IHsgbmFtZTogJ3RheCcgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IHsgbmFtZTogJ3RvdGFsJyB9IGFzIGFueVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdwcmljZScpIHJldHVybiAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd0YXgnKSByZXR1cm4gMjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd0b3RhbCcpIHJldHVybiAxMjA7IC8vIFNhbWUgYXMgY2FsY3VsYXRlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB3cml0ZUZvcm11bGEucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMTIwKTtcclxuICAgICAgICAgICAgICAgIGV4cGVjdChtb2NrRmlsZS51cGRhdGVNZXRhZGF0YSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0ZXN0KCdzaG91bGQgbm90IHVwZGF0ZSBtZXRhZGF0YSB3aGVuIHdyaXRlIGlzIGZhbHNlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVhZE9ubHlGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndG90YWwnLCAncHJpY2UgKyB0YXgnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGU6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBNb2NrIGdldEFsbFByb3BlcnRpZXMgcG91ciBjZXR0ZSBpbnN0YW5jZVxyXG4gICAgICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0QWxsUHJvcGVydGllcy5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgICAgIHByaWNlOiB7IG5hbWU6ICdwcmljZScgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICAgICAgdGF4OiB7IG5hbWU6ICd0YXgnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiB7IG5hbWU6ICd0b3RhbCcgfSBhcyBhbnlcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIG1vY2tGaWxlLmdldE1ldGFkYXRhVmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uKChrZXk6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAncHJpY2UnKSByZXR1cm4gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAndGF4JykgcmV0dXJuIDIwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSByZWFkT25seUZvcm11bGEucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMTIwKTtcclxuICAgICAgICAgICAgICAgIGV4cGVjdChtb2NrRmlsZS51cGRhdGVNZXRhZGF0YSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZ2V0UHJldHR5JywgKCkgPT4ge1xyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICBmb3JtdWxhUHJvcGVydHkgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0ZXN0JywgJzEgKyAxJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gaW5wdXQgaWYgZmFsc3knLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KCcnKSkudG9CZSgnJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KG51bGwgYXMgYW55KSkudG9CZShudWxsKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkodW5kZWZpbmVkIGFzIGFueSkpLnRvQmUodW5kZWZpbmVkKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBub24tc3RyaW5nIHZhbHVlcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IG51bWJlclZhbHVlID0gMTIzIGFzIGFueTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eShudW1iZXJWYWx1ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKDEyMyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb25zb2xlU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnVmFsdWUgaXMgbm90IGEgc3RyaW5nOicsIDEyMyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBmb3JtYXQgZGF0ZXMgaW4gRnJlbmNoIGxvY2FsZScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0ZVN0cmluZyA9ICcyMDIzLTEyLTI1JztcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eShkYXRlU3RyaW5nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJzI1IGTDqWNlbWJyZSAyMDIzJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBmb3JtYXQgaW50ZWdlcnMgd2l0aCBGcmVuY2ggbG9jYWxlIGZvcm1hdHRpbmcnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGludGVnZXJTdHJpbmcgPSAnMTIzNCc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoaW50ZWdlclN0cmluZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBWw6lyaWZpb25zIGQnYWJvcmQgbGUgcsOpc3VsdGF0IHLDqWVsXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBY3R1YWwgcmVzdWx0OicsIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpO1xyXG4gICAgICAgICAgICAvLyBMZSBmb3JtYXQgcGV1dCB2YXJpZXIgc2Vsb24gbCdlbnZpcm9ubmVtZW50LCB0ZXN0b25zIHF1ZSBjJ2VzdCBiaWVuIGZvcm1hdMOpXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvTWF0Y2goLzFbLFxcc10yMzRbLixdMDAvKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIG5vdCBmb3JtYXQgZGVjaW1hbCBudW1iZXJzIGFzIGludGVnZXJzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkZWNpbWFsU3RyaW5nID0gJzEyMy40NSc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoZGVjaW1hbFN0cmluZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCcxMjMuNDUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGNsZWFuIFVSTHMgYnkgcmVtb3ZpbmcgcHJvdG9jb2xzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eSgnaHR0cHM6Ly9leGFtcGxlLmNvbScpKS50b0JlKCdleGFtcGxlLmNvbScpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eSgnaHR0cDovL3Rlc3Qub3JnJykpLnRvQmUoJ3Rlc3Qub3JnJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBjbGVhbiBPYnNpZGlhbiBsaW5rcyBieSByZW1vdmluZyBicmFja2V0cycsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoJ1tbTm90ZSBUaXRsZV1dJykpLnRvQmUoJ05vdGUgVGl0bGUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBjb21wbGV4IHN0cmluZ3Mgd2l0aCBtdWx0aXBsZSBjbGVhbnVwcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29tcGxleFN0cmluZyA9ICdodHRwczovL1tbZXhhbXBsZS5jb21dXSc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoY29tcGxleFN0cmluZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdleGFtcGxlLmNvbScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIHJlZ3VsYXIgc3RyaW5ncyB1bmNoYW5nZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlZ3VsYXJTdHJpbmcgPSAnSnVzdCBhIG5vcm1hbCBzdHJpbmcnO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KHJlZ3VsYXJTdHJpbmcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnSnVzdCBhIG5vcm1hbCBzdHJpbmcnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdnZXRMaW5rJywgKCkgPT4ge1xyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICBmb3JtdWxhUHJvcGVydHkgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0ZXN0JywgJzEgKyAxJyk7XHJcbiAgICAgICAgICAgIGZvcm11bGFQcm9wZXJ0eS52YXVsdCA9IG1vY2tWYXVsdDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIHJldHVybiBpbnB1dCBpZiBmYWxzeScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKCcnKSkudG9CZSgnJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluayhudWxsIGFzIGFueSkpLnRvQmUobnVsbCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluayh1bmRlZmluZWQgYXMgYW55KSkudG9CZSh1bmRlZmluZWQpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgY3JlYXRlIG1haWx0byBsaW5rcyBmb3IgZW1haWxzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ3Rlc3RAZXhhbXBsZS5jb20nKSkudG9CZSgnbWFpbHRvOnRlc3RAZXhhbXBsZS5jb20nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKCd1c2VyLm5hbWUrdGFnQGRvbWFpbi5jby51aycpKS50b0JlKCdtYWlsdG86dXNlci5uYW1lK3RhZ0Bkb21haW4uY28udWsnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBPYnNpZGlhbiBsaW5rcycsICgpID0+IHtcclxuICAgICAgICAgICAgbW9ja1ZhdWx0LnJlYWRMaW5rRmlsZS5tb2NrUmV0dXJuVmFsdWUoW251bGwsICdwYXRoL3RvL2ZpbGUubWQnXSBhcyBhbnkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ1tbTXkgTm90ZV1dJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdvYnNpZGlhbjovL29wZW4/dmF1bHQ9VGVzdFZhdWx0JmZpbGU9cGF0aCUyRnRvJTJGZmlsZS5tZCcpO1xyXG4gICAgICAgICAgICBleHBlY3QobW9ja1ZhdWx0LnJlYWRMaW5rRmlsZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ015IE5vdGUnLCB0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBPYnNpZGlhbiBsaW5rIGVycm9ycyBncmFjZWZ1bGx5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xyXG4gICAgICAgICAgICBtb2NrVmF1bHQucmVhZExpbmtGaWxlLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ1tbSW52YWxpZCBOb3RlXV0nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ1tbSW52YWxpZCBOb3RlXV0nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnNvbGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICAgICAgICAgJ0Vycm9yIHBhcnNpbmcgbGluayBmb3IgW1tJbnZhbGlkIE5vdGVdXTonLFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LmFueShFcnJvcilcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBVUkxzIHdpdGggcHJvdG9jb2xzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ2h0dHBzOi8vZXhhbXBsZS5jb20nKSkudG9CZSgnaHR0cHM6Ly9leGFtcGxlLmNvbScpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ2h0dHA6Ly90ZXN0Lm9yZy9wYXRoJykpLnRvQmUoJ2h0dHA6Ly90ZXN0Lm9yZy9wYXRoJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBhZGQgcHJvdG9jb2wgdG8gVVJMcyB3aXRob3V0IHRoZW0nLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluaygnZXhhbXBsZS5jb20nKSkudG9CZSgnaHR0cDovL2V4YW1wbGUuY29tJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluaygndGVzdC5vcmcvcGF0aCcpKS50b0JlKCdodHRwOi8vdGVzdC5vcmcvcGF0aCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIHJlZ3VsYXIgc3RyaW5ncyB1bmNoYW5nZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlZ3VsYXJTdHJpbmcgPSAnSnVzdCBhIG5vcm1hbCBzdHJpbmcnO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0TGluayhyZWd1bGFyU3RyaW5nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ0p1c3QgYSBub3JtYWwgc3RyaW5nJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgaW52YWxpZCBVUkwgZm9ybWF0cycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaW52YWxpZFVybCA9ICdub3QtYS11cmwnO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0TGluayhpbnZhbGlkVXJsKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ25vdC1hLXVybCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==