{"file":"C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\properties\\3DModelProperty.ts","mappings":"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","names":[],"sources":["C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\properties\\3DModelProperty.ts"],"sourcesContent":["import { Vault } from \"vault/Vault\";\r\nimport { MediaProperty } from \"./MediaProperty\";\r\n\r\n// Déclarations temporaires pour les dépendances 3D\r\ndeclare const THREE: any;\r\ndeclare const GLTFLoader: any;\r\ndeclare const OrbitControls: any;\r\ndeclare const FreecadFile: any;\r\ndeclare const shell: any;\r\n\r\nexport class ThreeDModelProperty extends MediaProperty {\r\n    \r\n    public override type: string = \"3dmodel\";\r\n\r\n    constructor(name: string, vault : Vault, args: { icon?: string; display?: string; create?: string} = {icon: \"box\", create: \"\"}) {\r\n        super(name, vault, args);\r\n    }\r\n\r\n    /**\r\n     * Renders a 3D model using THREE.js\r\n     */\r\n    protected render3DModel(mediaPath: string, container: HTMLDivElement): void {\r\n        // Check if the file exists in the vault before trying to load it\r\n        const fileExists = this.vault.app.getFile(mediaPath);\r\n        if (!fileExists) {\r\n            const errorDiv = document.createElement(\"div\");\r\n            errorDiv.textContent = `Rendu 3D introuvable. Ouvrir le fichier dans FreeCAD pour le créer.`;\r\n            console.error(\"3D model file not found:\", mediaPath);\r\n            errorDiv.style.textAlign = \"center\";\r\n            errorDiv.style.margin = \"40px auto\";\r\n            errorDiv.style.color = \"#c00\";\r\n            container.appendChild(errorDiv);\r\n            return;\r\n        }\r\n\r\n        const embed = document.createElement(\"canvas\");\r\n        embed.classList.add(\"embed-media\");\r\n        container.appendChild(embed);\r\n        \r\n        const renderer = new THREE.WebGLRenderer({ canvas: embed, alpha: true, antialias: true });\r\n        renderer.setSize(300, 300);\r\n\r\n        const scene = new THREE.Scene();\r\n        const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 100);\r\n        // Position the camera directly above, looking down the -Z axis\r\n        camera.position.set(0, 10, 0);\r\n        camera.up.set(0, 0, -1); // Make Z axis \"up\" for the camera\r\n        camera.lookAt(0, 0, 0);\r\n\r\n        // Add multiple directional lights from different directions for even illumination\r\n        const directions = [\r\n            [0, 10, 0],    // Top\r\n            [0, -10, 0],   // Bottom\r\n            [10, 0, 0],    // Right\r\n            [-10, 0, 0],   // Left\r\n            [0, 0, 10],    // Front\r\n            [0, 0, -10],   // Back\r\n        ];\r\n        directions.forEach(dir => {\r\n            const light = new THREE.DirectionalLight(0xffffff, 1);\r\n            light.position.set(dir[0], dir[1], dir[2]);\r\n            light.target.position.set(0, 0, 0);\r\n            scene.add(light);\r\n            scene.add(light.target);\r\n        });\r\n        \r\n        // Optionally add a soft ambient light for subtle fill\r\n        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);\r\n        scene.add(ambientLight);\r\n\r\n        const loader = new GLTFLoader();\r\n        let model: any;\r\n        let animationActive = true; // Track animation state\r\n        const controls = new OrbitControls(camera, renderer.domElement);\r\n        controls.enableDamping = true; // Smooth rotation\r\n        controls.dampingFactor = 0.05;\r\n        controls.enableZoom = true;\r\n        controls.enablePan = true;\r\n        controls.enableRotate = true;\r\n        controls.minPolarAngle = 0; // Permet toutes les rotations verticales\r\n        controls.maxPolarAngle = Math.PI; // Permet toutes les rotations verticales\r\n        controls.target.set(0, 0, 0);\r\n\r\n        loader.load(\r\n            this.vault.app.getAbsolutePath(mediaPath),\r\n            (gltf: any) => {\r\n                model = gltf.scene;\r\n                model.traverse((child: any) => {\r\n                    if (child.isMesh && child.material) {\r\n                        // Handle both array and single material\r\n                        const materials = Array.isArray(child.material) ? child.material : [child.material];\r\n                        for (const mat of materials) {\r\n                            if (mat.transparent || mat.opacity < 0.5) {\r\n                                // Set mesh to be fully visible (opaque)\r\n                                mat.opacity = 1;\r\n                                mat.transparent = false;\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n\r\n                // Automatically center the model\r\n                const box = new THREE.Box3().setFromObject(model);\r\n                const center = new THREE.Vector3();\r\n                const size = new THREE.Vector3();\r\n                box.getCenter(center);\r\n                box.getSize(size);\r\n\r\n                // Center the model at the origin\r\n                model.position.sub(center);\r\n\r\n                // Scale model to fill 80% of the 300x300 area\r\n                const maxDim = Math.max(size.x, size.y, size.z);\r\n                const targetFill = 0.8;\r\n                const viewHeight = 2 * camera.position.y * Math.tan((camera.fov * Math.PI) / 360);\r\n                const desiredSize = viewHeight * targetFill;\r\n                const scale = desiredSize / maxDim;\r\n                model.scale.setScalar(scale);\r\n\r\n                scene.add(model);\r\n\r\n                // Animation function\r\n                const animate = () => {\r\n                    if (animationActive) {\r\n                        requestAnimationFrame(animate);\r\n                        // Rotate the model\r\n                        if (model) {\r\n                            model.rotation.z += 0.01; // Rotate around Z-axis\r\n                        }\r\n                        controls.update(); // Update camera controls\r\n                        renderer.render(scene, camera);\r\n                    }\r\n                };\r\n                animate();\r\n\r\n                // Reset model position and rotation after loading\r\n                model.rotation.set(0, 0, 0);\r\n\r\n                // Recalculate bounding box after positioning\r\n                const newBox = new THREE.Box3().setFromObject(model);\r\n                const newCenter = new THREE.Vector3();\r\n                newBox.getCenter(newCenter);\r\n                model.position.sub(newCenter);\r\n\r\n                controls.update();\r\n            },\r\n            undefined,\r\n            (error: any) => {\r\n                console.error(\"Erreur lors du chargement du modèle 3D:\", error);\r\n                const errorDiv = document.createElement(\"div\");\r\n                errorDiv.textContent = \"Erreur lors du chargement du modèle 3D\";\r\n                errorDiv.style.textAlign = \"center\";\r\n                errorDiv.style.margin = \"40px auto\";\r\n                errorDiv.style.color = \"#c00\";\r\n                container.appendChild(errorDiv);\r\n            }\r\n        );\r\n\r\n        // Add interaction controls\r\n        embed.addEventListener(\"mouseenter\", () => {\r\n            animationActive = false;\r\n        });\r\n\r\n        embed.addEventListener(\"mouseleave\", () => {\r\n            animationActive = true;\r\n        });\r\n    }\r\n\r\n    override fillDisplay(vault: any, value: any, update: (value: any) => Promise<void>, file: any = null): HTMLDivElement {\r\n        this.vault = vault;\r\n        \r\n        const mediaFile = this.vault.getMediaFromLink(value);\r\n        if (!mediaFile) {\r\n            return super.fillDisplay(vault, value, update, file);\r\n        }\r\n\r\n        const mediaPath = mediaFile.path;\r\n        if (!mediaPath) {\r\n            return super.fillDisplay(vault, value, update, file);\r\n        }\r\n        const extension = mediaPath.split('.').pop()?.toLowerCase();\r\n\r\n        // Check if it's a 3D model file\r\n        if (['gltf', 'glb'].includes(extension || '')) {\r\n            const container = document.createElement(\"div\");\r\n            container.classList.add(\"embed-container\");\r\n            this.render3DModel(mediaPath, container);\r\n            return container;\r\n        }\r\n\r\n        // For non-3D files, use the parent MediaProperty behavior\r\n        return super.fillDisplay(vault, value, update, file);\r\n    }\r\n}"],"version":3}