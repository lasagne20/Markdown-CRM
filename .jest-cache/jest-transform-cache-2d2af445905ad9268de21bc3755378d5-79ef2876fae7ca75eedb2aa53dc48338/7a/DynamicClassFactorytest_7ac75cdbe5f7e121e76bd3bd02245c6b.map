{"file":"C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\__tests__\\Config\\DynamicClassFactory.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\__tests__\\Config\\DynamicClassFactory.test.ts"],"sourcesContent":["import { DynamicClassFactory } from '../../src/Config/DynamicClassFactory';\r\nimport { ClassConfigManager } from '../../src/Config/ClassConfigManager';\r\nimport { Classe } from '../../src/vault/Classe';\r\n\r\n// Mock ClassConfigManager\r\njest.mock('../../src/Config/ClassConfigManager');\r\n\r\ndescribe('DynamicClassFactory', () => {\r\n    let factory: DynamicClassFactory;\r\n    let mockConfigManager: jest.Mocked<ClassConfigManager>;\r\n    let mockApp: any;\r\n\r\n    beforeEach(() => {\r\n        jest.clearAllMocks();\r\n        \r\n        mockApp = {\r\n            getVaultPath: jest.fn(() => '/test/vault'),\r\n            getName: jest.fn(() => 'TestVault')\r\n        };\r\n\r\n        // Create mock config manager with the correct methods\r\n        mockConfigManager = {\r\n            createDynamicClasse: jest.fn(),\r\n            getClassConfig: jest.fn(),\r\n            getAvailableClasses: jest.fn(),\r\n            clearCache: jest.fn()\r\n        } as any;\r\n\r\n        // Mock the constructor\r\n        (ClassConfigManager as jest.MockedClass<typeof ClassConfigManager>).mockImplementation(() => mockConfigManager);\r\n        \r\n        factory = new DynamicClassFactory('./test-config', mockApp);\r\n    });\r\n\r\n    describe('constructor', () => {\r\n        it('should create instance with config manager', () => {\r\n            expect(ClassConfigManager).toHaveBeenCalledWith('./test-config', mockApp);\r\n        });\r\n    });\r\n\r\n    describe('getClass', () => {\r\n        it('should return cached class if already registered', async () => {\r\n            const MockClass = class extends Classe {} as any;\r\n            \r\n            // First call - should call createDynamicClasse\r\n            mockConfigManager.createDynamicClasse.mockResolvedValue(MockClass);\r\n            \r\n            const firstResult = await factory.getClass('TestClass');\r\n            expect(firstResult).toBe(MockClass);\r\n            expect(mockConfigManager.createDynamicClasse).toHaveBeenCalledWith('TestClass');\r\n            \r\n            // Second call - should return cached version\r\n            jest.clearAllMocks();\r\n            const secondResult = await factory.getClass('TestClass');\r\n            expect(secondResult).toBe(MockClass);\r\n            expect(mockConfigManager.createDynamicClasse).not.toHaveBeenCalled();\r\n        });\r\n\r\n        it('should create new class if not cached', async () => {\r\n            const MockClass = class extends Classe {} as any;\r\n            mockConfigManager.createDynamicClasse.mockResolvedValue(MockClass);\r\n            \r\n            const result = await factory.getClass('NewClass');\r\n            \r\n            expect(result).toBe(MockClass);\r\n            expect(mockConfigManager.createDynamicClasse).toHaveBeenCalledWith('NewClass');\r\n        });\r\n    });\r\n\r\n    describe('createInstance', () => {\r\n        it('should create instance of dynamic class', async () => {\r\n            const mockVault = { app: mockApp } as any;\r\n            const mockFile = { path: 'test.md' } as any;\r\n            \r\n            const MockClass = jest.fn();\r\n            MockClass.mockImplementation(function(this: any, vault: any, file: any) {\r\n                this.vault = vault;\r\n                this.file = file;\r\n                this.displayConfig = undefined;\r\n            });\r\n            \r\n            mockConfigManager.createDynamicClasse.mockResolvedValue(MockClass as any);\r\n            mockConfigManager.getClassConfig.mockResolvedValue({ className: 'TestClass' } as any);\r\n            \r\n            const instance = await factory.createInstance('TestClass', mockApp, mockVault, mockFile);\r\n            \r\n            expect(MockClass).toHaveBeenCalledWith(mockVault, mockFile);\r\n            expect(instance).toBeInstanceOf(MockClass);\r\n        });\r\n    });\r\n\r\n    describe('getAvailableClasses', () => {\r\n        it('should delegate to config manager', async () => {\r\n            const mockClasses = ['Class1', 'Class2', 'Class3'];\r\n            mockConfigManager.getAvailableClasses.mockResolvedValue(mockClasses);\r\n            \r\n            const result = await factory.getAvailableClasses();\r\n            \r\n            expect(result).toEqual(mockClasses);\r\n            expect(mockConfigManager.getAvailableClasses).toHaveBeenCalled();\r\n        });\r\n    });\r\n\r\n    describe('clearCache', () => {\r\n        it('should clear both config manager and class registry', async () => {\r\n            const MockClass = class extends Classe {} as any;\r\n            mockConfigManager.createDynamicClasse.mockResolvedValue(MockClass);\r\n            \r\n            // Add class to registry\r\n            await factory.getClass('TestClass');\r\n            \r\n            // Clear cache\r\n            factory.clearCache();\r\n            \r\n            expect(mockConfigManager.clearCache).toHaveBeenCalled();\r\n            \r\n            // Should call createDynamicClasse again after clearing\r\n            jest.clearAllMocks();\r\n            await factory.getClass('TestClass');\r\n            expect(mockConfigManager.createDynamicClasse).toHaveBeenCalledWith('TestClass');\r\n        });\r\n    });\r\n});"],"version":3}