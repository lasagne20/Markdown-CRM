32e7a504033a6786393a29e48f0a4aed
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock complex dependencies
jest.mock('../../src/vault/Utils', () => ({
    setIcon: jest.fn()
}));
const _3DModelProperty_1 = require("../../src/properties/3DModelProperty");
const MediaProperty_1 = require("../../src/properties/MediaProperty");
// Mock external dependencies
global.Notice = jest.fn();
global.selectMedia = jest.fn();
global.shell = {
    openPath: jest.fn()
};
// Mock THREE.js dependencies
global.THREE = {
    WebGLRenderer: jest.fn().mockImplementation(() => ({
        setSize: jest.fn(),
        domElement: document.createElement('canvas'),
        render: jest.fn()
    })),
    Scene: jest.fn().mockImplementation(() => ({
        add: jest.fn()
    })),
    PerspectiveCamera: jest.fn().mockImplementation(() => ({
        position: { set: jest.fn() },
        up: { set: jest.fn() },
        lookAt: jest.fn()
    })),
    DirectionalLight: jest.fn().mockImplementation(() => ({
        position: { set: jest.fn() },
        target: { position: { set: jest.fn() } }
    })),
    AmbientLight: jest.fn(),
    Box3: jest.fn().mockImplementation(() => ({
        setFromObject: jest.fn().mockReturnThis(),
        getCenter: jest.fn(),
        getSize: jest.fn()
    })),
    Vector3: jest.fn().mockImplementation(() => ({
        sub: jest.fn()
    }))
};
global.GLTFLoader = jest.fn().mockImplementation(() => ({
    load: jest.fn()
}));
global.OrbitControls = jest.fn().mockImplementation(() => ({
    enableDamping: true,
    dampingFactor: 0.05,
    enableZoom: true,
    enablePan: true,
    enableRotate: true,
    minPolarAngle: 0,
    maxPolarAngle: Math.PI,
    target: { set: jest.fn() },
    update: jest.fn()
}));
global.FreecadFile = jest.fn();
describe('ThreeDModelProperty', () => {
    let property;
    let mockVault;
    beforeEach(() => {
        // Reset all mocks
        jest.clearAllMocks();
        // Create mock vault
        mockVault = {
            app: {
                getFile: jest.fn().mockReturnValue({ path: 'test.gltf' }),
                getAbsolutePath: jest.fn().mockReturnValue('/absolute/path/test.gltf'),
                setIcon: jest.fn(),
                vault: {
                    getFiles: jest.fn().mockReturnValue([]),
                    adapter: {
                        getResourcePath: jest.fn().mockReturnValue('/mock/path')
                    }
                }
            },
            getMediaFromLink: jest.fn().mockReturnValue({
                path: 'test.glb',
                name: 'test.glb'
            })
        };
        property = new _3DModelProperty_1.ThreeDModelProperty('test3d', mockVault);
        property.vault = mockVault;
    });
    describe('Constructor', () => {
        it('should create a ThreeDModelProperty with correct type', () => {
            expect(property.type).toBe('3dmodel');
        });
        it('should inherit from MediaProperty', () => {
            expect(property).toBeInstanceOf(MediaProperty_1.MediaProperty);
        });
        it('should set default icon to box', () => {
            expect(property.icon).toBe('box');
        });
    });
    describe('fillDisplay method', () => {
        it('should handle 3D model files (gltf)', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'model.gltf',
                name: 'model.gltf'
            });
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'model.gltf' }
            ]);
            const result = property.fillDisplay(mockVault, '[[model.gltf]]', mockUpdate);
            expect(result).toBeInstanceOf(HTMLDivElement);
            expect(result.classList.contains('embed-container')).toBe(true);
        });
        it('should handle 3D model files (glb)', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'model.glb',
                name: 'model.glb'
            });
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'model.glb' }
            ]);
            const result = property.fillDisplay(mockVault, '[[model.glb]]', mockUpdate);
            expect(result).toBeInstanceOf(HTMLDivElement);
            expect(result.classList.contains('embed-container')).toBe(true);
        });
        it('should fallback to parent MediaProperty for non-3D files', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'image.png',
                name: 'image.png'
            });
            const result = property.fillDisplay(mockVault, '[[image.png]]', mockUpdate);
            // Should call parent method for non-3D files
            expect(result).toBeInstanceOf(HTMLDivElement);
        });
        it('should handle missing media file', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue(null);
            const result = property.fillDisplay(mockVault, '[[missing.glb]]', mockUpdate);
            // Should call parent method when media file not found
            expect(result).toBeInstanceOf(HTMLDivElement);
        });
    });
    describe('render3DModel method', () => {
        it('should create error message when file does not exist', () => {
            const container = document.createElement('div');
            // Mock getFile to return null for missing file
            mockVault.app.getFile.mockReturnValue(null);
            property['render3DModel']('missing.glb', container);
            expect(container.children.length).toBeGreaterThan(0);
            const errorDiv = container.firstElementChild;
            expect(errorDiv.textContent).toContain('Rendu 3D introuvable');
        });
        it('should create canvas when file exists', () => {
            const container = document.createElement('div');
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'test.glb' }
            ]);
            property['render3DModel']('test.glb', container);
            expect(container.querySelector('canvas')).toBeTruthy();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXDNETW9kZWxQcm9wZXJ0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFLSCw0QkFBNEI7QUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ3JCLENBQUMsQ0FBQyxDQUFDO0FBTkosMkVBQTJFO0FBQzNFLHNFQUFtRTtBQU9uRSw2QkFBNkI7QUFDNUIsTUFBYyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDbEMsTUFBYyxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDdkMsTUFBYyxDQUFDLEtBQUssR0FBRztJQUNwQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUN0QixDQUFDO0FBRUYsNkJBQTZCO0FBQzVCLE1BQWMsQ0FBQyxLQUFLLEdBQUc7SUFDcEIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLFVBQVUsRUFBRSxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQztRQUM1QyxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNwQixDQUFDLENBQUM7SUFDSCxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDdkMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDakIsQ0FBQyxDQUFD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U0FBUyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRTVDLFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQyxhQUFhLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFFcEQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JELE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxpQkFBbUMsQ0FBQztZQUMvRCxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQ25FLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUM3QyxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRWhELFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUM7Z0JBQ3pDLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRTthQUN2QixDQUFDLENBQUM7WUFFSCxRQUFRLENBQUMsZUFBZSxDQUFDLENBQUMsVUFBVSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBRWpELE1BQU0sQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDM0QsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcX190ZXN0c19fXFxQcm9wZXJ0aWVzXFwzRE1vZGVsUHJvcGVydHkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGplc3QtZW52aXJvbm1lbnQganNkb21cclxuICovXHJcblxyXG5pbXBvcnQgeyBUaHJlZURNb2RlbFByb3BlcnR5IH0gZnJvbSAnLi4vLi4vc3JjL3Byb3BlcnRpZXMvM0RNb2RlbFByb3BlcnR5JztcclxuaW1wb3J0IHsgTWVkaWFQcm9wZXJ0eSB9IGZyb20gJy4uLy4uL3NyYy9wcm9wZXJ0aWVzL01lZGlhUHJvcGVydHknO1xyXG5cclxuLy8gTW9jayBjb21wbGV4IGRlcGVuZGVuY2llc1xyXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy92YXVsdC9VdGlscycsICgpID0+ICh7XHJcbiAgICBzZXRJY29uOiBqZXN0LmZuKClcclxufSkpO1xyXG5cclxuLy8gTW9jayBleHRlcm5hbCBkZXBlbmRlbmNpZXNcclxuKGdsb2JhbCBhcyBhbnkpLk5vdGljZSA9IGplc3QuZm4oKTtcclxuKGdsb2JhbCBhcyBhbnkpLnNlbGVjdE1lZGlhID0gamVzdC5mbigpO1xyXG4oZ2xvYmFsIGFzIGFueSkuc2hlbGwgPSB7XHJcbiAgICBvcGVuUGF0aDogamVzdC5mbigpXHJcbn07XHJcblxyXG4vLyBNb2NrIFRIUkVFLmpzIGRlcGVuZGVuY2llc1xyXG4oZ2xvYmFsIGFzIGFueSkuVEhSRUUgPSB7XHJcbiAgICBXZWJHTFJlbmRlcmVyOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgc2V0U2l6ZTogamVzdC5mbigpLFxyXG4gICAgICAgIGRvbUVsZW1lbnQ6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLFxyXG4gICAgICAgIHJlbmRlcjogamVzdC5mbigpXHJcbiAgICB9KSksXHJcbiAgICBTY2VuZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIGFkZDogamVzdC5mbigpXHJcbiAgICB9KSksXHJcbiAgICBQZXJzcGVjdGl2ZUNhbWVyYTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHBvc2l0aW9uOiB7IHNldDogamVzdC5mbigpIH0sXHJcbiAgICAgICAgdXA6IHsgc2V0OiBqZXN0LmZuKCkgfSxcclxuICAgICAgICBsb29rQXQ6IGplc3QuZm4oKVxyXG4gICAgfSkpLFxyXG4gICAgRGlyZWN0aW9uYWxMaWdodDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHBvc2l0aW9uOiB7IHNldDogamVzdC5mbigpIH0sXHJcbiAgICAgICAgdGFyZ2V0OiB7IHBvc2l0aW9uOiB7IHNldDogamVzdC5mbigpIH0gfVxyXG4gICAgfSkpLFxyXG4gICAgQW1iaWVudExpZ2h0OiBqZXN0LmZuKCksXHJcbiAgICBCb3gzOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgc2V0RnJvbU9iamVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgICAgZ2V0Q2VudGVyOiBqZXN0LmZuKCksXHJcbiAgICAgICAgZ2V0U2l6ZTogamVzdC5mbigpXHJcbiAgICB9KSksXHJcbiAgICBWZWN0b3IzOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgc3ViOiBqZXN0LmZuKClcclxuICAgIH0pKVxyXG59O1xyXG5cclxuKGdsb2JhbCBhcyBhbnkpLkdMVEZMb2FkZXIgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICBsb2FkOiBqZXN0LmZuKClcclxufSkpO1xyXG5cclxuKGdsb2JhbCBhcyBhbnkpLk9yYml0Q29udHJvbHMgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICBlbmFibGVEYW1waW5nOiB0cnVlLFxyXG4gICAgZGFtcGluZ0ZhY3RvcjogMC4wNSxcclxuICAgIGVuYWJsZVpvb206IHRydWUsXHJcbiAgICBlbmFibGVQYW46IHRydWUsXHJcbiAgICBlbmFibGVSb3RhdGU6IHRydWUsXHJcbiAgICBtaW5Qb2xhckFuZ2xlOiAwLFxyXG4gICAgbWF4UG9sYXJBbmdsZTogTWF0aC5QSSxcclxuICAgIHRhcmdldDogeyBzZXQ6IGplc3QuZm4oKSB9LFxyXG4gICAgdXBkYXRlOiBqZXN0LmZuKClcclxufSkpO1xyXG5cclxuKGdsb2JhbCBhcyBhbnkpLkZyZWVjYWRGaWxlID0gamVzdC5mbigpO1xyXG5cclxuZGVzY3JpYmUoJ1RocmVlRE1vZGVsUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICBsZXQgcHJvcGVydHk6IFRocmVlRE1vZGVsUHJvcGVydHk7XHJcbiAgICBsZXQgbW9ja1ZhdWx0OiBhbnk7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgLy8gUmVzZXQgYWxsIG1vY2tzXHJcbiAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQ3JlYXRlIG1vY2sgdmF1bHRcclxuICAgICAgICBtb2NrVmF1bHQgPSB7XHJcbiAgICAgICAgICAgIGFwcDoge1xyXG4gICAgICAgICAgICAgICAgZ2V0RmlsZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHBhdGg6ICd0ZXN0LmdsdGYnIH0pLFxyXG4gICAgICAgICAgICAgICAgZ2V0QWJzb2x1dGVQYXRoOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCcvYWJzb2x1dGUvcGF0aC90ZXN0LmdsdGYnKSxcclxuICAgICAgICAgICAgICAgIHNldEljb246IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgICAgIHZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0RmlsZXM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoW10pLFxyXG4gICAgICAgICAgICAgICAgICAgIGFkYXB0ZXI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UmVzb3VyY2VQYXRoOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCcvbW9jay9wYXRoJylcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGdldE1lZGlhRnJvbUxpbms6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcGF0aDogJ3Rlc3QuZ2xiJyxcclxuICAgICAgICAgICAgICAgIG5hbWU6ICd0ZXN0LmdsYidcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBwcm9wZXJ0eSA9IG5ldyBUaHJlZURNb2RlbFByb3BlcnR5KCd0ZXN0M2QnLCBtb2NrVmF1bHQpO1xyXG4gICAgICAgIHByb3BlcnR5LnZhdWx0ID0gbW9ja1ZhdWx0O1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ0NvbnN0cnVjdG9yJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgVGhyZWVETW9kZWxQcm9wZXJ0eSB3aXRoIGNvcnJlY3QgdHlwZScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnR5LnR5cGUpLnRvQmUoJzNkbW9kZWwnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBpbmhlcml0IGZyb20gTWVkaWFQcm9wZXJ0eScsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnR5KS50b0JlSW5zdGFuY2VPZihNZWRpYVByb3BlcnR5KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBzZXQgZGVmYXVsdCBpY29uIHRvIGJveCcsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KHByb3BlcnR5Lmljb24pLnRvQmUoJ2JveCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2ZpbGxEaXNwbGF5IG1ldGhvZCcsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSAzRCBtb2RlbCBmaWxlcyAoZ2x0ZiknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0TWVkaWFGcm9tTGluay5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcGF0aDogJ21vZGVsLmdsdGYnLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogJ21vZGVsLmdsdGYnXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9ja1ZhdWx0LmFwcC52YXVsdC5nZXRGaWxlcy5tb2NrUmV0dXJuVmFsdWUoW1xyXG4gICAgICAgICAgICAgICAgeyBwYXRoOiAnbW9kZWwuZ2x0ZicgfVxyXG4gICAgICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgJ1tbbW9kZWwuZ2x0Zl1dJywgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlSW5zdGFuY2VPZihIVE1MRGl2RWxlbWVudCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NMaXN0LmNvbnRhaW5zKCdlbWJlZC1jb250YWluZXInKSkudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgM0QgbW9kZWwgZmlsZXMgKGdsYiknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0TWVkaWFGcm9tTGluay5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcGF0aDogJ21vZGVsLmdsYicsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiAnbW9kZWwuZ2xiJ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG1vY2tWYXVsdC5hcHAudmF1bHQuZ2V0RmlsZXMubW9ja1JldHVyblZhbHVlKFtcclxuICAgICAgICAgICAgICAgIHsgcGF0aDogJ21vZGVsLmdsYicgfVxyXG4gICAgICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgJ1tbbW9kZWwuZ2xiXV0nLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVJbnN0YW5jZU9mKEhUTUxEaXZFbGVtZW50KTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jbGFzc0xpc3QuY29udGFpbnMoJ2VtYmVkLWNvbnRhaW5lcicpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGZhbGxiYWNrIHRvIHBhcmVudCBNZWRpYVByb3BlcnR5IGZvciBub24tM0QgZmlsZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0TWVkaWFGcm9tTGluay5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcGF0aDogJ2ltYWdlLnBuZycsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiAnaW1hZ2UucG5nJ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgJ1tbaW1hZ2UucG5nXV0nLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNob3VsZCBjYWxsIHBhcmVudCBtZXRob2QgZm9yIG5vbi0zRCBmaWxlc1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlSW5zdGFuY2VPZihIVE1MRGl2RWxlbWVudCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgbWVkaWEgZmlsZScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG1vY2tWYXVsdC5nZXRNZWRpYUZyb21MaW5rLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5LmZpbGxEaXNwbGF5KG1vY2tWYXVsdCwgJ1tbbWlzc2luZy5nbGJdXScsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gU2hvdWxkIGNhbGwgcGFyZW50IG1ldGhvZCB3aGVuIG1lZGlhIGZpbGUgbm90IGZvdW5kXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVJbnN0YW5jZU9mKEhUTUxEaXZFbGVtZW50KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdyZW5kZXIzRE1vZGVsIG1ldGhvZCcsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBlcnJvciBtZXNzYWdlIHdoZW4gZmlsZSBkb2VzIG5vdCBleGlzdCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBNb2NrIGdldEZpbGUgdG8gcmV0dXJuIG51bGwgZm9yIG1pc3NpbmcgZmlsZVxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuYXBwLmdldEZpbGUubW9ja1JldHVyblZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcHJvcGVydHlbJ3JlbmRlcjNETW9kZWwnXSgnbWlzc2luZy5nbGInLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3JEaXYgPSBjb250YWluZXIuZmlyc3RFbGVtZW50Q2hpbGQgYXMgSFRNTERpdkVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGV4cGVjdChlcnJvckRpdi50ZXh0Q29udGVudCkudG9Db250YWluKCdSZW5kdSAzRCBpbnRyb3V2YWJsZScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBjYW52YXMgd2hlbiBmaWxlIGV4aXN0cycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuYXBwLnZhdWx0LmdldEZpbGVzLm1vY2tSZXR1cm5WYWx1ZShbXHJcbiAgICAgICAgICAgICAgICB7IHBhdGg6ICd0ZXN0LmdsYicgfVxyXG4gICAgICAgICAgICBdKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHByb3BlcnR5WydyZW5kZXIzRE1vZGVsJ10oJ3Rlc3QuZ2xiJywgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIucXVlcnlTZWxlY3RvcignY2FudmFzJykpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9