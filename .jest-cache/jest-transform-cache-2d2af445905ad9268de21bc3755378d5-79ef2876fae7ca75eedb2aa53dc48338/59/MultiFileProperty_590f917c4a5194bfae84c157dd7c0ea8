ea42fc131684953951ccd70630003318
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MultiFileProperty = void 0;
const ObjectProperty_1 = require("./ObjectProperty");
const FileProperty_1 = require("./FileProperty");
const Utils_1 = require("../vault/Utils");
class MultiFileProperty extends ObjectProperty_1.ObjectProperty {
    constructor(name, classes, args = {}) {
        super(name, {}, args);
        this.type = "multiFile";
        this.flexSpan = 2;
        this.classes = classes;
        this.property = new FileProperty_1.FileProperty(name, classes, args);
    }
    getClasses() {
        return this.classes;
    }
    getParentValue(values) {
        return this.property.getParentValue(values);
    }
    formatParentValue(value) {
        return [value];
    }
    // Méthode principale pour obtenir l'affichage
    fillDisplay(vault, values, update) {
        this.vault = vault;
        const container = document.createElement("div");
        container.classList.add("metadata-multiFiles-container-" + this.name.toLowerCase());
        container.classList.add("metadata-multiFiles-container");
        // Créer les lignes d'objet
        this.createObjects(values, update, container);
        const addButton = this.createAddButton(values, update, container);
        container.appendChild(addButton);
        return container;
    }
    createObjects(values, update, container) {
        if (!values)
            return;
        values.forEach((objects, index) => {
            const row = this.createObjectRow(values, update, objects, index, container);
            container.appendChild(row);
        });
    }
    createObjectRow(values, update, value, index, container) {
        const row = document.createElement("div");
        row.classList.add("metadata-multiFiles-row-inline");
        // Ajouter le bouton de suppression
        const deleteButton = this.createDeleteButton(values, update, index, container);
        row.appendChild(deleteButton);
        let propertyContainer = document.createElement("div");
        propertyContainer.classList.add("metadata-multiFiles-property-inline");
        propertyContainer.appendChild(this.property.fillDisplay(this.vault, value, async (value) => await this.updateObject(values, update, index, this.property, value)));
        row.appendChild(propertyContainer);
        return row;
    }
    createDeleteButton(values, update, index, container) {
        const deleteButton = document.createElement("button");
        (0, Utils_1.setIcon)(deleteButton, "minus");
        deleteButton.classList.add("metadata-delete-button-inline-small");
        deleteButton.onclick = async () => await this.removeProperty(values, update, index, container);
        return deleteButton;
    }
    async addProperty(values, update, container) {
        // const newFiles = await selectMultipleFile(this.vault, this.classes, { hint: "Choisissez des fichiers " + this.getClasses().join(" ou ") }); // TODO: Fix selectMultipleFile
        const newFiles = []; // Temporary placeholder
        if (newFiles && newFiles.length > 0) {
            if (!values) {
                values = [];
            }
            newFiles.forEach((file) => {
                values.push(file.getLink());
            });
            await update(values);
            await this.reloadObjects(values, update);
        }
    }
    createAddButton(values, update, container) {
        const addButton = document.createElement("button");
        (0, Utils_1.setIcon)(addButton, "plus");
        addButton.classList.add("metadata-add-button-inline-small");
        addButton.onclick = async () => await this.addProperty(values, update, container);
        return addButton;
    }
    enableDragAndDrop() {
        // Disable drag and drop
    }
}
exports.MultiFileProperty = MultiFileProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE11bHRpRmlsZVByb3BlcnR5LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLHFEQUFrRDtBQUNsRCxpREFBOEM7QUFDOUMsMENBQXlDO0FBTXpDLE1BQWEsaUJBQWtCLFNBQVEsK0JBQWM7SUFRakQsWUFBWSxJQUFZLEVBQUUsT0FBa0IsRUFBRSxJQUFJLEdBQUcsRUFBRTtRQUNuRCxLQUFLLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQVBWLFNBQUksR0FBWSxXQUFXLENBQUM7UUFHNUIsYUFBUSxHQUFHLENBQUMsQ0FBQztRQUt6QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksMkJBQVksQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFUSxVQUFVO1FBQ2YsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3hCLENBQUM7SUFFUSxjQUFjLENBQUMsTUFBWTtRQUNoQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQy9DLENBQUM7SUFFUSxpQkFBaUIsQ0FBQyxLQUFjO1FBQ3JDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUNsQixDQUFDO0lBRUQsOENBQThDO0lBQ3JDLFdBQVcsQ0FBQyxLQUFXLEVBQUMsTUFBVyxFQUFFLE1BQXFDO1FBQy9FLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEQsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsZ0NB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QUF3QjtRQUNwRCxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ2xDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO1lBQUMsQ0FBQztZQUM3QixRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBVSxFQUFFLEVBQUU7Z0JBQzVCLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDaEMsQ0FBQyxDQUFDLENBQUM7WUFDSCxNQUFNLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNyQixNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQzdDLENBQUM7SUFDTCxDQUFDO0lBRVEsZUFBZSxDQUFDLE1BQVcsRUFBRSxNQUFxQyxFQUFFLFNBQXlCO1FBQ2xHLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbkQsSUFBQSxlQUFPLEVBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQzNCLFNBQVMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7UUFDNUQsU0FBUyxDQUFDLE9BQU8sR0FBRyxLQUFLLElBQUksRUFBRSxDQUFDLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ2xGLE9BQU8sU0FBUyxDQUFDO0lBQ3JCLENBQUM7SUFFUSxpQkFBaUI7UUFDdEIsd0JBQXdCO0lBQzVCLENBQUM7Q0FDSjtBQXBHRCw4Q0FvR0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXE11bHRpRmlsZVByb3BlcnR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQgeyBPYmplY3RQcm9wZXJ0eSB9IGZyb20gXCIuL09iamVjdFByb3BlcnR5XCI7XHJcbmltcG9ydCB7IEZpbGVQcm9wZXJ0eSB9IGZyb20gXCIuL0ZpbGVQcm9wZXJ0eVwiO1xyXG5pbXBvcnQgeyBzZXRJY29uIH0gZnJvbSBcIi4uL3ZhdWx0L1V0aWxzXCI7XHJcbi8vIGltcG9ydCB7IHNlbGVjdEZpbGUsIHNlbGVjdE11bHRpcGxlRmlsZSB9IGZyb20gXCJVdGlscy9Nb2RhbHMvTW9kYWxzXCI7IC8vIFRPRE86IEZpeCBtb2RhbHMgaW1wb3J0XHJcbmltcG9ydCB7IEZpbGUgfSBmcm9tIFwiLi4vdmF1bHQvRmlsZVwiO1xyXG5pbXBvcnQgeyBNeVZhdWx0IH0gZnJvbSBcIi4uL3ZhdWx0L015VmF1bHRcIjtcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgTXVsdGlGaWxlUHJvcGVydHkgZXh0ZW5kcyBPYmplY3RQcm9wZXJ0eSB7XHJcblxyXG4gICAgcHVibGljIG92ZXJyaWRlIHR5cGUgOiBzdHJpbmcgPSBcIm11bHRpRmlsZVwiO1xyXG4gICAgcHVibGljIGNsYXNzZXM6IHN0cmluZ1tdO1xyXG4gICAgcHVibGljIHByb3BlcnR5IDogRmlsZVByb3BlcnR5O1xyXG4gICAgcHVibGljIG92ZXJyaWRlIGZsZXhTcGFuID0gMjtcclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCBjbGFzc2VzIDogc3RyaW5nW10sIGFyZ3MgPSB7fSl7XHJcbiAgICAgICAgc3VwZXIobmFtZSwge30sIGFyZ3MpO1xyXG4gICAgICAgIHRoaXMuY2xhc3NlcyA9IGNsYXNzZXM7XHJcbiAgICAgICAgdGhpcy5wcm9wZXJ0eSA9IG5ldyBGaWxlUHJvcGVydHkobmFtZSwgY2xhc3NlcywgYXJncyk7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgZ2V0Q2xhc3NlcygpOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xhc3NlcztcclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZSBnZXRQYXJlbnRWYWx1ZSh2YWx1ZXMgOiBhbnkpIDogRmlsZSB8IHVuZGVmaW5lZHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0eS5nZXRQYXJlbnRWYWx1ZSh2YWx1ZXMpXHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgZm9ybWF0UGFyZW50VmFsdWUodmFsdWUgOiBzdHJpbmcpe1xyXG4gICAgICAgIHJldHVybiBbdmFsdWVdXHJcbiAgICB9XHJcblxyXG4gICAgLy8gTcOpdGhvZGUgcHJpbmNpcGFsZSBwb3VyIG9idGVuaXIgbCdhZmZpY2hhZ2VcclxuICAgIG92ZXJyaWRlIGZpbGxEaXNwbGF5KHZhdWx0IDogYW55LHZhbHVlczogYW55LCB1cGRhdGU6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+KSB7XHJcbiAgICAgICAgdGhpcy52YXVsdCA9IHZhdWx0O1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1tdWx0aUZpbGVzLWNvbnRhaW5lci1cIit0aGlzLm5hbWUudG9Mb3dlckNhc2UoKSk7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1tdWx0aUZpbGVzLWNvbnRhaW5lclwiKTtcclxuXHJcbiAgICAgICAgLy8gQ3LDqWVyIGxlcyBsaWduZXMgZCdvYmpldFxyXG4gICAgICAgIHRoaXMuY3JlYXRlT2JqZWN0cyh2YWx1ZXMsIHVwZGF0ZSwgY29udGFpbmVyKTtcclxuXHJcbiAgICAgICAgY29uc3QgYWRkQnV0dG9uID0gdGhpcy5jcmVhdGVBZGRCdXR0b24odmFsdWVzLCB1cGRhdGUsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGFkZEJ1dHRvbik7XHJcblxyXG4gICAgICAgIHJldHVybiBjb250YWluZXI7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgY3JlYXRlT2JqZWN0cyh2YWx1ZXM6IGFueSwgdXBkYXRlOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAgIGlmICghdmFsdWVzKSByZXR1cm47XHJcbiAgICAgICAgdmFsdWVzLmZvckVhY2goKG9iamVjdHM6IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByb3cgPSB0aGlzLmNyZWF0ZU9iamVjdFJvdyh2YWx1ZXMsIHVwZGF0ZSwgb2JqZWN0cywgaW5kZXgsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChyb3cpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG92ZXJyaWRlIGNyZWF0ZU9iamVjdFJvdyh2YWx1ZXM6IGFueSwgdXBkYXRlOiAodmFsdWU6IGFueSkgPT4gUHJvbWlzZTx2b2lkPiwgdmFsdWU6IGFueSwgaW5kZXg6IG51bWJlciwgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCk6IEhUTUxEaXZFbGVtZW50IHtcclxuICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtbXVsdGlGaWxlcy1yb3ctaW5saW5lXCIpO1xyXG5cclxuICAgICAgICAvLyBBam91dGVyIGxlIGJvdXRvbiBkZSBzdXBwcmVzc2lvblxyXG4gICAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IHRoaXMuY3JlYXRlRGVsZXRlQnV0dG9uKHZhbHVlcywgdXBkYXRlLCBpbmRleCwgY29udGFpbmVyKTtcclxuICAgICAgICByb3cuYXBwZW5kQ2hpbGQoZGVsZXRlQnV0dG9uKTtcclxuXHJcblxyXG4gXHJcbiAgICAgICAgbGV0IHByb3BlcnR5Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBwcm9wZXJ0eUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtbXVsdGlGaWxlcy1wcm9wZXJ0eS1pbmxpbmVcIik7XHJcbiAgICAgICAgcHJvcGVydHlDb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5wcm9wZXJ0eS5maWxsRGlzcGxheSh0aGlzLnZhdWx0LCB2YWx1ZSwgYXN5bmMgKHZhbHVlKSA9PiBhd2FpdCB0aGlzLnVwZGF0ZU9iamVjdCh2YWx1ZXMsIHVwZGF0ZSwgaW5kZXgsIHRoaXMucHJvcGVydHksIHZhbHVlKSkpO1xyXG4gICAgICAgIHJvdy5hcHBlbmRDaGlsZChwcm9wZXJ0eUNvbnRhaW5lcik7XHJcblxyXG4gICAgICAgIHJldHVybiByb3c7XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgY3JlYXRlRGVsZXRlQnV0dG9uKHZhbHVlczogYW55LCB1cGRhdGU6ICh2YWx1ZTogYW55KSA9PiBQcm9taXNlPHZvaWQ+LCBpbmRleDogbnVtYmVyLCBjb250YWluZXI6IEhUTUxEaXZFbGVtZW50KTogSFRNTEJ1dHRvbkVsZW1lbnQge1xyXG4gICAgICAgIGNvbnN0IGRlbGV0ZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgc2V0SWNvbihkZWxldGVCdXR0b24sIFwibWludXNcIik7XHJcbiAgICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJtZXRhZGF0YS1kZWxldGUtYnV0dG9uLWlubGluZS1zbWFsbFwiKTtcclxuICAgICAgICBkZWxldGVCdXR0b24ub25jbGljayA9IGFzeW5jICgpID0+IGF3YWl0IHRoaXMucmVtb3ZlUHJvcGVydHkodmFsdWVzLCB1cGRhdGUsIGluZGV4LCBjb250YWluZXIpO1xyXG4gICAgICAgIHJldHVybiBkZWxldGVCdXR0b247XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgYXN5bmMgYWRkUHJvcGVydHkodmFsdWVzOiBhbnksIHVwZGF0ZTogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgICAvLyBjb25zdCBuZXdGaWxlcyA9IGF3YWl0IHNlbGVjdE11bHRpcGxlRmlsZSh0aGlzLnZhdWx0LCB0aGlzLmNsYXNzZXMsIHsgaGludDogXCJDaG9pc2lzc2V6IGRlcyBmaWNoaWVycyBcIiArIHRoaXMuZ2V0Q2xhc3NlcygpLmpvaW4oXCIgb3UgXCIpIH0pOyAvLyBUT0RPOiBGaXggc2VsZWN0TXVsdGlwbGVGaWxlXHJcbiAgICAgICAgY29uc3QgbmV3RmlsZXM6IGFueVtdID0gW107IC8vIFRlbXBvcmFyeSBwbGFjZWhvbGRlclxyXG4gICAgICAgIGlmIChuZXdGaWxlcyAmJiBuZXdGaWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGlmICghdmFsdWVzKSB7IHZhbHVlcyA9IFtdOyB9XHJcbiAgICAgICAgICAgIG5ld0ZpbGVzLmZvckVhY2goKGZpbGU6IEZpbGUpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKGZpbGUuZ2V0TGluaygpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZSh2YWx1ZXMpO1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnJlbG9hZE9iamVjdHModmFsdWVzLCB1cGRhdGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvdmVycmlkZSBjcmVhdGVBZGRCdXR0b24odmFsdWVzOiBhbnksIHVwZGF0ZTogKHZhbHVlOiBhbnkpID0+IFByb21pc2U8dm9pZD4sIGNvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQpOiBIVE1MQnV0dG9uRWxlbWVudCB7XHJcbiAgICAgICAgY29uc3QgYWRkQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICBzZXRJY29uKGFkZEJ1dHRvbiwgXCJwbHVzXCIpO1xyXG4gICAgICAgIGFkZEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwibWV0YWRhdGEtYWRkLWJ1dHRvbi1pbmxpbmUtc21hbGxcIik7XHJcbiAgICAgICAgYWRkQnV0dG9uLm9uY2xpY2sgPSBhc3luYyAoKSA9PiBhd2FpdCB0aGlzLmFkZFByb3BlcnR5KHZhbHVlcywgdXBkYXRlLCBjb250YWluZXIpO1xyXG4gICAgICAgIHJldHVybiBhZGRCdXR0b247XHJcbiAgICB9XHJcblxyXG4gICAgb3ZlcnJpZGUgZW5hYmxlRHJhZ0FuZERyb3AoKSB7XHJcbiAgICAgICAgLy8gRGlzYWJsZSBkcmFnIGFuZCBkcm9wXHJcbiAgICB9XHJcbn1cclxuIl0sInZlcnNpb24iOjN9