7d0cd01b9e4bb9c781d0e5dbbce3118f
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock complex dependencies
jest.mock('../../src/vault/Utils', () => ({
    setIcon: jest.fn()
}));
const _3DModelProperty_1 = require("../../src/properties/3DModelProperty");
const MediaProperty_1 = require("../../src/properties/MediaProperty");
// Mock external dependencies
global.Notice = jest.fn();
global.selectMedia = jest.fn();
global.shell = {
    openPath: jest.fn()
};
// Mock THREE.js dependencies
global.THREE = {
    WebGLRenderer: jest.fn().mockImplementation(() => ({
        setSize: jest.fn(),
        domElement: document.createElement('canvas'),
        render: jest.fn()
    })),
    Scene: jest.fn().mockImplementation(() => ({
        add: jest.fn()
    })),
    PerspectiveCamera: jest.fn().mockImplementation(() => ({
        position: { set: jest.fn() },
        up: { set: jest.fn() },
        lookAt: jest.fn()
    })),
    DirectionalLight: jest.fn().mockImplementation(() => ({
        position: { set: jest.fn() },
        target: { position: { set: jest.fn() } }
    })),
    AmbientLight: jest.fn(),
    Box3: jest.fn().mockImplementation(() => ({
        setFromObject: jest.fn().mockReturnThis(),
        getCenter: jest.fn(),
        getSize: jest.fn()
    })),
    Vector3: jest.fn().mockImplementation(() => ({
        sub: jest.fn()
    }))
};
global.GLTFLoader = jest.fn().mockImplementation(() => ({
    load: jest.fn()
}));
global.OrbitControls = jest.fn().mockImplementation(() => ({
    enableDamping: true,
    dampingFactor: 0.05,
    enableZoom: true,
    enablePan: true,
    enableRotate: true,
    minPolarAngle: 0,
    maxPolarAngle: Math.PI,
    target: { set: jest.fn() },
    update: jest.fn()
}));
global.FreecadFile = jest.fn();
describe('ThreeDModelProperty', () => {
    let property;
    let mockVault;
    beforeEach(() => {
        // Reset all mocks
        jest.clearAllMocks();
        // Create mock vault
        mockVault = {
            app: {
                getFile: jest.fn().mockReturnValue({ path: 'test.gltf' }),
                getAbsolutePath: jest.fn().mockReturnValue('/absolute/path/test.gltf'),
                setIcon: jest.fn(),
                vault: {
                    getFiles: jest.fn().mockReturnValue([]),
                    adapter: {
                        getResourcePath: jest.fn().mockReturnValue('/mock/path')
                    }
                }
            },
            getMediaFromLink: jest.fn().mockReturnValue({
                path: 'test.glb',
                name: 'test.glb'
            })
        };
        property = new _3DModelProperty_1.ThreeDModelProperty('test3d', mockVault);
        property.vault = mockVault;
    });
    describe('Constructor', () => {
        it('should create a ThreeDModelProperty with correct type', () => {
            expect(property.type).toBe('3dmodel');
        });
        it('should inherit from MediaProperty', () => {
            expect(property).toBeInstanceOf(MediaProperty_1.MediaProperty);
        });
        it('should set default icon to box', () => {
            expect(property.icon).toBe('box');
        });
    });
    describe('fillDisplay method', () => {
        it('should handle 3D model files (gltf)', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'model.gltf',
                name: 'model.gltf'
            });
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'model.gltf' }
            ]);
            const result = property.fillDisplay(mockVault, '[[model.gltf]]', mockUpdate);
            expect(result).toBeInstanceOf(HTMLDivElement);
            expect(result.classList.contains('embed-container')).toBe(true);
        });
        it('should handle 3D model files (glb)', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'model.glb',
                name: 'model.glb'
            });
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'model.glb' }
            ]);
            const result = property.fillDisplay(mockVault, '[[model.glb]]', mockUpdate);
            expect(result).toBeInstanceOf(HTMLDivElement);
            expect(result.classList.contains('embed-container')).toBe(true);
        });
        it('should fallback to parent MediaProperty for non-3D files', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'image.png',
                name: 'image.png'
            });
            const result = property.fillDisplay('[[image.png]]', mockUpdate);
            // Should call parent method for non-3D files
            expect(result).toBeInstanceOf(HTMLDivElement);
        });
        it('should handle missing media file', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue(null);
            const result = property.fillDisplay('[[missing.glb]]', mockUpdate);
            // Should call parent method when media file not found
            expect(result).toBeInstanceOf(HTMLDivElement);
        });
    });
    describe('render3DModel method', () => {
        it('should create error message when file does not exist', () => {
            const container = document.createElement('div');
            // Mock getFile to return null for missing file
            mockVault.app.getFile.mockReturnValue(null);
            property['render3DModel']('missing.glb', container);
            expect(container.children.length).toBeGreaterThan(0);
            const errorDiv = container.firstElementChild;
            expect(errorDiv.textContent).toContain('Rendu 3D introuvable');
        });
        it('should create canvas when file exists', () => {
            const container = document.createElement('div');
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'test.glb' }
            ]);
            property['render3DModel']('test.glb', container);
            expect(container.querySelector('canvas')).toBeTruthy();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXDNETW9kZWxQcm9wZXJ0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFLSCw0QkFBNEI7QUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ3JCLENBQUMsQ0FBQyxDQUFDO0FBTkosMkVBQTJFO0FBQzNFLHNFQUFtRTtBQU9uRSw2QkFBNkI7QUFDNUIsTUFBYyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDbEMsTUFBYyxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDdkMsTUFBYyxDQUFDLEtBQUssR0FBRztJQUNwQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUN0QixDQUFDO0FBRUYsNkJBQTZCO0FBQzVCLE1BQWMsQ0FBQyxLQUFLLEdBQUc7SUFDcEIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLFVBQVUsRUFBRSxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQztRQUM1QyxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNwQixDQUFDLENBQUM7SUFDSCxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDdkMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDakIsQ0FBQyxDQUFD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T0FBTyxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUU1QyxRQUFRLENBQUMsZUFBZSxDQUFDLENBQUMsYUFBYSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBRXBELE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyRCxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsaUJBQW1DLENBQUM7WUFDL0QsTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUNuRSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7WUFDN0MsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVoRCxTQUFTLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDO2dCQUN6QyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUU7YUFDdkIsQ0FBQyxDQUFDO1lBRUgsUUFBUSxDQUFDLGVBQWUsQ0FBQyxDQUFDLFVBQVUsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUVqRCxNQUFNLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQzNELENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGxlb2R1XFxEb2N1bWVudHNcXDEgLSBQcm9cXFRlc3QgcGx1Z2luIG9ic2lkaWFuXFwub2JzaWRpYW5cXHBsdWdpbnNcXG9ic2lkaWFuLUNSTVxcZHluYW1pYy1maWVsZHNcXF9fdGVzdHNfX1xcUHJvcGVydGllc1xcM0RNb2RlbFByb3BlcnR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEBqZXN0LWVudmlyb25tZW50IGpzZG9tXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgVGhyZWVETW9kZWxQcm9wZXJ0eSB9IGZyb20gJy4uLy4uL3NyYy9wcm9wZXJ0aWVzLzNETW9kZWxQcm9wZXJ0eSc7XHJcbmltcG9ydCB7IE1lZGlhUHJvcGVydHkgfSBmcm9tICcuLi8uLi9zcmMvcHJvcGVydGllcy9NZWRpYVByb3BlcnR5JztcclxuXHJcbi8vIE1vY2sgY29tcGxleCBkZXBlbmRlbmNpZXNcclxuamVzdC5tb2NrKCcuLi8uLi9zcmMvdmF1bHQvVXRpbHMnLCAoKSA9PiAoe1xyXG4gICAgc2V0SWNvbjogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbi8vIE1vY2sgZXh0ZXJuYWwgZGVwZW5kZW5jaWVzXHJcbihnbG9iYWwgYXMgYW55KS5Ob3RpY2UgPSBqZXN0LmZuKCk7XHJcbihnbG9iYWwgYXMgYW55KS5zZWxlY3RNZWRpYSA9IGplc3QuZm4oKTtcclxuKGdsb2JhbCBhcyBhbnkpLnNoZWxsID0ge1xyXG4gICAgb3BlblBhdGg6IGplc3QuZm4oKVxyXG59O1xyXG5cclxuLy8gTW9jayBUSFJFRS5qcyBkZXBlbmRlbmNpZXNcclxuKGdsb2JhbCBhcyBhbnkpLlRIUkVFID0ge1xyXG4gICAgV2ViR0xSZW5kZXJlcjogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHNldFNpemU6IGplc3QuZm4oKSxcclxuICAgICAgICBkb21FbGVtZW50OiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKSxcclxuICAgICAgICByZW5kZXI6IGplc3QuZm4oKVxyXG4gICAgfSkpLFxyXG4gICAgU2NlbmU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgICBhZGQ6IGplc3QuZm4oKVxyXG4gICAgfSkpLFxyXG4gICAgUGVyc3BlY3RpdmVDYW1lcmE6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgICBwb3NpdGlvbjogeyBzZXQ6IGplc3QuZm4oKSB9LFxyXG4gICAgICAgIHVwOiB7IHNldDogamVzdC5mbigpIH0sXHJcbiAgICAgICAgbG9va0F0OiBqZXN0LmZuKClcclxuICAgIH0pKSxcclxuICAgIERpcmVjdGlvbmFsTGlnaHQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgICBwb3NpdGlvbjogeyBzZXQ6IGplc3QuZm4oKSB9LFxyXG4gICAgICAgIHRhcmdldDogeyBwb3NpdGlvbjogeyBzZXQ6IGplc3QuZm4oKSB9IH1cclxuICAgIH0pKSxcclxuICAgIEFtYmllbnRMaWdodDogamVzdC5mbigpLFxyXG4gICAgQm94MzogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHNldEZyb21PYmplY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICAgIGdldENlbnRlcjogamVzdC5mbigpLFxyXG4gICAgICAgIGdldFNpemU6IGplc3QuZm4oKVxyXG4gICAgfSkpLFxyXG4gICAgVmVjdG9yMzogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHN1YjogamVzdC5mbigpXHJcbiAgICB9KSlcclxufTtcclxuXHJcbihnbG9iYWwgYXMgYW55KS5HTFRGTG9hZGVyID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgbG9hZDogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbihnbG9iYWwgYXMgYW55KS5PcmJpdENvbnRyb2xzID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgZW5hYmxlRGFtcGluZzogdHJ1ZSxcclxuICAgIGRhbXBpbmdGYWN0b3I6IDAuMDUsXHJcbiAgICBlbmFibGVab29tOiB0cnVlLFxyXG4gICAgZW5hYmxlUGFuOiB0cnVlLFxyXG4gICAgZW5hYmxlUm90YXRlOiB0cnVlLFxyXG4gICAgbWluUG9sYXJBbmdsZTogMCxcclxuICAgIG1heFBvbGFyQW5nbGU6IE1hdGguUEksXHJcbiAgICB0YXJnZXQ6IHsgc2V0OiBqZXN0LmZuKCkgfSxcclxuICAgIHVwZGF0ZTogamVzdC5mbigpXHJcbn0pKTtcclxuXHJcbihnbG9iYWwgYXMgYW55KS5GcmVlY2FkRmlsZSA9IGplc3QuZm4oKTtcclxuXHJcbmRlc2NyaWJlKCdUaHJlZURNb2RlbFByb3BlcnR5JywgKCkgPT4ge1xyXG4gICAgbGV0IHByb3BlcnR5OiBUaHJlZURNb2RlbFByb3BlcnR5O1xyXG4gICAgbGV0IG1vY2tWYXVsdDogYW55O1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIC8vIFJlc2V0IGFsbCBtb2Nrc1xyXG4gICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENyZWF0ZSBtb2NrIHZhdWx0XHJcbiAgICAgICAgbW9ja1ZhdWx0ID0ge1xyXG4gICAgICAgICAgICBhcHA6IHtcclxuICAgICAgICAgICAgICAgIGdldEZpbGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBwYXRoOiAndGVzdC5nbHRmJyB9KSxcclxuICAgICAgICAgICAgICAgIGdldEFic29sdXRlUGF0aDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnL2Fic29sdXRlL3BhdGgvdGVzdC5nbHRmJyksXHJcbiAgICAgICAgICAgICAgICBzZXRJY29uOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICAgICAgICB2YXVsdDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldEZpbGVzOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFtdKSxcclxuICAgICAgICAgICAgICAgICAgICBhZGFwdGVyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldFJlc291cmNlUGF0aDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnL21vY2svcGF0aCcpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBnZXRNZWRpYUZyb21MaW5rOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgIHBhdGg6ICd0ZXN0LmdsYicsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiAndGVzdC5nbGInXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcHJvcGVydHkgPSBuZXcgVGhyZWVETW9kZWxQcm9wZXJ0eSgndGVzdDNkJywgbW9ja1ZhdWx0KTtcclxuICAgICAgICBwcm9wZXJ0eS52YXVsdCA9IG1vY2tWYXVsdDtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdDb25zdHJ1Y3RvcicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhIFRocmVlRE1vZGVsUHJvcGVydHkgd2l0aCBjb3JyZWN0IHR5cGUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0eS50eXBlKS50b0JlKCczZG1vZGVsJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaW5oZXJpdCBmcm9tIE1lZGlhUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0eSkudG9CZUluc3RhbmNlT2YoTWVkaWFQcm9wZXJ0eSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgc2V0IGRlZmF1bHQgaWNvbiB0byBib3gnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0eS5pY29uKS50b0JlKCdib3gnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdmaWxsRGlzcGxheSBtZXRob2QnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgM0QgbW9kZWwgZmlsZXMgKGdsdGYpJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja1ZhdWx0LmdldE1lZGlhRnJvbUxpbmsubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgIHBhdGg6ICdtb2RlbC5nbHRmJyxcclxuICAgICAgICAgICAgICAgIG5hbWU6ICdtb2RlbC5nbHRmJ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG1vY2tWYXVsdC5hcHAudmF1bHQuZ2V0RmlsZXMubW9ja1JldHVyblZhbHVlKFtcclxuICAgICAgICAgICAgICAgIHsgcGF0aDogJ21vZGVsLmdsdGYnIH1cclxuICAgICAgICAgICAgXSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9wZXJ0eS5maWxsRGlzcGxheShtb2NrVmF1bHQsICdbW21vZGVsLmdsdGZdXScsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZUluc3RhbmNlT2YoSFRNTERpdkVsZW1lbnQpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmNsYXNzTGlzdC5jb250YWlucygnZW1iZWQtY29udGFpbmVyJykpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIDNEIG1vZGVsIGZpbGVzIChnbGIpJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja1ZhdWx0LmdldE1lZGlhRnJvbUxpbmsubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgIHBhdGg6ICdtb2RlbC5nbGInLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogJ21vZGVsLmdsYidcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuYXBwLnZhdWx0LmdldEZpbGVzLm1vY2tSZXR1cm5WYWx1ZShbXHJcbiAgICAgICAgICAgICAgICB7IHBhdGg6ICdtb2RlbC5nbGInIH1cclxuICAgICAgICAgICAgXSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9wZXJ0eS5maWxsRGlzcGxheShtb2NrVmF1bHQsICdbW21vZGVsLmdsYl1dJywgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlSW5zdGFuY2VPZihIVE1MRGl2RWxlbWVudCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuY2xhc3NMaXN0LmNvbnRhaW5zKCdlbWJlZC1jb250YWluZXInKSkudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBmYWxsYmFjayB0byBwYXJlbnQgTWVkaWFQcm9wZXJ0eSBmb3Igbm9uLTNEIGZpbGVzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja1ZhdWx0LmdldE1lZGlhRnJvbUxpbmsubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgIHBhdGg6ICdpbWFnZS5wbmcnLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogJ2ltYWdlLnBuZydcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9wZXJ0eS5maWxsRGlzcGxheSgnW1tpbWFnZS5wbmddXScsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gU2hvdWxkIGNhbGwgcGFyZW50IG1ldGhvZCBmb3Igbm9uLTNEIGZpbGVzXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVJbnN0YW5jZU9mKEhUTUxEaXZFbGVtZW50KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWlzc2luZyBtZWRpYSBmaWxlJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja1ZhdWx0LmdldE1lZGlhRnJvbUxpbmsubW9ja1JldHVyblZhbHVlKG51bGwpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJvcGVydHkuZmlsbERpc3BsYXkoJ1tbbWlzc2luZy5nbGJdXScsIG1vY2tVcGRhdGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gU2hvdWxkIGNhbGwgcGFyZW50IG1ldGhvZCB3aGVuIG1lZGlhIGZpbGUgbm90IGZvdW5kXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVJbnN0YW5jZU9mKEhUTUxEaXZFbGVtZW50KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdyZW5kZXIzRE1vZGVsIG1ldGhvZCcsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBlcnJvciBtZXNzYWdlIHdoZW4gZmlsZSBkb2VzIG5vdCBleGlzdCcsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBNb2NrIGdldEZpbGUgdG8gcmV0dXJuIG51bGwgZm9yIG1pc3NpbmcgZmlsZVxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuYXBwLmdldEZpbGUubW9ja1JldHVyblZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcHJvcGVydHlbJ3JlbmRlcjNETW9kZWwnXSgnbWlzc2luZy5nbGInLCBjb250YWluZXIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgICAgICAgICAgY29uc3QgZXJyb3JEaXYgPSBjb250YWluZXIuZmlyc3RFbGVtZW50Q2hpbGQgYXMgSFRNTERpdkVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGV4cGVjdChlcnJvckRpdi50ZXh0Q29udGVudCkudG9Db250YWluKCdSZW5kdSAzRCBpbnRyb3V2YWJsZScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBjYW52YXMgd2hlbiBmaWxlIGV4aXN0cycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuYXBwLnZhdWx0LmdldEZpbGVzLm1vY2tSZXR1cm5WYWx1ZShbXHJcbiAgICAgICAgICAgICAgICB7IHBhdGg6ICd0ZXN0LmdsYicgfVxyXG4gICAgICAgICAgICBdKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHByb3BlcnR5WydyZW5kZXIzRE1vZGVsJ10oJ3Rlc3QuZ2xiJywgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIucXVlcnlTZWxlY3RvcignY2FudmFzJykpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9