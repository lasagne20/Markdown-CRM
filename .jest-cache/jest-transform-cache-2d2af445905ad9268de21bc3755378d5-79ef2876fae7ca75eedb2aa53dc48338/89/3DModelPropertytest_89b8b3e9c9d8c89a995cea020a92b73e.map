{"file":"C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\__tests__\\Properties\\3DModelProperty.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\__tests__\\Properties\\3DModelProperty.test.ts"],"sourcesContent":["/**\r\n * @jest-environment jsdom\r\n */\r\n\r\nimport { ThreeDModelProperty } from '../../src/properties/3DModelProperty';\r\nimport { MediaProperty } from '../../src/properties/MediaProperty';\r\n\r\n// Mock complex dependencies\r\njest.mock('../../src/vault/Utils', () => ({\r\n    setIcon: jest.fn()\r\n}));\r\n\r\n// Mock external dependencies\r\n(global as any).Notice = jest.fn();\r\n(global as any).selectMedia = jest.fn();\r\n(global as any).shell = {\r\n    openPath: jest.fn()\r\n};\r\n\r\n// Mock THREE.js dependencies\r\n(global as any).THREE = {\r\n    WebGLRenderer: jest.fn().mockImplementation(() => ({\r\n        setSize: jest.fn(),\r\n        domElement: document.createElement('canvas'),\r\n        render: jest.fn()\r\n    })),\r\n    Scene: jest.fn().mockImplementation(() => ({\r\n        add: jest.fn()\r\n    })),\r\n    PerspectiveCamera: jest.fn().mockImplementation(() => ({\r\n        position: { set: jest.fn() },\r\n        up: { set: jest.fn() },\r\n        lookAt: jest.fn()\r\n    })),\r\n    DirectionalLight: jest.fn().mockImplementation(() => ({\r\n        position: { set: jest.fn() },\r\n        target: { position: { set: jest.fn() } }\r\n    })),\r\n    AmbientLight: jest.fn(),\r\n    Box3: jest.fn().mockImplementation(() => ({\r\n        setFromObject: jest.fn().mockReturnThis(),\r\n        getCenter: jest.fn(),\r\n        getSize: jest.fn()\r\n    })),\r\n    Vector3: jest.fn().mockImplementation(() => ({\r\n        sub: jest.fn()\r\n    }))\r\n};\r\n\r\n(global as any).GLTFLoader = jest.fn().mockImplementation(() => ({\r\n    load: jest.fn()\r\n}));\r\n\r\n(global as any).OrbitControls = jest.fn().mockImplementation(() => ({\r\n    enableDamping: true,\r\n    dampingFactor: 0.05,\r\n    enableZoom: true,\r\n    enablePan: true,\r\n    enableRotate: true,\r\n    minPolarAngle: 0,\r\n    maxPolarAngle: Math.PI,\r\n    target: { set: jest.fn() },\r\n    update: jest.fn()\r\n}));\r\n\r\n(global as any).FreecadFile = jest.fn();\r\n\r\ndescribe('ThreeDModelProperty', () => {\r\n    let property: ThreeDModelProperty;\r\n    let mockVault: any;\r\n\r\n    beforeEach(() => {\r\n        // Reset all mocks\r\n        jest.clearAllMocks();\r\n        \r\n        // Create mock vault\r\n        mockVault = {\r\n            app: {\r\n                getFile: jest.fn().mockReturnValue({ path: 'test.gltf' }),\r\n                getAbsolutePath: jest.fn().mockReturnValue('/absolute/path/test.gltf'),\r\n                setIcon: jest.fn(),\r\n                vault: {\r\n                    getFiles: jest.fn().mockReturnValue([]),\r\n                    adapter: {\r\n                        getResourcePath: jest.fn().mockReturnValue('/mock/path')\r\n                    }\r\n                }\r\n            },\r\n            getMediaFromLink: jest.fn().mockReturnValue({\r\n                path: 'test.glb',\r\n                name: 'test.glb'\r\n            })\r\n        };\r\n\r\n        property = new ThreeDModelProperty('test3d', mockVault);\r\n        property.vault = mockVault;\r\n    });\r\n\r\n    describe('Constructor', () => {\r\n        it('should create a ThreeDModelProperty with correct type', () => {\r\n            expect(property.type).toBe('3dmodel');\r\n        });\r\n\r\n        it('should inherit from MediaProperty', () => {\r\n            expect(property).toBeInstanceOf(MediaProperty);\r\n        });\r\n\r\n        it('should set default icon to box', () => {\r\n            expect(property.icon).toBe('box');\r\n        });\r\n    });\r\n\r\n    describe('fillDisplay method', () => {\r\n        it('should handle 3D model files (gltf)', () => {\r\n            const mockUpdate = jest.fn();\r\n            \r\n            mockVault.getMediaFromLink.mockReturnValue({\r\n                path: 'model.gltf',\r\n                name: 'model.gltf'\r\n            });\r\n\r\n            mockVault.app.vault.getFiles.mockReturnValue([\r\n                { path: 'model.gltf' }\r\n            ]);\r\n\r\n            const result = property.fillDisplay(mockVault, '[[model.gltf]]', mockUpdate);\r\n            \r\n            expect(result).toBeInstanceOf(HTMLDivElement);\r\n            expect(result.classList.contains('embed-container')).toBe(true);\r\n        });\r\n\r\n        it('should handle 3D model files (glb)', () => {\r\n            const mockUpdate = jest.fn();\r\n            \r\n            mockVault.getMediaFromLink.mockReturnValue({\r\n                path: 'model.glb',\r\n                name: 'model.glb'\r\n            });\r\n\r\n            mockVault.app.vault.getFiles.mockReturnValue([\r\n                { path: 'model.glb' }\r\n            ]);\r\n\r\n            const result = property.fillDisplay(mockVault, '[[model.glb]]', mockUpdate);\r\n            \r\n            expect(result).toBeInstanceOf(HTMLDivElement);\r\n            expect(result.classList.contains('embed-container')).toBe(true);\r\n        });\r\n\r\n        it('should fallback to parent MediaProperty for non-3D files', () => {\r\n            const mockUpdate = jest.fn();\r\n            \r\n            mockVault.getMediaFromLink.mockReturnValue({\r\n                path: 'image.png',\r\n                name: 'image.png'\r\n            });\r\n\r\n            const result = property.fillDisplay('[[image.png]]', mockUpdate);\r\n            \r\n            // Should call parent method for non-3D files\r\n            expect(result).toBeInstanceOf(HTMLDivElement);\r\n        });\r\n\r\n        it('should handle missing media file', () => {\r\n            const mockUpdate = jest.fn();\r\n            \r\n            mockVault.getMediaFromLink.mockReturnValue(null);\r\n\r\n            const result = property.fillDisplay('[[missing.glb]]', mockUpdate);\r\n            \r\n            // Should call parent method when media file not found\r\n            expect(result).toBeInstanceOf(HTMLDivElement);\r\n        });\r\n    });\r\n\r\n    describe('render3DModel method', () => {\r\n        it('should create error message when file does not exist', () => {\r\n            const container = document.createElement('div');\r\n            \r\n            // Mock getFile to return null for missing file\r\n            mockVault.app.getFile.mockReturnValue(null);\r\n            \r\n            property['render3DModel']('missing.glb', container);\r\n            \r\n            expect(container.children.length).toBeGreaterThan(0);\r\n            const errorDiv = container.firstElementChild as HTMLDivElement;\r\n            expect(errorDiv.textContent).toContain('Rendu 3D introuvable');\r\n        });\r\n\r\n        it('should create canvas when file exists', () => {\r\n            const container = document.createElement('div');\r\n            \r\n            mockVault.app.vault.getFiles.mockReturnValue([\r\n                { path: 'test.glb' }\r\n            ]);\r\n            \r\n            property['render3DModel']('test.glb', container);\r\n            \r\n            expect(container.querySelector('canvas')).toBeTruthy();\r\n        });\r\n    });\r\n});\r\n"],"version":3}