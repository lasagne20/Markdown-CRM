7c87f3f78dd540d672a3d01c0203a926
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock des dépendances
jest.mock('../src/classes/Classe');
jest.mock('../src/vault/MyVault');
const FormulaProperty_1 = require("../src/properties/FormulaProperty");
describe('FormulaProperty', () => {
    let formulaProperty;
    let mockFile;
    let mockVault;
    beforeEach(() => {
        // Configuration des mocks
        mockVault = {
            app: {
                vault: {
                    getName: jest.fn().mockReturnValue('TestVault')
                }
            },
            readLinkFile: jest.fn()
        };
        mockFile = {
            vault: mockVault,
            getName: jest.fn(),
            getAllProperties: jest.fn(),
            getMetadataValue: jest.fn(),
            updateMetadata: jest.fn()
        };
        // Reset des mocks
        jest.clearAllMocks();
    });
    describe('Constructor', () => {
        test('should create formula property with default arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', '1 + 1');
            expect(formulaProperty.name).toBe('testFormula');
            expect(formulaProperty.formula).toBe('1 + 1');
            expect(formulaProperty.type).toBe('formula');
            expect(formulaProperty.write).toBe(false);
            expect(formulaProperty.static).toBe(true);
        });
        test('should create formula property with custom arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', '2 * 3', {
                icon: 'calculator',
                static: false,
                write: true
            });
            expect(formulaProperty.name).toBe('testFormula');
            expect(formulaProperty.formula).toBe('2 * 3');
            expect(formulaProperty.type).toBe('formula');
            expect(formulaProperty.write).toBe(true);
            expect(formulaProperty.static).toBe(false);
            expect(formulaProperty.icon).toBe('calculator');
        });
        test('should handle partial arguments', () => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('testFormula', 'x + y', {
                icon: 'math',
                write: true
                // static will use default value from FormulaProperty constructor (true)
            });
            expect(formulaProperty.write).toBe(true);
            // La valeur sera false car LinkProperty n'override pas le default de Property
            expect(formulaProperty.static).toBe(false);
            expect(formulaProperty.icon).toBe('math');
        });
    });
    describe('validate', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', '1 + 1');
        });
        test('should return input value unchanged', () => {
            expect(formulaProperty.validate('test')).toBe('test');
            expect(formulaProperty.validate('123')).toBe('123');
            expect(formulaProperty.validate('')).toBe('');
        });
    });
    describe('read', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('totalFormula', 'price * quantity');
            // Mock des propriétés du fichier
            mockFile.getAllProperties.mockReturnValue({
                price: { name: 'price' },
                quantity: { name: 'quantity' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getName.mockReturnValue('TestFile');
        });
        test('should execute simple arithmetic formula', () => {
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 10;
                if (key === 'quantity')
                    return 5;
                return null;
            });
            const result = formulaProperty.read(mockFile);
            expect(result).toBe(50);
        });
        test('should handle formula with return statement', () => {
            const formulaWithReturn = new FormulaProperty_1.FormulaProperty('test', 'return price + quantity');
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 15;
                if (key === 'quantity')
                    return 25;
                return null;
            });
            const result = formulaWithReturn.read(mockFile);
            expect(result).toBe(40);
        });
        test('should sanitize property names (remove spaces)', () => {
            mockFile.getAllProperties.mockReturnValue({
                'unit price': { name: 'unit price' },
                'item count': { name: 'item count' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'unit price')
                    return 12;
                if (key === 'item count')
                    return 3;
                return null;
            });
            const sanitizedFormula = new FormulaProperty_1.FormulaProperty('test', 'unitprice * itemcount');
            const result = sanitizedFormula.read(mockFile);
            expect(result).toBe(36);
        });
        test('should exclude self property from formula context', () => {
            mockFile.getAllProperties.mockReturnValue({
                price: { name: 'price' },
                totalFormula: { name: 'totalFormula' }
            });
            mockFile.getMetadataValue
                .mockImplementation((key) => {
                if (key === 'price')
                    return 100;
                if (key === 'totalFormula')
                    return 999; // Should be excluded
                return null;
            });
            const selfExcludingFormula = new FormulaProperty_1.FormulaProperty('totalFormula', 'price * 2');
            const result = selfExcludingFormula.read(mockFile);
            expect(result).toBe(200);
        });
        test('should handle formula errors gracefully (ReferenceError)', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockFile.getMetadataValue.mockReturnValue(null);
            const faultyFormula = new FormulaProperty_1.FormulaProperty('test', 'undefinedVariable * 5');
            const result = faultyFormula.read(mockFile);
            expect(result).toBeNull();
            // Test simple que console.error a été appelé avec le bon message
            expect(consoleSpy).toHaveBeenCalled();
            const errorCall = consoleSpy.mock.calls[0];
            expect(errorCall[0]).toContain('Formula error : undefinedVariable * 5');
            expect(errorCall[0]).toContain('This is all the properties available');
            consoleSpy.mockRestore();
        });
        test('should handle general formula errors', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockFile.getMetadataValue.mockReturnValue(null);
            const faultyFormula = new FormulaProperty_1.FormulaProperty('test', 'throw new Error("test error")');
            const result = faultyFormula.read(mockFile);
            expect(result).toBeNull();
            expect(consoleSpy).toHaveBeenCalledWith(expect.stringContaining('Formula error : throw new Error("test error")'));
            consoleSpy.mockRestore();
        });
        describe('write functionality', () => {
            test('should update metadata when write is true and value changed', () => {
                const writeFormula = new FormulaProperty_1.FormulaProperty('total', 'price + tax', {
                    icon: '',
                    write: true
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    if (key === 'total')
                        return 110; // Old value
                    return null;
                });
                const result = writeFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).toHaveBeenCalledWith('total', 120);
            });
            test('should not update metadata when write is true but value unchanged', () => {
                const writeFormula = new FormulaProperty_1.FormulaProperty('total', 'price + tax', {
                    icon: '',
                    write: true
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    if (key === 'total')
                        return 120; // Same as calculated
                    return null;
                });
                const result = writeFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).not.toHaveBeenCalled();
            });
            test('should not update metadata when write is false', () => {
                const readOnlyFormula = new FormulaProperty_1.FormulaProperty('total', 'price + tax', {
                    icon: '',
                    write: false
                });
                // Mock getAllProperties pour cette instance
                mockFile.getAllProperties.mockReturnValue({
                    price: { name: 'price' },
                    tax: { name: 'tax' },
                    total: { name: 'total' }
                });
                mockFile.getMetadataValue
                    .mockImplementation((key) => {
                    if (key === 'price')
                        return 100;
                    if (key === 'tax')
                        return 20;
                    return null;
                });
                const result = readOnlyFormula.read(mockFile);
                expect(result).toBe(120);
                expect(mockFile.updateMetadata).not.toHaveBeenCalled();
            });
        });
    });
    describe('getPretty', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', '1 + 1');
        });
        test('should return input if falsy', () => {
            expect(formulaProperty.getPretty('')).toBe('');
            expect(formulaProperty.getPretty(null)).toBe(null);
            expect(formulaProperty.getPretty(undefined)).toBe(undefined);
        });
        test('should handle non-string values', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            const numberValue = 123;
            const result = formulaProperty.getPretty(numberValue);
            expect(result).toBe(123);
            expect(consoleSpy).toHaveBeenCalledWith('Value is not a string:', 123);
            consoleSpy.mockRestore();
        });
        test('should format dates in French locale', () => {
            const dateString = '2023-12-25';
            const result = formulaProperty.getPretty(dateString);
            expect(result).toBe('25 décembre 2023');
        });
        test('should format integers with French locale formatting', () => {
            const integerString = '1234';
            const result = formulaProperty.getPretty(integerString);
            // Vérifions d'abord le résultat réel
            console.log('Actual result:', JSON.stringify(result));
            // Le format peut varier selon l'environnement, testons que c'est bien formaté
            expect(result).toMatch(/1[,\s]234[.,]00/);
        });
        test('should not format decimal numbers as integers', () => {
            const decimalString = '123.45';
            const result = formulaProperty.getPretty(decimalString);
            expect(result).toBe('123.45');
        });
        test('should clean URLs by removing protocols', () => {
            expect(formulaProperty.getPretty('https://example.com')).toBe('example.com');
            expect(formulaProperty.getPretty('http://test.org')).toBe('test.org');
        });
        test('should clean Obsidian links by removing brackets', () => {
            expect(formulaProperty.getPretty('[[Note Title]]')).toBe('Note Title');
        });
        test('should handle complex strings with multiple cleanups', () => {
            const complexString = 'https://[[example.com]]';
            const result = formulaProperty.getPretty(complexString);
            expect(result).toBe('example.com');
        });
        test('should return regular strings unchanged', () => {
            const regularString = 'Just a normal string';
            const result = formulaProperty.getPretty(regularString);
            expect(result).toBe('Just a normal string');
        });
    });
    describe('getLink', () => {
        beforeEach(() => {
            formulaProperty = new FormulaProperty_1.FormulaProperty('test', '1 + 1');
            formulaProperty.vault = mockVault;
        });
        test('should return input if falsy', () => {
            expect(formulaProperty.getLink('')).toBe('');
            expect(formulaProperty.getLink(null)).toBe(null);
            expect(formulaProperty.getLink(undefined)).toBe(undefined);
        });
        test('should create mailto links for emails', () => {
            expect(formulaProperty.getLink('test@example.com')).toBe('mailto:test@example.com');
            expect(formulaProperty.getLink('user.name+tag@domain.co.uk')).toBe('mailto:user.name+tag@domain.co.uk');
        });
        test('should handle Obsidian links', () => {
            mockVault.readLinkFile.mockReturnValue([null, 'path/to/file.md']);
            const result = formulaProperty.getLink('[[My Note]]');
            expect(result).toBe('obsidian://open?vault=TestVault&file=path%2Fto%2Ffile.md');
            expect(mockVault.readLinkFile).toHaveBeenCalledWith('My Note', true);
        });
        test('should handle Obsidian link errors gracefully', () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation(() => { });
            mockVault.readLinkFile.mockImplementation(() => {
                throw new Error('File not found');
            });
            const result = formulaProperty.getLink('[[Invalid Note]]');
            expect(result).toBe('[[Invalid Note]]');
            expect(consoleSpy).toHaveBeenCalledWith('Error parsing link for [[Invalid Note]]:', expect.any(Error));
            consoleSpy.mockRestore();
        });
        test('should handle URLs with protocols', () => {
            expect(formulaProperty.getLink('https://example.com')).toBe('https://example.com');
            expect(formulaProperty.getLink('http://test.org/path')).toBe('http://test.org/path');
        });
        test('should add protocol to URLs without them', () => {
            expect(formulaProperty.getLink('example.com')).toBe('http://example.com');
            expect(formulaProperty.getLink('test.org/path')).toBe('http://test.org/path');
        });
        test('should return regular strings unchanged', () => {
            const regularString = 'Just a normal string';
            const result = formulaProperty.getLink(regularString);
            expect(result).toBe('Just a normal string');
        });
        test('should handle invalid URL formats', () => {
            const invalidUrl = 'not-a-url';
            const result = formulaProperty.getLink(invalidUrl);
            expect(result).toBe('not-a-url');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXEZvcm11bGFQcm9wZXJ0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBSUEsdUJBQXVCO0FBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUNuQyxJQUFJLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFKbEMsdUVBQW9FO0FBTXBFLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDN0IsSUFBSSxlQUFnQyxDQUFDO0lBQ3JDLElBQUksUUFBNkIsQ0FBQztJQUNsQyxJQUFJLFNBQStCLENBQUM7SUFFcEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNaLDBCQUEwQjtRQUMxQixTQUFTLEdBQUc7WUFDUixHQUFHLEVBQUU7Z0JBQ0QsS0FBSyxFQUFFO29CQUNILE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQztpQkFDbEQ7YUFDSjtZQUNELFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ25CLENBQUM7UUFFVCxRQUFRLEdBQUc7WUFDUCxLQUFLLEVBQUUsU0FBUztZQUNoQixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNsQixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzNCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDM0IsY0FBYyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDckIsQ0FBQztRQUVULGtCQUFrQjtRQUNsQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDekIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUN6QixJ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QWUsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7WUFFbkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNyQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXEZvcm11bGFQcm9wZXJ0eS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENsYXNzZSB9IGZyb20gJy4uL3NyYy9jbGFzc2VzL0NsYXNzZSc7XHJcbmltcG9ydCB7IE15VmF1bHQgfSBmcm9tICcuLi9zcmMvdmF1bHQvTXlWYXVsdCc7XHJcbmltcG9ydCB7IEZvcm11bGFQcm9wZXJ0eSB9IGZyb20gJy4uL3NyYy9wcm9wZXJ0aWVzL0Zvcm11bGFQcm9wZXJ0eSc7XHJcblxyXG4vLyBNb2NrIGRlcyBkw6lwZW5kYW5jZXNcclxuamVzdC5tb2NrKCcuLi9zcmMvY2xhc3Nlcy9DbGFzc2UnKTtcclxuamVzdC5tb2NrKCcuLi9zcmMvdmF1bHQvTXlWYXVsdCcpO1xyXG5cclxuZGVzY3JpYmUoJ0Zvcm11bGFQcm9wZXJ0eScsICgpID0+IHtcclxuICAgIGxldCBmb3JtdWxhUHJvcGVydHk6IEZvcm11bGFQcm9wZXJ0eTtcclxuICAgIGxldCBtb2NrRmlsZTogamVzdC5Nb2NrZWQ8Q2xhc3NlPjtcclxuICAgIGxldCBtb2NrVmF1bHQ6IGplc3QuTW9ja2VkPE15VmF1bHQ+O1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIC8vIENvbmZpZ3VyYXRpb24gZGVzIG1vY2tzXHJcbiAgICAgICAgbW9ja1ZhdWx0ID0ge1xyXG4gICAgICAgICAgICBhcHA6IHtcclxuICAgICAgICAgICAgICAgIHZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0TmFtZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgnVGVzdFZhdWx0JylcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcmVhZExpbmtGaWxlOiBqZXN0LmZuKClcclxuICAgICAgICB9IGFzIGFueTtcclxuXHJcbiAgICAgICAgbW9ja0ZpbGUgPSB7XHJcbiAgICAgICAgICAgIHZhdWx0OiBtb2NrVmF1bHQsXHJcbiAgICAgICAgICAgIGdldE5hbWU6IGplc3QuZm4oKSxcclxuICAgICAgICAgICAgZ2V0QWxsUHJvcGVydGllczogamVzdC5mbigpLFxyXG4gICAgICAgICAgICBnZXRNZXRhZGF0YVZhbHVlOiBqZXN0LmZuKCksXHJcbiAgICAgICAgICAgIHVwZGF0ZU1ldGFkYXRhOiBqZXN0LmZuKClcclxuICAgICAgICB9IGFzIGFueTtcclxuXHJcbiAgICAgICAgLy8gUmVzZXQgZGVzIG1vY2tzXHJcbiAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnQ29uc3RydWN0b3InLCAoKSA9PiB7XHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGNyZWF0ZSBmb3JtdWxhIHByb3BlcnR5IHdpdGggZGVmYXVsdCBhcmd1bWVudHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGZvcm11bGFQcm9wZXJ0eSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3Rlc3RGb3JtdWxhJywgJzEgKyAxJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5Lm5hbWUpLnRvQmUoJ3Rlc3RGb3JtdWxhJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZm9ybXVsYSkudG9CZSgnMSArIDEnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS50eXBlKS50b0JlKCdmb3JtdWxhJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkud3JpdGUpLnRvQmUoZmFsc2UpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LnN0YXRpYykudG9CZSh0cnVlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGNyZWF0ZSBmb3JtdWxhIHByb3BlcnR5IHdpdGggY3VzdG9tIGFyZ3VtZW50cycsICgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdEZvcm11bGEnLCAnMiAqIDMnLCB7XHJcbiAgICAgICAgICAgICAgICBpY29uOiAnY2FsY3VsYXRvcicsXHJcbiAgICAgICAgICAgICAgICBzdGF0aWM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgd3JpdGU6IHRydWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5Lm5hbWUpLnRvQmUoJ3Rlc3RGb3JtdWxhJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZm9ybXVsYSkudG9CZSgnMiAqIDMnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS50eXBlKS50b0JlKCdmb3JtdWxhJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkud3JpdGUpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuc3RhdGljKS50b0JlKGZhbHNlKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5pY29uKS50b0JlKCdjYWxjdWxhdG9yJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgcGFydGlhbCBhcmd1bWVudHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGZvcm11bGFQcm9wZXJ0eSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3Rlc3RGb3JtdWxhJywgJ3ggKyB5Jywge1xyXG4gICAgICAgICAgICAgICAgaWNvbjogJ21hdGgnLFxyXG4gICAgICAgICAgICAgICAgd3JpdGU6IHRydWVcclxuICAgICAgICAgICAgICAgIC8vIHN0YXRpYyB3aWxsIHVzZSBkZWZhdWx0IHZhbHVlIGZyb20gRm9ybXVsYVByb3BlcnR5IGNvbnN0cnVjdG9yICh0cnVlKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkud3JpdGUpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgICAgIC8vIExhIHZhbGV1ciBzZXJhIGZhbHNlIGNhciBMaW5rUHJvcGVydHkgbidvdmVycmlkZSBwYXMgbGUgZGVmYXVsdCBkZSBQcm9wZXJ0eVxyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LnN0YXRpYykudG9CZShmYWxzZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuaWNvbikudG9CZSgnbWF0aCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ3ZhbGlkYXRlJywgKCkgPT4ge1xyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICBmb3JtdWxhUHJvcGVydHkgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0ZXN0JywgJzEgKyAxJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gaW5wdXQgdmFsdWUgdW5jaGFuZ2VkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LnZhbGlkYXRlKCd0ZXN0JykpLnRvQmUoJ3Rlc3QnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS52YWxpZGF0ZSgnMTIzJykpLnRvQmUoJzEyMycpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LnZhbGlkYXRlKCcnKSkudG9CZSgnJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgncmVhZCcsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndG90YWxGb3JtdWxhJywgJ3ByaWNlICogcXVhbnRpdHknKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIE1vY2sgZGVzIHByb3ByacOpdMOpcyBkdSBmaWNoaWVyXHJcbiAgICAgICAgICAgIG1vY2tGaWxlLmdldEFsbFByb3BlcnRpZXMubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgIHByaWNlOiB7IG5hbWU6ICdwcmljZScgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICBxdWFudGl0eTogeyBuYW1lOiAncXVhbnRpdHknIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgdG90YWxGb3JtdWxhOiB7IG5hbWU6ICd0b3RhbEZvcm11bGEnIH0gYXMgYW55XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TmFtZS5tb2NrUmV0dXJuVmFsdWUoJ1Rlc3RGaWxlJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBleGVjdXRlIHNpbXBsZSBhcml0aG1ldGljIGZvcm11bGEnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIG1vY2tGaWxlLmdldE1ldGFkYXRhVmFsdWVcclxuICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3ByaWNlJykgcmV0dXJuIDEwO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdxdWFudGl0eScpIHJldHVybiA1O1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoNTApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGZvcm11bGEgd2l0aCByZXR1cm4gc3RhdGVtZW50JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBmb3JtdWxhV2l0aFJldHVybiA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3Rlc3QnLCAncmV0dXJuIHByaWNlICsgcXVhbnRpdHknKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG1vY2tGaWxlLmdldE1ldGFkYXRhVmFsdWVcclxuICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3ByaWNlJykgcmV0dXJuIDE1O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdxdWFudGl0eScpIHJldHVybiAyNTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVdpdGhSZXR1cm4ucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoNDApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgc2FuaXRpemUgcHJvcGVydHkgbmFtZXMgKHJlbW92ZSBzcGFjZXMpJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBtb2NrRmlsZS5nZXRBbGxQcm9wZXJ0aWVzLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICAndW5pdCBwcmljZSc6IHsgbmFtZTogJ3VuaXQgcHJpY2UnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgJ2l0ZW0gY291bnQnOiB7IG5hbWU6ICdpdGVtIGNvdW50JyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgIHRvdGFsRm9ybXVsYTogeyBuYW1lOiAndG90YWxGb3JtdWxhJyB9IGFzIGFueVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG1vY2tGaWxlLmdldE1ldGFkYXRhVmFsdWVcclxuICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3VuaXQgcHJpY2UnKSByZXR1cm4gMTI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ2l0ZW0gY291bnQnKSByZXR1cm4gMztcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc2FuaXRpemVkRm9ybXVsYSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3Rlc3QnLCAndW5pdHByaWNlICogaXRlbWNvdW50Jyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHNhbml0aXplZEZvcm11bGEucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMzYpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgZXhjbHVkZSBzZWxmIHByb3BlcnR5IGZyb20gZm9ybXVsYSBjb250ZXh0JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBtb2NrRmlsZS5nZXRBbGxQcm9wZXJ0aWVzLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICBwcmljZTogeyBuYW1lOiAncHJpY2UnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgdG90YWxGb3JtdWxhOiB7IG5hbWU6ICd0b3RhbEZvcm11bGEnIH0gYXMgYW55XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAncHJpY2UnKSByZXR1cm4gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd0b3RhbEZvcm11bGEnKSByZXR1cm4gOTk5OyAvLyBTaG91bGQgYmUgZXhjbHVkZWRcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc2VsZkV4Y2x1ZGluZ0Zvcm11bGEgPSBuZXcgRm9ybXVsYVByb3BlcnR5KCd0b3RhbEZvcm11bGEnLCAncHJpY2UgKiAyJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHNlbGZFeGNsdWRpbmdGb3JtdWxhLnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKDIwMCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgZm9ybXVsYSBlcnJvcnMgZ3JhY2VmdWxseSAoUmVmZXJlbmNlRXJyb3IpJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZS5tb2NrUmV0dXJuVmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBmYXVsdHlGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsICd1bmRlZmluZWRWYXJpYWJsZSAqIDUnKTtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZmF1bHR5Rm9ybXVsYS5yZWFkKG1vY2tGaWxlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XHJcbiAgICAgICAgICAgIC8vIFRlc3Qgc2ltcGxlIHF1ZSBjb25zb2xlLmVycm9yIGEgw6l0w6kgYXBwZWzDqSBhdmVjIGxlIGJvbiBtZXNzYWdlXHJcbiAgICAgICAgICAgIGV4cGVjdChjb25zb2xlU3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGVycm9yQ2FsbCA9IGNvbnNvbGVTcHkubW9jay5jYWxsc1swXTtcclxuICAgICAgICAgICAgZXhwZWN0KGVycm9yQ2FsbFswXSkudG9Db250YWluKCdGb3JtdWxhIGVycm9yIDogdW5kZWZpbmVkVmFyaWFibGUgKiA1Jyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChlcnJvckNhbGxbMF0pLnRvQ29udGFpbignVGhpcyBpcyBhbGwgdGhlIHByb3BlcnRpZXMgYXZhaWxhYmxlJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgZ2VuZXJhbCBmb3JtdWxhIGVycm9ycycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG1vY2tGaWxlLmdldE1ldGFkYXRhVmFsdWUubW9ja1JldHVyblZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgZmF1bHR5Rm9ybXVsYSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3Rlc3QnLCAndGhyb3cgbmV3IEVycm9yKFwidGVzdCBlcnJvclwiKScpO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmYXVsdHlGb3JtdWxhLnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnNvbGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ0Zvcm11bGEgZXJyb3IgOiB0aHJvdyBuZXcgRXJyb3IoXCJ0ZXN0IGVycm9yXCIpJylcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZGVzY3JpYmUoJ3dyaXRlIGZ1bmN0aW9uYWxpdHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRlc3QoJ3Nob3VsZCB1cGRhdGUgbWV0YWRhdGEgd2hlbiB3cml0ZSBpcyB0cnVlIGFuZCB2YWx1ZSBjaGFuZ2VkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgd3JpdGVGb3JtdWxhID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndG90YWwnLCAncHJpY2UgKyB0YXgnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGU6IHRydWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE1vY2sgZ2V0QWxsUHJvcGVydGllcyBwb3VyIGNldHRlIGluc3RhbmNlXHJcbiAgICAgICAgICAgICAgICBtb2NrRmlsZS5nZXRBbGxQcm9wZXJ0aWVzLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpY2U6IHsgbmFtZTogJ3ByaWNlJyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgICAgICB0YXg6IHsgbmFtZTogJ3RheCcgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IHsgbmFtZTogJ3RvdGFsJyB9IGFzIGFueVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0TWV0YWRhdGFWYWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdwcmljZScpIHJldHVybiAxMDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd0YXgnKSByZXR1cm4gMjA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICd0b3RhbCcpIHJldHVybiAxMTA7IC8vIE9sZCB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB3cml0ZUZvcm11bGEucmVhZChtb2NrRmlsZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMTIwKTtcclxuICAgICAgICAgICAgICAgIGV4cGVjdChtb2NrRmlsZS51cGRhdGVNZXRhZGF0YSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3RvdGFsJywgMTIwKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0ZXN0KCdzaG91bGQgbm90IHVwZGF0ZSBtZXRhZGF0YSB3aGVuIHdyaXRlIGlzIHRydWUgYnV0IHZhbHVlIHVuY2hhbmdlZCcsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdyaXRlRm9ybXVsYSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3RvdGFsJywgJ3ByaWNlICsgdGF4Jywge1xyXG4gICAgICAgICAgICAgICAgICAgIGljb246ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlOiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBNb2NrIGdldEFsbFByb3BlcnRpZXMgcG91ciBjZXR0ZSBpbnN0YW5jZVxyXG4gICAgICAgICAgICAgICAgbW9ja0ZpbGUuZ2V0QWxsUHJvcGVydGllcy5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgICAgIHByaWNlOiB7IG5hbWU6ICdwcmljZScgfSBhcyBhbnksXHJcbiAgICAgICAgICAgICAgICAgICAgdGF4OiB7IG5hbWU6ICd0YXgnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiB7IG5hbWU6ICd0b3RhbCcgfSBhcyBhbnlcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIG1vY2tGaWxlLmdldE1ldGFkYXRhVmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uKChrZXk6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAncHJpY2UnKSByZXR1cm4gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAndGF4JykgcmV0dXJuIDIwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAndG90YWwnKSByZXR1cm4gMTIwOyAvLyBTYW1lIGFzIGNhbGN1bGF0ZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gd3JpdGVGb3JtdWxhLnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKDEyMCk7XHJcbiAgICAgICAgICAgICAgICBleHBlY3QobW9ja0ZpbGUudXBkYXRlTWV0YWRhdGEpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdGVzdCgnc2hvdWxkIG5vdCB1cGRhdGUgbWV0YWRhdGEgd2hlbiB3cml0ZSBpcyBmYWxzZScsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlYWRPbmx5Rm9ybXVsYSA9IG5ldyBGb3JtdWxhUHJvcGVydHkoJ3RvdGFsJywgJ3ByaWNlICsgdGF4Jywge1xyXG4gICAgICAgICAgICAgICAgICAgIGljb246ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gTW9jayBnZXRBbGxQcm9wZXJ0aWVzIHBvdXIgY2V0dGUgaW5zdGFuY2VcclxuICAgICAgICAgICAgICAgIG1vY2tGaWxlLmdldEFsbFByb3BlcnRpZXMubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgICAgICBwcmljZTogeyBuYW1lOiAncHJpY2UnIH0gYXMgYW55LFxyXG4gICAgICAgICAgICAgICAgICAgIHRheDogeyBuYW1lOiAndGF4JyB9IGFzIGFueSxcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogeyBuYW1lOiAndG90YWwnIH0gYXMgYW55XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBtb2NrRmlsZS5nZXRNZXRhZGF0YVZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoa2V5OiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3ByaWNlJykgcmV0dXJuIDEwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3RheCcpIHJldHVybiAyMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcmVhZE9ubHlGb3JtdWxhLnJlYWQobW9ja0ZpbGUpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKDEyMCk7XHJcbiAgICAgICAgICAgICAgICBleHBlY3QobW9ja0ZpbGUudXBkYXRlTWV0YWRhdGEpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ2dldFByZXR0eScsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsICcxICsgMScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIGlucHV0IGlmIGZhbHN5JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eSgnJykpLnRvQmUoJycpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eShudWxsIGFzIGFueSkpLnRvQmUobnVsbCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KHVuZGVmaW5lZCBhcyBhbnkpKS50b0JlKHVuZGVmaW5lZCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgbm9uLXN0cmluZyB2YWx1ZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBudW1iZXJWYWx1ZSA9IDEyMyBhcyBhbnk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkobnVtYmVyVmFsdWUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgxMjMpO1xyXG4gICAgICAgICAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1ZhbHVlIGlzIG5vdCBhIHN0cmluZzonLCAxMjMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgZm9ybWF0IGRhdGVzIGluIEZyZW5jaCBsb2NhbGUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGVTdHJpbmcgPSAnMjAyMy0xMi0yNSc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoZGF0ZVN0cmluZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCcyNSBkw6ljZW1icmUgMjAyMycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgZm9ybWF0IGludGVnZXJzIHdpdGggRnJlbmNoIGxvY2FsZSBmb3JtYXR0aW5nJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbnRlZ2VyU3RyaW5nID0gJzEyMzQnO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KGludGVnZXJTdHJpbmcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gVsOpcmlmaW9ucyBkJ2Fib3JkIGxlIHLDqXN1bHRhdCByw6llbFxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQWN0dWFsIHJlc3VsdDonLCBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTtcclxuICAgICAgICAgICAgLy8gTGUgZm9ybWF0IHBldXQgdmFyaWVyIHNlbG9uIGwnZW52aXJvbm5lbWVudCwgdGVzdG9ucyBxdWUgYydlc3QgYmllbiBmb3JtYXTDqVxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b01hdGNoKC8xWyxcXHNdMjM0Wy4sXTAwLyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBub3QgZm9ybWF0IGRlY2ltYWwgbnVtYmVycyBhcyBpbnRlZ2VycycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGVjaW1hbFN0cmluZyA9ICcxMjMuNDUnO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KGRlY2ltYWxTdHJpbmcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnMTIzLjQ1Jyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBjbGVhbiBVUkxzIGJ5IHJlbW92aW5nIHByb3RvY29scycsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoJ2h0dHBzOi8vZXhhbXBsZS5jb20nKSkudG9CZSgnZXhhbXBsZS5jb20nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRQcmV0dHkoJ2h0dHA6Ly90ZXN0Lm9yZycpKS50b0JlKCd0ZXN0Lm9yZycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgY2xlYW4gT2JzaWRpYW4gbGlua3MgYnkgcmVtb3ZpbmcgYnJhY2tldHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KCdbW05vdGUgVGl0bGVdXScpKS50b0JlKCdOb3RlIFRpdGxlJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgY29tcGxleCBzdHJpbmdzIHdpdGggbXVsdGlwbGUgY2xlYW51cHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXhTdHJpbmcgPSAnaHR0cHM6Ly9bW2V4YW1wbGUuY29tXV0nO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBmb3JtdWxhUHJvcGVydHkuZ2V0UHJldHR5KGNvbXBsZXhTdHJpbmcpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnZXhhbXBsZS5jb20nKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIHJldHVybiByZWd1bGFyIHN0cmluZ3MgdW5jaGFuZ2VkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZWd1bGFyU3RyaW5nID0gJ0p1c3QgYSBub3JtYWwgc3RyaW5nJztcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldFByZXR0eShyZWd1bGFyU3RyaW5nKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoJ0p1c3QgYSBub3JtYWwgc3RyaW5nJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnZ2V0TGluaycsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgZm9ybXVsYVByb3BlcnR5ID0gbmV3IEZvcm11bGFQcm9wZXJ0eSgndGVzdCcsICcxICsgMScpO1xyXG4gICAgICAgICAgICBmb3JtdWxhUHJvcGVydHkudmF1bHQgPSBtb2NrVmF1bHQ7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gaW5wdXQgaWYgZmFsc3knLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluaygnJykpLnRvQmUoJycpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsobnVsbCBhcyBhbnkpKS50b0JlKG51bGwpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsodW5kZWZpbmVkIGFzIGFueSkpLnRvQmUodW5kZWZpbmVkKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIGNyZWF0ZSBtYWlsdG8gbGlua3MgZm9yIGVtYWlscycsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKCd0ZXN0QGV4YW1wbGUuY29tJykpLnRvQmUoJ21haWx0bzp0ZXN0QGV4YW1wbGUuY29tJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmb3JtdWxhUHJvcGVydHkuZ2V0TGluaygndXNlci5uYW1lK3RhZ0Bkb21haW4uY28udWsnKSkudG9CZSgnbWFpbHRvOnVzZXIubmFtZSt0YWdAZG9tYWluLmNvLnVrJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgT2JzaWRpYW4gbGlua3MnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIG1vY2tWYXVsdC5yZWFkTGlua0ZpbGUubW9ja1JldHVyblZhbHVlKFtudWxsLCAncGF0aC90by9maWxlLm1kJ10gYXMgYW55KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKCdbW015IE5vdGVdXScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgnb2JzaWRpYW46Ly9vcGVuP3ZhdWx0PVRlc3RWYXVsdCZmaWxlPXBhdGglMkZ0byUyRmZpbGUubWQnKTtcclxuICAgICAgICAgICAgZXhwZWN0KG1vY2tWYXVsdC5yZWFkTGlua0ZpbGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdNeSBOb3RlJywgdHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgT2JzaWRpYW4gbGluayBlcnJvcnMgZ3JhY2VmdWxseScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHt9KTtcclxuICAgICAgICAgICAgbW9ja1ZhdWx0LnJlYWRMaW5rRmlsZS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGaWxlIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKCdbW0ludmFsaWQgTm90ZV1dJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdbW0ludmFsaWQgTm90ZV1dJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb25zb2xlU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAgICAgICAgICdFcnJvciBwYXJzaW5nIGxpbmsgZm9yIFtbSW52YWxpZCBOb3RlXV06JyxcclxuICAgICAgICAgICAgICAgIGV4cGVjdC5hbnkoRXJyb3IpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgVVJMcyB3aXRoIHByb3RvY29scycsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKCdodHRwczovL2V4YW1wbGUuY29tJykpLnRvQmUoJ2h0dHBzOi8vZXhhbXBsZS5jb20nKTtcclxuICAgICAgICAgICAgZXhwZWN0KGZvcm11bGFQcm9wZXJ0eS5nZXRMaW5rKCdodHRwOi8vdGVzdC5vcmcvcGF0aCcpKS50b0JlKCdodHRwOi8vdGVzdC5vcmcvcGF0aCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgYWRkIHByb3RvY29sIHRvIFVSTHMgd2l0aG91dCB0aGVtJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ2V4YW1wbGUuY29tJykpLnRvQmUoJ2h0dHA6Ly9leGFtcGxlLmNvbScpO1xyXG4gICAgICAgICAgICBleHBlY3QoZm9ybXVsYVByb3BlcnR5LmdldExpbmsoJ3Rlc3Qub3JnL3BhdGgnKSkudG9CZSgnaHR0cDovL3Rlc3Qub3JnL3BhdGgnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGVzdCgnc2hvdWxkIHJldHVybiByZWd1bGFyIHN0cmluZ3MgdW5jaGFuZ2VkJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZWd1bGFyU3RyaW5nID0gJ0p1c3QgYSBub3JtYWwgc3RyaW5nJztcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldExpbmsocmVndWxhclN0cmluZyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdKdXN0IGEgbm9ybWFsIHN0cmluZycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgVVJMIGZvcm1hdHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGludmFsaWRVcmwgPSAnbm90LWEtdXJsJztcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm9ybXVsYVByb3BlcnR5LmdldExpbmsoaW52YWxpZFVybCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdub3QtYS11cmwnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9