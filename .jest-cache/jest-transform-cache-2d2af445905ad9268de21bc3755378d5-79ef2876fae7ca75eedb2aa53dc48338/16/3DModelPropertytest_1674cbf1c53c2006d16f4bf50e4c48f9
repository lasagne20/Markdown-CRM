a38f7ddc545a0356cb00da8977c76ac4
"use strict";
/**
 * @jest-environment jsdom
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock complex dependencies
jest.mock('../../src/vault/Utils', () => ({
    setIcon: jest.fn()
}));
const _3DModelProperty_1 = require("../../src/properties/3DModelProperty");
const MediaProperty_1 = require("../../src/properties/MediaProperty");
// Mock external dependencies
global.Notice = jest.fn();
global.selectMedia = jest.fn();
global.shell = {
    openPath: jest.fn()
};
// Mock THREE.js dependencies
global.THREE = {
    WebGLRenderer: jest.fn().mockImplementation(() => ({
        setSize: jest.fn(),
        domElement: document.createElement('canvas'),
        render: jest.fn()
    })),
    Scene: jest.fn().mockImplementation(() => ({
        add: jest.fn()
    })),
    PerspectiveCamera: jest.fn().mockImplementation(() => ({
        position: { set: jest.fn() },
        up: { set: jest.fn() },
        lookAt: jest.fn()
    })),
    DirectionalLight: jest.fn().mockImplementation(() => ({
        position: { set: jest.fn() },
        target: { position: { set: jest.fn() } }
    })),
    AmbientLight: jest.fn(),
    Box3: jest.fn().mockImplementation(() => ({
        setFromObject: jest.fn().mockReturnThis(),
        getCenter: jest.fn(),
        getSize: jest.fn()
    })),
    Vector3: jest.fn().mockImplementation(() => ({
        sub: jest.fn()
    }))
};
global.GLTFLoader = jest.fn().mockImplementation(() => ({
    load: jest.fn()
}));
global.OrbitControls = jest.fn().mockImplementation(() => ({
    enableDamping: true,
    dampingFactor: 0.05,
    enableZoom: true,
    enablePan: true,
    enableRotate: true,
    minPolarAngle: 0,
    maxPolarAngle: Math.PI,
    target: { set: jest.fn() },
    update: jest.fn()
}));
global.FreecadFile = jest.fn();
describe('ThreeDModelProperty', () => {
    let property;
    let mockVault;
    beforeEach(() => {
        // Reset all mocks
        jest.clearAllMocks();
        // Create mock vault
        mockVault = {
            app: {
                vault: {
                    getFiles: jest.fn().mockReturnValue([]),
                    adapter: {
                        getResourcePath: jest.fn().mockReturnValue('/mock/path')
                    }
                }
            },
            getMediaFromLink: jest.fn().mockReturnValue({
                path: 'test.glb',
                name: 'test.glb'
            })
        };
        property = new _3DModelProperty_1.ThreeDModelProperty('test3d', mockVault, mockVault);
        property.vault = mockVault;
    });
    describe('Constructor', () => {
        it('should create a ThreeDModelProperty with correct type', () => {
            expect(property.type).toBe('3dmodel');
        });
        it('should inherit from MediaProperty', () => {
            expect(property).toBeInstanceOf(MediaProperty_1.MediaProperty);
        });
        it('should set default icon to box', () => {
            expect(property.icon).toBe('box');
        });
    });
    describe('fillDisplay method', () => {
        it('should handle 3D model files (gltf)', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'model.gltf',
                name: 'model.gltf'
            });
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'model.gltf' }
            ]);
            const result = property.fillDisplay('[[model.gltf]]', mockUpdate);
            expect(result).toBeInstanceOf(HTMLDivElement);
            expect(result.classList.contains('embed-container')).toBe(true);
        });
        it('should handle 3D model files (glb)', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'model.glb',
                name: 'model.glb'
            });
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'model.glb' }
            ]);
            const result = property.fillDisplay('[[model.glb]]', mockUpdate);
            expect(result).toBeInstanceOf(HTMLDivElement);
            expect(result.classList.contains('embed-container')).toBe(true);
        });
        it('should fallback to parent MediaProperty for non-3D files', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue({
                path: 'image.png',
                name: 'image.png'
            });
            const result = property.fillDisplay('[[image.png]]', mockUpdate);
            // Should call parent method for non-3D files
            expect(result).toBeInstanceOf(HTMLDivElement);
        });
        it('should handle missing media file', () => {
            const mockUpdate = jest.fn();
            mockVault.getMediaFromLink.mockReturnValue(null);
            const result = property.fillDisplay('[[missing.glb]]', mockUpdate);
            // Should call parent method when media file not found
            expect(result).toBeInstanceOf(HTMLDivElement);
        });
    });
    describe('render3DModel method', () => {
        it('should create error message when file does not exist', () => {
            const container = document.createElement('div');
            mockVault.app.vault.getFiles.mockReturnValue([]);
            property['render3DModel']('missing.glb', container);
            expect(container.children.length).toBeGreaterThan(0);
            const errorDiv = container.firstElementChild;
            expect(errorDiv.textContent).toContain('Rendu 3D introuvable');
        });
        it('should create canvas when file exists', () => {
            const container = document.createElement('div');
            mockVault.app.vault.getFiles.mockReturnValue([
                { path: 'test.glb' }
            ]);
            property['render3DModel']('test.glb', container);
            expect(container.querySelector('canvas')).toBeTruthy();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxfX3Rlc3RzX19cXFByb3BlcnRpZXNcXDNETW9kZWxQcm9wZXJ0eS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFLSCw0QkFBNEI7QUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ3JCLENBQUMsQ0FBQyxDQUFDO0FBTkosMkVBQTJFO0FBQzNFLHNFQUFtRTtBQU9uRSw2QkFBNkI7QUFDNUIsTUFBYyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDbEMsTUFBYyxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDdkMsTUFBYyxDQUFDLEtBQUssR0FBRztJQUNwQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUN0QixDQUFDO0FBRUYsNkJBQTZCO0FBQzVCLE1BQWMsQ0FBQyxLQUFLLEdBQUc7SUFDcEIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLFVBQVUsRUFBRSxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQztRQUM1QyxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNwQixDQUFDLENBQUM7SUFDSCxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDdkMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDakIsQ0FBQyxDQUFDO0lBQ0gsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDbkQsUUFBUSxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRTtRQUM1QixFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFO1FBQ3RCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ3BCLENBQUMsQ0FBQztJQUNILGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2xELFFBQVEsRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUU7UUFDNUIsTUFBTSxFQUFFLEVBQUUsUUFBUSxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFO0tBQzNDLENBQUMsQ0FBQztJQUNILFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3ZCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUN0QyxhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGNBQWMsRUFBRTtRQUN6QyxTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNwQixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNyQixDQUFDLENBQUM7SUFDSCxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDekMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDakIsQ0FBQyxDQUFDO0NBQ04sQ0FBQztBQUVELE1BQWMsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDN0QsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDbEIsQ0FBQyxDQUFDLENBQUM7QUFFSCxNQUFjLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2hFLGFBQWEsRUFBRSxJQUFJO0lBQ25CLGFBQWEsRUFBRSxJQUFJO0lBQ25CLFVBQVUsRUFBRSxJQUFJO0lBQ2hCLFNBQVMsRUFBRSxJQUFJO0lBQ2YsWUFBWSxFQUFFLElBQUk7SUFDbEIsYUFBYSxFQUFFLENBQUM7SUFDaEIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFO0lBQ3RCLE1BQU0sRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUU7SUFDMUIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDcEIsQ0FBQyxDQUFDLENBQUM7QUFFSCxNQUFjLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUV4QyxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ2pDLElBQUksUUFBNkIsQ0FBQztJQUNsQyxJQUFJLFNBQWMsQ0FBQztJQUVuQixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ1osa0JBQWtCO1FBQ2xCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUVyQixvQkFBb0I7UUFDcEIsU0FBUyxHQUFHO1lBQ1IsR0FBRyxFQUFFO2dCQUNELEtBQUssRUFBRTtvQkFDSCxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7b0JBQ3ZDLE9BQU8sRUFBRTt3QkFDTCxlQUFlLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUM7cUJBQzNEO2lCQUNKO2FBQ0o7WUFDRCxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDO2dCQUN4QyxJQUFJLEVBQUUsVUFBVTtnQkFDaEIsSUFBSSxFQUFFLFVBQVU7YUFDbkIsQ0FBQztTQUNMLENBQUM7UUFFRixRQUFRLEdBQUcsSUFBSSxzQ0FBbUIsQ0FBQyxRQUFRLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ25FLFFBQVEsQ0FBQyxLQUFLLEdBQUcsU0FBUyxDQUFDO0lBQy9CLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDekIsRUFBRSxDQUFDLHVEQUF1RCxFQUFFLEdBQUcsRUFBRTtZQUM3RCxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMxQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUU7WUFDekMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLGNBQWMsQ0FBQyw2QkFBYSxDQUFDLENBQUM7UUFDbkQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO1lBQ3RDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7WUFDM0MsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBRTdCLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxlQUFlLENBQUM7Z0JBQ3ZDLElBQUksRUFBRSxZQUFZO2dCQUNsQixJQUFJLEVBQUUsWUFBWTthQUNyQixDQUFDLENBQUM7WUFFSCxTQUFTLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDO2dCQUN6QyxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUU7YUFDekIsQ0FBQyxDQUFDO1lBRUgsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUVsRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtZQUMxQyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7WUFFN0IsU0FBUyxDQUFDLGdCQUFnQixDQUFDLGVBQWUsQ0FBQztnQkFDdkMsSUFBSSxFQUFFLFdBQVc7Z0JBQ2pCLElBQUksRUFBRSxXQUFXO2FBQ3BCLENBQUMsQ0FBQztZQUVILFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUM7Z0JBQ3pDLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRTthQUN4QixDQUFDLENBQUM7WUFFSCxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDLGVBQWUsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUVqRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDBEQUEwRCxFQUFFLEdBQUcsRUFBRTtZQUNoRSxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7WUFFN0IsU0FBUyxDQUFDLGdCQUFnQixDQUFDLGVBQWUsQ0FBQztnQkFDdkMsSUFBSSxFQUFFLFdBQVc7Z0JBQ2pCLElBQUksRUFBRSxXQUFXO2FBQ3BCLENBQUMsQ0FBQztZQUVILE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxXQUFXLENBQUMsZUFBZSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBRWpFLDZDQUE2QztZQUM3QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ2xELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtZQUN4QyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7WUFFN0IsU0FBUyxDQUFDLGdCQUFnQixDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVqRCxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDLGlCQUFpQixFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBRW5FLHNEQUFzRDtZQUN0RCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ2xELENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1FBQ2xDLEVBQUUsQ0FBQyxzREFBc0QsRUFBRSxHQUFHLEVBQUU7WUFDNUQsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVoRCxTQUFTLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRWpELFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQyxhQUFhLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFFcEQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JELE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxpQkFBbUMsQ0FBQztZQUMvRCxNQUFNLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQ25FLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUM3QyxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRWhELFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUM7Z0JBQ3pDLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRTthQUN2QixDQUFDLENBQUM7WUFFSCxRQUFRLENBQUMsZUFBZSxDQUFDLENBQUMsVUFBVSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBRWpELE1BQU0sQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDM0QsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcX190ZXN0c19fXFxQcm9wZXJ0aWVzXFwzRE1vZGVsUHJvcGVydHkudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQGplc3QtZW52aXJvbm1lbnQganNkb21cclxuICovXHJcblxyXG5pbXBvcnQgeyBUaHJlZURNb2RlbFByb3BlcnR5IH0gZnJvbSAnLi4vLi4vc3JjL3Byb3BlcnRpZXMvM0RNb2RlbFByb3BlcnR5JztcclxuaW1wb3J0IHsgTWVkaWFQcm9wZXJ0eSB9IGZyb20gJy4uLy4uL3NyYy9wcm9wZXJ0aWVzL01lZGlhUHJvcGVydHknO1xyXG5cclxuLy8gTW9jayBjb21wbGV4IGRlcGVuZGVuY2llc1xyXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy92YXVsdC9VdGlscycsICgpID0+ICh7XHJcbiAgICBzZXRJY29uOiBqZXN0LmZuKClcclxufSkpO1xyXG5cclxuLy8gTW9jayBleHRlcm5hbCBkZXBlbmRlbmNpZXNcclxuKGdsb2JhbCBhcyBhbnkpLk5vdGljZSA9IGplc3QuZm4oKTtcclxuKGdsb2JhbCBhcyBhbnkpLnNlbGVjdE1lZGlhID0gamVzdC5mbigpO1xyXG4oZ2xvYmFsIGFzIGFueSkuc2hlbGwgPSB7XHJcbiAgICBvcGVuUGF0aDogamVzdC5mbigpXHJcbn07XHJcblxyXG4vLyBNb2NrIFRIUkVFLmpzIGRlcGVuZGVuY2llc1xyXG4oZ2xvYmFsIGFzIGFueSkuVEhSRUUgPSB7XHJcbiAgICBXZWJHTFJlbmRlcmVyOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgc2V0U2l6ZTogamVzdC5mbigpLFxyXG4gICAgICAgIGRvbUVsZW1lbnQ6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLFxyXG4gICAgICAgIHJlbmRlcjogamVzdC5mbigpXHJcbiAgICB9KSksXHJcbiAgICBTY2VuZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIGFkZDogamVzdC5mbigpXHJcbiAgICB9KSksXHJcbiAgICBQZXJzcGVjdGl2ZUNhbWVyYTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHBvc2l0aW9uOiB7IHNldDogamVzdC5mbigpIH0sXHJcbiAgICAgICAgdXA6IHsgc2V0OiBqZXN0LmZuKCkgfSxcclxuICAgICAgICBsb29rQXQ6IGplc3QuZm4oKVxyXG4gICAgfSkpLFxyXG4gICAgRGlyZWN0aW9uYWxMaWdodDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICAgIHBvc2l0aW9uOiB7IHNldDogamVzdC5mbigpIH0sXHJcbiAgICAgICAgdGFyZ2V0OiB7IHBvc2l0aW9uOiB7IHNldDogamVzdC5mbigpIH0gfVxyXG4gICAgfSkpLFxyXG4gICAgQW1iaWVudExpZ2h0OiBqZXN0LmZuKCksXHJcbiAgICBCb3gzOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgc2V0RnJvbU9iamVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgICAgZ2V0Q2VudGVyOiBqZXN0LmZuKCksXHJcbiAgICAgICAgZ2V0U2l6ZTogamVzdC5mbigpXHJcbiAgICB9KSksXHJcbiAgICBWZWN0b3IzOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgICAgc3ViOiBqZXN0LmZuKClcclxuICAgIH0pKVxyXG59O1xyXG5cclxuKGdsb2JhbCBhcyBhbnkpLkdMVEZMb2FkZXIgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICBsb2FkOiBqZXN0LmZuKClcclxufSkpO1xyXG5cclxuKGdsb2JhbCBhcyBhbnkpLk9yYml0Q29udHJvbHMgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICBlbmFibGVEYW1waW5nOiB0cnVlLFxyXG4gICAgZGFtcGluZ0ZhY3RvcjogMC4wNSxcclxuICAgIGVuYWJsZVpvb206IHRydWUsXHJcbiAgICBlbmFibGVQYW46IHRydWUsXHJcbiAgICBlbmFibGVSb3RhdGU6IHRydWUsXHJcbiAgICBtaW5Qb2xhckFuZ2xlOiAwLFxyXG4gICAgbWF4UG9sYXJBbmdsZTogTWF0aC5QSSxcclxuICAgIHRhcmdldDogeyBzZXQ6IGplc3QuZm4oKSB9LFxyXG4gICAgdXBkYXRlOiBqZXN0LmZuKClcclxufSkpO1xyXG5cclxuKGdsb2JhbCBhcyBhbnkpLkZyZWVjYWRGaWxlID0gamVzdC5mbigpO1xyXG5cclxuZGVzY3JpYmUoJ1RocmVlRE1vZGVsUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICBsZXQgcHJvcGVydHk6IFRocmVlRE1vZGVsUHJvcGVydHk7XHJcbiAgICBsZXQgbW9ja1ZhdWx0OiBhbnk7XHJcblxyXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAgICAgLy8gUmVzZXQgYWxsIG1vY2tzXHJcbiAgICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQ3JlYXRlIG1vY2sgdmF1bHRcclxuICAgICAgICBtb2NrVmF1bHQgPSB7XHJcbiAgICAgICAgICAgIGFwcDoge1xyXG4gICAgICAgICAgICAgICAgdmF1bHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBnZXRGaWxlczogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShbXSksXHJcbiAgICAgICAgICAgICAgICAgICAgYWRhcHRlcjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRSZXNvdXJjZVBhdGg6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJy9tb2NrL3BhdGgnKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZ2V0TWVkaWFGcm9tTGluazogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICBwYXRoOiAndGVzdC5nbGInLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogJ3Rlc3QuZ2xiJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHByb3BlcnR5ID0gbmV3IFRocmVlRE1vZGVsUHJvcGVydHkoJ3Rlc3QzZCcsIG1vY2tWYXVsdCwgbW9ja1ZhdWx0KTtcclxuICAgICAgICBwcm9wZXJ0eS52YXVsdCA9IG1vY2tWYXVsdDtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdDb25zdHJ1Y3RvcicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhIFRocmVlRE1vZGVsUHJvcGVydHkgd2l0aCBjb3JyZWN0IHR5cGUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0eS50eXBlKS50b0JlKCczZG1vZGVsJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaW5oZXJpdCBmcm9tIE1lZGlhUHJvcGVydHknLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0eSkudG9CZUluc3RhbmNlT2YoTWVkaWFQcm9wZXJ0eSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgc2V0IGRlZmF1bHQgaWNvbiB0byBib3gnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4cGVjdChwcm9wZXJ0eS5pY29uKS50b0JlKCdib3gnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdmaWxsRGlzcGxheSBtZXRob2QnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgM0QgbW9kZWwgZmlsZXMgKGdsdGYpJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBtb2NrVXBkYXRlID0gamVzdC5mbigpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja1ZhdWx0LmdldE1lZGlhRnJvbUxpbmsubW9ja1JldHVyblZhbHVlKHtcclxuICAgICAgICAgICAgICAgIHBhdGg6ICdtb2RlbC5nbHRmJyxcclxuICAgICAgICAgICAgICAgIG5hbWU6ICdtb2RlbC5nbHRmJ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG1vY2tWYXVsdC5hcHAudmF1bHQuZ2V0RmlsZXMubW9ja1JldHVyblZhbHVlKFtcclxuICAgICAgICAgICAgICAgIHsgcGF0aDogJ21vZGVsLmdsdGYnIH1cclxuICAgICAgICAgICAgXSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9wZXJ0eS5maWxsRGlzcGxheSgnW1ttb2RlbC5nbHRmXV0nLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVJbnN0YW5jZU9mKEhUTUxEaXZFbGVtZW50KTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jbGFzc0xpc3QuY29udGFpbnMoJ2VtYmVkLWNvbnRhaW5lcicpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSAzRCBtb2RlbCBmaWxlcyAoZ2xiKScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbW9ja1VwZGF0ZSA9IGplc3QuZm4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG1vY2tWYXVsdC5nZXRNZWRpYUZyb21MaW5rLm1vY2tSZXR1cm5WYWx1ZSh7XHJcbiAgICAgICAgICAgICAgICBwYXRoOiAnbW9kZWwuZ2xiJyxcclxuICAgICAgICAgICAgICAgIG5hbWU6ICdtb2RlbC5nbGInXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbW9ja1ZhdWx0LmFwcC52YXVsdC5nZXRGaWxlcy5tb2NrUmV0dXJuVmFsdWUoW1xyXG4gICAgICAgICAgICAgICAgeyBwYXRoOiAnbW9kZWwuZ2xiJyB9XHJcbiAgICAgICAgICAgIF0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJvcGVydHkuZmlsbERpc3BsYXkoJ1tbbW9kZWwuZ2xiXV0nLCBtb2NrVXBkYXRlKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVJbnN0YW5jZU9mKEhUTUxEaXZFbGVtZW50KTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5jbGFzc0xpc3QuY29udGFpbnMoJ2VtYmVkLWNvbnRhaW5lcicpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGZhbGxiYWNrIHRvIHBhcmVudCBNZWRpYVByb3BlcnR5IGZvciBub24tM0QgZmlsZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0TWVkaWFGcm9tTGluay5tb2NrUmV0dXJuVmFsdWUoe1xyXG4gICAgICAgICAgICAgICAgcGF0aDogJ2ltYWdlLnBuZycsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiAnaW1hZ2UucG5nJ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHByb3BlcnR5LmZpbGxEaXNwbGF5KCdbW2ltYWdlLnBuZ11dJywgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTaG91bGQgY2FsbCBwYXJlbnQgbWV0aG9kIGZvciBub24tM0QgZmlsZXNcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZUluc3RhbmNlT2YoSFRNTERpdkVsZW1lbnQpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXNzaW5nIG1lZGlhIGZpbGUnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tVcGRhdGUgPSBqZXN0LmZuKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBtb2NrVmF1bHQuZ2V0TWVkaWFGcm9tTGluay5tb2NrUmV0dXJuVmFsdWUobnVsbCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBwcm9wZXJ0eS5maWxsRGlzcGxheSgnW1ttaXNzaW5nLmdsYl1dJywgbW9ja1VwZGF0ZSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTaG91bGQgY2FsbCBwYXJlbnQgbWV0aG9kIHdoZW4gbWVkaWEgZmlsZSBub3QgZm91bmRcclxuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZUluc3RhbmNlT2YoSFRNTERpdkVsZW1lbnQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ3JlbmRlcjNETW9kZWwgbWV0aG9kJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGVycm9yIG1lc3NhZ2Ugd2hlbiBmaWxlIGRvZXMgbm90IGV4aXN0JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG1vY2tWYXVsdC5hcHAudmF1bHQuZ2V0RmlsZXMubW9ja1JldHVyblZhbHVlKFtdKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHByb3BlcnR5WydyZW5kZXIzRE1vZGVsJ10oJ21pc3NpbmcuZ2xiJywgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGV4cGVjdChjb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGVycm9yRGl2ID0gY29udGFpbmVyLmZpcnN0RWxlbWVudENoaWxkIGFzIEhUTUxEaXZFbGVtZW50O1xyXG4gICAgICAgICAgICBleHBlY3QoZXJyb3JEaXYudGV4dENvbnRlbnQpLnRvQ29udGFpbignUmVuZHUgM0QgaW50cm91dmFibGUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgY2FudmFzIHdoZW4gZmlsZSBleGlzdHMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbW9ja1ZhdWx0LmFwcC52YXVsdC5nZXRGaWxlcy5tb2NrUmV0dXJuVmFsdWUoW1xyXG4gICAgICAgICAgICAgICAgeyBwYXRoOiAndGVzdC5nbGInIH1cclxuICAgICAgICAgICAgXSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBwcm9wZXJ0eVsncmVuZGVyM0RNb2RlbCddKCd0ZXN0LmdsYicsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBleHBlY3QoY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ2NhbnZhcycpKS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcbiJdLCJ2ZXJzaW9uIjozfQ==