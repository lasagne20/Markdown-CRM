f1d0db7b67bd509ab75177390077dff3
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.LinkProperty = void 0;
const Property_1 = require("./Property");
const Utils_1 = require("../vault/Utils");
class LinkProperty extends Property_1.Property {
    constructor(name, args = { icon: "square-arrow-out-up-right" }) {
        super(name, args);
        this.type = "link";
    }
    createIconContainer(update) {
        const iconContainer = super.createIconContainer(update);
        iconContainer.style.cursor = "pointer";
        if (!this.static) {
            iconContainer.onclick = (event) => this.modifyField(event);
        }
        return iconContainer;
    }
    validate(url) {
        // Ajoute le préfixe "http://" si l'URL ne commence pas par http:// ou https://
        let fixedUrl = url.trim();
        // Si le lien ne commence pas par http:// ou https://, ajoute "http://"
        if (!/^https?:\/\//i.test(fixedUrl)) {
            fixedUrl = "http://" + fixedUrl;
        }
        const urlRegex = /^(https?:\/\/)?([a-zA-Z0-9_-]+\.)+[a-zA-Z]{2,6}(\/[a-zA-Z0-9_-]+)*\/?$/;
        if (!urlRegex.test(fixedUrl)) {
            return "";
        }
        return fixedUrl;
    }
    getPretty(value) {
        if (!value)
            return value;
        try {
            const urlObj = new URL(value);
            // Garde le domaine, puis les premiers segments du chemin si trop long
            let pretty = urlObj.hostname;
            if (urlObj.pathname && urlObj.pathname !== "/") {
                const segments = urlObj.pathname.split("/").filter(Boolean);
                if (segments.length > 2) {
                    pretty += "/" + segments.slice(0, 2).join("/") + "/...";
                }
                else {
                    pretty += urlObj.pathname;
                }
            }
            return pretty;
        }
        catch {
            // Si ce n'est pas une URL valide, retourne la valeur d'origine sans protocole
            return value.replace(/^https?:\/\//, "");
        }
    }
    // Fonction pour créer le lien de l'field
    createFieldLink(value) {
        const link = document.createElement("a");
        link.href = this.getLink(value);
        link.textContent = this.getPretty(value) || "";
        link.classList.add("field-link");
        link.oncontextmenu = (event) => {
            event.preventDefault();
            const value = link.textContent;
            if (value) {
                navigator.clipboard.writeText(value).then(() => {
                    (0, Utils_1.sendNotice)("Lien copié dans le presse-papiers");
                });
            }
        };
        return link;
    }
}
exports.LinkProperty = LinkProperty;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxsZW9kdVxcRG9jdW1lbnRzXFwxIC0gUHJvXFxUZXN0IHBsdWdpbiBvYnNpZGlhblxcLm9ic2lkaWFuXFxwbHVnaW5zXFxvYnNpZGlhbi1DUk1cXGR5bmFtaWMtZmllbGRzXFxzcmNcXHByb3BlcnRpZXNcXExpbmtQcm9wZXJ0eS50cyIsIm1hcHBpbmdzIjoiOzs7QUFDQSx5Q0FBc0M7QUFDdEMsMENBQXFEO0FBSXJELE1BQWEsWUFBYSxTQUFRLG1CQUFRO0lBSXhDLFlBQVksSUFBWSxFQUFFLE9BQXlCLEVBQUUsSUFBSSxFQUFFLDJCQUEyQixFQUFFO1FBQ3RGLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFIWCxTQUFJLEdBQVksTUFBTSxDQUFDO0lBSWhDLENBQUM7SUFFUSxtQkFBbUIsQ0FBQyxNQUF3QztRQUNuRSxNQUFNLGFBQWEsR0FBRyxLQUFLLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEQsYUFBYSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDO1FBRXZDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDakIsYUFBYSxDQUFDLE9BQU8sR0FBRyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3RCxDQUFDO1FBRUQsT0FBTyxhQUFhLENBQUM7SUFDdkIsQ0FBQztJQUdVLFFBQVEsQ0FBQyxHQUFXO1FBQzNCLCtFQUErRTtRQUMvRSxJQUFJLFFBQVEsR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFMUIsdUVBQXVFO1FBQ3ZFLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7WUFDbEMsUUFBUSxHQUFHLFNBQVMsR0FBRyxRQUFRLENBQUM7UUFDcEMsQ0FBQztRQUNELE1BQU0sUUFBUSxHQUFHLHdFQUF3RSxDQUFDO1FBQzFGLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7WUFDM0IsT0FBTyxFQUFFLENBQUM7UUFDZCxDQUFDO1FBQ0QsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUdRLFNBQVMsQ0FBQyxLQUFhO1FBQzlCLElBQUksQ0FBQyxLQUFLO1lBQUUsT0FBTyxLQUFLLENBQUM7UUFDekIsSUFBSSxDQUFDO1lBQ0gsTUFBTSxNQUFNLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDOUIsc0VBQXNFO1lBQ3RFLElBQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUM7WUFDN0IsSUFBSSxNQUFNLENBQUMsUUFBUSxJQUFJLE1BQU0sQ0FBQyxRQUFRLEtBQUssR0FBRyxFQUFFLENBQUM7Z0JBQy9DLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDNUQsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUN4QixNQUFNLElBQUksR0FBRyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUM7Z0JBQzFELENBQUM7cUJBQU0sQ0FBQztvQkFDTixNQUFNLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQztnQkFDNUIsQ0FBQztZQUNILENBQUM7WUFDRCxPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDO1FBQUMsTUFBTSxDQUFDO1lBQ1AsOEVBQThFO1lBQzlFLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDM0MsQ0FBQztJQUNILENBQUM7SUFFRCx5Q0FBeUM7SUFDaEMsZUFBZSxDQUFDLEtBQWE7UUFDcEMsTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUMvQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsS0FBSyxFQUFFLEVBQUU7WUFDN0IsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7WUFDL0IsSUFBSSxLQUFLLEVBQUUsQ0FBQztnQkFDVixTQUFTLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFO29CQUNqRCxJQUFBLGtCQUFVLEVBQUMsbUNBQW1DLENBQUMsQ0FBQztnQkFDOUMsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1FBQ0gsQ0FBQyxDQUFDO1FBQ0YsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0o7QUExRUQsb0NBMEVDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbGVvZHVcXERvY3VtZW50c1xcMSAtIFByb1xcVGVzdCBwbHVnaW4gb2JzaWRpYW5cXC5vYnNpZGlhblxccGx1Z2luc1xcb2JzaWRpYW4tQ1JNXFxkeW5hbWljLWZpZWxkc1xcc3JjXFxwcm9wZXJ0aWVzXFxMaW5rUHJvcGVydHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTXlWYXVsdCB9IGZyb20gXCIuLi92YXVsdC9NeVZhdWx0XCI7XHJcbmltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSBcIi4vUHJvcGVydHlcIjtcclxuaW1wb3J0IHsgc2V0SWNvbiwgc2VuZE5vdGljZSB9IGZyb20gXCIuLi92YXVsdC9VdGlsc1wiO1xyXG5cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgTGlua1Byb3BlcnR5IGV4dGVuZHMgUHJvcGVydHl7XHJcblxyXG4gIG92ZXJyaWRlIHR5cGUgOiBzdHJpbmcgPSBcImxpbmtcIjtcclxuXHJcbiAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCBhcmdzOiB7IGljb24/OiBzdHJpbmd9ID0geyBpY29uOiBcInNxdWFyZS1hcnJvdy1vdXQtdXAtcmlnaHRcIiB9KSB7XHJcbiAgICBzdXBlcihuYW1lLCBhcmdzKTtcclxuICB9XHJcblxyXG4gIG92ZXJyaWRlIGNyZWF0ZUljb25Db250YWluZXIodXBkYXRlOiAodmFsdWU6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPikge1xyXG4gICAgY29uc3QgaWNvbkNvbnRhaW5lciA9IHN1cGVyLmNyZWF0ZUljb25Db250YWluZXIodXBkYXRlKTtcclxuICAgIGljb25Db250YWluZXIuc3R5bGUuY3Vyc29yID0gXCJwb2ludGVyXCI7XHJcblxyXG4gICAgaWYgKCF0aGlzLnN0YXRpYykge1xyXG4gICAgICBpY29uQ29udGFpbmVyLm9uY2xpY2sgPSAoZXZlbnQpID0+IHRoaXMubW9kaWZ5RmllbGQoZXZlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBpY29uQ29udGFpbmVyO1xyXG4gIH1cclxuXHJcblxyXG4gICAgb3ZlcnJpZGUgdmFsaWRhdGUodXJsOiBzdHJpbmcpIHtcclxuICAgICAgLy8gQWpvdXRlIGxlIHByw6lmaXhlIFwiaHR0cDovL1wiIHNpIGwnVVJMIG5lIGNvbW1lbmNlIHBhcyBwYXIgaHR0cDovLyBvdSBodHRwczovL1xyXG4gICAgICBsZXQgZml4ZWRVcmwgPSB1cmwudHJpbSgpO1xyXG4gIFxyXG4gICAgICAvLyBTaSBsZSBsaWVuIG5lIGNvbW1lbmNlIHBhcyBwYXIgaHR0cDovLyBvdSBodHRwczovLywgYWpvdXRlIFwiaHR0cDovL1wiXHJcbiAgICAgIGlmICghL15odHRwcz86XFwvXFwvL2kudGVzdChmaXhlZFVybCkpIHtcclxuICAgICAgICAgIGZpeGVkVXJsID0gXCJodHRwOi8vXCIgKyBmaXhlZFVybDtcclxuICAgICAgfVxyXG4gICAgICBjb25zdCB1cmxSZWdleCA9IC9eKGh0dHBzPzpcXC9cXC8pPyhbYS16QS1aMC05Xy1dK1xcLikrW2EtekEtWl17Miw2fShcXC9bYS16QS1aMC05Xy1dKykqXFwvPyQvO1xyXG4gICAgICBpZiAoIXVybFJlZ2V4LnRlc3QoZml4ZWRVcmwpKSB7XHJcbiAgICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZml4ZWRVcmw7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIG92ZXJyaWRlIGdldFByZXR0eSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgIGlmICghdmFsdWUpIHJldHVybiB2YWx1ZTtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1cmxPYmogPSBuZXcgVVJMKHZhbHVlKTtcclxuICAgICAgICAvLyBHYXJkZSBsZSBkb21haW5lLCBwdWlzIGxlcyBwcmVtaWVycyBzZWdtZW50cyBkdSBjaGVtaW4gc2kgdHJvcCBsb25nXHJcbiAgICAgICAgbGV0IHByZXR0eSA9IHVybE9iai5ob3N0bmFtZTtcclxuICAgICAgICBpZiAodXJsT2JqLnBhdGhuYW1lICYmIHVybE9iai5wYXRobmFtZSAhPT0gXCIvXCIpIHtcclxuICAgICAgICAgIGNvbnN0IHNlZ21lbnRzID0gdXJsT2JqLnBhdGhuYW1lLnNwbGl0KFwiL1wiKS5maWx0ZXIoQm9vbGVhbik7XHJcbiAgICAgICAgICBpZiAoc2VnbWVudHMubGVuZ3RoID4gMikge1xyXG4gICAgICAgICAgICBwcmV0dHkgKz0gXCIvXCIgKyBzZWdtZW50cy5zbGljZSgwLCAyKS5qb2luKFwiL1wiKSArIFwiLy4uLlwiO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcHJldHR5ICs9IHVybE9iai5wYXRobmFtZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHByZXR0eTtcclxuICAgICAgfSBjYXRjaCB7XHJcbiAgICAgICAgLy8gU2kgY2Ugbidlc3QgcGFzIHVuZSBVUkwgdmFsaWRlLCByZXRvdXJuZSBsYSB2YWxldXIgZCdvcmlnaW5lIHNhbnMgcHJvdG9jb2xlXHJcbiAgICAgICAgcmV0dXJuIHZhbHVlLnJlcGxhY2UoL15odHRwcz86XFwvXFwvLywgXCJcIik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBGb25jdGlvbiBwb3VyIGNyw6llciBsZSBsaWVuIGRlIGwnZmllbGRcclxuICAgIG92ZXJyaWRlIGNyZWF0ZUZpZWxkTGluayh2YWx1ZTogc3RyaW5nKSA6IGFueSB7XHJcbiAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuICAgICAgbGluay5ocmVmID0gdGhpcy5nZXRMaW5rKHZhbHVlKTtcclxuICAgICAgbGluay50ZXh0Q29udGVudCA9IHRoaXMuZ2V0UHJldHR5KHZhbHVlKSB8fCBcIlwiO1xyXG4gICAgICBsaW5rLmNsYXNzTGlzdC5hZGQoXCJmaWVsZC1saW5rXCIpO1xyXG4gICAgICBsaW5rLm9uY29udGV4dG1lbnUgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gbGluay50ZXh0Q29udGVudDtcclxuICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KHZhbHVlKS50aGVuKCgpID0+IHtcclxuICAgICAgICBzZW5kTm90aWNlKFwiTGllbiBjb3Bpw6kgZGFucyBsZSBwcmVzc2UtcGFwaWVyc1wiKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgcmV0dXJuIGxpbms7XHJcbiAgICB9XHJcbn0iXSwidmVyc2lvbiI6M30=