{"file":"C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\vault\\Classe.ts","mappings":"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","names":[],"sources":["C:\\Users\\leodu\\Documents\\1 - Pro\\Test plugin obsidian\\.obsidian\\plugins\\obsidian-CRM\\dynamic-fields\\src\\vault\\Classe.ts"],"sourcesContent":["import { IFile } from '../interfaces/IApp';\r\nimport { Vault } from './Vault';\r\nimport { Property } from '../properties/Property';\r\nimport { File } from './File';\r\nimport { Data } from './Data';\r\n\r\nexport class Classe {\r\n    protected properties: Property[] = [];\r\n    protected file?: File;\r\n    public name: string = '';\r\n    public icon: string = '';\r\n    public template?: string;\r\n    public data : Data | null = null;\r\n    public displayConfig : any = {};\r\n    \r\n    constructor(protected vault: Vault, file ? : File, data ? : Data) {\r\n        if (file) {\r\n            this.setFile(file);\r\n        }\r\n        if (data) {\r\n            this.data = data;\r\n        }\r\n    }\r\n\r\n    getName(): string{ \r\n      return this.name\r\n    }\r\n    \r\n    // Property management\r\n    addProperty(property: Property): void {\r\n        this.properties.push(property);\r\n    }\r\n    \r\n    getProperty(name: string): Property | undefined {\r\n        return this.properties.find(p => p.name === name);\r\n    }\r\n    \r\n    getProperties(): Property[] {\r\n        return [...this.properties];\r\n    }\r\n    \r\n    // File operations\r\n    setFile(file: File): void {\r\n        this.file = file;\r\n    }\r\n    \r\n    getFile(): File | undefined {\r\n        return this.file;\r\n    }\r\n\r\n    getPath(): string | undefined {\r\n        return this.file?.getPath();\r\n    }\r\n    \r\n    async update(): Promise<void> {\r\n        if (!this.file) return;\r\n        \r\n        // Update metadata\r\n        await this.updateAllPropertiesMetadata();\r\n    }\r\n    \r\n    async validate(): Promise<boolean> {\r\n        // Validate all properties\r\n        for (const property of this.properties) {\r\n            const value = await this.getPropertyValue(property.name);\r\n            if (!property.validate(value)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    \r\n    \r\n    // Content generation helpers\r\n    protected async generateFrontMatter(): Promise<string> {\r\n        const metadata = await this.getMetadata();\r\n        const lines = ['---'];\r\n        \r\n        // Add class-specific metadata\r\n        if (this.name) metadata.type = this.name;\r\n        if (this.icon) metadata.icon = this.icon;\r\n        \r\n        // Add property values\r\n        for (const property of this.properties) {\r\n            const value = await this.getPropertyValue(property.name);\r\n            if (value !== undefined && value !== '') {\r\n                metadata[property.name] = value;\r\n            }\r\n        }\r\n        \r\n        // Convert to YAML\r\n        for (const [key, value] of Object.entries(metadata)) {\r\n            if (Array.isArray(value)) {\r\n                lines.push(`${key}:`);\r\n                value.forEach(item => lines.push(`  - ${item}`));\r\n            } else if (typeof value === 'object' && value !== null) {\r\n                lines.push(`${key}:`);\r\n                for (const [subKey, subValue] of Object.entries(value)) {\r\n                    lines.push(`  ${subKey}: ${subValue}`);\r\n                }\r\n            } else {\r\n                lines.push(`${key}: ${value}`);\r\n            }\r\n        }\r\n        \r\n        lines.push('---\\n');\r\n        return lines.join('\\n');\r\n    }\r\n    \r\n    protected async generateTemplateContent(): Promise<string> {\r\n        if (!this.template) return '';\r\n        \r\n        try {\r\n            return await this.vault.app.getTemplateContent(this.template);\r\n        } catch (error) {\r\n            console.warn(`Template ${this.template} not found`);\r\n            return '';\r\n        }\r\n    }\r\n    \r\n    // Metadata operations\r\n    async getMetadata(): Promise<Record<string, any>> {\r\n        if (!this.file) return {};\r\n        return await this.vault.app.getMetadata(this.file);\r\n    }\r\n    \r\n    async updateMetadata(metadata: Record<string, any>): Promise<void> {\r\n        if (!this.file) return;\r\n        await this.vault.app.updateMetadata(this.file, metadata);\r\n    }\r\n    \r\n    async getPropertyValue(propertyName: string): Promise<any> {\r\n        const metadata = await this.getMetadata();\r\n        return metadata[propertyName];\r\n    }\r\n    \r\n    async setPropertyValue(propertyName: string, value: any): Promise<void> {\r\n        const metadata = await this.getMetadata();\r\n        metadata[propertyName] = value;\r\n        await this.updateMetadata(metadata);\r\n    }\r\n    \r\n    private async updateAllPropertiesMetadata(): Promise<void> {\r\n        const metadata = await this.getMetadata();\r\n        let hasChanges = false;\r\n        \r\n        for (const property of this.properties) {\r\n            const currentValue = metadata[property.name];\r\n            const validatedValue = property.validate(currentValue);\r\n            \r\n            if (validatedValue !== currentValue) {\r\n                metadata[property.name] = validatedValue;\r\n                hasChanges = true;\r\n            }\r\n        }\r\n        \r\n        if (hasChanges) {\r\n            await this.updateMetadata(metadata);\r\n        }\r\n    }\r\n    \r\n    // Display methods\r\n    async getDisplay(): Promise<HTMLElement> {\r\n        const container = this.vault.app.createDiv('classe-display');\r\n        \r\n        // Add class header\r\n        const header = this.vault.app.createDiv('classe-header');\r\n        header.textContent = this.getName();\r\n        if (this.icon) {\r\n            this.vault.app.setIcon(header, this.icon);\r\n        }\r\n        container.appendChild(header);\r\n        \r\n        // Add properties\r\n        for (const property of this.properties) {\r\n            const value = await this.getPropertyValue(property.name);\r\n            const propertyDisplay = await property.getDisplay(this, value);\r\n            container.appendChild(propertyDisplay);\r\n        }\r\n        \r\n        return container;\r\n    }\r\n    \r\n    // Factory method for creating instances\r\n    static create(vault: Vault): Classe {\r\n        throw new Error('Must implement create method in subclass');\r\n    }\r\n    \r\n    // Utility methods\r\n    protected sanitizeFileName(name: string): string {\r\n        return name.replace(/[<>:\"/\\\\|?*]/g, '-').trim();\r\n    }\r\n    \r\n    protected async ensureFolder(folderPath: string): Promise<void> {\r\n        try {\r\n            await this.vault.app.createFolder(folderPath);\r\n        } catch (error) {\r\n            // Folder might already exist, which is fine\r\n        }\r\n    }\r\n    \r\n    // Lifecycle hooks\r\n    async onCreate(): Promise<void> {\r\n        // Override in subclasses for post-creation logic\r\n    }\r\n    \r\n    async onUpdate(): Promise<void> {\r\n        // Override in subclasses for post-update logic\r\n    }\r\n    \r\n    async onDelete(): Promise<void> {\r\n        // Override in subclasses for pre-deletion logic\r\n    }\r\n}\r\n"],"version":3}